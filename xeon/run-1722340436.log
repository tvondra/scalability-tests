+ set -e
+ LABEL=glibc-default
+ MACHINE=xeon
+ DBNAME=test
+ RUNS=1
+ DURATION=10
+ CLIENTS='1 16 32'
+ PARTITIONS='1000 100 1 0'
+ BUILDS=/mnt/data/builds
+ SOURCE=/mnt/data/postgres
+ PATH_OLD=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
++ date +%Y%m%d-%H%M
+ DATE=20240730-1353
++ pwd
+ PATCHES=/home/tomas/lock-scalability-test/patches
++ pwd
+ LOGS=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs
++ pwd
+ RESULTS=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results
+ DATADIR=/mnt/pgdata/data-test
+ ulimit -n 35000
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 01:53:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 01:53:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c7bb96ac22 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722340437
+ git checkout -b scalability-yes-32-1000-1000-1722340437
Switched to a new branch 'scalability-yes-32-1000-1000-1722340437'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722340437 d5dc06e20c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722340437 6ffffadf2a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 01:54:25 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 01:54:25 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-1000-1722340437 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 01:56:24 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 01:56:24 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6ffffadf2a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722340584
+ git checkout -b scalability-yes-0-1000-1000-1722340584
Switched to a new branch 'scalability-yes-0-1000-1000-1722340584'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722340584 9d71a6b899] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 01:56:52 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 01:56:52 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-1000-1722340584 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 01:58:50 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 01:58:50 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9d71a6b899 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722340730
+ git checkout -b scalability-yes-1-1000-1000-1722340730
Switched to a new branch 'scalability-yes-1-1000-1000-1722340730'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722340730 5201b5d289] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722340730 5d72400f04] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 01:59:19 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 01:59:19 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-1000-1722340730 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:01:18 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 02:01:18 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5d72400f04 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722340879
+ git checkout -b scalability-yes-1024-1000-1000-1722340879
Switched to a new branch 'scalability-yes-1024-1000-1000-1722340879'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722340879 0eb52a1088] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722340879 6bf855edc4] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:01:47 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:01:47 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-1000-1722340879 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:03:46 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 02:03:46 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6bf855edc4 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722341027
+ git checkout -b scalability-yes-8-1000-1000-1722341027
Switched to a new branch 'scalability-yes-8-1000-1000-1722341027'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722341027 92d79c812a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722341027 9d9c79d3ec] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:04:15 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:04:15 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-1000-1722341027 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:06:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 02:06:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9d9c79d3ec fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722341173
+ git checkout -b scalability-yes-512-1000-1000-1722341173
Switched to a new branch 'scalability-yes-512-1000-1000-1722341173'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722341173 a5459bc5ba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722341173 15165e4a3b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:06:42 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:06:42 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-1000-1722341173 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:08:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 02:08:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 15165e4a3b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722341324
+ git checkout -b scalability-yes-128-1000-1000-1722341324
Switched to a new branch 'scalability-yes-128-1000-1000-1722341324'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722341324 bac957a010] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722341324 f32f2fb7c2] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:09:12 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:09:12 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-1000-1722341324 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:11:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 02:11:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f32f2fb7c2 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722341473
+ git checkout -b scalability-no-32-1000-1000-1722341473
Switched to a new branch 'scalability-no-32-1000-1000-1722341473'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/32/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722341473 1fefb3d3cd] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:11:42 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:11:42 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-1000-1722341473 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:13:39 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 02:13:39 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1fefb3d3cd fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722341620
+ git checkout -b scalability-no-0-1000-1000-1722341620
Switched to a new branch 'scalability-no-0-1000-1000-1722341620'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:14:08 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:14:08 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-1000-1722341620 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:16:08 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 02:16:08 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722341768
+ git checkout -b scalability-no-1-1000-1000-1722341768
Switched to a new branch 'scalability-no-1-1000-1000-1722341768'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722341768 13ef66c15d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:16:36 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:16:36 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-1000-1722341768 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:18:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 02:18:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 13ef66c15d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722341915
+ git checkout -b scalability-no-1024-1000-1000-1722341915
Switched to a new branch 'scalability-no-1024-1000-1000-1722341915'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722341915 4ea4ecbf61] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:19:03 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:19:03 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-1000-1722341915 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:21:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 02:21:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4ea4ecbf61 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722342065
+ git checkout -b scalability-no-8-1000-1000-1722342065
Switched to a new branch 'scalability-no-8-1000-1000-1722342065'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722342065 f675123f51] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:21:34 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:21:34 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-1000-1722342065 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:23:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 02:23:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f675123f51 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722342215
+ git checkout -b scalability-no-512-1000-1000-1722342215
Switched to a new branch 'scalability-no-512-1000-1000-1722342215'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722342215 db30cdeb7f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:24:04 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:24:04 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-1000-1722342215 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:26:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 02:26:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at db30cdeb7f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722342364
+ git checkout -b scalability-no-128-1000-1000-1722342364
Switched to a new branch 'scalability-no-128-1000-1000-1722342364'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722342364 5d14dcf85a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:26:32 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:26:32 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-1000-1722342364 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:28:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 02:28:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5d14dcf85a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722342513
+ git checkout -b scalability-yes-32-1000-1000-1722342513
Switched to a new branch 'scalability-yes-32-1000-1000-1722342513'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722342513 d69c57ee2b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722342513 7bf9a2a132] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:29:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:29:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-1000-1722342513 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:30:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 02:30:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7bf9a2a132 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722342634
+ git checkout -b scalability-yes-0-1000-1000-1722342634
Switched to a new branch 'scalability-yes-0-1000-1000-1722342634'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722342634 2508e0cb4e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:31:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:31:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-1000-1722342634 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:32:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 02:32:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2508e0cb4e NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722342754
+ git checkout -b scalability-yes-1-1000-1000-1722342754
Switched to a new branch 'scalability-yes-1-1000-1000-1722342754'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722342754 1c16492132] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722342754 9691c8c1dc] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:33:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:33:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-1000-1722342754 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:34:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 02:34:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9691c8c1dc fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722342873
+ git checkout -b scalability-yes-1024-1000-1000-1722342873
Switched to a new branch 'scalability-yes-1024-1000-1000-1722342873'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722342873 38d03ef5ff] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722342873 98528cf773] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:35:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:35:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-1000-1722342873 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:36:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 02:36:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 98528cf773 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722342994
+ git checkout -b scalability-yes-8-1000-1000-1722342994
Switched to a new branch 'scalability-yes-8-1000-1000-1722342994'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722342994 fc521916a7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722342994 b4fdb268f5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:37:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:37:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-1000-1722342994 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:38:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 02:38:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b4fdb268f5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722343114
+ git checkout -b scalability-yes-512-1000-1000-1722343114
Switched to a new branch 'scalability-yes-512-1000-1000-1722343114'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722343114 9c83585653] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722343114 54d3449006] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:39:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:39:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-1000-1722343114 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:40:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 02:40:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 54d3449006 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722343233
+ git checkout -b scalability-yes-128-1000-1000-1722343233
Switched to a new branch 'scalability-yes-128-1000-1000-1722343233'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722343233 cfce1845dc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722343233 f24249a715] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:41:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:41:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-1000-1722343233 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:42:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 02:42:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f24249a715 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722343354
+ git checkout -b scalability-no-32-1000-1000-1722343354
Switched to a new branch 'scalability-no-32-1000-1000-1722343354'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722343354 70b8d456c4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:43:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:43:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-1000-1722343354 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:44:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 02:44:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 70b8d456c4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722343474
+ git checkout -b scalability-no-0-1000-1000-1722343474
Switched to a new branch 'scalability-no-0-1000-1000-1722343474'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:45:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:45:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-1000-1722343474 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:46:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 02:46:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722343594
+ git checkout -b scalability-no-1-1000-1000-1722343594
Switched to a new branch 'scalability-no-1-1000-1000-1722343594'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722343594 c247835140] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:47:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:47:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-1000-1722343594 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:48:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 02:48:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c247835140 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722343714
+ git checkout -b scalability-no-1024-1000-1000-1722343714
Switched to a new branch 'scalability-no-1024-1000-1000-1722343714'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722343714 b06ec299df] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:49:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:49:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-1000-1722343714 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:50:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 02:50:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b06ec299df fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722343834
+ git checkout -b scalability-no-8-1000-1000-1722343834
Switched to a new branch 'scalability-no-8-1000-1000-1722343834'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722343834 dcab865620] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:51:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:51:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-1000-1722343834 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:52:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 02:52:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dcab865620 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722343954
+ git checkout -b scalability-no-512-1000-1000-1722343954
Switched to a new branch 'scalability-no-512-1000-1000-1722343954'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722343954 15eaa411ab] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:53:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:53:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-1000-1722343954 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:54:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 02:54:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 15eaa411ab fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722344074
+ git checkout -b scalability-no-128-1000-1000-1722344074
Switched to a new branch 'scalability-no-128-1000-1000-1722344074'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722344074 cb1d807cb4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:55:03 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:55:03 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-1000-1722344074 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:56:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 02:56:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cb1d807cb4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722344194
+ git checkout -b scalability-yes-32-1000-1000-1722344194
Switched to a new branch 'scalability-yes-32-1000-1000-1722344194'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722344194 8f09d413ae] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722344194 3872414994] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:57:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:57:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-1000-1722344194 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 02:58:28 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 02:58:28 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3872414994 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722344308
+ git checkout -b scalability-yes-0-1000-1000-1722344308
Switched to a new branch 'scalability-yes-0-1000-1000-1722344308'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722344308 8faf3bef3e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 02:58:56 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 02:58:56 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-1000-1722344308 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:00:21 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 03:00:21 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8faf3bef3e NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722344421
+ git checkout -b scalability-yes-1-1000-1000-1722344421
Switched to a new branch 'scalability-yes-1-1000-1000-1722344421'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722344421 84972ff9ec] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722344421 94f2687907] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:00:49 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:00:49 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-1000-1722344421 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:02:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 03:02:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 94f2687907 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722344534
+ git checkout -b scalability-yes-1024-1000-1000-1722344534
Switched to a new branch 'scalability-yes-1024-1000-1000-1722344534'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722344534 a6b9562dcb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722344534 142c857f5a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:02:42 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:02:42 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-1000-1722344534 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:04:10 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 03:04:10 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 142c857f5a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722344650
+ git checkout -b scalability-yes-8-1000-1000-1722344650
Switched to a new branch 'scalability-yes-8-1000-1000-1722344650'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722344650 4a918e2a54] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722344650 a591bca5c7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:04:39 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:04:39 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-1000-1722344650 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:06:04 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 03:06:04 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a591bca5c7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722344764
+ git checkout -b scalability-yes-512-1000-1000-1722344764
Switched to a new branch 'scalability-yes-512-1000-1000-1722344764'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722344764 a029b49b6e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722344764 cdc127269d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:06:32 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:06:32 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-1000-1722344764 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:07:58 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 03:07:58 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cdc127269d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722344879
+ git checkout -b scalability-yes-128-1000-1000-1722344879
Switched to a new branch 'scalability-yes-128-1000-1000-1722344879'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722344879 2a76f0a646] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722344879 3579ce49d6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:08:27 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:08:27 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-1000-1722344879 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:09:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 03:09:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3579ce49d6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722344992
+ git checkout -b scalability-no-32-1000-1000-1722344992
Switched to a new branch 'scalability-no-32-1000-1000-1722344992'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722344992 d7e8f357a9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:10:20 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:10:20 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-1000-1722344992 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:11:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 03:11:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d7e8f357a9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722345105
+ git checkout -b scalability-no-0-1000-1000-1722345105
Switched to a new branch 'scalability-no-0-1000-1000-1722345105'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:12:13 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:12:13 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-1000-1722345105 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:13:38 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 03:13:38 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722345218
+ git checkout -b scalability-no-1-1000-1000-1722345218
Switched to a new branch 'scalability-no-1-1000-1000-1722345218'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722345218 eec3f17bb3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:14:06 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:14:06 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-1000-1722345218 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:15:30 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 03:15:30 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eec3f17bb3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722345331
+ git checkout -b scalability-no-1024-1000-1000-1722345331
Switched to a new branch 'scalability-no-1024-1000-1000-1722345331'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722345331 9904ac71dc] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:15:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:15:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-1000-1722345331 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:17:26 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 03:17:26 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9904ac71dc fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722345446
+ git checkout -b scalability-no-8-1000-1000-1722345446
Switched to a new branch 'scalability-no-8-1000-1000-1722345446'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722345446 695f04f192] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:17:53 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:17:53 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-1000-1722345446 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:19:19 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 03:19:19 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 695f04f192 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722345559
+ git checkout -b scalability-no-512-1000-1000-1722345559
Switched to a new branch 'scalability-no-512-1000-1000-1722345559'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722345559 5bd67d4615] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:19:47 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:19:47 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-1000-1722345559 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:21:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 03:21:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5bd67d4615 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722345673
+ git checkout -b scalability-no-128-1000-1000-1722345673
Switched to a new branch 'scalability-no-128-1000-1000-1722345673'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722345673 8f9e415873] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:21:41 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:21:41 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-1000-1722345673 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:23:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 03:23:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f9e415873 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722345787
+ git checkout -b scalability-yes-32-1000-1000-1722345787
Switched to a new branch 'scalability-yes-32-1000-1000-1722345787'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722345787 f498b8f84c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722345787 4613a1dbbd] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:23:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:23:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-1000-1722345787 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:24:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 03:24:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4613a1dbbd fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722345896
+ git checkout -b scalability-yes-0-1000-1000-1722345896
Switched to a new branch 'scalability-yes-0-1000-1000-1722345896'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722345896 5718f2c881] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:25:24 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:25:24 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-1000-1722345896 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:26:45 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 03:26:45 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5718f2c881 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722346005
+ git checkout -b scalability-yes-1-1000-1000-1722346005
Switched to a new branch 'scalability-yes-1-1000-1000-1722346005'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722346005 6f68e7261f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722346005 0d25b2ed25] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:27:13 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:27:13 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-1000-1722346005 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:28:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 03:28:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0d25b2ed25 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722346114
+ git checkout -b scalability-yes-1024-1000-1000-1722346114
Switched to a new branch 'scalability-yes-1024-1000-1000-1722346114'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722346114 79aeff2813] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722346114 9600e09d68] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:29:02 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:29:02 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-1000-1722346114 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:30:23 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 03:30:23 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9600e09d68 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722346223
+ git checkout -b scalability-yes-8-1000-1000-1722346223
Switched to a new branch 'scalability-yes-8-1000-1000-1722346223'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722346223 b0b12af3a2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722346223 6e89587f9b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:30:52 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:30:52 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-1000-1722346223 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:32:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 03:32:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6e89587f9b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722346333
+ git checkout -b scalability-yes-512-1000-1000-1722346333
Switched to a new branch 'scalability-yes-512-1000-1000-1722346333'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722346333 e017568fb0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722346333 648dbb9941] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:32:41 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:32:41 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-1000-1722346333 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:34:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 03:34:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 648dbb9941 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722346442
+ git checkout -b scalability-yes-128-1000-1000-1722346442
Switched to a new branch 'scalability-yes-128-1000-1000-1722346442'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722346442 f1ff9f388e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722346442 dda51d9c74] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:34:31 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:34:31 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-1000-1722346442 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:35:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 03:35:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dda51d9c74 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722346552
+ git checkout -b scalability-no-32-1000-1000-1722346552
Switched to a new branch 'scalability-no-32-1000-1000-1722346552'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722346552 61475685aa] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:36:21 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:36:21 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-1000-1722346552 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:37:42 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 03:37:42 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 61475685aa fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722346662
+ git checkout -b scalability-no-0-1000-1000-1722346662
Switched to a new branch 'scalability-no-0-1000-1000-1722346662'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:38:10 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:38:10 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-1000-1722346662 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:39:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 03:39:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722346772
+ git checkout -b scalability-no-1-1000-1000-1722346772
Switched to a new branch 'scalability-no-1-1000-1000-1722346772'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722346772 f7cbf4e55e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:40:00 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:40:00 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-1000-1722346772 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:41:22 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 03:41:22 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f7cbf4e55e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722346882
+ git checkout -b scalability-no-1024-1000-1000-1722346882
Switched to a new branch 'scalability-no-1024-1000-1000-1722346882'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722346882 4ee526f20d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:41:50 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:41:50 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-1000-1722346882 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:43:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 03:43:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4ee526f20d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722346992
+ git checkout -b scalability-no-8-1000-1000-1722346992
Switched to a new branch 'scalability-no-8-1000-1000-1722346992'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722346992 4a9e861a57] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:43:40 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:43:40 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-1000-1722346992 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:45:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 03:45:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4a9e861a57 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722347101
+ git checkout -b scalability-no-512-1000-1000-1722347101
Switched to a new branch 'scalability-no-512-1000-1000-1722347101'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722347101 8d135f1f47] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:45:30 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:45:30 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-1000-1722347101 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:46:51 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 03:46:51 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8d135f1f47 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722347211
+ git checkout -b scalability-no-128-1000-1000-1722347211
Switched to a new branch 'scalability-no-128-1000-1000-1722347211'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722347211 70cda81eed] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:47:19 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:47:19 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-1000-1722347211 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:48:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 03:48:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 70cda81eed fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722347320
+ git checkout -b scalability-yes-32-1000-1000-1722347320
Switched to a new branch 'scalability-yes-32-1000-1000-1722347320'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722347320 3e95734bcf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722347320 9c74cdd628] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:49:08 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:49:08 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-1000-1722347320 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:49:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 03:49:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9c74cdd628 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722347352
+ git checkout -b scalability-yes-0-1000-1000-1722347352
Switched to a new branch 'scalability-yes-0-1000-1000-1722347352'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722347352 b277341680] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:49:40 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:49:40 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-1000-1722347352 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:49:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 03:49:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b277341680 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722347384
+ git checkout -b scalability-yes-1-1000-1000-1722347384
Switched to a new branch 'scalability-yes-1-1000-1000-1722347384'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722347384 130d82c3ad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722347384 360f78e1b9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:50:13 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:50:13 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-1000-1722347384 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:50:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 03:50:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 360f78e1b9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722347416
+ git checkout -b scalability-yes-1024-1000-1000-1722347416
Switched to a new branch 'scalability-yes-1024-1000-1000-1722347416'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722347416 967033d4da] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722347416 7e0559b7bc] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:50:45 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:50:45 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-1000-1722347416 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:50:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 03:50:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7e0559b7bc fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722347448
+ git checkout -b scalability-yes-8-1000-1000-1722347448
Switched to a new branch 'scalability-yes-8-1000-1000-1722347448'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722347448 7f3e936986] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722347448 efbd9cc61a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:51:17 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:51:17 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-1000-1722347448 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:51:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 03:51:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at efbd9cc61a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722347480
+ git checkout -b scalability-yes-512-1000-1000-1722347480
Switched to a new branch 'scalability-yes-512-1000-1000-1722347480'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722347480 977bf761c1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722347480 5956605e90] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:51:49 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:51:49 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-1000-1722347480 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:51:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 03:51:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5956605e90 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722347512
+ git checkout -b scalability-yes-128-1000-1000-1722347512
Switched to a new branch 'scalability-yes-128-1000-1000-1722347512'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722347512 007904c208] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722347512 7dd5a9504b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:52:21 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:52:21 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-1000-1722347512 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:52:24 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 03:52:24 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7dd5a9504b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722347544
+ git checkout -b scalability-no-32-1000-1000-1722347544
Switched to a new branch 'scalability-no-32-1000-1000-1722347544'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722347544 27cace07a3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:52:53 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:52:53 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-1000-1722347544 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:52:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 03:52:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 27cace07a3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722347576
+ git checkout -b scalability-no-0-1000-1000-1722347576
Switched to a new branch 'scalability-no-0-1000-1000-1722347576'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:53:25 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:53:25 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-1000-1722347576 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:53:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 03:53:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722347608
+ git checkout -b scalability-no-1-1000-1000-1722347608
Switched to a new branch 'scalability-no-1-1000-1000-1722347608'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722347608 17560ff379] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:53:57 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:53:57 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-1000-1722347608 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:54:00 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 03:54:00 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 17560ff379 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722347640
+ git checkout -b scalability-no-1024-1000-1000-1722347640
Switched to a new branch 'scalability-no-1024-1000-1000-1722347640'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722347640 4fe6d5da34] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:54:29 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:54:29 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-1000-1722347640 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:54:32 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 03:54:32 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4fe6d5da34 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722347672
+ git checkout -b scalability-no-8-1000-1000-1722347672
Switched to a new branch 'scalability-no-8-1000-1000-1722347672'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722347672 5a7d1184db] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:55:01 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:55:01 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-1000-1722347672 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:55:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 03:55:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5a7d1184db fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722347704
+ git checkout -b scalability-no-512-1000-1000-1722347704
Switched to a new branch 'scalability-no-512-1000-1000-1722347704'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722347704 17f775b4c8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:55:32 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:55:32 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-1000-1722347704 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-1000
+ env
++ date
+ echo Tue Jul 30 03:55:36 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 03:55:36 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 17f775b4c8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722347736
+ git checkout -b scalability-no-128-1000-1000-1722347736
Switched to a new branch 'scalability-no-128-1000-1000-1722347736'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722347736 8e88b3721e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:56:05 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Tue Jul 30 03:56:05 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-1000-1722347736 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-100
+ env
++ date
+ echo Tue Jul 30 03:56:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 03:56:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8e88b3721e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722347768
+ git checkout -b scalability-yes-32-1000-100-1722347768
Switched to a new branch 'scalability-yes-32-1000-100-1722347768'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722347768 f0d03b6f34] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722347768 0ace4f7d9e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:56:37 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 03:56:37 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-100-1722347768 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-100
+ env
++ date
+ echo Tue Jul 30 03:57:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 03:57:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0ace4f7d9e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722347876
+ git checkout -b scalability-yes-0-1000-100-1722347876
Switched to a new branch 'scalability-yes-0-1000-100-1722347876'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722347876 ae1bfe2d50] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 03:58:25 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 03:58:25 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-100-1722347876 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-100
+ env
++ date
+ echo Tue Jul 30 03:59:45 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 03:59:45 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ae1bfe2d50 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722347985
+ git checkout -b scalability-yes-1-1000-100-1722347985
Switched to a new branch 'scalability-yes-1-1000-100-1722347985'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722347985 ec73a071d2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722347985 b50caa6300] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:00:13 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:00:13 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-100-1722347985 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 04:01:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 04:01:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b50caa6300 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722348093
+ git checkout -b scalability-yes-1024-1000-100-1722348093
Switched to a new branch 'scalability-yes-1024-1000-100-1722348093'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722348093 982a879252] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722348093 857462fd61] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:02:01 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:02:01 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-100-1722348093 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-100
+ env
++ date
+ echo Tue Jul 30 04:03:21 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 04:03:21 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 857462fd61 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722348201
+ git checkout -b scalability-yes-8-1000-100-1722348201
Switched to a new branch 'scalability-yes-8-1000-100-1722348201'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722348201 b5b3a4695f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722348201 27c2edd16b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:03:50 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:03:50 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-100-1722348201 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-100
+ env
++ date
+ echo Tue Jul 30 04:05:10 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 04:05:10 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 27c2edd16b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722348310
+ git checkout -b scalability-yes-512-1000-100-1722348310
Switched to a new branch 'scalability-yes-512-1000-100-1722348310'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722348310 3a191950ec] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722348310 01602e3bba] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:05:38 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:05:38 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-100-1722348310 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-100
+ env
++ date
+ echo Tue Jul 30 04:06:58 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 04:06:58 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 01602e3bba fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722348418
+ git checkout -b scalability-yes-128-1000-100-1722348418
Switched to a new branch 'scalability-yes-128-1000-100-1722348418'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722348418 df204f4528] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722348418 025f37089d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:07:26 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:07:26 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-100-1722348418 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-100
+ env
++ date
+ echo Tue Jul 30 04:08:46 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 04:08:46 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 025f37089d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722348526
+ git checkout -b scalability-no-32-1000-100-1722348526
Switched to a new branch 'scalability-no-32-1000-100-1722348526'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722348526 6f486051f9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:09:14 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:09:14 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-100-1722348526 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-100
+ env
++ date
+ echo Tue Jul 30 04:10:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 04:10:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6f486051f9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722348634
+ git checkout -b scalability-no-0-1000-100-1722348634
Switched to a new branch 'scalability-no-0-1000-100-1722348634'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:11:02 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:11:02 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-100-1722348634 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-100
+ env
++ date
+ echo Tue Jul 30 04:12:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 04:12:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722348741
+ git checkout -b scalability-no-1-1000-100-1722348741
Switched to a new branch 'scalability-no-1-1000-100-1722348741'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722348741 f86f636b45] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:12:49 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:12:49 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-100-1722348741 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 04:14:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 04:14:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f86f636b45 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722348849
+ git checkout -b scalability-no-1024-1000-100-1722348849
Switched to a new branch 'scalability-no-1024-1000-100-1722348849'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722348849 4fce5fa00c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:14:37 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:14:37 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-100-1722348849 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-100
+ env
++ date
+ echo Tue Jul 30 04:15:57 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 04:15:57 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4fce5fa00c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722348957
+ git checkout -b scalability-no-8-1000-100-1722348957
Switched to a new branch 'scalability-no-8-1000-100-1722348957'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722348957 6f9cda6b03] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:16:25 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:16:25 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-100-1722348957 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-100
+ env
++ date
+ echo Tue Jul 30 04:17:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 04:17:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6f9cda6b03 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722349064
+ git checkout -b scalability-no-512-1000-100-1722349064
Switched to a new branch 'scalability-no-512-1000-100-1722349064'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722349064 96c1d03e01] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:18:12 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:18:12 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-100-1722349064 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-100
+ env
++ date
+ echo Tue Jul 30 04:19:32 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 04:19:32 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 96c1d03e01 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722349172
+ git checkout -b scalability-no-128-1000-100-1722349172
Switched to a new branch 'scalability-no-128-1000-100-1722349172'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722349172 d67503d82b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:20:00 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:20:00 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-100-1722349172 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-100
+ env
++ date
+ echo Tue Jul 30 04:21:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 04:21:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d67503d82b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722349280
+ git checkout -b scalability-yes-32-1000-100-1722349280
Switched to a new branch 'scalability-yes-32-1000-100-1722349280'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722349280 d4a14775e1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722349280 6ff572d346] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:21:48 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:21:48 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-100-1722349280 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-100
+ env
++ date
+ echo Tue Jul 30 04:23:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 04:23:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6ff572d346 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722349389
+ git checkout -b scalability-yes-0-1000-100-1722349389
Switched to a new branch 'scalability-yes-0-1000-100-1722349389'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722349389 693a0d68bd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:23:36 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:23:36 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-100-1722349389 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-100
+ env
++ date
+ echo Tue Jul 30 04:24:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 04:24:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 693a0d68bd NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722349497
+ git checkout -b scalability-yes-1-1000-100-1722349497
Switched to a new branch 'scalability-yes-1-1000-100-1722349497'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722349497 ca3b2dae07] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722349497 d6d1337269] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:25:25 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:25:25 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-100-1722349497 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 04:26:46 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 04:26:46 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d6d1337269 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722349606
+ git checkout -b scalability-yes-1024-1000-100-1722349606
Switched to a new branch 'scalability-yes-1024-1000-100-1722349606'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722349606 11060d6a16] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722349606 1da75a0341] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:27:14 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:27:14 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-100-1722349606 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-100
+ env
++ date
+ echo Tue Jul 30 04:28:35 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 04:28:35 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1da75a0341 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722349715
+ git checkout -b scalability-yes-8-1000-100-1722349715
Switched to a new branch 'scalability-yes-8-1000-100-1722349715'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722349715 2c557398ef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722349715 b5dc5fd2e4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:29:03 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:29:03 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-100-1722349715 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-100
+ env
++ date
+ echo Tue Jul 30 04:30:23 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 04:30:23 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b5dc5fd2e4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722349824
+ git checkout -b scalability-yes-512-1000-100-1722349824
Switched to a new branch 'scalability-yes-512-1000-100-1722349824'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722349824 65921e46a4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722349824 b9c0b637b8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:30:51 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:30:51 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-100-1722349824 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-100
+ env
++ date
+ echo Tue Jul 30 04:32:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 04:32:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b9c0b637b8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722349932
+ git checkout -b scalability-yes-128-1000-100-1722349932
Switched to a new branch 'scalability-yes-128-1000-100-1722349932'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722349932 67f356a94b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722349932 11ba868a55] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:32:40 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:32:40 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-100-1722349932 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-100
+ env
++ date
+ echo Tue Jul 30 04:34:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 04:34:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 11ba868a55 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722350041
+ git checkout -b scalability-no-32-1000-100-1722350041
Switched to a new branch 'scalability-no-32-1000-100-1722350041'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722350041 8dd1b78e97] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:34:30 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:34:30 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-100-1722350041 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-100
+ env
++ date
+ echo Tue Jul 30 04:35:50 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 04:35:50 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8dd1b78e97 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722350151
+ git checkout -b scalability-no-0-1000-100-1722350151
Switched to a new branch 'scalability-no-0-1000-100-1722350151'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:36:19 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:36:19 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-100-1722350151 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-100
+ env
++ date
+ echo Tue Jul 30 04:37:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 04:37:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722350260
+ git checkout -b scalability-no-1-1000-100-1722350260
Switched to a new branch 'scalability-no-1-1000-100-1722350260'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722350260 4e2460fcf0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:38:08 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:38:08 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-100-1722350260 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 04:39:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 04:39:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4e2460fcf0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722350369
+ git checkout -b scalability-no-1024-1000-100-1722350369
Switched to a new branch 'scalability-no-1024-1000-100-1722350369'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722350369 c7e4ebe60f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:39:57 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:39:57 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-100-1722350369 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-100
+ env
++ date
+ echo Tue Jul 30 04:41:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 04:41:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c7e4ebe60f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722350477
+ git checkout -b scalability-no-8-1000-100-1722350477
Switched to a new branch 'scalability-no-8-1000-100-1722350477'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722350477 824534ae90] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:41:45 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:41:45 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-100-1722350477 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-100
+ env
++ date
+ echo Tue Jul 30 04:43:06 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 04:43:06 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 824534ae90 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722350586
+ git checkout -b scalability-no-512-1000-100-1722350586
Switched to a new branch 'scalability-no-512-1000-100-1722350586'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722350586 e6616ae4fc] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:43:34 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:43:34 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-100-1722350586 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-100
+ env
++ date
+ echo Tue Jul 30 04:44:55 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 04:44:55 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e6616ae4fc fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722350695
+ git checkout -b scalability-no-128-1000-100-1722350695
Switched to a new branch 'scalability-no-128-1000-100-1722350695'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722350695 a5950f5c5a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:45:23 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:45:23 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-100-1722350695 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-100
+ env
++ date
+ echo Tue Jul 30 04:46:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 04:46:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a5950f5c5a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722350804
+ git checkout -b scalability-yes-32-1000-100-1722350804
Switched to a new branch 'scalability-yes-32-1000-100-1722350804'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722350804 dcf469a506] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722350804 793b6f960e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:47:12 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:47:12 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-100-1722350804 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-100
+ env
++ date
+ echo Tue Jul 30 04:48:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 04:48:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 793b6f960e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722350907
+ git checkout -b scalability-yes-0-1000-100-1722350907
Switched to a new branch 'scalability-yes-0-1000-100-1722350907'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722350907 d9c1f3fd9d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:48:55 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:48:55 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-100-1722350907 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-100
+ env
++ date
+ echo Tue Jul 30 04:50:09 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 04:50:09 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d9c1f3fd9d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722351009
+ git checkout -b scalability-yes-1-1000-100-1722351009
Switched to a new branch 'scalability-yes-1-1000-100-1722351009'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722351009 67ecd7b626] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722351009 d77e8b592b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:50:38 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:50:38 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-100-1722351009 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 04:51:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 04:51:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d77e8b592b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722351113
+ git checkout -b scalability-yes-1024-1000-100-1722351113
Switched to a new branch 'scalability-yes-1024-1000-100-1722351113'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722351113 e6979b5d56] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722351113 559379b4b9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:52:21 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:52:21 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-100-1722351113 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-100
+ env
++ date
+ echo Tue Jul 30 04:53:35 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 04:53:35 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 559379b4b9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722351216
+ git checkout -b scalability-yes-8-1000-100-1722351216
Switched to a new branch 'scalability-yes-8-1000-100-1722351216'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722351216 01ba5f29e0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722351216 6aae723487] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:54:04 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:54:04 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-100-1722351216 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-100
+ env
++ date
+ echo Tue Jul 30 04:55:18 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 04:55:18 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6aae723487 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722351318
+ git checkout -b scalability-yes-512-1000-100-1722351318
Switched to a new branch 'scalability-yes-512-1000-100-1722351318'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722351318 f521c3d090] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722351318 ba3fda1b4e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:55:47 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:55:47 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-100-1722351318 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-100
+ env
++ date
+ echo Tue Jul 30 04:57:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 04:57:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ba3fda1b4e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722351422
+ git checkout -b scalability-yes-128-1000-100-1722351422
Switched to a new branch 'scalability-yes-128-1000-100-1722351422'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722351422 3711e5f98a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722351422 b791a44dc9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:57:30 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:57:30 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-100-1722351422 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-100
+ env
++ date
+ echo Tue Jul 30 04:58:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 04:58:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b791a44dc9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722351525
+ git checkout -b scalability-no-32-1000-100-1722351525
Switched to a new branch 'scalability-no-32-1000-100-1722351525'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722351525 bb9e9d29f7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 04:59:13 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 04:59:13 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-100-1722351525 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-100
+ env
++ date
+ echo Tue Jul 30 05:00:27 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 05:00:27 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bb9e9d29f7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722351627
+ git checkout -b scalability-no-0-1000-100-1722351627
Switched to a new branch 'scalability-no-0-1000-100-1722351627'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:00:55 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:00:55 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-100-1722351627 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-100
+ env
++ date
+ echo Tue Jul 30 05:02:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 05:02:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722351730
+ git checkout -b scalability-no-1-1000-100-1722351730
Switched to a new branch 'scalability-no-1-1000-100-1722351730'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722351730 ff782f9f5f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:02:38 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:02:38 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-100-1722351730 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 05:03:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 05:03:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ff782f9f5f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722351832
+ git checkout -b scalability-no-1024-1000-100-1722351832
Switched to a new branch 'scalability-no-1024-1000-100-1722351832'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722351832 ac33a6fccf] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:04:20 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:04:20 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-100-1722351832 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-100
+ env
++ date
+ echo Tue Jul 30 05:05:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 05:05:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac33a6fccf fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722351936
+ git checkout -b scalability-no-8-1000-100-1722351936
Switched to a new branch 'scalability-no-8-1000-100-1722351936'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722351936 bc36cec897] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:06:03 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:06:03 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-100-1722351936 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-100
+ env
++ date
+ echo Tue Jul 30 05:07:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 05:07:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bc36cec897 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722352038
+ git checkout -b scalability-no-512-1000-100-1722352038
Switched to a new branch 'scalability-no-512-1000-100-1722352038'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722352038 ff86310276] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:07:46 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:07:46 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-100-1722352038 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-100
+ env
++ date
+ echo Tue Jul 30 05:09:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 05:09:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ff86310276 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722352141
+ git checkout -b scalability-no-128-1000-100-1722352141
Switched to a new branch 'scalability-no-128-1000-100-1722352141'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722352141 370b144ace] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:09:28 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:09:28 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-100-1722352141 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-100
+ env
++ date
+ echo Tue Jul 30 05:10:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 05:10:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 370b144ace fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722352243
+ git checkout -b scalability-yes-32-1000-100-1722352243
Switched to a new branch 'scalability-yes-32-1000-100-1722352243'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722352243 8a103893c5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722352243 299c889708] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:11:11 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:11:11 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-100-1722352243 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-100
+ env
++ date
+ echo Tue Jul 30 05:12:27 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 05:12:27 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 299c889708 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722352347
+ git checkout -b scalability-yes-0-1000-100-1722352347
Switched to a new branch 'scalability-yes-0-1000-100-1722352347'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722352347 fd63186608] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:12:55 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:12:55 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-100-1722352347 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-100
+ env
++ date
+ echo Tue Jul 30 05:14:11 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 05:14:11 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fd63186608 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722352451
+ git checkout -b scalability-yes-1-1000-100-1722352451
Switched to a new branch 'scalability-yes-1-1000-100-1722352451'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722352451 ef39f849cc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722352451 cbf8539ea6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:14:39 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:14:39 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-100-1722352451 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 05:15:54 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 05:15:54 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cbf8539ea6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722352555
+ git checkout -b scalability-yes-1024-1000-100-1722352555
Switched to a new branch 'scalability-yes-1024-1000-100-1722352555'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722352555 83ccb284e3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722352555 cbc1ef42b5] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:16:23 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:16:23 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-100-1722352555 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-100
+ env
++ date
+ echo Tue Jul 30 05:17:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 05:17:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cbc1ef42b5 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722352659
+ git checkout -b scalability-yes-8-1000-100-1722352659
Switched to a new branch 'scalability-yes-8-1000-100-1722352659'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722352659 47940a1b08] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722352659 50939c9ed3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:18:07 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:18:07 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-100-1722352659 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-100
+ env
++ date
+ echo Tue Jul 30 05:19:22 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 05:19:22 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 50939c9ed3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722352763
+ git checkout -b scalability-yes-512-1000-100-1722352763
Switched to a new branch 'scalability-yes-512-1000-100-1722352763'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722352763 6946cac14f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722352763 c99d461e39] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:19:51 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:19:51 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-100-1722352763 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-100
+ env
++ date
+ echo Tue Jul 30 05:21:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 05:21:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c99d461e39 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722352867
+ git checkout -b scalability-yes-128-1000-100-1722352867
Switched to a new branch 'scalability-yes-128-1000-100-1722352867'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722352867 4523d7f7f3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722352867 3dcee8fe83] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:21:35 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:21:35 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-100-1722352867 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-100
+ env
++ date
+ echo Tue Jul 30 05:22:50 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 05:22:50 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3dcee8fe83 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722352970
+ git checkout -b scalability-no-32-1000-100-1722352970
Switched to a new branch 'scalability-no-32-1000-100-1722352970'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722352970 6bc5b53802] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:23:19 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:23:19 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-100-1722352970 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-100
+ env
++ date
+ echo Tue Jul 30 05:24:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 05:24:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6bc5b53802 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722353074
+ git checkout -b scalability-no-0-1000-100-1722353074
Switched to a new branch 'scalability-no-0-1000-100-1722353074'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:25:03 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:25:03 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-100-1722353074 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-100
+ env
++ date
+ echo Tue Jul 30 05:26:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 05:26:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722353179
+ git checkout -b scalability-no-1-1000-100-1722353179
Switched to a new branch 'scalability-no-1-1000-100-1722353179'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722353179 938cc49778] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:26:47 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:26:47 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-100-1722353179 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 05:28:03 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 05:28:03 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 938cc49778 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722353283
+ git checkout -b scalability-no-1024-1000-100-1722353283
Switched to a new branch 'scalability-no-1024-1000-100-1722353283'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722353283 cf6b827050] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:28:31 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:28:31 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-100-1722353283 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-100
+ env
++ date
+ echo Tue Jul 30 05:29:47 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 05:29:47 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cf6b827050 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722353387
+ git checkout -b scalability-no-8-1000-100-1722353387
Switched to a new branch 'scalability-no-8-1000-100-1722353387'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722353387 8166874cc4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:30:15 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:30:15 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-100-1722353387 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-100
+ env
++ date
+ echo Tue Jul 30 05:31:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 05:31:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8166874cc4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722353491
+ git checkout -b scalability-no-512-1000-100-1722353491
Switched to a new branch 'scalability-no-512-1000-100-1722353491'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722353491 a4a8cea61f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:31:59 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:31:59 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-100-1722353491 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-100
+ env
++ date
+ echo Tue Jul 30 05:33:15 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 05:33:15 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a4a8cea61f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722353595
+ git checkout -b scalability-no-128-1000-100-1722353595
Switched to a new branch 'scalability-no-128-1000-100-1722353595'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722353595 0ad38bba3a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:33:43 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:33:43 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-100-1722353595 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-100
+ env
++ date
+ echo Tue Jul 30 05:34:58 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 05:34:58 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0ad38bba3a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722353698
+ git checkout -b scalability-yes-32-1000-100-1722353698
Switched to a new branch 'scalability-yes-32-1000-100-1722353698'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722353698 dee528dea7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722353698 dfe314e254] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:35:26 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:35:26 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-100-1722353698 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-100
+ env
++ date
+ echo Tue Jul 30 05:53:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 05:53:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dfe314e254 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722354821
+ git checkout -b scalability-yes-0-1000-100-1722354821
Switched to a new branch 'scalability-yes-0-1000-100-1722354821'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722354821 73dd0528bb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 05:54:09 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 05:54:09 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-100-1722354821 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-100
+ env
++ date
+ echo Tue Jul 30 06:12:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 06:12:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 73dd0528bb NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722355939
+ git checkout -b scalability-yes-1-1000-100-1722355939
Switched to a new branch 'scalability-yes-1-1000-100-1722355939'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722355939 9c1dde05d3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722355939 7735d59d37] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 06:12:47 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 06:12:47 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-100-1722355939 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 06:30:58 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 06:30:58 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7735d59d37 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722357058
+ git checkout -b scalability-yes-1024-1000-100-1722357058
Switched to a new branch 'scalability-yes-1024-1000-100-1722357058'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722357058 a2368f5c3e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722357058 e7741f2364] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 06:31:26 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 06:31:26 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-100-1722357058 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-100
+ env
++ date
+ echo Tue Jul 30 06:49:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 06:49:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e7741f2364 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722358197
+ git checkout -b scalability-yes-8-1000-100-1722358197
Switched to a new branch 'scalability-yes-8-1000-100-1722358197'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722358197 d509aa4dcf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722358197 e69f39d7ed] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 06:50:25 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 06:50:25 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-100-1722358197 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-100
+ env
++ date
+ echo Tue Jul 30 07:08:45 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 07:08:45 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e69f39d7ed fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722359325
+ git checkout -b scalability-yes-512-1000-100-1722359325
Switched to a new branch 'scalability-yes-512-1000-100-1722359325'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722359325 3481bd38b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722359325 0b9b0e4144] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 07:09:13 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 07:09:13 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-100-1722359325 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-100
+ env
++ date
+ echo Tue Jul 30 07:27:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 07:27:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0b9b0e4144 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722360453
+ git checkout -b scalability-yes-128-1000-100-1722360453
Switched to a new branch 'scalability-yes-128-1000-100-1722360453'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722360453 a4d3d91035] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722360453 848d1c5de9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 07:28:01 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 07:28:01 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-100-1722360453 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-100
+ env
++ date
+ echo Tue Jul 30 07:46:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 07:46:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 848d1c5de9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722361581
+ git checkout -b scalability-no-32-1000-100-1722361581
Switched to a new branch 'scalability-no-32-1000-100-1722361581'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722361581 0389396e7f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 07:46:49 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 07:46:49 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-100-1722361581 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-100
+ env
++ date
+ echo Tue Jul 30 08:05:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 08:05:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0389396e7f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722362707
+ git checkout -b scalability-no-0-1000-100-1722362707
Switched to a new branch 'scalability-no-0-1000-100-1722362707'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 08:05:35 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 08:05:35 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-100-1722362707 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-100
+ env
++ date
+ echo Tue Jul 30 08:23:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 08:23:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722363829
+ git checkout -b scalability-no-1-1000-100-1722363829
Switched to a new branch 'scalability-no-1-1000-100-1722363829'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722363829 63005390b3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 08:24:17 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 08:24:17 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-100-1722363829 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-100
+ env
++ date
+ echo Tue Jul 30 08:42:38 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 08:42:38 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 63005390b3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722364958
+ git checkout -b scalability-no-1024-1000-100-1722364958
Switched to a new branch 'scalability-no-1024-1000-100-1722364958'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722364958 19796f145f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 08:43:06 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 08:43:06 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-100-1722364958 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-100
+ env
++ date
+ echo Tue Jul 30 09:01:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 09:01:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 19796f145f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722366093
+ git checkout -b scalability-no-8-1000-100-1722366093
Switched to a new branch 'scalability-no-8-1000-100-1722366093'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722366093 d84b8a51d1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 09:02:01 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 09:02:01 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-100-1722366093 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-100
+ env
++ date
+ echo Tue Jul 30 09:20:16 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 09:20:16 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d84b8a51d1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722367216
+ git checkout -b scalability-no-512-1000-100-1722367216
Switched to a new branch 'scalability-no-512-1000-100-1722367216'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722367216 735733f35e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 09:20:44 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 09:20:44 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-100-1722367216 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-100
+ env
++ date
+ echo Tue Jul 30 09:39:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 09:39:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 735733f35e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722368354
+ git checkout -b scalability-no-128-1000-100-1722368354
Switched to a new branch 'scalability-no-128-1000-100-1722368354'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722368354 048816515d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 09:39:42 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Tue Jul 30 09:39:42 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-100-1722368354 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-1
+ env
++ date
+ echo Tue Jul 30 09:57:59 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 09:57:59 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 048816515d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722369479
+ git checkout -b scalability-yes-32-1000-1-1722369479
Switched to a new branch 'scalability-yes-32-1000-1-1722369479'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722369479 55285ebb4f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722369479 4db6beee1d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 09:58:52 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 09:58:52 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-1-1722369479 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-1
+ env
++ date
+ echo Tue Jul 30 10:00:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 10:00:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4db6beee1d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722369608
+ git checkout -b scalability-yes-0-1000-1-1722369608
Switched to a new branch 'scalability-yes-0-1000-1-1722369608'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722369608 7ae33549e9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:00:59 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:00:59 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-1-1722369608 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-1
+ env
++ date
+ echo Tue Jul 30 10:02:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 10:02:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7ae33549e9 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722369734
+ git checkout -b scalability-yes-1-1000-1-1722369734
Switched to a new branch 'scalability-yes-1-1000-1-1722369734'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722369734 a211a34862] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722369734 6a086b4fd2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:03:06 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:03:06 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-1-1722369734 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 10:04:21 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 10:04:21 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6a086b4fd2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722369861
+ git checkout -b scalability-yes-1024-1000-1-1722369861
Switched to a new branch 'scalability-yes-1024-1000-1-1722369861'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722369861 90025c092a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722369861 42a2b405b5] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:05:12 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:05:12 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-1-1722369861 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-1
+ env
++ date
+ echo Tue Jul 30 10:06:27 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 10:06:27 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 42a2b405b5 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722369987
+ git checkout -b scalability-yes-8-1000-1-1722369987
Switched to a new branch 'scalability-yes-8-1000-1-1722369987'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722369987 aa39774125] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722369987 e010510bbe] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:07:19 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:07:19 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-1-1722369987 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-1
+ env
++ date
+ echo Tue Jul 30 10:08:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 10:08:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e010510bbe fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722370114
+ git checkout -b scalability-yes-512-1000-1-1722370114
Switched to a new branch 'scalability-yes-512-1000-1-1722370114'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722370114 7d47bd0051] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722370114 0efe00c052] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:09:26 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:09:26 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-1-1722370114 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-1
+ env
++ date
+ echo Tue Jul 30 10:10:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 10:10:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0efe00c052 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722370241
+ git checkout -b scalability-yes-128-1000-1-1722370241
Switched to a new branch 'scalability-yes-128-1000-1-1722370241'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722370241 cc8f8624bf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722370241 03b36616c0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:11:34 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:11:34 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-1-1722370241 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-1
+ env
++ date
+ echo Tue Jul 30 10:12:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 10:12:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 03b36616c0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722370369
+ git checkout -b scalability-no-32-1000-1-1722370369
Switched to a new branch 'scalability-no-32-1000-1-1722370369'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722370369 0b6d269ba9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:13:41 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:13:41 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-1-1722370369 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-1
+ env
++ date
+ echo Tue Jul 30 10:14:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 10:14:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0b6d269ba9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722370496
+ git checkout -b scalability-no-0-1000-1-1722370496
Switched to a new branch 'scalability-no-0-1000-1-1722370496'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:15:48 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:15:48 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-1-1722370496 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-1
+ env
++ date
+ echo Tue Jul 30 10:17:02 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 10:17:02 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722370622
+ git checkout -b scalability-no-1-1000-1-1722370622
Switched to a new branch 'scalability-no-1-1000-1-1722370622'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722370622 640ff65328] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:17:55 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:17:55 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-1-1722370622 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 10:19:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 10:19:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 640ff65328 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722370750
+ git checkout -b scalability-no-1024-1000-1-1722370750
Switched to a new branch 'scalability-no-1024-1000-1-1722370750'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722370750 75d79fbe8d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:20:02 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:20:02 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-1-1722370750 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-1
+ env
++ date
+ echo Tue Jul 30 10:21:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 10:21:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 75d79fbe8d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722370877
+ git checkout -b scalability-no-8-1000-1-1722370877
Switched to a new branch 'scalability-no-8-1000-1-1722370877'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722370877 65cf3518c6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:22:09 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:22:09 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-1-1722370877 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-1
+ env
++ date
+ echo Tue Jul 30 10:23:24 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 10:23:24 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65cf3518c6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722371004
+ git checkout -b scalability-no-512-1000-1-1722371004
Switched to a new branch 'scalability-no-512-1000-1-1722371004'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722371004 552e0b5e25] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:24:16 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:24:16 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-1-1722371004 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-1
+ env
++ date
+ echo Tue Jul 30 10:25:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 10:25:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 552e0b5e25 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722371131
+ git checkout -b scalability-no-128-1000-1-1722371131
Switched to a new branch 'scalability-no-128-1000-1-1722371131'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722371131 f5dc81e379] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:26:24 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:26:24 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-1-1722371131 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-1
+ env
++ date
+ echo Tue Jul 30 10:27:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 10:27:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f5dc81e379 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722371259
+ git checkout -b scalability-yes-32-1000-1-1722371259
Switched to a new branch 'scalability-yes-32-1000-1-1722371259'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722371259 277483d135] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722371259 da06316673] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:28:07 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:28:07 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-1-1722371259 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-1
+ env
++ date
+ echo Tue Jul 30 10:29:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 10:29:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at da06316673 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722371366
+ git checkout -b scalability-yes-0-1000-1-1722371366
Switched to a new branch 'scalability-yes-0-1000-1-1722371366'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722371366 4a94bc45b8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:29:54 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:29:54 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-1-1722371366 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-1
+ env
++ date
+ echo Tue Jul 30 10:31:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 10:31:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4a94bc45b8 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722371473
+ git checkout -b scalability-yes-1-1000-1-1722371473
Switched to a new branch 'scalability-yes-1-1000-1-1722371473'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722371473 93c40890b6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722371473 4a1141e0b4] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:31:42 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:31:42 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-1-1722371473 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 10:33:01 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 10:33:01 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4a1141e0b4 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722371581
+ git checkout -b scalability-yes-1024-1000-1-1722371581
Switched to a new branch 'scalability-yes-1024-1000-1-1722371581'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722371581 75f1d44cfa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722371581 d22e130edd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:33:30 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:33:30 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-1-1722371581 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-1
+ env
++ date
+ echo Tue Jul 30 10:34:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 10:34:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d22e130edd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722371689
+ git checkout -b scalability-yes-8-1000-1-1722371689
Switched to a new branch 'scalability-yes-8-1000-1-1722371689'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722371689 dd8286371d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722371689 27f8e2f8a9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:35:17 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:35:17 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-1-1722371689 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-1
+ env
++ date
+ echo Tue Jul 30 10:36:36 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 10:36:36 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 27f8e2f8a9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722371796
+ git checkout -b scalability-yes-512-1000-1-1722371796
Switched to a new branch 'scalability-yes-512-1000-1-1722371796'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722371796 79a1b271f5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722371796 e2a370e290] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:37:04 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:37:04 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-1-1722371796 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-1
+ env
++ date
+ echo Tue Jul 30 10:38:23 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 10:38:23 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e2a370e290 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722371904
+ git checkout -b scalability-yes-128-1000-1-1722371904
Switched to a new branch 'scalability-yes-128-1000-1-1722371904'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722371904 3dbd39b914] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722371904 e13374d4d5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:38:52 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:38:52 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-1-1722371904 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-1
+ env
++ date
+ echo Tue Jul 30 10:40:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 10:40:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e13374d4d5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722372011
+ git checkout -b scalability-no-32-1000-1-1722372011
Switched to a new branch 'scalability-no-32-1000-1-1722372011'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722372011 c9bbfde5e0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:40:39 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:40:39 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-1-1722372011 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-1
+ env
++ date
+ echo Tue Jul 30 10:41:58 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 10:41:58 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c9bbfde5e0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722372119
+ git checkout -b scalability-no-0-1000-1-1722372119
Switched to a new branch 'scalability-no-0-1000-1-1722372119'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:42:27 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:42:27 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-1-1722372119 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-1
+ env
++ date
+ echo Tue Jul 30 10:43:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 10:43:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722372226
+ git checkout -b scalability-no-1-1000-1-1722372226
Switched to a new branch 'scalability-no-1-1000-1-1722372226'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722372226 afe27ad63e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:44:14 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:44:14 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-1-1722372226 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 10:45:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 10:45:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at afe27ad63e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722372333
+ git checkout -b scalability-no-1024-1000-1-1722372333
Switched to a new branch 'scalability-no-1024-1000-1-1722372333'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722372333 fe7fab0d54] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:46:01 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:46:01 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-1-1722372333 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-1
+ env
++ date
+ echo Tue Jul 30 10:47:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 10:47:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fe7fab0d54 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722372441
+ git checkout -b scalability-no-8-1000-1-1722372441
Switched to a new branch 'scalability-no-8-1000-1-1722372441'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722372441 c470e8a0ba] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:47:49 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:47:49 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-1-1722372441 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-1
+ env
++ date
+ echo Tue Jul 30 10:49:08 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 10:49:08 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c470e8a0ba fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722372548
+ git checkout -b scalability-no-512-1000-1-1722372548
Switched to a new branch 'scalability-no-512-1000-1-1722372548'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722372548 7a8e919454] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:49:37 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:49:37 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-1-1722372548 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-1
+ env
++ date
+ echo Tue Jul 30 10:50:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 10:50:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7a8e919454 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722372656
+ git checkout -b scalability-no-128-1000-1-1722372656
Switched to a new branch 'scalability-no-128-1000-1-1722372656'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722372656 3f39cf430c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:51:24 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:51:24 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-1-1722372656 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-1
+ env
++ date
+ echo Tue Jul 30 10:52:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 10:52:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3f39cf430c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722372763
+ git checkout -b scalability-yes-32-1000-1-1722372763
Switched to a new branch 'scalability-yes-32-1000-1-1722372763'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722372763 eee16f00dd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722372763 015b2ef659] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:53:12 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:53:12 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-1-1722372763 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-1
+ env
++ date
+ echo Tue Jul 30 10:54:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 10:54:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 015b2ef659 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722372866
+ git checkout -b scalability-yes-0-1000-1-1722372866
Switched to a new branch 'scalability-yes-0-1000-1-1722372866'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722372866 65e49ccb99] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:54:54 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:54:54 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-1-1722372866 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-1
+ env
++ date
+ echo Tue Jul 30 10:56:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 10:56:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65e49ccb99 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722372967
+ git checkout -b scalability-yes-1-1000-1-1722372967
Switched to a new branch 'scalability-yes-1-1000-1-1722372967'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722372967 ea47e67111] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722372967 e2f545d0e5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:56:36 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:56:36 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-1-1722372967 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 10:57:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 10:57:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e2f545d0e5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722373070
+ git checkout -b scalability-yes-1024-1000-1-1722373070
Switched to a new branch 'scalability-yes-1024-1000-1-1722373070'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722373070 61bec51ee9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722373070 9495991854] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 10:58:19 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 10:58:19 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-1-1722373070 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-1
+ env
++ date
+ echo Tue Jul 30 10:59:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 10:59:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9495991854 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722373173
+ git checkout -b scalability-yes-8-1000-1-1722373173
Switched to a new branch 'scalability-yes-8-1000-1-1722373173'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722373173 56fdb9c268] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722373173 03a594baae] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:00:01 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:00:01 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-1-1722373173 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-1
+ env
++ date
+ echo Tue Jul 30 11:01:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 11:01:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 03a594baae fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722373274
+ git checkout -b scalability-yes-512-1000-1-1722373274
Switched to a new branch 'scalability-yes-512-1000-1-1722373274'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722373274 cf258ece4c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722373274 d911f42b48] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:01:43 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:01:43 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-1-1722373274 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-1
+ env
++ date
+ echo Tue Jul 30 11:02:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 11:02:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d911f42b48 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722373376
+ git checkout -b scalability-yes-128-1000-1-1722373376
Switched to a new branch 'scalability-yes-128-1000-1-1722373376'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722373376 69ffb2ffcf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722373376 f5d7d2779e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:03:25 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:03:25 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-1-1722373376 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-1
+ env
++ date
+ echo Tue Jul 30 11:04:39 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 11:04:39 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f5d7d2779e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722373479
+ git checkout -b scalability-no-32-1000-1-1722373479
Switched to a new branch 'scalability-no-32-1000-1-1722373479'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722373479 136671d5d2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:05:07 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:05:07 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-1-1722373479 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-1
+ env
++ date
+ echo Tue Jul 30 11:06:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 11:06:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 136671d5d2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722373581
+ git checkout -b scalability-no-0-1000-1-1722373581
Switched to a new branch 'scalability-no-0-1000-1-1722373581'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:06:49 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:06:49 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-1-1722373581 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-1
+ env
++ date
+ echo Tue Jul 30 11:08:03 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 11:08:03 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722373683
+ git checkout -b scalability-no-1-1000-1-1722373683
Switched to a new branch 'scalability-no-1-1000-1-1722373683'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722373683 c002f30f9b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:08:31 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:08:31 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-1-1722373683 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 11:09:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 11:09:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c002f30f9b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722373785
+ git checkout -b scalability-no-1024-1000-1-1722373785
Switched to a new branch 'scalability-no-1024-1000-1-1722373785'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722373785 68c0108033] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:10:13 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:10:13 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-1-1722373785 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-1
+ env
++ date
+ echo Tue Jul 30 11:11:27 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 11:11:27 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 68c0108033 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722373887
+ git checkout -b scalability-no-8-1000-1-1722373887
Switched to a new branch 'scalability-no-8-1000-1-1722373887'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722373887 58123d906d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:11:55 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:11:55 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-1-1722373887 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-1
+ env
++ date
+ echo Tue Jul 30 11:13:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 11:13:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 58123d906d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722373989
+ git checkout -b scalability-no-512-1000-1-1722373989
Switched to a new branch 'scalability-no-512-1000-1-1722373989'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722373989 2f88f730bc] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:13:37 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:13:37 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-1-1722373989 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-1
+ env
++ date
+ echo Tue Jul 30 11:14:51 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 11:14:51 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f88f730bc fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722374091
+ git checkout -b scalability-no-128-1000-1-1722374091
Switched to a new branch 'scalability-no-128-1000-1-1722374091'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722374091 66a26c1da1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:15:19 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:15:19 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-1-1722374091 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-1
+ env
++ date
+ echo Tue Jul 30 11:16:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 11:16:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 66a26c1da1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722374193
+ git checkout -b scalability-yes-32-1000-1-1722374193
Switched to a new branch 'scalability-yes-32-1000-1-1722374193'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722374193 473922c276] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722374193 28e497fbb8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:17:02 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:17:02 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-1-1722374193 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-1
+ env
++ date
+ echo Tue Jul 30 11:18:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 11:18:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 28e497fbb8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722374297
+ git checkout -b scalability-yes-0-1000-1-1722374297
Switched to a new branch 'scalability-yes-0-1000-1-1722374297'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722374297 a59457b3e0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:18:45 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:18:45 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-1-1722374297 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-1
+ env
++ date
+ echo Tue Jul 30 11:19:59 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 11:19:59 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a59457b3e0 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722374400
+ git checkout -b scalability-yes-1-1000-1-1722374400
Switched to a new branch 'scalability-yes-1-1000-1-1722374400'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722374400 e3db13cffc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722374400 a8af500aeb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:20:27 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:20:27 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-1-1722374400 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 11:21:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 11:21:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a8af500aeb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722374502
+ git checkout -b scalability-yes-1024-1000-1-1722374502
Switched to a new branch 'scalability-yes-1024-1000-1-1722374502'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722374502 b51f2a0320] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722374502 e864cab75d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:22:11 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:22:11 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-1-1722374502 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-1
+ env
++ date
+ echo Tue Jul 30 11:23:25 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 11:23:25 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e864cab75d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722374605
+ git checkout -b scalability-yes-8-1000-1-1722374605
Switched to a new branch 'scalability-yes-8-1000-1-1722374605'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722374605 f6ffd29d61] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722374605 2c7df75f73] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:23:54 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:23:54 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-1-1722374605 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-1
+ env
++ date
+ echo Tue Jul 30 11:25:09 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 11:25:09 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2c7df75f73 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722374709
+ git checkout -b scalability-yes-512-1000-1-1722374709
Switched to a new branch 'scalability-yes-512-1000-1-1722374709'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722374709 2cc433674e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722374709 ac57829688] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:25:37 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:25:37 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-1-1722374709 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-1
+ env
++ date
+ echo Tue Jul 30 11:26:51 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 11:26:51 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac57829688 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722374812
+ git checkout -b scalability-yes-128-1000-1-1722374812
Switched to a new branch 'scalability-yes-128-1000-1-1722374812'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722374812 9dde5c2101] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722374812 c1a1639d3a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:27:19 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:27:19 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-1-1722374812 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-1
+ env
++ date
+ echo Tue Jul 30 11:28:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 11:28:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c1a1639d3a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722374914
+ git checkout -b scalability-no-32-1000-1-1722374914
Switched to a new branch 'scalability-no-32-1000-1-1722374914'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722374914 3ae9d32cd1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:29:03 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:29:03 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-1-1722374914 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-1
+ env
++ date
+ echo Tue Jul 30 11:30:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 11:30:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3ae9d32cd1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722375017
+ git checkout -b scalability-no-0-1000-1-1722375017
Switched to a new branch 'scalability-no-0-1000-1-1722375017'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:30:45 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:30:45 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-1-1722375017 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-1
+ env
++ date
+ echo Tue Jul 30 11:32:00 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue Jul 30 11:32:00 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722375120
+ git checkout -b scalability-no-1-1000-1-1722375120
Switched to a new branch 'scalability-no-1-1000-1-1722375120'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722375120 06df742f6f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:32:28 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:32:28 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-1-1722375120 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 11:33:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue Jul 30 11:33:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 06df742f6f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722375223
+ git checkout -b scalability-no-1024-1000-1-1722375223
Switched to a new branch 'scalability-no-1024-1000-1-1722375223'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722375223 41ec348ee1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:34:11 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:34:11 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-1-1722375223 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-1
+ env
++ date
+ echo Tue Jul 30 11:35:26 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue Jul 30 11:35:26 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 41ec348ee1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722375326
+ git checkout -b scalability-no-8-1000-1-1722375326
Switched to a new branch 'scalability-no-8-1000-1-1722375326'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722375326 c1706a8d0b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:35:54 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:35:54 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-1-1722375326 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-1
+ env
++ date
+ echo Tue Jul 30 11:37:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue Jul 30 11:37:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c1706a8d0b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722375429
+ git checkout -b scalability-no-512-1000-1-1722375429
Switched to a new branch 'scalability-no-512-1000-1-1722375429'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722375429 ad95036c90] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:37:38 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:37:38 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-1-1722375429 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-1
+ env
++ date
+ echo Tue Jul 30 11:38:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue Jul 30 11:38:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ad95036c90 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722375532
+ git checkout -b scalability-no-128-1000-1-1722375532
Switched to a new branch 'scalability-no-128-1000-1-1722375532'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722375532 eb797a5744] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:39:20 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:39:20 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-1-1722375532 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-1
+ env
++ date
+ echo Tue Jul 30 11:40:35 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue Jul 30 11:40:35 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eb797a5744 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722375635
+ git checkout -b scalability-yes-32-1000-1-1722375635
Switched to a new branch 'scalability-yes-32-1000-1-1722375635'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722375635 c5ec23b16d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722375635 b0fd95879f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:41:03 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:41:03 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-1-1722375635 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-1
+ env
++ date
+ echo Tue Jul 30 11:42:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue Jul 30 11:42:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b0fd95879f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722375773
+ git checkout -b scalability-yes-0-1000-1-1722375773
Switched to a new branch 'scalability-yes-0-1000-1-1722375773'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722375773 2aff2cc24a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:43:21 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:43:21 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-1-1722375773 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-1
+ env
++ date
+ echo Tue Jul 30 11:45:10 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue Jul 30 11:45:10 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2aff2cc24a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722375911
+ git checkout -b scalability-yes-1-1000-1-1722375911
Switched to a new branch 'scalability-yes-1-1000-1-1722375911'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722375911 a1f1cb9277] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722375911 a973f8d20e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:45:39 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:45:39 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-1-1722375911 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-1
+ env
++ date
+ echo Tue Jul 30 11:47:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue Jul 30 11:47:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a973f8d20e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722376050
+ git checkout -b scalability-yes-1024-1000-1-1722376050
Switched to a new branch 'scalability-yes-1024-1000-1-1722376050'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722376050 9abb205437] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722376050 1bcdbca3be] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:47:58 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:47:58 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-1-1722376050 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-1
+ env
++ date
+ echo Tue Jul 30 11:49:47 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue Jul 30 11:49:47 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1bcdbca3be fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722376187
+ git checkout -b scalability-yes-8-1000-1-1722376187
Switched to a new branch 'scalability-yes-8-1000-1-1722376187'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722376187 869040460e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722376187 81f5ba7418] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:50:16 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:50:16 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-1-1722376187 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-1
+ env
++ date
+ echo Tue Jul 30 11:52:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue Jul 30 11:52:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 81f5ba7418 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722376325
+ git checkout -b scalability-yes-512-1000-1-1722376325
Switched to a new branch 'scalability-yes-512-1000-1-1722376325'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722376325 eced1c2b15] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722376325 3352e3eabc] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:52:34 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:52:34 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-1-1722376325 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-1
+ env
++ date
+ echo Tue Jul 30 11:54:24 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue Jul 30 11:54:24 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3352e3eabc fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722376464
+ git checkout -b scalability-yes-128-1000-1-1722376464
Switched to a new branch 'scalability-yes-128-1000-1-1722376464'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722376464 06ccf177e1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722376464 c497ee245b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:54:53 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:54:53 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-1-1722376464 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-1
+ env
++ date
+ echo Tue Jul 30 11:56:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue Jul 30 11:56:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c497ee245b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722376603
+ git checkout -b scalability-no-32-1000-1-1722376603
Switched to a new branch 'scalability-no-32-1000-1-1722376603'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722376603 1e2df27f04] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:57:11 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:57:11 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-1-1722376603 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-1
+ env
++ date
+ echo Tue Jul 30 11:59:02 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue Jul 30 11:59:02 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1e2df27f04 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722376742
+ git checkout -b scalability-no-0-1000-1-1722376742
Switched to a new branch 'scalability-no-0-1000-1-1722376742'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Tue Jul 30 11:59:30 PM CEST 2024 'RUN   files: 1000  partitions: 1'
Tue Jul 30 11:59:30 PM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-1-1722376742 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-1
+ env
++ date
+ echo Wed Jul 31 12:01:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 12:01:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722376879
+ git checkout -b scalability-no-1-1000-1-1722376879
Switched to a new branch 'scalability-no-1-1000-1-1722376879'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722376879 1248028b5d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:01:48 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Wed Jul 31 12:01:48 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-1-1722376879 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-1
+ env
++ date
+ echo Wed Jul 31 12:03:38 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 12:03:38 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1248028b5d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722377018
+ git checkout -b scalability-no-1024-1000-1-1722377018
Switched to a new branch 'scalability-no-1024-1000-1-1722377018'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722377018 68f76321d1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:04:07 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Wed Jul 31 12:04:07 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-1-1722377018 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-1
+ env
++ date
+ echo Wed Jul 31 12:05:57 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 12:05:57 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 68f76321d1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722377158
+ git checkout -b scalability-no-8-1000-1-1722377158
Switched to a new branch 'scalability-no-8-1000-1-1722377158'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722377158 3d918f5f7c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:06:26 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Wed Jul 31 12:06:26 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-1-1722377158 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-1
+ env
++ date
+ echo Wed Jul 31 12:08:15 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 12:08:15 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3d918f5f7c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722377295
+ git checkout -b scalability-no-512-1000-1-1722377295
Switched to a new branch 'scalability-no-512-1000-1-1722377295'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722377295 11824222f4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:08:44 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Wed Jul 31 12:08:44 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-1-1722377295 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-1
+ env
++ date
+ echo Wed Jul 31 12:10:33 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 12:10:33 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 11824222f4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722377434
+ git checkout -b scalability-no-128-1000-1-1722377434
Switched to a new branch 'scalability-no-128-1000-1-1722377434'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722377434 92f8c019ad] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:11:02 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Wed Jul 31 12:11:02 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-1-1722377434 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-1000-0
+ env
++ date
+ echo Wed Jul 31 12:12:52 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 12:12:52 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 92f8c019ad fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722377572
+ git checkout -b scalability-yes-32-1000-0-1722377572
Switched to a new branch 'scalability-yes-32-1000-0-1722377572'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722377572 21926eeed9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722377572 d67ae12ded] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:13:46 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:13:46 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-0-1722377572 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-1000-0
+ env
++ date
+ echo Wed Jul 31 12:15:00 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 12:15:00 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d67ae12ded fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722377700
+ git checkout -b scalability-yes-0-1000-0-1722377700
Switched to a new branch 'scalability-yes-0-1000-0-1722377700'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722377700 406a71367b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:15:53 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:15:53 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-0-1722377700 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-1000-0
+ env
++ date
+ echo Wed Jul 31 12:17:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 12:17:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 406a71367b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722377827
+ git checkout -b scalability-yes-1-1000-0-1722377827
Switched to a new branch 'scalability-yes-1-1000-0-1722377827'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722377827 82ad2fb2ff] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722377827 c7f93a9d59] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:18:00 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:18:00 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-0-1722377827 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 12:19:14 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 12:19:14 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c7f93a9d59 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722377954
+ git checkout -b scalability-yes-1024-1000-0-1722377954
Switched to a new branch 'scalability-yes-1024-1000-0-1722377954'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722377954 20f9686bba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722377954 368217b533] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:20:07 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:20:07 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-0-1722377954 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-1000-0
+ env
++ date
+ echo Wed Jul 31 12:21:22 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 12:21:22 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 368217b533 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722378082
+ git checkout -b scalability-yes-8-1000-0-1722378082
Switched to a new branch 'scalability-yes-8-1000-0-1722378082'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722378082 44e9f219ca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722378082 0763360bef] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:22:14 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:22:14 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-0-1722378082 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-1000-0
+ env
++ date
+ echo Wed Jul 31 12:23:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 12:23:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0763360bef fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722378209
+ git checkout -b scalability-yes-512-1000-0-1722378209
Switched to a new branch 'scalability-yes-512-1000-0-1722378209'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722378209 83e78b4299] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722378209 bc5a59fbf0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:24:22 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:24:22 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-0-1722378209 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-1000-0
+ env
++ date
+ echo Wed Jul 31 12:25:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 12:25:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bc5a59fbf0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722378337
+ git checkout -b scalability-yes-128-1000-0-1722378337
Switched to a new branch 'scalability-yes-128-1000-0-1722378337'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722378337 1252f31347] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722378337 5f2cf38cd0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:26:29 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:26:29 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-0-1722378337 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-1000-0
+ env
++ date
+ echo Wed Jul 31 12:27:44 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 12:27:44 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5f2cf38cd0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722378464
+ git checkout -b scalability-no-32-1000-0-1722378464
Switched to a new branch 'scalability-no-32-1000-0-1722378464'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722378464 36a95f0c70] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:28:36 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:28:36 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-0-1722378464 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-1000-0
+ env
++ date
+ echo Wed Jul 31 12:29:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 12:29:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 36a95f0c70 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722378591
+ git checkout -b scalability-no-0-1000-0-1722378591
Switched to a new branch 'scalability-no-0-1000-0-1722378591'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:30:43 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:30:43 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-0-1722378591 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-1000-0
+ env
++ date
+ echo Wed Jul 31 12:31:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 12:31:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722378718
+ git checkout -b scalability-no-1-1000-0-1722378718
Switched to a new branch 'scalability-no-1-1000-0-1722378718'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722378718 91b3fbaaec] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:32:51 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:32:51 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-0-1722378718 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 12:34:06 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 12:34:06 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 91b3fbaaec fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722378846
+ git checkout -b scalability-no-1024-1000-0-1722378846
Switched to a new branch 'scalability-no-1024-1000-0-1722378846'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722378846 f8eae18632] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:34:58 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:34:58 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-0-1722378846 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-1000-0
+ env
++ date
+ echo Wed Jul 31 12:36:13 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 12:36:13 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f8eae18632 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722378973
+ git checkout -b scalability-no-8-1000-0-1722378973
Switched to a new branch 'scalability-no-8-1000-0-1722378973'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722378973 aa920b5314] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:37:06 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:37:06 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-0-1722378973 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-1000-0
+ env
++ date
+ echo Wed Jul 31 12:38:20 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 12:38:20 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at aa920b5314 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722379100
+ git checkout -b scalability-no-512-1000-0-1722379100
Switched to a new branch 'scalability-no-512-1000-0-1722379100'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722379100 3a328eab00] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:39:12 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:39:12 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-0-1722379100 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-1000-0
+ env
++ date
+ echo Wed Jul 31 12:40:27 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 12:40:27 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3a328eab00 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722379227
+ git checkout -b scalability-no-128-1000-0-1722379227
Switched to a new branch 'scalability-no-128-1000-0-1722379227'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722379227 fb0dcedf37] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:41:19 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:41:19 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-0-1722379227 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-1000-0
+ env
++ date
+ echo Wed Jul 31 12:42:34 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 12:42:34 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fb0dcedf37 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722379354
+ git checkout -b scalability-yes-32-1000-0-1722379354
Switched to a new branch 'scalability-yes-32-1000-0-1722379354'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722379354 9ae15d8f5d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722379354 ddb91c885d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:43:03 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:43:03 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-0-1722379354 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-1000-0
+ env
++ date
+ echo Wed Jul 31 12:44:21 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 12:44:21 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ddb91c885d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722379462
+ git checkout -b scalability-yes-0-1000-0-1722379462
Switched to a new branch 'scalability-yes-0-1000-0-1722379462'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722379462 31a31a0507] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:44:50 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:44:50 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-0-1722379462 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-1000-0
+ env
++ date
+ echo Wed Jul 31 12:46:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 12:46:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 31a31a0507 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722379569
+ git checkout -b scalability-yes-1-1000-0-1722379569
Switched to a new branch 'scalability-yes-1-1000-0-1722379569'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722379569 64fa4df7b8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722379569 3c73b41560] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:46:37 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:46:37 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-0-1722379569 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 12:47:56 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 12:47:56 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3c73b41560 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722379676
+ git checkout -b scalability-yes-1024-1000-0-1722379676
Switched to a new branch 'scalability-yes-1024-1000-0-1722379676'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722379676 3d850c8be0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722379676 1295db15bc] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:48:25 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:48:25 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-0-1722379676 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-1000-0
+ env
++ date
+ echo Wed Jul 31 12:49:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 12:49:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1295db15bc fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722379783
+ git checkout -b scalability-yes-8-1000-0-1722379783
Switched to a new branch 'scalability-yes-8-1000-0-1722379783'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722379783 fa49e00155] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722379783 82127a8028] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:50:12 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:50:12 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-0-1722379783 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-1000-0
+ env
++ date
+ echo Wed Jul 31 12:51:30 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 12:51:30 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 82127a8028 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722379891
+ git checkout -b scalability-yes-512-1000-0-1722379891
Switched to a new branch 'scalability-yes-512-1000-0-1722379891'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722379891 9fab3c94e7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722379891 68cfe8b1a2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:51:58 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:51:58 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-0-1722379891 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-1000-0
+ env
++ date
+ echo Wed Jul 31 12:53:17 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 12:53:17 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 68cfe8b1a2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722379997
+ git checkout -b scalability-yes-128-1000-0-1722379997
Switched to a new branch 'scalability-yes-128-1000-0-1722379997'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722379997 b73bd4afb6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722379997 fe4133afbb] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:53:46 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:53:46 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-0-1722379997 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-1000-0
+ env
++ date
+ echo Wed Jul 31 12:55:04 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 12:55:04 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fe4133afbb fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722380104
+ git checkout -b scalability-no-32-1000-0-1722380104
Switched to a new branch 'scalability-no-32-1000-0-1722380104'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722380104 1aa80d0ad5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:55:32 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:55:32 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-0-1722380104 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-1000-0
+ env
++ date
+ echo Wed Jul 31 12:56:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 12:56:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1aa80d0ad5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722380211
+ git checkout -b scalability-no-0-1000-0-1722380211
Switched to a new branch 'scalability-no-0-1000-0-1722380211'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:57:19 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:57:19 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-0-1722380211 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-1000-0
+ env
++ date
+ echo Wed Jul 31 12:58:38 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 12:58:38 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722380318
+ git checkout -b scalability-no-1-1000-0-1722380318
Switched to a new branch 'scalability-no-1-1000-0-1722380318'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722380318 9a05155ee3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:59:06 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 12:59:06 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-0-1722380318 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 01:00:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 01:00:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9a05155ee3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722380425
+ git checkout -b scalability-no-1024-1000-0-1722380425
Switched to a new branch 'scalability-no-1024-1000-0-1722380425'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722380425 b74bd3a36a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:00:54 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:00:54 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-0-1722380425 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-1000-0
+ env
++ date
+ echo Wed Jul 31 01:02:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 01:02:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b74bd3a36a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722380532
+ git checkout -b scalability-no-8-1000-0-1722380532
Switched to a new branch 'scalability-no-8-1000-0-1722380532'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722380532 d7f685121e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:02:41 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:02:41 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-0-1722380532 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-1000-0
+ env
++ date
+ echo Wed Jul 31 01:03:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 01:03:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d7f685121e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722380639
+ git checkout -b scalability-no-512-1000-0-1722380639
Switched to a new branch 'scalability-no-512-1000-0-1722380639'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722380639 ea3612a4ec] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:04:28 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:04:28 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-0-1722380639 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-1000-0
+ env
++ date
+ echo Wed Jul 31 01:05:47 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 01:05:47 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ea3612a4ec fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722380748
+ git checkout -b scalability-no-128-1000-0-1722380748
Switched to a new branch 'scalability-no-128-1000-0-1722380748'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722380748 771b4e543f] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:06:16 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:06:16 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-0-1722380748 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-1000-0
+ env
++ date
+ echo Wed Jul 31 01:07:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 01:07:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 771b4e543f fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722380855
+ git checkout -b scalability-yes-32-1000-0-1722380855
Switched to a new branch 'scalability-yes-32-1000-0-1722380855'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722380855 5e84ccc436] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722380855 5de214a8a8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:08:03 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:08:03 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-0-1722380855 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-1000-0
+ env
++ date
+ echo Wed Jul 31 01:09:17 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 01:09:17 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5de214a8a8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722380957
+ git checkout -b scalability-yes-0-1000-0-1722380957
Switched to a new branch 'scalability-yes-0-1000-0-1722380957'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722380957 87eb908224] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:09:46 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:09:46 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-0-1722380957 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-1000-0
+ env
++ date
+ echo Wed Jul 31 01:10:59 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 01:10:59 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 87eb908224 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722381059
+ git checkout -b scalability-yes-1-1000-0-1722381059
Switched to a new branch 'scalability-yes-1-1000-0-1722381059'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722381059 5339f51e6b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722381059 7dce7dddd9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:11:28 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:11:28 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-0-1722381059 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 01:12:42 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 01:12:42 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7dce7dddd9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722381162
+ git checkout -b scalability-yes-1024-1000-0-1722381162
Switched to a new branch 'scalability-yes-1024-1000-0-1722381162'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722381162 15290b04a2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722381162 96369c30f3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:13:10 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:13:10 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-0-1722381162 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-1000-0
+ env
++ date
+ echo Wed Jul 31 01:14:23 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 01:14:23 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 96369c30f3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722381264
+ git checkout -b scalability-yes-8-1000-0-1722381264
Switched to a new branch 'scalability-yes-8-1000-0-1722381264'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722381264 0e70c52f10] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722381264 9876a1c067] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:14:52 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:14:52 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-0-1722381264 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-1000-0
+ env
++ date
+ echo Wed Jul 31 01:16:05 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 01:16:05 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9876a1c067 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722381366
+ git checkout -b scalability-yes-512-1000-0-1722381366
Switched to a new branch 'scalability-yes-512-1000-0-1722381366'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722381366 cfdf55ec16] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722381366 f24c3e1433] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:16:35 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:16:35 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-0-1722381366 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-1000-0
+ env
++ date
+ echo Wed Jul 31 01:17:48 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 01:17:48 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f24c3e1433 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722381468
+ git checkout -b scalability-yes-128-1000-0-1722381468
Switched to a new branch 'scalability-yes-128-1000-0-1722381468'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722381468 8ee60d4822] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722381468 202297643b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:18:17 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:18:17 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-0-1722381468 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-1000-0
+ env
++ date
+ echo Wed Jul 31 01:19:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 01:19:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 202297643b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722381570
+ git checkout -b scalability-no-32-1000-0-1722381570
Switched to a new branch 'scalability-no-32-1000-0-1722381570'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722381570 1db9b4c0e9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:19:58 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:19:58 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-0-1722381570 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-1000-0
+ env
++ date
+ echo Wed Jul 31 01:21:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 01:21:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1db9b4c0e9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722381672
+ git checkout -b scalability-no-0-1000-0-1722381672
Switched to a new branch 'scalability-no-0-1000-0-1722381672'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:21:41 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:21:41 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-0-1722381672 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-1000-0
+ env
++ date
+ echo Wed Jul 31 01:22:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 01:22:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722381774
+ git checkout -b scalability-no-1-1000-0-1722381774
Switched to a new branch 'scalability-no-1-1000-0-1722381774'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722381774 cea8147d34] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:23:23 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:23:23 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-0-1722381774 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 01:24:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 01:24:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cea8147d34 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722381877
+ git checkout -b scalability-no-1024-1000-0-1722381877
Switched to a new branch 'scalability-no-1024-1000-0-1722381877'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722381877 42ba35966d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:25:05 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:25:05 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-0-1722381877 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-1000-0
+ env
++ date
+ echo Wed Jul 31 01:26:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 01:26:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 42ba35966d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722381979
+ git checkout -b scalability-no-8-1000-0-1722381979
Switched to a new branch 'scalability-no-8-1000-0-1722381979'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722381979 05bea153d8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:26:47 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:26:47 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-0-1722381979 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-1000-0
+ env
++ date
+ echo Wed Jul 31 01:28:01 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 01:28:01 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05bea153d8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722382081
+ git checkout -b scalability-no-512-1000-0-1722382081
Switched to a new branch 'scalability-no-512-1000-0-1722382081'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722382081 7e3f727459] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:28:30 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:28:30 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-0-1722382081 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-1000-0
+ env
++ date
+ echo Wed Jul 31 01:29:43 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 01:29:43 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7e3f727459 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722382183
+ git checkout -b scalability-no-128-1000-0-1722382183
Switched to a new branch 'scalability-no-128-1000-0-1722382183'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722382183 3cdd62da7d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:30:12 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:30:12 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-0-1722382183 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-1000-0
+ env
++ date
+ echo Wed Jul 31 01:31:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 01:31:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3cdd62da7d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722382285
+ git checkout -b scalability-yes-32-1000-0-1722382285
Switched to a new branch 'scalability-yes-32-1000-0-1722382285'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722382285 ea98ffba3f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722382285 1286307d57] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:31:54 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:31:54 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-0-1722382285 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-1000-0
+ env
++ date
+ echo Wed Jul 31 01:33:08 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 01:33:08 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1286307d57 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722382388
+ git checkout -b scalability-yes-0-1000-0-1722382388
Switched to a new branch 'scalability-yes-0-1000-0-1722382388'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722382388 dbd219304d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:33:36 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:33:36 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-0-1722382388 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-1000-0
+ env
++ date
+ echo Wed Jul 31 01:34:51 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 01:34:51 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dbd219304d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722382491
+ git checkout -b scalability-yes-1-1000-0-1722382491
Switched to a new branch 'scalability-yes-1-1000-0-1722382491'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722382491 801e04a14d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722382491 cbaa6c6bad] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:35:20 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:35:20 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-0-1722382491 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 01:36:34 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 01:36:34 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cbaa6c6bad fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722382594
+ git checkout -b scalability-yes-1024-1000-0-1722382594
Switched to a new branch 'scalability-yes-1024-1000-0-1722382594'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722382594 86894eee0b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722382594 252385d5c1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:37:03 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:37:03 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-0-1722382594 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-1000-0
+ env
++ date
+ echo Wed Jul 31 01:38:17 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 01:38:17 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 252385d5c1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722382697
+ git checkout -b scalability-yes-8-1000-0-1722382697
Switched to a new branch 'scalability-yes-8-1000-0-1722382697'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722382697 008c082d9a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722382697 8be83d4f24] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:38:45 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:38:45 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-0-1722382697 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-1000-0
+ env
++ date
+ echo Wed Jul 31 01:39:59 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 01:39:59 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8be83d4f24 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722382800
+ git checkout -b scalability-yes-512-1000-0-1722382800
Switched to a new branch 'scalability-yes-512-1000-0-1722382800'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722382800 7e204ab810] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722382800 c2c1dbef63] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:40:28 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:40:28 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-0-1722382800 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-1000-0
+ env
++ date
+ echo Wed Jul 31 01:41:42 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 01:41:42 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c2c1dbef63 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722382903
+ git checkout -b scalability-yes-128-1000-0-1722382903
Switched to a new branch 'scalability-yes-128-1000-0-1722382903'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722382903 61ec66961b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722382903 1c0a0de2e5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:42:11 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:42:11 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-0-1722382903 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-1000-0
+ env
++ date
+ echo Wed Jul 31 01:43:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 01:43:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1c0a0de2e5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722383006
+ git checkout -b scalability-no-32-1000-0-1722383006
Switched to a new branch 'scalability-no-32-1000-0-1722383006'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722383006 2523ff90c4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:43:54 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:43:54 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-0-1722383006 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-1000-0
+ env
++ date
+ echo Wed Jul 31 01:45:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 01:45:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2523ff90c4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722383108
+ git checkout -b scalability-no-0-1000-0-1722383108
Switched to a new branch 'scalability-no-0-1000-0-1722383108'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:45:36 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:45:36 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-0-1722383108 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-1000-0
+ env
++ date
+ echo Wed Jul 31 01:46:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 01:46:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722383211
+ git checkout -b scalability-no-1-1000-0-1722383211
Switched to a new branch 'scalability-no-1-1000-0-1722383211'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722383211 675327bfee] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:47:19 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:47:19 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-0-1722383211 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 01:48:33 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 01:48:33 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 675327bfee fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722383313
+ git checkout -b scalability-no-1024-1000-0-1722383313
Switched to a new branch 'scalability-no-1024-1000-0-1722383313'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722383313 19d088220a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:49:02 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:49:02 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-0-1722383313 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-1000-0
+ env
++ date
+ echo Wed Jul 31 01:50:16 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 01:50:16 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 19d088220a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722383416
+ git checkout -b scalability-no-8-1000-0-1722383416
Switched to a new branch 'scalability-no-8-1000-0-1722383416'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722383416 5679fb12a0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:50:44 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:50:44 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-0-1722383416 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-1000-0
+ env
++ date
+ echo Wed Jul 31 01:51:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 01:51:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5679fb12a0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722383519
+ git checkout -b scalability-no-512-1000-0-1722383519
Switched to a new branch 'scalability-no-512-1000-0-1722383519'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722383519 07eb62dbed] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:52:27 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:52:27 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-0-1722383519 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-1000-0
+ env
++ date
+ echo Wed Jul 31 01:53:41 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 01:53:41 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 07eb62dbed fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722383622
+ git checkout -b scalability-no-128-1000-0-1722383622
Switched to a new branch 'scalability-no-128-1000-0-1722383622'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722383622 b3f31ded99] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:54:10 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:54:10 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-0-1722383622 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-1000-0
+ env
++ date
+ echo Wed Jul 31 01:55:24 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 01:55:24 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b3f31ded99 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722383724
+ git checkout -b scalability-yes-32-1000-0-1722383724
Switched to a new branch 'scalability-yes-32-1000-0-1722383724'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722383724 1c93928fb9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722383724 7d211b9eb9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:55:52 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:55:52 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-0-1722383724 1000 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-1000-0
+ env
++ date
+ echo Wed Jul 31 01:55:56 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 01:55:56 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7d211b9eb9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722383756
+ git checkout -b scalability-yes-0-1000-0-1722383756
Switched to a new branch 'scalability-yes-0-1000-0-1722383756'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722383756 e683d91df1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:56:25 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:56:25 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-0-1722383756 1000 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-1000-0
+ env
++ date
+ echo Wed Jul 31 01:56:28 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 01:56:28 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e683d91df1 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722383788
+ git checkout -b scalability-yes-1-1000-0-1722383788
Switched to a new branch 'scalability-yes-1-1000-0-1722383788'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722383788 d99b42c192] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722383788 2bc6d95213] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:56:57 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:56:57 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-0-1722383788 1000 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 01:57:00 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 01:57:00 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2bc6d95213 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722383820
+ git checkout -b scalability-yes-1024-1000-0-1722383820
Switched to a new branch 'scalability-yes-1024-1000-0-1722383820'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722383820 c4bd0847e4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722383820 1f2d34134a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:57:29 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:57:29 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-0-1722383820 1000 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-1000-0
+ env
++ date
+ echo Wed Jul 31 01:57:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 01:57:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1f2d34134a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722383853
+ git checkout -b scalability-yes-8-1000-0-1722383853
Switched to a new branch 'scalability-yes-8-1000-0-1722383853'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722383853 6ffae3d9fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722383853 ac6268d547] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:58:02 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:58:02 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-0-1722383853 1000 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-1000-0
+ env
++ date
+ echo Wed Jul 31 01:58:05 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 01:58:05 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac6268d547 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722383885
+ git checkout -b scalability-yes-512-1000-0-1722383885
Switched to a new branch 'scalability-yes-512-1000-0-1722383885'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722383885 708b413bbf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722383885 253eccc96c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:58:34 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:58:34 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-0-1722383885 1000 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-1000-0
+ env
++ date
+ echo Wed Jul 31 01:58:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 01:58:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 253eccc96c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722383917
+ git checkout -b scalability-yes-128-1000-0-1722383917
Switched to a new branch 'scalability-yes-128-1000-0-1722383917'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722383917 54f6580d67] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722383917 fef5c99856] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:59:06 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:59:06 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-0-1722383917 1000 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-1000-0
+ env
++ date
+ echo Wed Jul 31 01:59:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 01:59:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fef5c99856 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722383949
+ git checkout -b scalability-no-32-1000-0-1722383949
Switched to a new branch 'scalability-no-32-1000-0-1722383949'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722383949 af85316551] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:59:38 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 01:59:38 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-0-1722383949 1000 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-1000-0
+ env
++ date
+ echo Wed Jul 31 01:59:41 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 01:59:41 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af85316551 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722383981
+ git checkout -b scalability-no-0-1000-0-1722383981
Switched to a new branch 'scalability-no-0-1000-0-1722383981'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:00:10 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 02:00:10 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-0-1722383981 1000 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-1000-0
+ env
++ date
+ echo Wed Jul 31 02:00:13 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 02:00:13 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722384013
+ git checkout -b scalability-no-1-1000-0-1722384013
Switched to a new branch 'scalability-no-1-1000-0-1722384013'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722384013 e17c9b7a63] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:00:42 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 02:00:42 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-0-1722384013 1000 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-1000-0
+ env
++ date
+ echo Wed Jul 31 02:00:45 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 02:00:45 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e17c9b7a63 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722384045
+ git checkout -b scalability-no-1024-1000-0-1722384045
Switched to a new branch 'scalability-no-1024-1000-0-1722384045'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722384045 c5b4359c9f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:01:14 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 02:01:14 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-0-1722384045 1000 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-1000-0
+ env
++ date
+ echo Wed Jul 31 02:01:17 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 02:01:17 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c5b4359c9f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722384078
+ git checkout -b scalability-no-8-1000-0-1722384078
Switched to a new branch 'scalability-no-8-1000-0-1722384078'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722384078 04e34faf64] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:01:46 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 02:01:46 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-0-1722384078 1000 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-1000-0
+ env
++ date
+ echo Wed Jul 31 02:01:49 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 02:01:49 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 04e34faf64 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722384110
+ git checkout -b scalability-no-512-1000-0-1722384110
Switched to a new branch 'scalability-no-512-1000-0-1722384110'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722384110 b8d16300d3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:02:18 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 02:02:18 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-0-1722384110 1000 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-1000-0
+ env
++ date
+ echo Wed Jul 31 02:02:21 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 02:02:21 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b8d16300d3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722384142
+ git checkout -b scalability-no-128-1000-0-1722384142
Switched to a new branch 'scalability-no-128-1000-0-1722384142'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722384142 5e0a6fcb4b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:02:51 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Wed Jul 31 02:02:51 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-0-1722384142 1000 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:02:54 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 02:02:54 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5e0a6fcb4b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722384174
+ git checkout -b scalability-yes-32-32768-1000-1722384174
Switched to a new branch 'scalability-yes-32-32768-1000-1722384174'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722384174 d9073de7bc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722384174 15b9271fdc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:03:47 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:03:47 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-1000-1722384174 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:05:47 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 02:05:47 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 15b9271fdc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722384347
+ git checkout -b scalability-yes-0-32768-1000-1722384347
Switched to a new branch 'scalability-yes-0-32768-1000-1722384347'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722384347 e297db8c55] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:06:40 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:06:40 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-1000-1722384347 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:08:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 02:08:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e297db8c55 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722384520
+ git checkout -b scalability-yes-1-32768-1000-1722384520
Switched to a new branch 'scalability-yes-1-32768-1000-1722384520'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722384520 7d651d6726] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722384520 0418af0943] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:09:33 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:09:33 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-1000-1722384520 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:11:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 02:11:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0418af0943 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722384693
+ git checkout -b scalability-yes-1024-32768-1000-1722384693
Switched to a new branch 'scalability-yes-1024-32768-1000-1722384693'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722384693 ad10dfd6a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722384693 f84d090b03] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:12:26 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:12:26 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-1000-1722384693 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:14:28 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 02:14:28 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f84d090b03 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722384868
+ git checkout -b scalability-yes-8-32768-1000-1722384868
Switched to a new branch 'scalability-yes-8-32768-1000-1722384868'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722384868 06a4da3b2c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722384868 698198742b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:15:20 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:15:20 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-1000-1722384868 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:17:20 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 02:17:20 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 698198742b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722385040
+ git checkout -b scalability-yes-512-32768-1000-1722385040
Switched to a new branch 'scalability-yes-512-32768-1000-1722385040'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722385040 8adcabc887] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722385040 af3e26d80f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:18:13 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:18:13 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-1000-1722385040 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:20:14 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 02:20:14 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af3e26d80f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722385214
+ git checkout -b scalability-yes-128-32768-1000-1722385214
Switched to a new branch 'scalability-yes-128-32768-1000-1722385214'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722385214 28d067a10f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722385214 548c278840] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:21:06 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:21:06 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-1000-1722385214 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:23:07 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 02:23:07 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 548c278840 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722385387
+ git checkout -b scalability-no-32-32768-1000-1722385387
Switched to a new branch 'scalability-no-32-32768-1000-1722385387'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722385387 8f855e897f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:24:00 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:24:00 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-1000-1722385387 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:25:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 02:25:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f855e897f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722385559
+ git checkout -b scalability-no-0-32768-1000-1722385559
Switched to a new branch 'scalability-no-0-32768-1000-1722385559'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:26:51 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:26:51 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-1000-1722385559 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:28:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 02:28:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722385731
+ git checkout -b scalability-no-1-32768-1000-1722385731
Switched to a new branch 'scalability-no-1-32768-1000-1722385731'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722385731 97a96fca9f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:29:44 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:29:44 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-1000-1722385731 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:31:42 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 02:31:42 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 97a96fca9f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722385903
+ git checkout -b scalability-no-1024-32768-1000-1722385903
Switched to a new branch 'scalability-no-1024-32768-1000-1722385903'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722385903 eaff044cb4] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:32:35 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:32:35 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-1000-1722385903 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:34:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 02:34:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eaff044cb4 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722386076
+ git checkout -b scalability-no-8-32768-1000-1722386076
Switched to a new branch 'scalability-no-8-32768-1000-1722386076'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722386076 6043b49f99] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:35:29 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:35:29 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-1000-1722386076 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:37:27 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 02:37:27 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6043b49f99 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722386247
+ git checkout -b scalability-no-512-32768-1000-1722386247
Switched to a new branch 'scalability-no-512-32768-1000-1722386247'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722386247 eab615234c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:38:19 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:38:19 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-1000-1722386247 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:40:20 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 02:40:20 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eab615234c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722386420
+ git checkout -b scalability-no-128-32768-1000-1722386420
Switched to a new branch 'scalability-no-128-32768-1000-1722386420'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722386420 0a5d764813] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:41:13 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:41:13 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-1000-1722386420 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:43:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 02:43:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0a5d764813 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722386591
+ git checkout -b scalability-yes-32-32768-1000-1722386591
Switched to a new branch 'scalability-yes-32-32768-1000-1722386591'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722386591 d9d46c1f85] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722386591 2c22d712e2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:43:40 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:43:40 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-1000-1722386591 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:45:12 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 02:45:12 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2c22d712e2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722386712
+ git checkout -b scalability-yes-0-32768-1000-1722386712
Switched to a new branch 'scalability-yes-0-32768-1000-1722386712'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722386712 3d8ecb270d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:45:40 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:45:40 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-1000-1722386712 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:47:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 02:47:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3d8ecb270d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722386831
+ git checkout -b scalability-yes-1-32768-1000-1722386831
Switched to a new branch 'scalability-yes-1-32768-1000-1722386831'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722386831 8a1179bf00] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722386831 b3d6349ec3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:47:40 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:47:40 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-1000-1722386831 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:49:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 02:49:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b3d6349ec3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722386951
+ git checkout -b scalability-yes-1024-32768-1000-1722386951
Switched to a new branch 'scalability-yes-1024-32768-1000-1722386951'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722386951 0b8c305e97] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722386951 bf1878a3e1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:49:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:49:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-1000-1722386951 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:51:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 02:51:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bf1878a3e1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722387071
+ git checkout -b scalability-yes-8-32768-1000-1722387071
Switched to a new branch 'scalability-yes-8-32768-1000-1722387071'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722387071 cc4d32d402] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722387071 2f08097960] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:51:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:51:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-1000-1722387071 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:53:10 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 02:53:10 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f08097960 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722387190
+ git checkout -b scalability-yes-512-32768-1000-1722387190
Switched to a new branch 'scalability-yes-512-32768-1000-1722387190'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722387190 04fbd1bf05] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722387190 9fa8f8262e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:53:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:53:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-1000-1722387190 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:55:10 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 02:55:10 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9fa8f8262e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722387310
+ git checkout -b scalability-yes-128-32768-1000-1722387310
Switched to a new branch 'scalability-yes-128-32768-1000-1722387310'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722387310 23b7860f9a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722387310 1c5b5af883] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:55:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:55:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-1000-1722387310 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:57:10 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 02:57:10 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1c5b5af883 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722387430
+ git checkout -b scalability-no-32-32768-1000-1722387430
Switched to a new branch 'scalability-no-32-32768-1000-1722387430'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722387430 d5ebf901d8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:57:38 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:57:38 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-1000-1722387430 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 02:59:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 02:59:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d5ebf901d8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722387549
+ git checkout -b scalability-no-0-32768-1000-1722387549
Switched to a new branch 'scalability-no-0-32768-1000-1722387549'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:59:37 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 02:59:37 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-1000-1722387549 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:01:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 03:01:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722387668
+ git checkout -b scalability-no-1-32768-1000-1722387668
Switched to a new branch 'scalability-no-1-32768-1000-1722387668'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722387668 86ba338f30] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:01:37 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:01:37 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-1000-1722387668 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:03:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 03:03:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 86ba338f30 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722387789
+ git checkout -b scalability-no-1024-32768-1000-1722387789
Switched to a new branch 'scalability-no-1024-32768-1000-1722387789'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722387789 3088e655c1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:03:37 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:03:37 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-1000-1722387789 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:05:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 03:05:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3088e655c1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722387908
+ git checkout -b scalability-no-8-32768-1000-1722387908
Switched to a new branch 'scalability-no-8-32768-1000-1722387908'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722387908 412f9fc17d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:05:36 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:05:36 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-1000-1722387908 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:07:07 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 03:07:07 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 412f9fc17d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722388027
+ git checkout -b scalability-no-512-32768-1000-1722388027
Switched to a new branch 'scalability-no-512-32768-1000-1722388027'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722388027 47d4c3525f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:07:35 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:07:35 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-1000-1722388027 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:09:07 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 03:09:07 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 47d4c3525f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722388147
+ git checkout -b scalability-no-128-32768-1000-1722388147
Switched to a new branch 'scalability-no-128-32768-1000-1722388147'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722388147 a6bb991296] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:09:35 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:09:35 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-1000-1722388147 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:11:06 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 03:11:06 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a6bb991296 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722388266
+ git checkout -b scalability-yes-32-32768-1000-1722388266
Switched to a new branch 'scalability-yes-32-32768-1000-1722388266'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722388266 08daf8d814] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722388266 2f74d42d56] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:11:34 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:11:34 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-1000-1722388266 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:13:00 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 03:13:00 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f74d42d56 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722388380
+ git checkout -b scalability-yes-0-32768-1000-1722388380
Switched to a new branch 'scalability-yes-0-32768-1000-1722388380'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722388380 7042d90334] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:13:28 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:13:28 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-1000-1722388380 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:14:53 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 03:14:53 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7042d90334 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722388493
+ git checkout -b scalability-yes-1-32768-1000-1722388493
Switched to a new branch 'scalability-yes-1-32768-1000-1722388493'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722388493 5607f7e203] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722388493 ebe08abc68] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:15:21 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:15:21 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-1000-1722388493 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:16:45 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 03:16:45 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ebe08abc68 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722388606
+ git checkout -b scalability-yes-1024-32768-1000-1722388606
Switched to a new branch 'scalability-yes-1024-32768-1000-1722388606'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722388606 e3f4cd7101] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722388606 049a71b648] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:17:13 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:17:13 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-1000-1722388606 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:18:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 03:18:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 049a71b648 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722388721
+ git checkout -b scalability-yes-8-32768-1000-1722388721
Switched to a new branch 'scalability-yes-8-32768-1000-1722388721'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722388721 8974ef0edd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722388721 83f9c1f20e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:19:09 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:19:09 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-1000-1722388721 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:20:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 03:20:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 83f9c1f20e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722388834
+ git checkout -b scalability-yes-512-32768-1000-1722388834
Switched to a new branch 'scalability-yes-512-32768-1000-1722388834'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722388834 5bd185ad1a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722388834 3247337d49] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:21:02 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:21:02 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-1000-1722388834 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:22:28 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 03:22:28 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3247337d49 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722388948
+ git checkout -b scalability-yes-128-32768-1000-1722388948
Switched to a new branch 'scalability-yes-128-32768-1000-1722388948'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722388948 505d50477c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722388948 44b4071613] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:22:57 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:22:57 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-1000-1722388948 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:24:22 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 03:24:22 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 44b4071613 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722389062
+ git checkout -b scalability-no-32-32768-1000-1722389062
Switched to a new branch 'scalability-no-32-32768-1000-1722389062'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722389062 df8290dd43] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:24:51 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:24:51 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-1000-1722389062 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:26:16 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 03:26:16 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at df8290dd43 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722389176
+ git checkout -b scalability-no-0-32768-1000-1722389176
Switched to a new branch 'scalability-no-0-32768-1000-1722389176'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:26:44 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:26:44 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-1000-1722389176 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:28:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 03:28:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722389289
+ git checkout -b scalability-no-1-32768-1000-1722389289
Switched to a new branch 'scalability-no-1-32768-1000-1722389289'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722389289 b27ed06877] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:28:37 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:28:37 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-1000-1722389289 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:30:02 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 03:30:02 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b27ed06877 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722389403
+ git checkout -b scalability-no-1024-32768-1000-1722389403
Switched to a new branch 'scalability-no-1024-32768-1000-1722389403'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722389403 2d086f9716] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:30:32 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:30:32 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-1000-1722389403 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:31:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 03:31:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2d086f9716 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722389519
+ git checkout -b scalability-no-8-32768-1000-1722389519
Switched to a new branch 'scalability-no-8-32768-1000-1722389519'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722389519 21dc337e0c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:32:27 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:32:27 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-1000-1722389519 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:33:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 03:33:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 21dc337e0c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722389632
+ git checkout -b scalability-no-512-32768-1000-1722389632
Switched to a new branch 'scalability-no-512-32768-1000-1722389632'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722389632 320ec25765] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:34:20 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:34:20 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-1000-1722389632 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:35:46 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 03:35:46 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 320ec25765 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722389746
+ git checkout -b scalability-no-128-32768-1000-1722389746
Switched to a new branch 'scalability-no-128-32768-1000-1722389746'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722389746 6baaca6999] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:36:14 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:36:14 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-1000-1722389746 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:37:39 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 03:37:39 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6baaca6999 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722389859
+ git checkout -b scalability-yes-32-32768-1000-1722389859
Switched to a new branch 'scalability-yes-32-32768-1000-1722389859'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722389859 ab8d1ae6a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722389859 6192166534] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:38:08 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:38:08 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-1000-1722389859 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:39:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 03:39:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6192166534 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722389969
+ git checkout -b scalability-yes-0-32768-1000-1722389969
Switched to a new branch 'scalability-yes-0-32768-1000-1722389969'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722389969 4113f27400] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:39:57 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:39:57 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-1000-1722389969 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:41:17 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 03:41:17 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4113f27400 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722390077
+ git checkout -b scalability-yes-1-32768-1000-1722390077
Switched to a new branch 'scalability-yes-1-32768-1000-1722390077'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722390077 f5048167c1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722390077 43aefd0c99] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:41:46 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:41:46 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-1000-1722390077 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:43:06 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 03:43:06 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 43aefd0c99 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722390186
+ git checkout -b scalability-yes-1024-32768-1000-1722390186
Switched to a new branch 'scalability-yes-1024-32768-1000-1722390186'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722390186 28d3bdf367] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722390186 6b7f8cdae9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:43:35 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:43:35 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-1000-1722390186 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:44:55 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 03:44:55 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6b7f8cdae9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722390296
+ git checkout -b scalability-yes-8-32768-1000-1722390296
Switched to a new branch 'scalability-yes-8-32768-1000-1722390296'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722390296 3821ba5f28] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722390296 758fd0d24b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:45:24 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:45:24 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-1000-1722390296 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:46:44 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 03:46:44 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 758fd0d24b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722390404
+ git checkout -b scalability-yes-512-32768-1000-1722390404
Switched to a new branch 'scalability-yes-512-32768-1000-1722390404'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722390404 2deb705c71] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722390404 b749ad6bee] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:47:12 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:47:12 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-1000-1722390404 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:48:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 03:48:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b749ad6bee fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722390513
+ git checkout -b scalability-yes-128-32768-1000-1722390513
Switched to a new branch 'scalability-yes-128-32768-1000-1722390513'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722390513 055bdb5b3e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722390513 9fbc53902b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:49:01 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:49:01 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-1000-1722390513 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:50:22 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 03:50:22 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9fbc53902b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722390622
+ git checkout -b scalability-no-32-32768-1000-1722390622
Switched to a new branch 'scalability-no-32-32768-1000-1722390622'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722390622 6c8103428d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:50:50 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:50:50 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-1000-1722390622 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:52:10 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 03:52:10 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6c8103428d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722390731
+ git checkout -b scalability-no-0-32768-1000-1722390731
Switched to a new branch 'scalability-no-0-32768-1000-1722390731'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:52:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:52:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-1000-1722390731 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:54:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 03:54:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722390840
+ git checkout -b scalability-no-1-32768-1000-1722390840
Switched to a new branch 'scalability-no-1-32768-1000-1722390840'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722390840 227de172fb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:54:28 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:54:28 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-1000-1722390840 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:55:49 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 03:55:49 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 227de172fb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722390949
+ git checkout -b scalability-no-1024-32768-1000-1722390949
Switched to a new branch 'scalability-no-1024-32768-1000-1722390949'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722390949 c541f23ea5] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:56:17 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:56:17 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-1000-1722390949 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:57:38 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 03:57:38 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c541f23ea5 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722391058
+ git checkout -b scalability-no-8-32768-1000-1722391058
Switched to a new branch 'scalability-no-8-32768-1000-1722391058'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722391058 a49969e7b1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:58:06 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:58:06 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-1000-1722391058 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 03:59:27 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 03:59:27 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a49969e7b1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722391167
+ git checkout -b scalability-no-512-32768-1000-1722391167
Switched to a new branch 'scalability-no-512-32768-1000-1722391167'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/512/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722391167 d1af1d967e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:59:56 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 03:59:56 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-1000-1722391167 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:01:16 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 04:01:16 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d1af1d967e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722391277
+ git checkout -b scalability-no-128-32768-1000-1722391277
Switched to a new branch 'scalability-no-128-32768-1000-1722391277'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722391277 c56b75a646] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:01:45 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:01:45 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-1000-1722391277 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:03:05 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 04:03:05 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c56b75a646 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722391386
+ git checkout -b scalability-yes-32-32768-1000-1722391386
Switched to a new branch 'scalability-yes-32-32768-1000-1722391386'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722391386 2ee53615b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722391386 cce76ab12f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:03:34 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:03:34 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-1000-1722391386 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:03:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 04:03:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cce76ab12f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722391417
+ git checkout -b scalability-yes-0-32768-1000-1722391417
Switched to a new branch 'scalability-yes-0-32768-1000-1722391417'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722391417 c181590aa4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:04:06 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:04:06 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-1000-1722391417 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:04:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 04:04:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c181590aa4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722391449
+ git checkout -b scalability-yes-1-32768-1000-1722391449
Switched to a new branch 'scalability-yes-1-32768-1000-1722391449'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722391449 10fe88393a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722391449 e2b7f6dcca] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:04:38 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:04:38 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-1000-1722391449 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:04:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 04:04:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e2b7f6dcca fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722391482
+ git checkout -b scalability-yes-1024-32768-1000-1722391482
Switched to a new branch 'scalability-yes-1024-32768-1000-1722391482'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722391482 a1aad0b8e6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722391482 f0e85f6afa] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:05:10 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:05:10 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-1000-1722391482 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:05:13 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 04:05:13 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f0e85f6afa fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722391514
+ git checkout -b scalability-yes-8-32768-1000-1722391514
Switched to a new branch 'scalability-yes-8-32768-1000-1722391514'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722391514 7537762150] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722391514 995d806802] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:05:42 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:05:42 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-1000-1722391514 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:05:46 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 04:05:46 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 995d806802 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722391546
+ git checkout -b scalability-yes-512-32768-1000-1722391546
Switched to a new branch 'scalability-yes-512-32768-1000-1722391546'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722391546 f917daf844] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722391546 fdf5706863] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:06:15 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:06:15 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-1000-1722391546 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:06:18 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 04:06:18 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fdf5706863 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722391578
+ git checkout -b scalability-yes-128-32768-1000-1722391578
Switched to a new branch 'scalability-yes-128-32768-1000-1722391578'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722391578 aaa4a8035b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722391578 93c1356b8a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:06:47 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:06:47 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-1000-1722391578 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:06:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 04:06:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 93c1356b8a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722391610
+ git checkout -b scalability-no-32-32768-1000-1722391610
Switched to a new branch 'scalability-no-32-32768-1000-1722391610'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722391610 8d784f14de] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:07:19 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:07:19 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-1000-1722391610 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:07:22 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 04:07:22 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8d784f14de fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722391643
+ git checkout -b scalability-no-0-32768-1000-1722391643
Switched to a new branch 'scalability-no-0-32768-1000-1722391643'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:07:51 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:07:51 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-1000-1722391643 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:07:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 04:07:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722391674
+ git checkout -b scalability-no-1-32768-1000-1722391674
Switched to a new branch 'scalability-no-1-32768-1000-1722391674'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722391674 7d24029d67] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:08:23 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:08:23 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-1000-1722391674 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:08:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 04:08:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7d24029d67 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722391706
+ git checkout -b scalability-no-1024-32768-1000-1722391706
Switched to a new branch 'scalability-no-1024-32768-1000-1722391706'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722391706 2460ad505b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:08:55 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:08:55 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-1000-1722391706 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:08:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 04:08:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2460ad505b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722391738
+ git checkout -b scalability-no-8-32768-1000-1722391738
Switched to a new branch 'scalability-no-8-32768-1000-1722391738'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722391738 4bf05a1825] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:09:27 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:09:27 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-1000-1722391738 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:09:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 04:09:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4bf05a1825 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722391770
+ git checkout -b scalability-no-512-32768-1000-1722391770
Switched to a new branch 'scalability-no-512-32768-1000-1722391770'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722391770 56dfb8bdf1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:09:59 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:09:59 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-1000-1722391770 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-1000
+ env
++ date
+ echo Wed Jul 31 04:10:03 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 04:10:03 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 56dfb8bdf1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722391803
+ git checkout -b scalability-no-128-32768-1000-1722391803
Switched to a new branch 'scalability-no-128-32768-1000-1722391803'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722391803 0ef5c51929] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:10:32 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Wed Jul 31 04:10:32 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-1000-1722391803 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-100
+ env
++ date
+ echo Wed Jul 31 04:10:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 04:10:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0ef5c51929 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722391835
+ git checkout -b scalability-yes-32-32768-100-1722391835
Switched to a new branch 'scalability-yes-32-32768-100-1722391835'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722391835 750a1f78fe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722391835 4a072c0331] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:11:28 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:11:28 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-100-1722391835 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-100
+ env
++ date
+ echo Wed Jul 31 04:12:47 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 04:12:47 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4a072c0331 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722391968
+ git checkout -b scalability-yes-0-32768-100-1722391968
Switched to a new branch 'scalability-yes-0-32768-100-1722391968'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722391968 42b736338e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:13:40 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:13:40 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-100-1722391968 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-100
+ env
++ date
+ echo Wed Jul 31 04:14:59 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 04:14:59 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 42b736338e NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722392100
+ git checkout -b scalability-yes-1-32768-100-1722392100
Switched to a new branch 'scalability-yes-1-32768-100-1722392100'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722392100 800be87d6c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722392100 5fa9757df3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:15:52 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:15:52 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-100-1722392100 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 04:17:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 04:17:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5fa9757df3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722392231
+ git checkout -b scalability-yes-1024-32768-100-1722392231
Switched to a new branch 'scalability-yes-1024-32768-100-1722392231'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722392231 38279dbbf1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722392231 6ed6354a36] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:18:04 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:18:04 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-100-1722392231 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-100
+ env
++ date
+ echo Wed Jul 31 04:19:23 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 04:19:23 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6ed6354a36 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722392363
+ git checkout -b scalability-yes-8-32768-100-1722392363
Switched to a new branch 'scalability-yes-8-32768-100-1722392363'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722392363 31f353c8e0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722392363 e08b6e10e7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:20:16 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:20:16 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-100-1722392363 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-100
+ env
++ date
+ echo Wed Jul 31 04:21:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 04:21:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e08b6e10e7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722392496
+ git checkout -b scalability-yes-512-32768-100-1722392496
Switched to a new branch 'scalability-yes-512-32768-100-1722392496'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722392496 dd50885530] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722392496 edc769fb91] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:22:28 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:22:28 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-100-1722392496 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-100
+ env
++ date
+ echo Wed Jul 31 04:23:48 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 04:23:48 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at edc769fb91 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722392628
+ git checkout -b scalability-yes-128-32768-100-1722392628
Switched to a new branch 'scalability-yes-128-32768-100-1722392628'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722392628 0032ecad55] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/128/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722392628 56209159ef] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:24:41 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:24:41 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-100-1722392628 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-100
+ env
++ date
+ echo Wed Jul 31 04:26:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 04:26:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 56209159ef fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722392760
+ git checkout -b scalability-no-32-32768-100-1722392760
Switched to a new branch 'scalability-no-32-32768-100-1722392760'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722392760 68d622d9f1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:26:52 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:26:52 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-100-1722392760 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-100
+ env
++ date
+ echo Wed Jul 31 04:28:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 04:28:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 68d622d9f1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722392892
+ git checkout -b scalability-no-0-32768-100-1722392892
Switched to a new branch 'scalability-no-0-32768-100-1722392892'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:29:04 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:29:04 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-100-1722392892 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-100
+ env
++ date
+ echo Wed Jul 31 04:30:24 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 04:30:24 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722393024
+ git checkout -b scalability-no-1-32768-100-1722393024
Switched to a new branch 'scalability-no-1-32768-100-1722393024'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722393024 a3984ea225] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:31:16 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:31:16 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-100-1722393024 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 04:32:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 04:32:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a3984ea225 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722393156
+ git checkout -b scalability-no-1024-32768-100-1722393156
Switched to a new branch 'scalability-no-1024-32768-100-1722393156'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722393156 c119c6486c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:33:28 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:33:28 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-100-1722393156 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-100
+ env
++ date
+ echo Wed Jul 31 04:34:48 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 04:34:48 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c119c6486c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722393288
+ git checkout -b scalability-no-8-32768-100-1722393288
Switched to a new branch 'scalability-no-8-32768-100-1722393288'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722393288 1a7610e77c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:35:41 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:35:41 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-100-1722393288 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-100
+ env
++ date
+ echo Wed Jul 31 04:37:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 04:37:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1a7610e77c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722393420
+ git checkout -b scalability-no-512-32768-100-1722393420
Switched to a new branch 'scalability-no-512-32768-100-1722393420'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722393420 1d0817c4b2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:37:53 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:37:53 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-100-1722393420 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-100
+ env
++ date
+ echo Wed Jul 31 04:39:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 04:39:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1d0817c4b2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722393552
+ git checkout -b scalability-no-128-32768-100-1722393552
Switched to a new branch 'scalability-no-128-32768-100-1722393552'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722393552 5d2aed9293] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:40:05 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:40:05 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-100-1722393552 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-100
+ env
++ date
+ echo Wed Jul 31 04:41:24 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 04:41:24 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5d2aed9293 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722393685
+ git checkout -b scalability-yes-32-32768-100-1722393685
Switched to a new branch 'scalability-yes-32-32768-100-1722393685'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722393685 a443a72aa9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722393685 189c10f4b8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:42:13 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:42:13 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-100-1722393685 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-100
+ env
++ date
+ echo Wed Jul 31 04:43:34 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 04:43:34 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 189c10f4b8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722393814
+ git checkout -b scalability-yes-0-32768-100-1722393814
Switched to a new branch 'scalability-yes-0-32768-100-1722393814'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722393814 c1b28885d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:44:22 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:44:22 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-100-1722393814 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-100
+ env
++ date
+ echo Wed Jul 31 04:45:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 04:45:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c1b28885d6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722393943
+ git checkout -b scalability-yes-1-32768-100-1722393943
Switched to a new branch 'scalability-yes-1-32768-100-1722393943'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722393943 46ff956fe6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722393943 31143c7230] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:46:31 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:46:31 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-100-1722393943 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 04:47:52 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 04:47:52 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 31143c7230 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722394072
+ git checkout -b scalability-yes-1024-32768-100-1722394072
Switched to a new branch 'scalability-yes-1024-32768-100-1722394072'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722394072 afaccfc052] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722394072 d267e97fe9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:48:40 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:48:40 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-100-1722394072 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-100
+ env
++ date
+ echo Wed Jul 31 04:50:00 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 04:50:00 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d267e97fe9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722394201
+ git checkout -b scalability-yes-8-32768-100-1722394201
Switched to a new branch 'scalability-yes-8-32768-100-1722394201'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722394201 1eb7e2858f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722394201 3da6597fc5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:50:49 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:50:49 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-100-1722394201 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-100
+ env
++ date
+ echo Wed Jul 31 04:52:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 04:52:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3da6597fc5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722394329
+ git checkout -b scalability-yes-512-32768-100-1722394329
Switched to a new branch 'scalability-yes-512-32768-100-1722394329'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722394329 e739a0d989] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722394329 c72b8f7118] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:52:57 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:52:57 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-100-1722394329 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-100
+ env
++ date
+ echo Wed Jul 31 04:54:18 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 04:54:18 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c72b8f7118 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722394458
+ git checkout -b scalability-yes-128-32768-100-1722394458
Switched to a new branch 'scalability-yes-128-32768-100-1722394458'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722394458 d29d4861d3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722394458 ad03056ea6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:55:06 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:55:06 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-100-1722394458 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-100
+ env
++ date
+ echo Wed Jul 31 04:56:27 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 04:56:27 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ad03056ea6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722394587
+ git checkout -b scalability-no-32-32768-100-1722394587
Switched to a new branch 'scalability-no-32-32768-100-1722394587'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722394587 a95af6705a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:57:09 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:57:09 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-100-1722394587 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-100
+ env
++ date
+ echo Wed Jul 31 04:58:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 04:58:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a95af6705a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722394710
+ git checkout -b scalability-no-0-32768-100-1722394710
Switched to a new branch 'scalability-no-0-32768-100-1722394710'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:58:58 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 04:58:58 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-100-1722394710 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-100
+ env
++ date
+ echo Wed Jul 31 05:00:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 05:00:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722394819
+ git checkout -b scalability-no-1-32768-100-1722394819
Switched to a new branch 'scalability-no-1-32768-100-1722394819'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722394819 bd95ec3a34] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:00:47 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:00:47 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-100-1722394819 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 05:02:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 05:02:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bd95ec3a34 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722394928
+ git checkout -b scalability-no-1024-32768-100-1722394928
Switched to a new branch 'scalability-no-1024-32768-100-1722394928'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722394928 3e4268a290] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:02:36 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:02:36 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-100-1722394928 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-100
+ env
++ date
+ echo Wed Jul 31 05:03:57 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 05:03:57 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3e4268a290 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722395037
+ git checkout -b scalability-no-8-32768-100-1722395037
Switched to a new branch 'scalability-no-8-32768-100-1722395037'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722395037 8b15b346a6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:04:25 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:04:25 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-100-1722395037 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-100
+ env
++ date
+ echo Wed Jul 31 05:05:46 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 05:05:46 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8b15b346a6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722395146
+ git checkout -b scalability-no-512-32768-100-1722395146
Switched to a new branch 'scalability-no-512-32768-100-1722395146'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722395146 0c8bfe1ca0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:06:15 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:06:15 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-100-1722395146 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-100
+ env
++ date
+ echo Wed Jul 31 05:07:35 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 05:07:35 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0c8bfe1ca0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722395255
+ git checkout -b scalability-no-128-32768-100-1722395255
Switched to a new branch 'scalability-no-128-32768-100-1722395255'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722395255 e318b6601c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:08:04 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:08:04 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-100-1722395255 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-100
+ env
++ date
+ echo Wed Jul 31 05:09:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 05:09:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e318b6601c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722395365
+ git checkout -b scalability-yes-32-32768-100-1722395365
Switched to a new branch 'scalability-yes-32-32768-100-1722395365'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722395365 41c75dfd7c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722395365 f21d8ab5e7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:09:53 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:09:53 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-100-1722395365 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-100
+ env
++ date
+ echo Wed Jul 31 05:11:08 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 05:11:08 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f21d8ab5e7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722395468
+ git checkout -b scalability-yes-0-32768-100-1722395468
Switched to a new branch 'scalability-yes-0-32768-100-1722395468'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722395468 c50e023f83] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:11:36 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:11:36 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-100-1722395468 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-100
+ env
++ date
+ echo Wed Jul 31 05:12:50 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 05:12:50 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c50e023f83 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722395570
+ git checkout -b scalability-yes-1-32768-100-1722395570
Switched to a new branch 'scalability-yes-1-32768-100-1722395570'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722395570 3ce252df10] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722395570 933d027e3f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:13:19 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:13:19 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-100-1722395570 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 05:14:34 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 05:14:34 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 933d027e3f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722395674
+ git checkout -b scalability-yes-1024-32768-100-1722395674
Switched to a new branch 'scalability-yes-1024-32768-100-1722395674'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722395674 c36ec6d658] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722395674 e3b51d700d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:15:02 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:15:02 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-100-1722395674 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-100
+ env
++ date
+ echo Wed Jul 31 05:16:17 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 05:16:17 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e3b51d700d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722395777
+ git checkout -b scalability-yes-8-32768-100-1722395777
Switched to a new branch 'scalability-yes-8-32768-100-1722395777'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722395777 e9113abc4a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722395777 aee74966ca] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:16:45 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:16:45 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-100-1722395777 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-100
+ env
++ date
+ echo Wed Jul 31 05:18:00 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 05:18:00 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at aee74966ca fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722395880
+ git checkout -b scalability-yes-512-32768-100-1722395880
Switched to a new branch 'scalability-yes-512-32768-100-1722395880'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722395880 035904f623] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/512/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722395880 9c2f209339] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:18:28 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:18:28 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-100-1722395880 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-100
+ env
++ date
+ echo Wed Jul 31 05:19:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 05:19:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9c2f209339 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722395983
+ git checkout -b scalability-yes-128-32768-100-1722395983
Switched to a new branch 'scalability-yes-128-32768-100-1722395983'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722395983 2ca351ede7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722395983 9d4e77ff95] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:20:11 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:20:11 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-100-1722395983 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-100
+ env
++ date
+ echo Wed Jul 31 05:21:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 05:21:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9d4e77ff95 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722396086
+ git checkout -b scalability-no-32-32768-100-1722396086
Switched to a new branch 'scalability-no-32-32768-100-1722396086'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722396086 adb70b539b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:21:54 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:21:54 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-100-1722396086 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-100
+ env
++ date
+ echo Wed Jul 31 05:23:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 05:23:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at adb70b539b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722396189
+ git checkout -b scalability-no-0-32768-100-1722396189
Switched to a new branch 'scalability-no-0-32768-100-1722396189'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:23:38 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:23:38 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-100-1722396189 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-100
+ env
++ date
+ echo Wed Jul 31 05:24:52 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 05:24:52 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722396292
+ git checkout -b scalability-no-1-32768-100-1722396292
Switched to a new branch 'scalability-no-1-32768-100-1722396292'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722396292 7f255c4b0e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:25:20 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:25:20 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-100-1722396292 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 05:26:35 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 05:26:35 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7f255c4b0e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722396395
+ git checkout -b scalability-no-1024-32768-100-1722396395
Switched to a new branch 'scalability-no-1024-32768-100-1722396395'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722396395 222c0cd00d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:27:03 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:27:03 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-100-1722396395 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-100
+ env
++ date
+ echo Wed Jul 31 05:28:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 05:28:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 222c0cd00d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722396498
+ git checkout -b scalability-no-8-32768-100-1722396498
Switched to a new branch 'scalability-no-8-32768-100-1722396498'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722396498 73bd62e5fc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:28:47 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:28:47 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-100-1722396498 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-100
+ env
++ date
+ echo Wed Jul 31 05:30:01 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 05:30:01 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 73bd62e5fc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722396601
+ git checkout -b scalability-no-512-32768-100-1722396601
Switched to a new branch 'scalability-no-512-32768-100-1722396601'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722396601 36c5c8e5e2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:30:29 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:30:29 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-100-1722396601 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-100
+ env
++ date
+ echo Wed Jul 31 05:31:44 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 05:31:44 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 36c5c8e5e2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722396704
+ git checkout -b scalability-no-128-32768-100-1722396704
Switched to a new branch 'scalability-no-128-32768-100-1722396704'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722396704 bc186d3392] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:32:12 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:32:12 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-100-1722396704 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-100
+ env
++ date
+ echo Wed Jul 31 05:33:26 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 05:33:26 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bc186d3392 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722396807
+ git checkout -b scalability-yes-32-32768-100-1722396807
Switched to a new branch 'scalability-yes-32-32768-100-1722396807'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722396807 88f9974f3d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722396807 e2bf9cc27b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:33:55 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:33:55 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-100-1722396807 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-100
+ env
++ date
+ echo Wed Jul 31 05:35:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 05:35:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e2bf9cc27b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722396911
+ git checkout -b scalability-yes-0-32768-100-1722396911
Switched to a new branch 'scalability-yes-0-32768-100-1722396911'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722396911 79a68d7cd2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:35:39 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:35:39 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-100-1722396911 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-100
+ env
++ date
+ echo Wed Jul 31 05:36:54 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 05:36:54 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 79a68d7cd2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722397015
+ git checkout -b scalability-yes-1-32768-100-1722397015
Switched to a new branch 'scalability-yes-1-32768-100-1722397015'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722397015 93c3ec22e8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722397015 6c4d6bea4f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:37:23 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:37:23 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-100-1722397015 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 05:38:39 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 05:38:39 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6c4d6bea4f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722397119
+ git checkout -b scalability-yes-1024-32768-100-1722397119
Switched to a new branch 'scalability-yes-1024-32768-100-1722397119'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722397119 a66df777e7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722397119 171b528696] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:39:08 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:39:08 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-100-1722397119 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-100
+ env
++ date
+ echo Wed Jul 31 05:40:24 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 05:40:24 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 171b528696 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722397224
+ git checkout -b scalability-yes-8-32768-100-1722397224
Switched to a new branch 'scalability-yes-8-32768-100-1722397224'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722397224 eafe3a7f6b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722397224 82f4ec5b52] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:40:52 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:40:52 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-100-1722397224 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-100
+ env
++ date
+ echo Wed Jul 31 05:42:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 05:42:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 82f4ec5b52 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722397327
+ git checkout -b scalability-yes-512-32768-100-1722397327
Switched to a new branch 'scalability-yes-512-32768-100-1722397327'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722397327 16d63ca238] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722397327 e08f7b8305] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:42:36 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:42:36 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-100-1722397327 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-100
+ env
++ date
+ echo Wed Jul 31 05:43:51 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 05:43:51 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e08f7b8305 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722397432
+ git checkout -b scalability-yes-128-32768-100-1722397432
Switched to a new branch 'scalability-yes-128-32768-100-1722397432'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722397432 fbf9728367] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722397432 f50863b25b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:44:20 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:44:20 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-100-1722397432 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-100
+ env
++ date
+ echo Wed Jul 31 05:45:35 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 05:45:35 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f50863b25b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722397536
+ git checkout -b scalability-no-32-32768-100-1722397536
Switched to a new branch 'scalability-no-32-32768-100-1722397536'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722397536 e18b48855f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:46:04 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:46:04 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-100-1722397536 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-100
+ env
++ date
+ echo Wed Jul 31 05:47:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 05:47:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e18b48855f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722397640
+ git checkout -b scalability-no-0-32768-100-1722397640
Switched to a new branch 'scalability-no-0-32768-100-1722397640'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:47:48 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:47:48 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-100-1722397640 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-100
+ env
++ date
+ echo Wed Jul 31 05:49:03 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 05:49:03 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722397743
+ git checkout -b scalability-no-1-32768-100-1722397743
Switched to a new branch 'scalability-no-1-32768-100-1722397743'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722397743 2304d52691] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:49:31 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:49:31 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-100-1722397743 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 05:50:47 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 05:50:47 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2304d52691 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722397847
+ git checkout -b scalability-no-1024-32768-100-1722397847
Switched to a new branch 'scalability-no-1024-32768-100-1722397847'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722397847 f26a59217b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:51:15 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:51:15 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-100-1722397847 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-100
+ env
++ date
+ echo Wed Jul 31 05:52:31 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 05:52:31 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f26a59217b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722397951
+ git checkout -b scalability-no-8-32768-100-1722397951
Switched to a new branch 'scalability-no-8-32768-100-1722397951'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722397951 6f83aea377] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:52:59 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:52:59 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-100-1722397951 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-100
+ env
++ date
+ echo Wed Jul 31 05:54:14 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 05:54:14 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6f83aea377 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722398055
+ git checkout -b scalability-no-512-32768-100-1722398055
Switched to a new branch 'scalability-no-512-32768-100-1722398055'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722398055 9d6518550e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:54:42 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:54:42 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-100-1722398055 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-100
+ env
++ date
+ echo Wed Jul 31 05:55:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 05:55:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9d6518550e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722398158
+ git checkout -b scalability-no-128-32768-100-1722398158
Switched to a new branch 'scalability-no-128-32768-100-1722398158'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722398158 d24d35719d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:56:26 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:56:26 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-100-1722398158 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-100
+ env
++ date
+ echo Wed Jul 31 05:57:42 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 05:57:42 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d24d35719d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722398262
+ git checkout -b scalability-yes-32-32768-100-1722398262
Switched to a new branch 'scalability-yes-32-32768-100-1722398262'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722398262 7d0df312e3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722398262 446e5fbee8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:58:10 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 05:58:10 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-100-1722398262 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-100
+ env
++ date
+ echo Wed Jul 31 06:16:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 06:16:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 446e5fbee8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722399385
+ git checkout -b scalability-yes-0-32768-100-1722399385
Switched to a new branch 'scalability-yes-0-32768-100-1722399385'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722399385 d5a520f2e0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:16:53 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 06:16:53 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-100-1722399385 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-100
+ env
++ date
+ echo Wed Jul 31 06:35:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 06:35:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d5a520f2e0 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722400503
+ git checkout -b scalability-yes-1-32768-100-1722400503
Switched to a new branch 'scalability-yes-1-32768-100-1722400503'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722400503 578a2a0ebf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722400503 e5182ee4ec] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:35:31 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 06:35:31 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-100-1722400503 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 06:53:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 06:53:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e5182ee4ec fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722401621
+ git checkout -b scalability-yes-1024-32768-100-1722401621
Switched to a new branch 'scalability-yes-1024-32768-100-1722401621'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722401621 b455932915] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722401621 c4e46aeda1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:54:09 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 06:54:09 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-100-1722401621 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-100
+ env
++ date
+ echo Wed Jul 31 07:12:26 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 07:12:26 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c4e46aeda1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722402746
+ git checkout -b scalability-yes-8-32768-100-1722402746
Switched to a new branch 'scalability-yes-8-32768-100-1722402746'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722402746 d55f694af9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722402746 e95d5a3b40] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:12:54 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 07:12:54 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-100-1722402746 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-100
+ env
++ date
+ echo Wed Jul 31 07:31:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 07:31:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e95d5a3b40 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722403867
+ git checkout -b scalability-yes-512-32768-100-1722403867
Switched to a new branch 'scalability-yes-512-32768-100-1722403867'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722403867 818ad0266e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722403867 ff6eae526f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:31:36 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 07:31:36 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-100-1722403867 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-100
+ env
++ date
+ echo Wed Jul 31 07:49:58 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 07:49:58 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ff6eae526f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722404998
+ git checkout -b scalability-yes-128-32768-100-1722404998
Switched to a new branch 'scalability-yes-128-32768-100-1722404998'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722404998 a98c570569] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722404998 75218119af] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:50:27 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 07:50:27 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-100-1722404998 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-100
+ env
++ date
+ echo Wed Jul 31 08:08:44 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 08:08:44 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 75218119af fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722406124
+ git checkout -b scalability-no-32-32768-100-1722406124
Switched to a new branch 'scalability-no-32-32768-100-1722406124'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722406124 448c8fcb79] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:09:12 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 08:09:12 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-100-1722406124 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-100
+ env
++ date
+ echo Wed Jul 31 08:27:27 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 08:27:27 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 448c8fcb79 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722407247
+ git checkout -b scalability-no-0-32768-100-1722407247
Switched to a new branch 'scalability-no-0-32768-100-1722407247'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:27:55 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 08:27:55 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-100-1722407247 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-100
+ env
++ date
+ echo Wed Jul 31 08:46:10 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 08:46:10 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722408370
+ git checkout -b scalability-no-1-32768-100-1722408370
Switched to a new branch 'scalability-no-1-32768-100-1722408370'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722408370 63a0e6e353] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:46:38 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 08:46:38 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-100-1722408370 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-100
+ env
++ date
+ echo Wed Jul 31 09:04:49 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 09:04:49 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 63a0e6e353 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722409490
+ git checkout -b scalability-no-1024-32768-100-1722409490
Switched to a new branch 'scalability-no-1024-32768-100-1722409490'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722409490 fcd6935e60] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:05:18 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 09:05:18 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-100-1722409490 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-100
+ env
++ date
+ echo Wed Jul 31 09:23:44 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 09:23:44 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fcd6935e60 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722410624
+ git checkout -b scalability-no-8-32768-100-1722410624
Switched to a new branch 'scalability-no-8-32768-100-1722410624'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722410624 def0701a37] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:24:12 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 09:24:12 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-100-1722410624 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-100
+ env
++ date
+ echo Wed Jul 31 09:42:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 09:42:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at def0701a37 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722411745
+ git checkout -b scalability-no-512-32768-100-1722411745
Switched to a new branch 'scalability-no-512-32768-100-1722411745'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722411745 5bfd44cbb2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:42:53 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 09:42:53 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-100-1722411745 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-100
+ env
++ date
+ echo Wed Jul 31 10:01:14 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 10:01:14 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5bfd44cbb2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722412874
+ git checkout -b scalability-no-128-32768-100-1722412874
Switched to a new branch 'scalability-no-128-32768-100-1722412874'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722412874 b3b4eeb7f1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:01:42 AM CEST 2024 'RUN   files: 32768  partitions: 100'
Wed Jul 31 10:01:42 AM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-100-1722412874 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-1
+ env
++ date
+ echo Wed Jul 31 10:19:53 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 10:19:53 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b3b4eeb7f1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722413993
+ git checkout -b scalability-yes-32-32768-1-1722413993
Switched to a new branch 'scalability-yes-32-32768-1-1722413993'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722413993 dc09232bb4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722413993 a6fbe8a6ff] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:20:45 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:20:45 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-1-1722413993 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-1
+ env
++ date
+ echo Wed Jul 31 10:22:01 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 10:22:01 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a6fbe8a6ff fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722414121
+ git checkout -b scalability-yes-0-32768-1-1722414121
Switched to a new branch 'scalability-yes-0-32768-1-1722414121'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722414121 bbd676d6c6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:22:54 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:22:54 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-1-1722414121 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-1
+ env
++ date
+ echo Wed Jul 31 10:24:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 10:24:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bbd676d6c6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722414249
+ git checkout -b scalability-yes-1-32768-1-1722414249
Switched to a new branch 'scalability-yes-1-32768-1-1722414249'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722414249 752a9bf8dc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722414249 e2bba24f35] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:25:01 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:25:01 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-1-1722414249 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 10:26:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 10:26:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e2bba24f35 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722414376
+ git checkout -b scalability-yes-1024-32768-1-1722414376
Switched to a new branch 'scalability-yes-1024-32768-1-1722414376'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722414376 fe242b4dbb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722414376 7adee7737f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:27:09 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:27:09 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-1-1722414376 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-1
+ env
++ date
+ echo Wed Jul 31 10:28:24 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 10:28:24 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7adee7737f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722414504
+ git checkout -b scalability-yes-8-32768-1-1722414504
Switched to a new branch 'scalability-yes-8-32768-1-1722414504'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722414504 24a1bb9d87] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722414504 eeb9881703] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:29:16 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:29:16 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-1-1722414504 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-1
+ env
++ date
+ echo Wed Jul 31 10:30:31 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 10:30:31 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eeb9881703 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722414631
+ git checkout -b scalability-yes-512-32768-1-1722414631
Switched to a new branch 'scalability-yes-512-32768-1-1722414631'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722414631 a9b7575e0a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722414631 0832c8c60d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:31:24 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:31:24 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-1-1722414631 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-1
+ env
++ date
+ echo Wed Jul 31 10:32:39 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 10:32:39 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0832c8c60d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722414759
+ git checkout -b scalability-yes-128-32768-1-1722414759
Switched to a new branch 'scalability-yes-128-32768-1-1722414759'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722414759 205d1509a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722414759 caf205f9f8] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:33:31 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:33:31 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-1-1722414759 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-1
+ env
++ date
+ echo Wed Jul 31 10:34:46 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 10:34:46 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at caf205f9f8 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722414886
+ git checkout -b scalability-no-32-32768-1-1722414886
Switched to a new branch 'scalability-no-32-32768-1-1722414886'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722414886 100eb6cfe0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:35:38 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:35:38 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-1-1722414886 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-1
+ env
++ date
+ echo Wed Jul 31 10:36:53 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 10:36:53 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 100eb6cfe0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722415013
+ git checkout -b scalability-no-0-32768-1-1722415013
Switched to a new branch 'scalability-no-0-32768-1-1722415013'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:37:45 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:37:45 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-1-1722415013 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-1
+ env
++ date
+ echo Wed Jul 31 10:39:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 10:39:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722415140
+ git checkout -b scalability-no-1-32768-1-1722415140
Switched to a new branch 'scalability-no-1-32768-1-1722415140'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722415140 a8edf49da8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:39:52 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:39:52 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-1-1722415140 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 10:41:06 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 10:41:06 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a8edf49da8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722415267
+ git checkout -b scalability-no-1024-32768-1-1722415267
Switched to a new branch 'scalability-no-1024-32768-1-1722415267'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722415267 80bdccf228] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:41:59 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:41:59 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-1-1722415267 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-1
+ env
++ date
+ echo Wed Jul 31 10:43:14 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 10:43:14 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 80bdccf228 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722415394
+ git checkout -b scalability-no-8-32768-1-1722415394
Switched to a new branch 'scalability-no-8-32768-1-1722415394'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722415394 ff8442fb72] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:44:07 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:44:07 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-1-1722415394 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-1
+ env
++ date
+ echo Wed Jul 31 10:45:21 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 10:45:21 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ff8442fb72 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722415521
+ git checkout -b scalability-no-512-32768-1-1722415521
Switched to a new branch 'scalability-no-512-32768-1-1722415521'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722415521 e8ff741a7c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:46:14 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:46:14 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-1-1722415521 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-1
+ env
++ date
+ echo Wed Jul 31 10:47:28 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 10:47:28 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e8ff741a7c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722415649
+ git checkout -b scalability-no-128-32768-1-1722415649
Switched to a new branch 'scalability-no-128-32768-1-1722415649'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722415649 441de4cf23] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:48:21 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:48:21 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-1-1722415649 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-1
+ env
++ date
+ echo Wed Jul 31 10:49:36 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 10:49:36 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 441de4cf23 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722415776
+ git checkout -b scalability-yes-32-32768-1-1722415776
Switched to a new branch 'scalability-yes-32-32768-1-1722415776'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722415776 ce8ccbe0e6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722415776 3fa1deea85] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:50:04 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:50:04 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-1-1722415776 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-1
+ env
++ date
+ echo Wed Jul 31 10:51:23 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 10:51:23 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3fa1deea85 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722415883
+ git checkout -b scalability-yes-0-32768-1-1722415883
Switched to a new branch 'scalability-yes-0-32768-1-1722415883'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722415883 767bfc7f57] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:51:51 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:51:51 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-1-1722415883 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-1
+ env
++ date
+ echo Wed Jul 31 10:53:10 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 10:53:10 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 767bfc7f57 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722415990
+ git checkout -b scalability-yes-1-32768-1-1722415990
Switched to a new branch 'scalability-yes-1-32768-1-1722415990'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722415990 c1de521425] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722415990 5907c0b6b9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:53:39 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:53:39 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-1-1722415990 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 10:54:58 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 10:54:58 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5907c0b6b9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722416098
+ git checkout -b scalability-yes-1024-32768-1-1722416098
Switched to a new branch 'scalability-yes-1024-32768-1-1722416098'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722416098 4f06790219] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722416098 3f244fdcf9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:55:26 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:55:26 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-1-1722416098 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-1
+ env
++ date
+ echo Wed Jul 31 10:56:45 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 10:56:45 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3f244fdcf9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722416205
+ git checkout -b scalability-yes-8-32768-1-1722416205
Switched to a new branch 'scalability-yes-8-32768-1-1722416205'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722416205 57b7d1617c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722416205 1e58dc59b9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:57:14 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:57:14 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-1-1722416205 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-1
+ env
++ date
+ echo Wed Jul 31 10:58:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 10:58:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1e58dc59b9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722416313
+ git checkout -b scalability-yes-512-32768-1-1722416313
Switched to a new branch 'scalability-yes-512-32768-1-1722416313'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722416313 5f7d0bfd5b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722416313 796205a7b0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:59:01 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 10:59:01 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-1-1722416313 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-1
+ env
++ date
+ echo Wed Jul 31 11:00:20 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 11:00:20 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 796205a7b0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722416420
+ git checkout -b scalability-yes-128-32768-1-1722416420
Switched to a new branch 'scalability-yes-128-32768-1-1722416420'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722416420 2ea1c2bf77] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722416420 20d9e6fa89] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:00:49 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:00:49 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-1-1722416420 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-1
+ env
++ date
+ echo Wed Jul 31 11:02:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 11:02:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 20d9e6fa89 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722416528
+ git checkout -b scalability-no-32-32768-1-1722416528
Switched to a new branch 'scalability-no-32-32768-1-1722416528'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722416528 0b3d863c38] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:02:36 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:02:36 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-1-1722416528 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-1
+ env
++ date
+ echo Wed Jul 31 11:03:55 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 11:03:55 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0b3d863c38 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722416635
+ git checkout -b scalability-no-0-32768-1-1722416635
Switched to a new branch 'scalability-no-0-32768-1-1722416635'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:04:23 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:04:23 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-1-1722416635 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-1
+ env
++ date
+ echo Wed Jul 31 11:05:42 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 11:05:42 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722416743
+ git checkout -b scalability-no-1-32768-1-1722416743
Switched to a new branch 'scalability-no-1-32768-1-1722416743'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722416743 4bdbcfbd46] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:06:11 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:06:11 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-1-1722416743 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 11:07:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 11:07:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4bdbcfbd46 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722416850
+ git checkout -b scalability-no-1024-32768-1-1722416850
Switched to a new branch 'scalability-no-1024-32768-1-1722416850'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722416850 220ed40031] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:07:58 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:07:58 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-1-1722416850 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-1
+ env
++ date
+ echo Wed Jul 31 11:09:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 11:09:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 220ed40031 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722416958
+ git checkout -b scalability-no-8-32768-1-1722416958
Switched to a new branch 'scalability-no-8-32768-1-1722416958'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722416958 e743c61ce2] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:09:46 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:09:46 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-1-1722416958 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-1
+ env
++ date
+ echo Wed Jul 31 11:11:05 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 11:11:05 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e743c61ce2 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722417065
+ git checkout -b scalability-no-512-32768-1-1722417065
Switched to a new branch 'scalability-no-512-32768-1-1722417065'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722417065 83b8d026c2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:11:34 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:11:34 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-1-1722417065 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-1
+ env
++ date
+ echo Wed Jul 31 11:12:52 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 11:12:52 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 83b8d026c2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722417173
+ git checkout -b scalability-no-128-32768-1-1722417173
Switched to a new branch 'scalability-no-128-32768-1-1722417173'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722417173 6d84601d58] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:13:20 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:13:20 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-1-1722417173 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-1
+ env
++ date
+ echo Wed Jul 31 11:14:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 11:14:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6d84601d58 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722417280
+ git checkout -b scalability-yes-32-32768-1-1722417280
Switched to a new branch 'scalability-yes-32-32768-1-1722417280'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722417280 27e1a068b2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722417280 5375662d4f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:15:08 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:15:08 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-1-1722417280 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-1
+ env
++ date
+ echo Wed Jul 31 11:16:21 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 11:16:21 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5375662d4f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722417382
+ git checkout -b scalability-yes-0-32768-1-1722417382
Switched to a new branch 'scalability-yes-0-32768-1-1722417382'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722417382 3d9baf4052] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:16:50 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:16:50 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-1-1722417382 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-1
+ env
++ date
+ echo Wed Jul 31 11:18:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 11:18:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3d9baf4052 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722417483
+ git checkout -b scalability-yes-1-32768-1-1722417483
Switched to a new branch 'scalability-yes-1-32768-1-1722417483'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722417483 e97e4293c9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722417483 25cd5ed660] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:18:32 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:18:32 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-1-1722417483 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 11:19:45 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 11:19:45 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 25cd5ed660 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722417585
+ git checkout -b scalability-yes-1024-32768-1-1722417585
Switched to a new branch 'scalability-yes-1024-32768-1-1722417585'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722417585 372b7a6b46] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722417585 8cd2f72683] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:20:14 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:20:14 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-1-1722417585 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-1
+ env
++ date
+ echo Wed Jul 31 11:21:28 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 11:21:28 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8cd2f72683 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722417688
+ git checkout -b scalability-yes-8-32768-1-1722417688
Switched to a new branch 'scalability-yes-8-32768-1-1722417688'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722417688 b929274294] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722417688 2274efac74] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:21:56 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:21:56 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-1-1722417688 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-1
+ env
++ date
+ echo Wed Jul 31 11:23:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 11:23:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2274efac74 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722417790
+ git checkout -b scalability-yes-512-32768-1-1722417790
Switched to a new branch 'scalability-yes-512-32768-1-1722417790'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722417790 7f48e718e8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722417790 a081eb735b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:23:37 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:23:37 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-1-1722417790 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-1
+ env
++ date
+ echo Wed Jul 31 11:24:51 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 11:24:51 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a081eb735b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722417891
+ git checkout -b scalability-yes-128-32768-1-1722417891
Switched to a new branch 'scalability-yes-128-32768-1-1722417891'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722417891 dc688f4d6c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722417891 0aebe7ca6b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:25:20 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:25:20 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-1-1722417891 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-1
+ env
++ date
+ echo Wed Jul 31 11:26:34 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 11:26:34 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0aebe7ca6b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722417994
+ git checkout -b scalability-no-32-32768-1-1722417994
Switched to a new branch 'scalability-no-32-32768-1-1722417994'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722417994 6203a6081d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:27:02 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:27:02 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-1-1722417994 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-1
+ env
++ date
+ echo Wed Jul 31 11:28:16 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 11:28:16 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6203a6081d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722418096
+ git checkout -b scalability-no-0-32768-1-1722418096
Switched to a new branch 'scalability-no-0-32768-1-1722418096'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:28:44 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:28:44 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-1-1722418096 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-1
+ env
++ date
+ echo Wed Jul 31 11:29:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 11:29:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722418198
+ git checkout -b scalability-no-1-32768-1-1722418198
Switched to a new branch 'scalability-no-1-32768-1-1722418198'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722418198 68b33c494c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:30:26 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:30:26 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-1-1722418198 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 11:31:40 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 11:31:40 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 68b33c494c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722418300
+ git checkout -b scalability-no-1024-32768-1-1722418300
Switched to a new branch 'scalability-no-1024-32768-1-1722418300'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722418300 507c248adb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:32:08 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:32:08 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-1-1722418300 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-1
+ env
++ date
+ echo Wed Jul 31 11:33:21 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 11:33:21 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 507c248adb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722418402
+ git checkout -b scalability-no-8-32768-1-1722418402
Switched to a new branch 'scalability-no-8-32768-1-1722418402'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722418402 05c51548f6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:33:49 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:33:49 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-1-1722418402 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-1
+ env
++ date
+ echo Wed Jul 31 11:35:03 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 11:35:03 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05c51548f6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722418503
+ git checkout -b scalability-no-512-32768-1-1722418503
Switched to a new branch 'scalability-no-512-32768-1-1722418503'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722418503 10d9e2eac9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:35:31 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:35:31 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-1-1722418503 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-1
+ env
++ date
+ echo Wed Jul 31 11:36:44 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 11:36:44 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 10d9e2eac9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722418604
+ git checkout -b scalability-no-128-32768-1-1722418604
Switched to a new branch 'scalability-no-128-32768-1-1722418604'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722418604 cb20bf4bc6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:37:12 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:37:12 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-1-1722418604 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-1
+ env
++ date
+ echo Wed Jul 31 11:38:26 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 11:38:26 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cb20bf4bc6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722418706
+ git checkout -b scalability-yes-32-32768-1-1722418706
Switched to a new branch 'scalability-yes-32-32768-1-1722418706'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722418706 c12e9a178c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722418706 69b83b170c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:38:55 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:38:55 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-1-1722418706 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-1
+ env
++ date
+ echo Wed Jul 31 11:40:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 11:40:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 69b83b170c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722418810
+ git checkout -b scalability-yes-0-32768-1-1722418810
Switched to a new branch 'scalability-yes-0-32768-1-1722418810'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722418810 f13e11208c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:40:37 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:40:37 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-1-1722418810 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-1
+ env
++ date
+ echo Wed Jul 31 11:41:52 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 11:41:52 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f13e11208c NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722418912
+ git checkout -b scalability-yes-1-32768-1-1722418912
Switched to a new branch 'scalability-yes-1-32768-1-1722418912'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722418912 ddc7788d6a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722418912 d9ebb6d97b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:42:20 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:42:20 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-1-1722418912 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 11:43:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 11:43:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d9ebb6d97b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722419015
+ git checkout -b scalability-yes-1024-32768-1-1722419015
Switched to a new branch 'scalability-yes-1024-32768-1-1722419015'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722419015 d9941f16e9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722419015 4c63c648f1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:44:03 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:44:03 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-1-1722419015 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-1
+ env
++ date
+ echo Wed Jul 31 11:45:18 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 11:45:18 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4c63c648f1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722419118
+ git checkout -b scalability-yes-8-32768-1-1722419118
Switched to a new branch 'scalability-yes-8-32768-1-1722419118'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722419118 1376c15530] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722419118 429bb2aeff] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:45:47 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:45:47 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-1-1722419118 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-1
+ env
++ date
+ echo Wed Jul 31 11:47:01 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 11:47:01 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 429bb2aeff fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722419221
+ git checkout -b scalability-yes-512-32768-1-1722419221
Switched to a new branch 'scalability-yes-512-32768-1-1722419221'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722419221 6145ff6784] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722419221 f8887c2d7a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:47:29 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:47:29 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-1-1722419221 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-1
+ env
++ date
+ echo Wed Jul 31 11:48:44 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 11:48:44 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f8887c2d7a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722419324
+ git checkout -b scalability-yes-128-32768-1-1722419324
Switched to a new branch 'scalability-yes-128-32768-1-1722419324'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722419324 ea98a2fdce] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722419324 6498a19519] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:49:12 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:49:12 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-1-1722419324 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-1
+ env
++ date
+ echo Wed Jul 31 11:50:27 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 11:50:27 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6498a19519 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722419427
+ git checkout -b scalability-no-32-32768-1-1722419427
Switched to a new branch 'scalability-no-32-32768-1-1722419427'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722419427 9817725a01] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:50:55 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:50:55 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-1-1722419427 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-1
+ env
++ date
+ echo Wed Jul 31 11:52:10 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 11:52:10 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9817725a01 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722419530
+ git checkout -b scalability-no-0-32768-1-1722419530
Switched to a new branch 'scalability-no-0-32768-1-1722419530'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:52:37 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:52:37 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-1-1722419530 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-1
+ env
++ date
+ echo Wed Jul 31 11:53:52 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 11:53:52 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722419632
+ git checkout -b scalability-no-1-32768-1-1722419632
Switched to a new branch 'scalability-no-1-32768-1-1722419632'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722419632 960d95d2c6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:54:20 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:54:20 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-1-1722419632 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 11:55:34 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 11:55:34 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 960d95d2c6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722419735
+ git checkout -b scalability-no-1024-32768-1-1722419735
Switched to a new branch 'scalability-no-1024-32768-1-1722419735'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722419735 56e539af71] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:56:03 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:56:03 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-1-1722419735 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-1
+ env
++ date
+ echo Wed Jul 31 11:57:17 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 11:57:17 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 56e539af71 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722419837
+ git checkout -b scalability-no-8-32768-1-1722419837
Switched to a new branch 'scalability-no-8-32768-1-1722419837'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722419837 9b19566eaa] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:57:46 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:57:46 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-1-1722419837 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-1
+ env
++ date
+ echo Wed Jul 31 11:59:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 11:59:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9b19566eaa fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722419941
+ git checkout -b scalability-no-512-32768-1-1722419941
Switched to a new branch 'scalability-no-512-32768-1-1722419941'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722419941 ab33dee32a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:59:28 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 11:59:28 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-1-1722419941 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-1
+ env
++ date
+ echo Wed Jul 31 12:00:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 12:00:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ab33dee32a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722420043
+ git checkout -b scalability-no-128-32768-1-1722420043
Switched to a new branch 'scalability-no-128-32768-1-1722420043'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722420043 eb1ea5fff1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:01:12 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:01:12 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-1-1722420043 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-1
+ env
++ date
+ echo Wed Jul 31 12:02:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 12:02:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eb1ea5fff1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722420146
+ git checkout -b scalability-yes-32-32768-1-1722420146
Switched to a new branch 'scalability-yes-32-32768-1-1722420146'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722420146 cd7f9d227c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722420146 c804c49d6d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:02:55 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:02:55 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-1-1722420146 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-1
+ env
++ date
+ echo Wed Jul 31 12:04:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 12:04:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c804c49d6d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722420284
+ git checkout -b scalability-yes-0-32768-1-1722420284
Switched to a new branch 'scalability-yes-0-32768-1-1722420284'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722420284 cece473dee] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:05:12 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:05:12 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-1-1722420284 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-1
+ env
++ date
+ echo Wed Jul 31 12:07:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 12:07:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cece473dee NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722420422
+ git checkout -b scalability-yes-1-32768-1-1722420422
Switched to a new branch 'scalability-yes-1-32768-1-1722420422'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722420422 768cfbec43] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722420422 2d0615fffb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:07:31 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:07:31 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-1-1722420422 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 12:09:22 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 12:09:22 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2d0615fffb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722420563
+ git checkout -b scalability-yes-1024-32768-1-1722420563
Switched to a new branch 'scalability-yes-1024-32768-1-1722420563'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722420563 4180c2a8e4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722420563 b1d422eb28] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:09:51 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:09:51 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-1-1722420563 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-1
+ env
++ date
+ echo Wed Jul 31 12:11:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 12:11:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b1d422eb28 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722420702
+ git checkout -b scalability-yes-8-32768-1-1722420702
Switched to a new branch 'scalability-yes-8-32768-1-1722420702'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722420702 fa53f996bf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722420702 a7ffe101b7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:12:10 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:12:10 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-1-1722420702 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-1
+ env
++ date
+ echo Wed Jul 31 12:14:00 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 12:14:00 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a7ffe101b7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722420840
+ git checkout -b scalability-yes-512-32768-1-1722420840
Switched to a new branch 'scalability-yes-512-32768-1-1722420840'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722420840 779b10a37b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722420840 0895f5d835] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:14:28 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:14:28 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-1-1722420840 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-1
+ env
++ date
+ echo Wed Jul 31 12:16:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 12:16:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0895f5d835 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722420980
+ git checkout -b scalability-yes-128-32768-1-1722420980
Switched to a new branch 'scalability-yes-128-32768-1-1722420980'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722420980 6d442f35ac] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722420980 9d6caa0896] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:16:48 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:16:48 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-1-1722420980 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-1
+ env
++ date
+ echo Wed Jul 31 12:18:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 12:18:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9d6caa0896 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722421117
+ git checkout -b scalability-no-32-32768-1-1722421117
Switched to a new branch 'scalability-no-32-32768-1-1722421117'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722421117 949e1e2d23] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:19:05 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:19:05 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-1-1722421117 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-1
+ env
++ date
+ echo Wed Jul 31 12:20:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 12:20:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 949e1e2d23 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722421256
+ git checkout -b scalability-no-0-32768-1-1722421256
Switched to a new branch 'scalability-no-0-32768-1-1722421256'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:21:25 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:21:25 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-1-1722421256 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-1
+ env
++ date
+ echo Wed Jul 31 12:23:15 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 12:23:15 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722421395
+ git checkout -b scalability-no-1-32768-1-1722421395
Switched to a new branch 'scalability-no-1-32768-1-1722421395'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722421395 fb19689432] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:23:44 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:23:44 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-1-1722421395 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-1
+ env
++ date
+ echo Wed Jul 31 12:25:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 12:25:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fb19689432 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722421535
+ git checkout -b scalability-no-1024-32768-1-1722421535
Switched to a new branch 'scalability-no-1024-32768-1-1722421535'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/1024/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722421535 830d26fd0e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:26:03 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:26:03 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-1-1722421535 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-1
+ env
++ date
+ echo Wed Jul 31 12:27:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 12:27:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 830d26fd0e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722421675
+ git checkout -b scalability-no-8-32768-1-1722421675
Switched to a new branch 'scalability-no-8-32768-1-1722421675'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722421675 609833a42d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:28:23 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:28:23 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-1-1722421675 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-1
+ env
++ date
+ echo Wed Jul 31 12:30:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 12:30:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 609833a42d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722421815
+ git checkout -b scalability-no-512-32768-1-1722421815
Switched to a new branch 'scalability-no-512-32768-1-1722421815'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722421815 c6682338a2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:30:43 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:30:43 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-1-1722421815 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-1
+ env
++ date
+ echo Wed Jul 31 12:32:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 12:32:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c6682338a2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722421953
+ git checkout -b scalability-no-128-32768-1-1722421953
Switched to a new branch 'scalability-no-128-32768-1-1722421953'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722421953 2622fb2293] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:33:01 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Wed Jul 31 12:33:01 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-1-1722421953 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-32-32768-0
+ env
++ date
+ echo Wed Jul 31 12:34:50 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 12:34:50 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2622fb2293 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722422091
+ git checkout -b scalability-yes-32-32768-0-1722422091
Switched to a new branch 'scalability-yes-32-32768-0-1722422091'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722422091 f0ff1af8c6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722422091 e1224a1243] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:35:43 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:35:43 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-0-1722422091 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-0-32768-0
+ env
++ date
+ echo Wed Jul 31 12:36:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 12:36:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e1224a1243 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722422218
+ git checkout -b scalability-yes-0-32768-0-1722422218
Switched to a new branch 'scalability-yes-0-32768-0-1722422218'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722422218 35c7488235] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:37:50 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:37:50 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-0-1722422218 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1-32768-0
+ env
++ date
+ echo Wed Jul 31 12:39:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 12:39:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 35c7488235 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722422345
+ git checkout -b scalability-yes-1-32768-0-1722422345
Switched to a new branch 'scalability-yes-1-32768-0-1722422345'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722422345 e7debe60f1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722422345 af2a849795] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:39:57 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:39:57 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-0-1722422345 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 12:41:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 12:41:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af2a849795 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722422472
+ git checkout -b scalability-yes-1024-32768-0-1722422472
Switched to a new branch 'scalability-yes-1024-32768-0-1722422472'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722422472 a75776b3af] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722422472 ea939badb7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:42:04 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:42:04 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-0-1722422472 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-8-32768-0
+ env
++ date
+ echo Wed Jul 31 12:43:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 12:43:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ea939badb7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722422599
+ git checkout -b scalability-yes-8-32768-0-1722422599
Switched to a new branch 'scalability-yes-8-32768-0-1722422599'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722422599 49b9dd5a8f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722422599 fbb2c6152f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:44:11 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:44:11 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-0-1722422599 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-512-32768-0
+ env
++ date
+ echo Wed Jul 31 12:45:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 12:45:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fbb2c6152f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722422726
+ git checkout -b scalability-yes-512-32768-0-1722422726
Switched to a new branch 'scalability-yes-512-32768-0-1722422726'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722422726 fe11d9107e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722422726 723f866a9c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:46:19 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:46:19 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-0-1722422726 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-yes-128-32768-0
+ env
++ date
+ echo Wed Jul 31 12:47:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 12:47:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 723f866a9c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722422853
+ git checkout -b scalability-yes-128-32768-0-1722422853
Switched to a new branch 'scalability-yes-128-32768-0-1722422853'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722422853 13f807b528] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722422853 6f20cb1a00] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:48:26 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:48:26 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-0-1722422853 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-32-32768-0
+ env
++ date
+ echo Wed Jul 31 12:49:41 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 12:49:41 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6f20cb1a00 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722422981
+ git checkout -b scalability-no-32-32768-0-1722422981
Switched to a new branch 'scalability-no-32-32768-0-1722422981'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722422981 3b1cda4a6e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:50:34 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:50:34 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-0-1722422981 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-0-32768-0
+ env
++ date
+ echo Wed Jul 31 12:51:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 12:51:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3b1cda4a6e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722423109
+ git checkout -b scalability-no-0-32768-0-1722423109
Switched to a new branch 'scalability-no-0-32768-0-1722423109'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:52:40 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:52:40 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-0-1722423109 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1-32768-0
+ env
++ date
+ echo Wed Jul 31 12:53:55 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 12:53:55 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722423235
+ git checkout -b scalability-no-1-32768-0-1722423235
Switched to a new branch 'scalability-no-1-32768-0-1722423235'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722423235 405466ef3d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:54:48 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:54:48 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-0-1722423235 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 12:56:03 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 12:56:03 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 405466ef3d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722423363
+ git checkout -b scalability-no-1024-32768-0-1722423363
Switched to a new branch 'scalability-no-1024-32768-0-1722423363'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722423363 6202d4221d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:56:56 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:56:56 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-0-1722423363 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-8-32768-0
+ env
++ date
+ echo Wed Jul 31 12:58:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 12:58:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6202d4221d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722423491
+ git checkout -b scalability-no-8-32768-0-1722423491
Switched to a new branch 'scalability-no-8-32768-0-1722423491'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722423491 218d0edff7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 12:59:02 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 12:59:02 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-0-1722423491 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-512-32768-0
+ env
++ date
+ echo Wed Jul 31 01:00:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 01:00:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 218d0edff7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722423617
+ git checkout -b scalability-no-512-32768-0-1722423617
Switched to a new branch 'scalability-no-512-32768-0-1722423617'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722423617 e0d69beefe] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:01:09 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:01:09 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-0-1722423617 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/index-no-128-32768-0
+ env
++ date
+ echo Wed Jul 31 01:02:24 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 01:02:24 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e0d69beefe fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722423744
+ git checkout -b scalability-no-128-32768-0-1722423744
Switched to a new branch 'scalability-no-128-32768-0-1722423744'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722423744 f75246ea64] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:03:17 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:03:17 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-0-1722423744 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/index-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-32-32768-0
+ env
++ date
+ echo Wed Jul 31 01:04:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 01:04:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f75246ea64 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722423872
+ git checkout -b scalability-yes-32-32768-0-1722423872
Switched to a new branch 'scalability-yes-32-32768-0-1722423872'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722423872 82f3dbbd0a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722423872 262b7fd3d7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:05:00 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:05:00 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-0-1722423872 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-0-32768-0
+ env
++ date
+ echo Wed Jul 31 01:06:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 01:06:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 262b7fd3d7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722423979
+ git checkout -b scalability-yes-0-32768-0-1722423979
Switched to a new branch 'scalability-yes-0-32768-0-1722423979'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722423979 a4e40ab4f9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:06:47 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:06:47 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-0-1722423979 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1-32768-0
+ env
++ date
+ echo Wed Jul 31 01:08:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 01:08:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a4e40ab4f9 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722424086
+ git checkout -b scalability-yes-1-32768-0-1722424086
Switched to a new branch 'scalability-yes-1-32768-0-1722424086'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722424086 7aa10e5cfd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722424086 d63ec09ff9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:08:34 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:08:34 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-0-1722424086 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 01:09:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 01:09:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d63ec09ff9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722424193
+ git checkout -b scalability-yes-1024-32768-0-1722424193
Switched to a new branch 'scalability-yes-1024-32768-0-1722424193'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722424193 97333be919] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722424193 b2eb0d97f1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:10:22 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:10:22 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-0-1722424193 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-8-32768-0
+ env
++ date
+ echo Wed Jul 31 01:11:40 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 01:11:40 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b2eb0d97f1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722424301
+ git checkout -b scalability-yes-8-32768-0-1722424301
Switched to a new branch 'scalability-yes-8-32768-0-1722424301'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722424301 3203776cf5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722424301 2c8b229571] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:12:09 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:12:09 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-0-1722424301 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-512-32768-0
+ env
++ date
+ echo Wed Jul 31 01:13:28 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 01:13:28 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2c8b229571 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722424408
+ git checkout -b scalability-yes-512-32768-0-1722424408
Switched to a new branch 'scalability-yes-512-32768-0-1722424408'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722424408 9dc8b7360a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722424408 fc46b9f4c2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:13:56 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:13:56 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-0-1722424408 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-yes-128-32768-0
+ env
++ date
+ echo Wed Jul 31 01:15:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 01:15:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fc46b9f4c2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722424515
+ git checkout -b scalability-yes-128-32768-0-1722424515
Switched to a new branch 'scalability-yes-128-32768-0-1722424515'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722424515 c3e9eea9db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722424515 dcbb5bb281] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:15:43 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:15:43 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-0-1722424515 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-32-32768-0
+ env
++ date
+ echo Wed Jul 31 01:17:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 01:17:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dcbb5bb281 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722424622
+ git checkout -b scalability-no-32-32768-0-1722424622
Switched to a new branch 'scalability-no-32-32768-0-1722424622'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722424622 3bd5c52305] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:17:30 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:17:30 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-0-1722424622 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-0-32768-0
+ env
++ date
+ echo Wed Jul 31 01:18:49 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 01:18:49 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3bd5c52305 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722424729
+ git checkout -b scalability-no-0-32768-0-1722424729
Switched to a new branch 'scalability-no-0-32768-0-1722424729'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:19:16 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:19:16 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-0-1722424729 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1-32768-0
+ env
++ date
+ echo Wed Jul 31 01:20:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 01:20:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722424835
+ git checkout -b scalability-no-1-32768-0-1722424835
Switched to a new branch 'scalability-no-1-32768-0-1722424835'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722424835 c9b3edd402] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:21:03 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:21:03 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-0-1722424835 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 01:22:22 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 01:22:22 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c9b3edd402 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722424942
+ git checkout -b scalability-no-1024-32768-0-1722424942
Switched to a new branch 'scalability-no-1024-32768-0-1722424942'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722424942 4288516c8b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:22:50 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:22:50 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-0-1722424942 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-8-32768-0
+ env
++ date
+ echo Wed Jul 31 01:24:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 01:24:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4288516c8b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722425050
+ git checkout -b scalability-no-8-32768-0-1722425050
Switched to a new branch 'scalability-no-8-32768-0-1722425050'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722425050 8212cd08a0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:24:38 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:24:38 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-0-1722425050 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-512-32768-0
+ env
++ date
+ echo Wed Jul 31 01:25:57 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 01:25:57 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8212cd08a0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722425157
+ git checkout -b scalability-no-512-32768-0-1722425157
Switched to a new branch 'scalability-no-512-32768-0-1722425157'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722425157 9654a6e37c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:26:25 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:26:25 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-0-1722425157 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/join-no-128-32768-0
+ env
++ date
+ echo Wed Jul 31 01:27:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 01:27:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9654a6e37c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722425264
+ git checkout -b scalability-no-128-32768-0-1722425264
Switched to a new branch 'scalability-no-128-32768-0-1722425264'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722425264 c05492f21b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:28:12 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:28:12 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-0-1722425264 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/join-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-32-32768-0
+ env
++ date
+ echo Wed Jul 31 01:29:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 01:29:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c05492f21b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722425371
+ git checkout -b scalability-yes-32-32768-0-1722425371
Switched to a new branch 'scalability-yes-32-32768-0-1722425371'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722425371 f2007c304b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722425371 2323499dac] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:30:00 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:30:00 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-0-1722425371 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-0-32768-0
+ env
++ date
+ echo Wed Jul 31 01:31:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 01:31:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2323499dac fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722425474
+ git checkout -b scalability-yes-0-32768-0-1722425474
Switched to a new branch 'scalability-yes-0-32768-0-1722425474'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722425474 a85fa9528c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:31:42 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:31:42 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-0-1722425474 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1-32768-0
+ env
++ date
+ echo Wed Jul 31 01:32:55 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 01:32:55 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a85fa9528c NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722425576
+ git checkout -b scalability-yes-1-32768-0-1722425576
Switched to a new branch 'scalability-yes-1-32768-0-1722425576'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722425576 5aba0aef3d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722425576 4da168363e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:33:24 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:33:24 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-0-1722425576 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 01:34:37 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 01:34:37 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4da168363e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722425677
+ git checkout -b scalability-yes-1024-32768-0-1722425677
Switched to a new branch 'scalability-yes-1024-32768-0-1722425677'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722425677 c3bcfad516] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722425677 2f76259d1d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:35:05 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:35:05 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-0-1722425677 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-8-32768-0
+ env
++ date
+ echo Wed Jul 31 01:36:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 01:36:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f76259d1d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722425779
+ git checkout -b scalability-yes-8-32768-0-1722425779
Switched to a new branch 'scalability-yes-8-32768-0-1722425779'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722425779 e764232fbb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722425779 4c5f36c186] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:36:48 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:36:48 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-0-1722425779 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-512-32768-0
+ env
++ date
+ echo Wed Jul 31 01:38:01 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 01:38:01 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4c5f36c186 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722425881
+ git checkout -b scalability-yes-512-32768-0-1722425881
Switched to a new branch 'scalability-yes-512-32768-0-1722425881'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722425881 05c43fe823] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722425881 562a220cd5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:38:29 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:38:29 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-0-1722425881 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-yes-128-32768-0
+ env
++ date
+ echo Wed Jul 31 01:39:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 01:39:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 562a220cd5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722425983
+ git checkout -b scalability-yes-128-32768-0-1722425983
Switched to a new branch 'scalability-yes-128-32768-0-1722425983'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722425983 657828dca3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722425983 ba5b5fb6ae] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:40:11 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:40:11 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-0-1722425983 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-32-32768-0
+ env
++ date
+ echo Wed Jul 31 01:41:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 01:41:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ba5b5fb6ae fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722426085
+ git checkout -b scalability-no-32-32768-0-1722426085
Switched to a new branch 'scalability-no-32-32768-0-1722426085'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722426085 29f9e6a153] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:41:53 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:41:53 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-0-1722426085 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-0-32768-0
+ env
++ date
+ echo Wed Jul 31 01:43:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 01:43:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 29f9e6a153 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722426187
+ git checkout -b scalability-no-0-32768-0-1722426187
Switched to a new branch 'scalability-no-0-32768-0-1722426187'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:43:35 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:43:35 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-0-1722426187 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1-32768-0
+ env
++ date
+ echo Wed Jul 31 01:44:49 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 01:44:49 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722426289
+ git checkout -b scalability-no-1-32768-0-1722426289
Switched to a new branch 'scalability-no-1-32768-0-1722426289'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722426289 d9f490cddb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:45:17 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:45:17 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-0-1722426289 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 01:46:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 01:46:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d9f490cddb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722426391
+ git checkout -b scalability-no-1024-32768-0-1722426391
Switched to a new branch 'scalability-no-1024-32768-0-1722426391'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/1024/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722426391 5783c5451c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:47:00 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:47:00 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-0-1722426391 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-8-32768-0
+ env
++ date
+ echo Wed Jul 31 01:48:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 01:48:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5783c5451c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722426494
+ git checkout -b scalability-no-8-32768-0-1722426494
Switched to a new branch 'scalability-no-8-32768-0-1722426494'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722426494 64f62a7a28] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:48:42 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:48:42 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-0-1722426494 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-512-32768-0
+ env
++ date
+ echo Wed Jul 31 01:49:55 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 01:49:55 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 64f62a7a28 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722426595
+ git checkout -b scalability-no-512-32768-0-1722426595
Switched to a new branch 'scalability-no-512-32768-0-1722426595'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722426595 7c337849eb] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:50:23 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:50:23 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-0-1722426595 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/count-no-128-32768-0
+ env
++ date
+ echo Wed Jul 31 01:51:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 01:51:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7c337849eb fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722426697
+ git checkout -b scalability-no-128-32768-0-1722426697
Switched to a new branch 'scalability-no-128-32768-0-1722426697'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722426697 8c65987063] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:52:05 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:52:05 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-0-1722426697 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/count-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-32-32768-0
+ env
++ date
+ echo Wed Jul 31 01:53:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 01:53:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8c65987063 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722426799
+ git checkout -b scalability-yes-32-32768-0-1722426799
Switched to a new branch 'scalability-yes-32-32768-0-1722426799'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722426799 79d845520a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722426799 a4d7f00d7c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:53:48 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:53:48 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-0-1722426799 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-0-32768-0
+ env
++ date
+ echo Wed Jul 31 01:55:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 01:55:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a4d7f00d7c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722426902
+ git checkout -b scalability-yes-0-32768-0-1722426902
Switched to a new branch 'scalability-yes-0-32768-0-1722426902'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722426902 237da1ebef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:55:30 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:55:30 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-0-1722426902 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1-32768-0
+ env
++ date
+ echo Wed Jul 31 01:56:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 01:56:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 237da1ebef NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722427005
+ git checkout -b scalability-yes-1-32768-0-1722427005
Switched to a new branch 'scalability-yes-1-32768-0-1722427005'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722427005 e94949e0e4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722427005 ac79b3910e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:57:13 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:57:13 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-0-1722427005 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 01:58:27 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 01:58:27 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac79b3910e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722427107
+ git checkout -b scalability-yes-1024-32768-0-1722427107
Switched to a new branch 'scalability-yes-1024-32768-0-1722427107'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722427107 a4cd905f66] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722427107 3898dd3fce] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 01:58:56 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 01:58:56 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-0-1722427107 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-8-32768-0
+ env
++ date
+ echo Wed Jul 31 02:00:11 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 02:00:11 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3898dd3fce fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722427211
+ git checkout -b scalability-yes-8-32768-0-1722427211
Switched to a new branch 'scalability-yes-8-32768-0-1722427211'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722427211 dc98a4459b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722427211 b258b48ca9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:00:39 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:00:39 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-0-1722427211 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-512-32768-0
+ env
++ date
+ echo Wed Jul 31 02:01:54 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 02:01:54 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b258b48ca9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722427314
+ git checkout -b scalability-yes-512-32768-0-1722427314
Switched to a new branch 'scalability-yes-512-32768-0-1722427314'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722427314 71e6c109dc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722427314 f7b442b7fa] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:02:22 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:02:22 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-0-1722427314 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-yes-128-32768-0
+ env
++ date
+ echo Wed Jul 31 02:03:37 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 02:03:37 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f7b442b7fa fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722427417
+ git checkout -b scalability-yes-128-32768-0-1722427417
Switched to a new branch 'scalability-yes-128-32768-0-1722427417'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722427417 0554edaeb3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722427417 ed7cc07412] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:04:05 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:04:05 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-0-1722427417 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-32-32768-0
+ env
++ date
+ echo Wed Jul 31 02:05:19 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 02:05:19 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ed7cc07412 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722427520
+ git checkout -b scalability-no-32-32768-0-1722427520
Switched to a new branch 'scalability-no-32-32768-0-1722427520'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722427520 a351b1826d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:05:48 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:05:48 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-0-1722427520 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-0-32768-0
+ env
++ date
+ echo Wed Jul 31 02:07:02 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 02:07:02 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a351b1826d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722427622
+ git checkout -b scalability-no-0-32768-0-1722427622
Switched to a new branch 'scalability-no-0-32768-0-1722427622'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:07:31 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:07:31 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-0-1722427622 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1-32768-0
+ env
++ date
+ echo Wed Jul 31 02:08:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 02:08:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722427725
+ git checkout -b scalability-no-1-32768-0-1722427725
Switched to a new branch 'scalability-no-1-32768-0-1722427725'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722427725 3bbbf9d0b1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:09:14 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:09:14 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-0-1722427725 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 02:10:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 02:10:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3bbbf9d0b1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722427828
+ git checkout -b scalability-no-1024-32768-0-1722427828
Switched to a new branch 'scalability-no-1024-32768-0-1722427828'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722427828 67385a0bb1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:10:56 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:10:56 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-0-1722427828 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-8-32768-0
+ env
++ date
+ echo Wed Jul 31 02:12:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 02:12:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 67385a0bb1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722427931
+ git checkout -b scalability-no-8-32768-0-1722427931
Switched to a new branch 'scalability-no-8-32768-0-1722427931'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722427931 91db7a8abd] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:12:39 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:12:39 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-0-1722427931 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-512-32768-0
+ env
++ date
+ echo Wed Jul 31 02:13:53 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 02:13:53 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 91db7a8abd fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722428033
+ git checkout -b scalability-no-512-32768-0-1722428033
Switched to a new branch 'scalability-no-512-32768-0-1722428033'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722428033 a8c397d38a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:14:22 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:14:22 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-0-1722428033 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/pgbench-no-128-32768-0
+ env
++ date
+ echo Wed Jul 31 02:15:36 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 02:15:36 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a8c397d38a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722428136
+ git checkout -b scalability-no-128-32768-0-1722428136
Switched to a new branch 'scalability-no-128-32768-0-1722428136'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722428136 680a9b8852] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:16:05 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:16:05 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-0-1722428136 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/pgbench-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-32-32768-0
+ env
++ date
+ echo Wed Jul 31 02:17:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 02:17:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 680a9b8852 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722428239
+ git checkout -b scalability-yes-32-32768-0-1722428239
Switched to a new branch 'scalability-yes-32-32768-0-1722428239'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722428239 0aa65a5473] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722428239 7c436ff29a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:17:47 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:17:47 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-0-1722428239 32768 yes 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-0-32768-0
+ env
++ date
+ echo Wed Jul 31 02:17:51 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 02:17:51 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7c436ff29a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722428271
+ git checkout -b scalability-yes-0-32768-0-1722428271
Switched to a new branch 'scalability-yes-0-32768-0-1722428271'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722428271 14dbc0e408] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:18:19 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:18:19 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-0-1722428271 32768 yes 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1-32768-0
+ env
++ date
+ echo Wed Jul 31 02:18:22 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 02:18:22 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 14dbc0e408 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722428303
+ git checkout -b scalability-yes-1-32768-0-1722428303
Switched to a new branch 'scalability-yes-1-32768-0-1722428303'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722428303 8d4fd0fa88] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722428303 c24c92c1d8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:18:52 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:18:52 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-0-1722428303 32768 yes 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 02:18:55 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 02:18:55 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c24c92c1d8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722428335
+ git checkout -b scalability-yes-1024-32768-0-1722428335
Switched to a new branch 'scalability-yes-1024-32768-0-1722428335'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722428335 b594f533c5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722428335 fc674aae13] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:19:24 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:19:24 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-0-1722428335 32768 yes 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-8-32768-0
+ env
++ date
+ echo Wed Jul 31 02:19:28 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 02:19:28 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fc674aae13 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722428368
+ git checkout -b scalability-yes-8-32768-0-1722428368
Switched to a new branch 'scalability-yes-8-32768-0-1722428368'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722428368 f1d9e51777] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722428368 27c0487595] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:19:57 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:19:57 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-0-1722428368 32768 yes 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-512-32768-0
+ env
++ date
+ echo Wed Jul 31 02:20:00 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 02:20:00 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 27c0487595 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722428400
+ git checkout -b scalability-yes-512-32768-0-1722428400
Switched to a new branch 'scalability-yes-512-32768-0-1722428400'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722428400 6f732184db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722428400 4dbda63447] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:20:29 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:20:29 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-0-1722428400 32768 yes 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-yes-128-32768-0
+ env
++ date
+ echo Wed Jul 31 02:20:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 02:20:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4dbda63447 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722428432
+ git checkout -b scalability-yes-128-32768-0-1722428432
Switched to a new branch 'scalability-yes-128-32768-0-1722428432'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722428432 14c92e55a5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722428432 65949ae7bf] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:21:01 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:21:01 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-0-1722428432 32768 yes 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-32-32768-0
+ env
++ date
+ echo Wed Jul 31 02:21:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 02:21:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65949ae7bf fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722428465
+ git checkout -b scalability-no-32-32768-0-1722428465
Switched to a new branch 'scalability-no-32-32768-0-1722428465'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722428465 c7a52ffa69] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:21:33 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:21:33 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-0-1722428465 32768 no 32 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-0-32768-0
+ env
++ date
+ echo Wed Jul 31 02:21:36 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 02:21:36 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c7a52ffa69 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722428497
+ git checkout -b scalability-no-0-32768-0-1722428497
Switched to a new branch 'scalability-no-0-32768-0-1722428497'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:22:05 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:22:05 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-0-1722428497 32768 no 0 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1-32768-0
+ env
++ date
+ echo Wed Jul 31 02:22:08 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 02:22:08 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722428528
+ git checkout -b scalability-no-1-32768-0-1722428528
Switched to a new branch 'scalability-no-1-32768-0-1722428528'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722428528 06033d26ec] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:22:37 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:22:37 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-0-1722428528 32768 no 1 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-1024-32768-0
+ env
++ date
+ echo Wed Jul 31 02:22:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 02:22:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 06033d26ec fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722428560
+ git checkout -b scalability-no-1024-32768-0-1722428560
Switched to a new branch 'scalability-no-1024-32768-0-1722428560'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722428560 e9a1e8e27c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:23:09 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:23:09 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-0-1722428560 32768 no 1024 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-8-32768-0
+ env
++ date
+ echo Wed Jul 31 02:23:12 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 02:23:12 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e9a1e8e27c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722428592
+ git checkout -b scalability-no-8-32768-0-1722428592
Switched to a new branch 'scalability-no-8-32768-0-1722428592'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722428592 f9e2cbd1ec] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:23:41 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:23:41 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-0-1722428592 32768 no 8 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-512-32768-0
+ env
++ date
+ echo Wed Jul 31 02:23:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 02:23:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f9e2cbd1ec fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722428625
+ git checkout -b scalability-no-512-32768-0-1722428625
Switched to a new branch 'scalability-no-512-32768-0-1722428625'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722428625 79fadc1699] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:24:13 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:24:13 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-0-1722428625 32768 no 512 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240730-1353-glibc-default/results/star-no-128-32768-0
+ env
++ date
+ echo Wed Jul 31 02:24:16 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 02:24:16 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 79fadc1699 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722428657
+ git checkout -b scalability-no-128-32768-0-1722428657
Switched to a new branch 'scalability-no-128-32768-0-1722428657'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722428657 1d02c36868] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:24:46 PM CEST 2024 'RUN   files: 32768  partitions: 0'
Wed Jul 31 02:24:46 PM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-0-1722428657 32768 no 128 /home/tomas/lock-scalability-test/20240730-1353-glibc-default/logs/star-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
