+ set -e
+ LABEL=glibc-tuned
+ MACHINE=xeon
+ DBNAME=test
+ RUNS=1
+ DURATION=10
+ CLIENTS='1 16 32'
+ PARTITIONS='1000 100 10 1 0'
+ BUILDS=/mnt/data/builds
+ SOURCE=/mnt/data/postgres
+ PATH_OLD=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
++ date +%Y%m%d-%H%M
+ DATE=20240731-2049
++ pwd
+ PATCHES=/home/tomas/lock-scalability-test/patches
++ pwd
+ LOGS=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs
++ pwd
+ RESULTS=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results
+ DATADIR=/mnt/pgdata/data-test
+ ulimit -n 35000
+ export MALLOC_TOP_PAD_=67108864
+ MALLOC_TOP_PAD_=67108864
+ export MALLOC_MMAP_THRESHOLD_=1048576
+ MALLOC_MMAP_THRESHOLD_=1048576
+ export MALLOC_TRIM_THRESHOLD_=1048576
+ MALLOC_TRIM_THRESHOLD_=1048576
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 08:49:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 08:49:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 39ace4b14e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722451797
+ git checkout -b scalability-yes-32-1000-1000-1722451797
Switched to a new branch 'scalability-yes-32-1000-1000-1722451797'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722451797 94ab3516ef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722451797 dcba6ca8f4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:50:45 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 08:50:45 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-1000-1722451797 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 08:52:45 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 08:52:45 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dcba6ca8f4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722451965
+ git checkout -b scalability-yes-0-1000-1000-1722451965
Switched to a new branch 'scalability-yes-0-1000-1000-1722451965'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722451965 f5b03980b5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:53:32 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 08:53:32 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-1000-1722451965 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 08:55:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 08:55:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f5b03980b5 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722452133
+ git checkout -b scalability-yes-1-1000-1000-1722452133
Switched to a new branch 'scalability-yes-1-1000-1000-1722452133'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722452133 d1e541753e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722452133 003fbdd539] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:56:21 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 08:56:21 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-1000-1722452133 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 08:58:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 08:58:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 003fbdd539 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722452300
+ git checkout -b scalability-yes-1024-1000-1000-1722452300
Switched to a new branch 'scalability-yes-1024-1000-1000-1722452300'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722452300 47381ddfb6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722452300 bee3a5e584] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 08:59:08 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 08:59:08 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-1000-1722452300 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:01:10 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 09:01:10 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bee3a5e584 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722452470
+ git checkout -b scalability-yes-8-1000-1000-1722452470
Switched to a new branch 'scalability-yes-8-1000-1000-1722452470'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722452470 42eafd7ad1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722452470 ebe146d2ab] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:01:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:01:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-1000-1722452470 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:03:58 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 09:03:58 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ebe146d2ab fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722452639
+ git checkout -b scalability-yes-512-1000-1000-1722452639
Switched to a new branch 'scalability-yes-512-1000-1000-1722452639'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722452639 320ef9b52b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722452639 9aeeb01aeb] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:04:47 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:04:47 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-1000-1722452639 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:06:46 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 09:06:46 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9aeeb01aeb fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722452806
+ git checkout -b scalability-yes-128-1000-1000-1722452806
Switched to a new branch 'scalability-yes-128-1000-1000-1722452806'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722452806 e5a4e8af40] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722452806 c5f21c2922] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:07:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:07:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-1000-1722452806 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:09:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 09:09:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c5f21c2922 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722452975
+ git checkout -b scalability-no-32-1000-1000-1722452975
Switched to a new branch 'scalability-no-32-1000-1000-1722452975'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722452975 c60a18fe40] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:10:24 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:10:24 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-1000-1722452975 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:12:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 09:12:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c60a18fe40 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722453141
+ git checkout -b scalability-no-0-1000-1000-1722453141
Switched to a new branch 'scalability-no-0-1000-1000-1722453141'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:13:09 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:13:09 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-1000-1722453141 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:15:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 09:15:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722453309
+ git checkout -b scalability-no-1-1000-1000-1722453309
Switched to a new branch 'scalability-no-1-1000-1000-1722453309'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/1/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722453309 e922bc8418] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:15:57 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:15:57 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-1000-1722453309 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:17:57 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 09:17:57 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e922bc8418 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722453477
+ git checkout -b scalability-no-1024-1000-1000-1722453477
Switched to a new branch 'scalability-no-1024-1000-1000-1722453477'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722453477 7811fae147] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:18:45 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:18:45 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-1000-1722453477 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:20:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 09:20:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7811fae147 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722453645
+ git checkout -b scalability-no-8-1000-1000-1722453645
Switched to a new branch 'scalability-no-8-1000-1000-1722453645'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722453645 311ee0d879] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:21:33 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:21:33 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-1000-1722453645 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:23:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 09:23:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 311ee0d879 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722453813
+ git checkout -b scalability-no-512-1000-1000-1722453813
Switched to a new branch 'scalability-no-512-1000-1000-1722453813'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722453813 0a66bacec6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:24:20 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:24:20 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-1000-1722453813 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:26:22 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 09:26:22 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0a66bacec6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722453982
+ git checkout -b scalability-no-128-1000-1000-1722453982
Switched to a new branch 'scalability-no-128-1000-1000-1722453982'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722453982 c17bf560d3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:27:10 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:27:10 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-1000-1722453982 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:29:10 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 09:29:10 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c17bf560d3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722454150
+ git checkout -b scalability-yes-32-1000-1000-1722454150
Switched to a new branch 'scalability-yes-32-1000-1000-1722454150'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722454150 fb0caef746] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722454150 71545c6192] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:29:38 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:29:38 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-1000-1722454150 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:31:09 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 09:31:09 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 71545c6192 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722454269
+ git checkout -b scalability-yes-0-1000-1000-1722454269
Switched to a new branch 'scalability-yes-0-1000-1000-1722454269'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722454269 9a735e6e22] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:31:37 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:31:37 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-1000-1722454269 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:33:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 09:33:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9a735e6e22 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722454388
+ git checkout -b scalability-yes-1-1000-1000-1722454388
Switched to a new branch 'scalability-yes-1-1000-1000-1722454388'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722454388 474bf30f59] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722454388 0bac8fd62d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:33:36 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:33:36 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-1000-1722454388 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:35:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 09:35:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0bac8fd62d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722454507
+ git checkout -b scalability-yes-1024-1000-1000-1722454507
Switched to a new branch 'scalability-yes-1024-1000-1000-1722454507'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722454507 514a70a049] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722454507 4bc07d2bd6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:35:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:35:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-1000-1722454507 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:37:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 09:37:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4bc07d2bd6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722454625
+ git checkout -b scalability-yes-8-1000-1000-1722454625
Switched to a new branch 'scalability-yes-8-1000-1000-1722454625'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722454625 b040821538] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722454625 58b3b98199] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:37:32 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:37:32 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-1000-1722454625 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:39:03 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 09:39:03 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 58b3b98199 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722454743
+ git checkout -b scalability-yes-512-1000-1000-1722454743
Switched to a new branch 'scalability-yes-512-1000-1000-1722454743'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722454743 6dd17beca7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722454743 ca0d54e308] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:39:31 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:39:31 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-1000-1722454743 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:41:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 09:41:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ca0d54e308 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722454862
+ git checkout -b scalability-yes-128-1000-1000-1722454862
Switched to a new branch 'scalability-yes-128-1000-1000-1722454862'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722454862 d17c6156de] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722454862 07b4f8dfc0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:41:30 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:41:30 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-1000-1722454862 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:43:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 09:43:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 07b4f8dfc0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722454981
+ git checkout -b scalability-no-32-1000-1000-1722454981
Switched to a new branch 'scalability-no-32-1000-1000-1722454981'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722454981 bf0d01330a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:43:28 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:43:28 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-1000-1722454981 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:44:59 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 09:44:59 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bf0d01330a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722455099
+ git checkout -b scalability-no-0-1000-1000-1722455099
Switched to a new branch 'scalability-no-0-1000-1000-1722455099'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:45:27 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:45:27 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-1000-1722455099 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:46:57 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 09:46:57 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722455217
+ git checkout -b scalability-no-1-1000-1000-1722455217
Switched to a new branch 'scalability-no-1-1000-1000-1722455217'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722455217 534b5debd9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:47:25 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:47:25 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-1000-1722455217 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:48:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 09:48:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 534b5debd9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722455336
+ git checkout -b scalability-no-1024-1000-1000-1722455336
Switched to a new branch 'scalability-no-1024-1000-1000-1722455336'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722455336 6a93dc2b43] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:49:23 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:49:23 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-1000-1722455336 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:50:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 09:50:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6a93dc2b43 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722455454
+ git checkout -b scalability-no-8-1000-1000-1722455454
Switched to a new branch 'scalability-no-8-1000-1000-1722455454'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722455454 793ad5b01d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:51:23 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:51:23 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-1000-1722455454 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:52:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 09:52:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 793ad5b01d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722455574
+ git checkout -b scalability-no-512-1000-1000-1722455574
Switched to a new branch 'scalability-no-512-1000-1000-1722455574'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722455574 bf5d365b9c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:53:22 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:53:22 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-1000-1722455574 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:54:53 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 09:54:53 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bf5d365b9c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722455693
+ git checkout -b scalability-no-128-1000-1000-1722455693
Switched to a new branch 'scalability-no-128-1000-1000-1722455693'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722455693 81a7b3f166] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:55:21 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:55:21 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-1000-1722455693 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:56:51 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 09:56:51 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 81a7b3f166 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722455811
+ git checkout -b scalability-yes-32-1000-1000-1722455811
Switched to a new branch 'scalability-yes-32-1000-1000-1722455811'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722455811 3b241c202a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722455811 270ed80333] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:57:19 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:57:19 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-1000-1722455811 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 09:58:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 09:58:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 270ed80333 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722455924
+ git checkout -b scalability-yes-0-1000-1000-1722455924
Switched to a new branch 'scalability-yes-0-1000-1000-1722455924'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722455924 26ed06bc44] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 09:59:13 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 09:59:13 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-1000-1722455924 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:00:38 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 10:00:38 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 26ed06bc44 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722456038
+ git checkout -b scalability-yes-1-1000-1000-1722456038
Switched to a new branch 'scalability-yes-1-1000-1000-1722456038'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722456038 ce0c40a6d3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722456038 123b976c40] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:01:06 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:01:06 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-1000-1722456038 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:02:30 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 10:02:30 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 123b976c40 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722456151
+ git checkout -b scalability-yes-1024-1000-1000-1722456151
Switched to a new branch 'scalability-yes-1024-1000-1000-1722456151'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722456151 65d318269a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722456151 efa66dfece] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:02:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:02:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-1000-1722456151 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:04:27 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 10:04:27 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at efa66dfece fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722456267
+ git checkout -b scalability-yes-8-1000-1000-1722456267
Switched to a new branch 'scalability-yes-8-1000-1000-1722456267'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722456267 480e34d006] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722456267 3573f55b24] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:04:55 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:04:55 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-1000-1722456267 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:06:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 10:06:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3573f55b24 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722456380
+ git checkout -b scalability-yes-512-1000-1000-1722456380
Switched to a new branch 'scalability-yes-512-1000-1000-1722456380'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722456380 07f9dad49d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722456380 15a17c9ccc] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:06:48 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:06:48 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-1000-1722456380 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:08:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 10:08:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 15a17c9ccc fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722456494
+ git checkout -b scalability-yes-128-1000-1000-1722456494
Switched to a new branch 'scalability-yes-128-1000-1000-1722456494'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722456494 710e861429] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722456494 af11a50fb7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:08:41 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:08:41 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-1000-1722456494 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:10:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 10:10:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af11a50fb7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722456607
+ git checkout -b scalability-no-32-1000-1000-1722456607
Switched to a new branch 'scalability-no-32-1000-1000-1722456607'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722456607 6fc27c25ca] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:10:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:10:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-1000-1722456607 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:11:59 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 10:11:59 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6fc27c25ca fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722456719
+ git checkout -b scalability-no-0-1000-1000-1722456719
Switched to a new branch 'scalability-no-0-1000-1000-1722456719'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:12:27 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:12:27 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-1000-1722456719 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:13:51 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 10:13:51 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722456832
+ git checkout -b scalability-no-1-1000-1000-1722456832
Switched to a new branch 'scalability-no-1-1000-1000-1722456832'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722456832 6fdf87a619] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:14:19 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:14:19 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-1000-1722456832 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:15:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 10:15:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6fdf87a619 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722456944
+ git checkout -b scalability-no-1024-1000-1000-1722456944
Switched to a new branch 'scalability-no-1024-1000-1000-1722456944'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722456944 439cc70d86] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:16:12 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:16:12 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-1000-1722456944 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:17:39 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 10:17:39 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 439cc70d86 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722457059
+ git checkout -b scalability-no-8-1000-1000-1722457059
Switched to a new branch 'scalability-no-8-1000-1000-1722457059'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722457059 cb6395e906] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:18:07 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:18:07 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-1000-1722457059 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:19:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 10:19:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cb6395e906 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722457172
+ git checkout -b scalability-no-512-1000-1000-1722457172
Switched to a new branch 'scalability-no-512-1000-1000-1722457172'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722457172 dea567a069] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:19:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:19:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-1000-1722457172 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:21:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 10:21:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dea567a069 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722457285
+ git checkout -b scalability-no-128-1000-1000-1722457285
Switched to a new branch 'scalability-no-128-1000-1000-1722457285'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722457285 056bdf1b74] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:21:53 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:21:53 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-1000-1722457285 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:23:18 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 10:23:18 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 056bdf1b74 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722457399
+ git checkout -b scalability-yes-32-1000-1000-1722457399
Switched to a new branch 'scalability-yes-32-1000-1000-1722457399'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722457399 cb36c329f0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722457399 3388aaf043] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:23:47 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:23:47 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-1000-1722457399 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:25:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 10:25:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3388aaf043 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722457507
+ git checkout -b scalability-yes-0-1000-1000-1722457507
Switched to a new branch 'scalability-yes-0-1000-1000-1722457507'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722457507 2ad7d9e451] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:25:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:25:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-1000-1722457507 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:26:55 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 10:26:55 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2ad7d9e451 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722457615
+ git checkout -b scalability-yes-1-1000-1000-1722457615
Switched to a new branch 'scalability-yes-1-1000-1000-1722457615'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722457615 0587c4a8c3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722457615 75e528c519] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:27:23 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:27:23 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-1000-1722457615 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:28:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 10:28:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 75e528c519 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722457723
+ git checkout -b scalability-yes-1024-1000-1000-1722457723
Switched to a new branch 'scalability-yes-1024-1000-1000-1722457723'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722457723 8a04b473b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722457723 06a075b769] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:29:11 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:29:11 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-1000-1722457723 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:30:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 10:30:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 06a075b769 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722457831
+ git checkout -b scalability-yes-8-1000-1000-1722457831
Switched to a new branch 'scalability-yes-8-1000-1000-1722457831'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722457831 7e64e91cd1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722457831 8d335bff37] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:30:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:30:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-1000-1722457831 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:32:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 10:32:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8d335bff37 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722457940
+ git checkout -b scalability-yes-512-1000-1000-1722457940
Switched to a new branch 'scalability-yes-512-1000-1000-1722457940'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722457940 8cd1118f34] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722457940 0ef2a7761e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:32:47 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:32:47 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-1000-1722457940 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:34:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 10:34:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0ef2a7761e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722458047
+ git checkout -b scalability-yes-128-1000-1000-1722458047
Switched to a new branch 'scalability-yes-128-1000-1000-1722458047'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722458047 178d892028] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722458047 8b2307e634] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:34:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:34:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-1000-1722458047 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:35:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 10:35:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8b2307e634 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722458156
+ git checkout -b scalability-no-32-1000-1000-1722458156
Switched to a new branch 'scalability-no-32-1000-1000-1722458156'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722458156 62b3167043] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:36:23 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:36:23 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-1000-1722458156 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:37:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 10:37:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 62b3167043 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722458263
+ git checkout -b scalability-no-0-1000-1000-1722458263
Switched to a new branch 'scalability-no-0-1000-1000-1722458263'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:38:11 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:38:11 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-1000-1722458263 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:39:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 10:39:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722458371
+ git checkout -b scalability-no-1-1000-1000-1722458371
Switched to a new branch 'scalability-no-1-1000-1000-1722458371'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722458371 ceb43a6f09] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:39:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:39:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-1000-1722458371 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:41:19 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 10:41:19 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ceb43a6f09 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722458480
+ git checkout -b scalability-no-1024-1000-1000-1722458480
Switched to a new branch 'scalability-no-1024-1000-1000-1722458480'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722458480 af50af3518] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:41:47 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:41:47 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-1000-1722458480 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:43:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 10:43:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af50af3518 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722458588
+ git checkout -b scalability-no-8-1000-1000-1722458588
Switched to a new branch 'scalability-no-8-1000-1000-1722458588'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722458588 fc4c5968f8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:43:35 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:43:35 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-1000-1722458588 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:44:55 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 10:44:55 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fc4c5968f8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722458695
+ git checkout -b scalability-no-512-1000-1000-1722458695
Switched to a new branch 'scalability-no-512-1000-1000-1722458695'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722458695 8cfab173a2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:45:23 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:45:23 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-1000-1722458695 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:46:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 10:46:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8cfab173a2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722458803
+ git checkout -b scalability-no-128-1000-1000-1722458803
Switched to a new branch 'scalability-no-128-1000-1000-1722458803'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722458803 2e7f1c901b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:47:11 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:47:11 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-1000-1722458803 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:48:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 10:48:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2e7f1c901b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722458911
+ git checkout -b scalability-yes-32-1000-1000-1722458911
Switched to a new branch 'scalability-yes-32-1000-1000-1722458911'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722458911 5b274e0eb4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722458911 dd9783697c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:48:59 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:48:59 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-1000-1722458911 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:49:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 10:49:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dd9783697c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722458942
+ git checkout -b scalability-yes-0-1000-1000-1722458942
Switched to a new branch 'scalability-yes-0-1000-1000-1722458942'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722458942 87bd2a49cf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:49:30 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:49:30 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-1000-1722458942 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:49:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 10:49:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 87bd2a49cf NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722458974
+ git checkout -b scalability-yes-1-1000-1000-1722458974
Switched to a new branch 'scalability-yes-1-1000-1000-1722458974'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722458974 e645ab1936] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722458974 e847007c22] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:50:01 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:50:01 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-1000-1722458974 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:50:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 10:50:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e847007c22 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722459005
+ git checkout -b scalability-yes-1024-1000-1000-1722459005
Switched to a new branch 'scalability-yes-1024-1000-1000-1722459005'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722459005 5ceab44236] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722459005 b149e320d9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:50:33 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:50:33 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-1000-1722459005 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:50:36 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 10:50:36 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b149e320d9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722459036
+ git checkout -b scalability-yes-8-1000-1000-1722459036
Switched to a new branch 'scalability-yes-8-1000-1000-1722459036'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722459036 fed400f7fd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722459036 2e79cbfc8b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:51:05 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:51:05 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-1000-1722459036 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:51:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 10:51:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2e79cbfc8b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722459069
+ git checkout -b scalability-yes-512-1000-1000-1722459069
Switched to a new branch 'scalability-yes-512-1000-1000-1722459069'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722459069 ecceed43c5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722459069 8636505cd3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:51:37 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:51:37 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-1000-1722459069 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:51:40 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 10:51:40 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8636505cd3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722459100
+ git checkout -b scalability-yes-128-1000-1000-1722459100
Switched to a new branch 'scalability-yes-128-1000-1000-1722459100'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722459100 0b3a4337ef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722459100 83bb6e85b1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:52:08 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:52:08 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-1000-1722459100 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:52:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 10:52:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 83bb6e85b1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722459132
+ git checkout -b scalability-no-32-1000-1000-1722459132
Switched to a new branch 'scalability-no-32-1000-1000-1722459132'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722459132 abbb07c9ff] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:52:40 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:52:40 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-1000-1722459132 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:52:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 10:52:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at abbb07c9ff fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722459163
+ git checkout -b scalability-no-0-1000-1000-1722459163
Switched to a new branch 'scalability-no-0-1000-1000-1722459163'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:53:11 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:53:11 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-1000-1722459163 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:53:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 10:53:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722459195
+ git checkout -b scalability-no-1-1000-1000-1722459195
Switched to a new branch 'scalability-no-1-1000-1000-1722459195'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722459195 f1ffa088a8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:53:42 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:53:42 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-1000-1722459195 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:53:46 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 10:53:46 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f1ffa088a8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722459226
+ git checkout -b scalability-no-1024-1000-1000-1722459226
Switched to a new branch 'scalability-no-1024-1000-1000-1722459226'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722459226 d8f87e6c24] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:54:14 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:54:14 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-1000-1722459226 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:54:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 10:54:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d8f87e6c24 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722459257
+ git checkout -b scalability-no-8-1000-1000-1722459257
Switched to a new branch 'scalability-no-8-1000-1000-1722459257'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722459257 aaf8dc4311] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:54:45 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:54:45 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-1000-1722459257 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:54:49 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 10:54:49 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at aaf8dc4311 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722459289
+ git checkout -b scalability-no-512-1000-1000-1722459289
Switched to a new branch 'scalability-no-512-1000-1000-1722459289'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722459289 0e5f870870] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:55:17 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:55:17 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-1000-1722459289 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-1000
+ env
++ date
+ echo Wed Jul 31 10:55:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 10:55:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0e5f870870 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722459321
+ git checkout -b scalability-no-128-1000-1000-1722459321
Switched to a new branch 'scalability-no-128-1000-1000-1722459321'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722459321 d79183568c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:55:49 PM CEST 2024 'RUN   files: 1000  partitions: 1000'
Wed Jul 31 10:55:49 PM CEST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-1000-1722459321 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-100
+ env
++ date
+ echo Wed Jul 31 10:55:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 10:55:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d79183568c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722459352
+ git checkout -b scalability-yes-32-1000-100-1722459352
Switched to a new branch 'scalability-yes-32-1000-100-1722459352'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722459352 085c06abca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722459352 1d43d4b04c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:56:41 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 10:56:41 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-100-1722459352 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-100
+ env
++ date
+ echo Wed Jul 31 10:58:00 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 10:58:00 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1d43d4b04c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722459480
+ git checkout -b scalability-yes-0-1000-100-1722459480
Switched to a new branch 'scalability-yes-0-1000-100-1722459480'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722459480 e625bd33b7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 10:58:48 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 10:58:48 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-100-1722459480 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-100
+ env
++ date
+ echo Wed Jul 31 11:00:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 11:00:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e625bd33b7 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722459608
+ git checkout -b scalability-yes-1-1000-100-1722459608
Switched to a new branch 'scalability-yes-1-1000-100-1722459608'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722459608 e13f157df6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722459608 c07a3cc21d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:00:56 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:00:56 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-100-1722459608 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-100
+ env
++ date
+ echo Wed Jul 31 11:02:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 11:02:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c07a3cc21d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722459735
+ git checkout -b scalability-yes-1024-1000-100-1722459735
Switched to a new branch 'scalability-yes-1024-1000-100-1722459735'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722459735 814f6a4a85] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722459735 dc34c49e15] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:03:03 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:03:03 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-100-1722459735 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-100
+ env
++ date
+ echo Wed Jul 31 11:04:23 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 11:04:23 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dc34c49e15 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722459863
+ git checkout -b scalability-yes-8-1000-100-1722459863
Switched to a new branch 'scalability-yes-8-1000-100-1722459863'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722459863 ece508b140] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722459863 140923660e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:05:11 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:05:11 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-100-1722459863 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-100
+ env
++ date
+ echo Wed Jul 31 11:06:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 11:06:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 140923660e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722459991
+ git checkout -b scalability-yes-512-1000-100-1722459991
Switched to a new branch 'scalability-yes-512-1000-100-1722459991'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722459991 5be319a432] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722459991 fa20888d10] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:07:19 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:07:19 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-100-1722459991 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-100
+ env
++ date
+ echo Wed Jul 31 11:08:38 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 11:08:38 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fa20888d10 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722460119
+ git checkout -b scalability-yes-128-1000-100-1722460119
Switched to a new branch 'scalability-yes-128-1000-100-1722460119'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722460119 319bccb390] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722460119 f1015bc1de] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:09:26 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:09:26 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-100-1722460119 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-100
+ env
++ date
+ echo Wed Jul 31 11:10:46 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 11:10:46 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f1015bc1de fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722460246
+ git checkout -b scalability-no-32-1000-100-1722460246
Switched to a new branch 'scalability-no-32-1000-100-1722460246'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722460246 f0cfa0c1ed] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:11:34 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:11:34 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-100-1722460246 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-100
+ env
++ date
+ echo Wed Jul 31 11:12:53 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 11:12:53 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f0cfa0c1ed fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722460374
+ git checkout -b scalability-no-0-1000-100-1722460374
Switched to a new branch 'scalability-no-0-1000-100-1722460374'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:13:41 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:13:41 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-100-1722460374 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-100
+ env
++ date
+ echo Wed Jul 31 11:15:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 11:15:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722460501
+ git checkout -b scalability-no-1-1000-100-1722460501
Switched to a new branch 'scalability-no-1-1000-100-1722460501'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722460501 3c023d4026] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:15:49 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:15:49 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-100-1722460501 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-100
+ env
++ date
+ echo Wed Jul 31 11:17:08 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 11:17:08 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3c023d4026 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722460628
+ git checkout -b scalability-no-1024-1000-100-1722460628
Switched to a new branch 'scalability-no-1024-1000-100-1722460628'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722460628 7a66d9eff1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:17:56 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:17:56 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-100-1722460628 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-100
+ env
++ date
+ echo Wed Jul 31 11:19:16 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 11:19:16 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7a66d9eff1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722460756
+ git checkout -b scalability-no-8-1000-100-1722460756
Switched to a new branch 'scalability-no-8-1000-100-1722460756'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722460756 58ebf67f6e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:20:04 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:20:04 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-100-1722460756 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-100
+ env
++ date
+ echo Wed Jul 31 11:21:23 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 11:21:23 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 58ebf67f6e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722460883
+ git checkout -b scalability-no-512-1000-100-1722460883
Switched to a new branch 'scalability-no-512-1000-100-1722460883'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/512/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722460883 3e75f2de4e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:22:11 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:22:11 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-100-1722460883 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-100
+ env
++ date
+ echo Wed Jul 31 11:23:30 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 11:23:30 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3e75f2de4e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722461010
+ git checkout -b scalability-no-128-1000-100-1722461010
Switched to a new branch 'scalability-no-128-1000-100-1722461010'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722461010 ab9df2070d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:24:18 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:24:18 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-100-1722461010 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-100
+ env
++ date
+ echo Wed Jul 31 11:25:38 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 11:25:38 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ab9df2070d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722461138
+ git checkout -b scalability-yes-32-1000-100-1722461138
Switched to a new branch 'scalability-yes-32-1000-100-1722461138'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722461138 9b0e01a38a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722461138 427e3d727a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:26:06 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:26:06 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-100-1722461138 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-100
+ env
++ date
+ echo Wed Jul 31 11:27:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 11:27:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 427e3d727a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722461246
+ git checkout -b scalability-yes-0-1000-100-1722461246
Switched to a new branch 'scalability-yes-0-1000-100-1722461246'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722461246 b1f6f38818] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:27:55 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:27:55 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-100-1722461246 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-100
+ env
++ date
+ echo Wed Jul 31 11:29:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 11:29:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b1f6f38818 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722461355
+ git checkout -b scalability-yes-1-1000-100-1722461355
Switched to a new branch 'scalability-yes-1-1000-100-1722461355'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722461355 c65a03cb47] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722461355 dde3d64e55] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:29:43 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:29:43 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-100-1722461355 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-100
+ env
++ date
+ echo Wed Jul 31 11:31:04 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 11:31:04 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dde3d64e55 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722461464
+ git checkout -b scalability-yes-1024-1000-100-1722461464
Switched to a new branch 'scalability-yes-1024-1000-100-1722461464'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722461464 8e8a9b2fed] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722461464 0b95271631] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:31:32 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:31:32 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-100-1722461464 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-100
+ env
++ date
+ echo Wed Jul 31 11:32:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 11:32:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0b95271631 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722461572
+ git checkout -b scalability-yes-8-1000-100-1722461572
Switched to a new branch 'scalability-yes-8-1000-100-1722461572'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722461572 d8b690559c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722461572 d17c624186] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:33:20 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:33:20 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-100-1722461572 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-100
+ env
++ date
+ echo Wed Jul 31 11:34:40 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 11:34:40 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d17c624186 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722461681
+ git checkout -b scalability-yes-512-1000-100-1722461681
Switched to a new branch 'scalability-yes-512-1000-100-1722461681'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722461681 6231a131be] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722461681 687398ca07] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:35:08 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:35:08 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-100-1722461681 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-100
+ env
++ date
+ echo Wed Jul 31 11:36:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 11:36:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 687398ca07 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722461789
+ git checkout -b scalability-yes-128-1000-100-1722461789
Switched to a new branch 'scalability-yes-128-1000-100-1722461789'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722461789 fd417fcaa2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722461789 7df6465afd] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:36:56 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:36:56 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-100-1722461789 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-100
+ env
++ date
+ echo Wed Jul 31 11:38:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 11:38:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7df6465afd fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722461897
+ git checkout -b scalability-no-32-1000-100-1722461897
Switched to a new branch 'scalability-no-32-1000-100-1722461897'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722461897 55ed453733] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:38:45 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:38:45 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-100-1722461897 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-100
+ env
++ date
+ echo Wed Jul 31 11:40:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 11:40:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 55ed453733 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722462005
+ git checkout -b scalability-no-0-1000-100-1722462005
Switched to a new branch 'scalability-no-0-1000-100-1722462005'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:40:33 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:40:33 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-100-1722462005 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-100
+ env
++ date
+ echo Wed Jul 31 11:41:53 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 11:41:53 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722462114
+ git checkout -b scalability-no-1-1000-100-1722462114
Switched to a new branch 'scalability-no-1-1000-100-1722462114'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722462114 6d9fbc0b3e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:42:21 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:42:21 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-100-1722462114 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-100
+ env
++ date
+ echo Wed Jul 31 11:43:42 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 11:43:42 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6d9fbc0b3e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722462222
+ git checkout -b scalability-no-1024-1000-100-1722462222
Switched to a new branch 'scalability-no-1024-1000-100-1722462222'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722462222 cd6e853b7d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:44:10 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:44:10 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-100-1722462222 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-100
+ env
++ date
+ echo Wed Jul 31 11:45:30 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 11:45:30 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cd6e853b7d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722462331
+ git checkout -b scalability-no-8-1000-100-1722462331
Switched to a new branch 'scalability-no-8-1000-100-1722462331'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722462331 86f43f27f8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:45:59 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:45:59 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-100-1722462331 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-100
+ env
++ date
+ echo Wed Jul 31 11:47:19 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 11:47:19 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 86f43f27f8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722462440
+ git checkout -b scalability-no-512-1000-100-1722462440
Switched to a new branch 'scalability-no-512-1000-100-1722462440'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722462440 f1bade930d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:47:48 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:47:48 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-100-1722462440 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-100
+ env
++ date
+ echo Wed Jul 31 11:49:08 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 11:49:08 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f1bade930d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722462548
+ git checkout -b scalability-no-128-1000-100-1722462548
Switched to a new branch 'scalability-no-128-1000-100-1722462548'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722462548 2a4596e68e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:49:36 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:49:36 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-100-1722462548 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-100
+ env
++ date
+ echo Wed Jul 31 11:50:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 11:50:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2a4596e68e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722462657
+ git checkout -b scalability-yes-32-1000-100-1722462657
Switched to a new branch 'scalability-yes-32-1000-100-1722462657'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722462657 18ca568836] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722462657 47e44a0e6f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:51:25 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:51:25 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-100-1722462657 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-100
+ env
++ date
+ echo Wed Jul 31 11:52:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 11:52:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 47e44a0e6f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722462759
+ git checkout -b scalability-yes-0-1000-100-1722462759
Switched to a new branch 'scalability-yes-0-1000-100-1722462759'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722462759 213c7150f7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:53:07 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:53:07 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-100-1722462759 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-100
+ env
++ date
+ echo Wed Jul 31 11:54:22 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 11:54:22 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 213c7150f7 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722462862
+ git checkout -b scalability-yes-1-1000-100-1722462862
Switched to a new branch 'scalability-yes-1-1000-100-1722462862'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722462862 f15989b0d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722462862 9fb386af8b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:54:50 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:54:50 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-100-1722462862 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-100
+ env
++ date
+ echo Wed Jul 31 11:56:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 11:56:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9fb386af8b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722462965
+ git checkout -b scalability-yes-1024-1000-100-1722462965
Switched to a new branch 'scalability-yes-1024-1000-100-1722462965'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722462965 6ebcea57e5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722462965 94618997e0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:56:33 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:56:33 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-100-1722462965 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-100
+ env
++ date
+ echo Wed Jul 31 11:57:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 11:57:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 94618997e0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722463068
+ git checkout -b scalability-yes-8-1000-100-1722463068
Switched to a new branch 'scalability-yes-8-1000-100-1722463068'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722463068 63cc5ba964] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722463068 b317ed74b4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:58:16 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:58:16 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-100-1722463068 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-100
+ env
++ date
+ echo Wed Jul 31 11:59:30 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 11:59:30 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b317ed74b4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722463170
+ git checkout -b scalability-yes-512-1000-100-1722463170
Switched to a new branch 'scalability-yes-512-1000-100-1722463170'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722463170 c8cc015912] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722463170 dcc04fbb71] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 11:59:58 PM CEST 2024 'RUN   files: 1000  partitions: 100'
Wed Jul 31 11:59:58 PM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-100-1722463170 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-100
+ env
++ date
+ echo Thu Aug 1 12:01:12 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 12:01:12 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dcc04fbb71 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722463273
+ git checkout -b scalability-yes-128-1000-100-1722463273
Switched to a new branch 'scalability-yes-128-1000-100-1722463273'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722463273 c739ab24d9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722463273 a17026ddc3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:01:40 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:01:40 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-100-1722463273 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-100
+ env
++ date
+ echo Thu Aug 1 12:02:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 12:02:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a17026ddc3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722463375
+ git checkout -b scalability-no-32-1000-100-1722463375
Switched to a new branch 'scalability-no-32-1000-100-1722463375'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722463375 1f6572b41e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:03:22 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:03:22 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-100-1722463375 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-100
+ env
++ date
+ echo Thu Aug 1 12:04:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 12:04:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1f6572b41e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722463476
+ git checkout -b scalability-no-0-1000-100-1722463476
Switched to a new branch 'scalability-no-0-1000-100-1722463476'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:05:04 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:05:04 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-100-1722463476 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-100
+ env
++ date
+ echo Thu Aug 1 12:06:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 12:06:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722463578
+ git checkout -b scalability-no-1-1000-100-1722463578
Switched to a new branch 'scalability-no-1-1000-100-1722463578'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722463578 376a73f4bf] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:06:46 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:06:46 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-100-1722463578 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-100
+ env
++ date
+ echo Thu Aug 1 12:08:01 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 12:08:01 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 376a73f4bf fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722463681
+ git checkout -b scalability-no-1024-1000-100-1722463681
Switched to a new branch 'scalability-no-1024-1000-100-1722463681'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722463681 772b216f87] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:08:28 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:08:28 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-100-1722463681 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-100
+ env
++ date
+ echo Thu Aug 1 12:09:43 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 12:09:43 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 772b216f87 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722463783
+ git checkout -b scalability-no-8-1000-100-1722463783
Switched to a new branch 'scalability-no-8-1000-100-1722463783'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722463783 b4b022ddcd] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:10:11 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:10:11 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-100-1722463783 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-100
+ env
++ date
+ echo Thu Aug 1 12:11:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 12:11:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b4b022ddcd fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722463886
+ git checkout -b scalability-no-512-1000-100-1722463886
Switched to a new branch 'scalability-no-512-1000-100-1722463886'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722463886 378ca75fd6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:11:54 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:11:54 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-100-1722463886 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-100
+ env
++ date
+ echo Thu Aug 1 12:13:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 12:13:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 378ca75fd6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722463989
+ git checkout -b scalability-no-128-1000-100-1722463989
Switched to a new branch 'scalability-no-128-1000-100-1722463989'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722463989 8da3e69302] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:13:37 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:13:37 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-100-1722463989 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-100
+ env
++ date
+ echo Thu Aug 1 12:14:52 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 12:14:52 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8da3e69302 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722464092
+ git checkout -b scalability-yes-32-1000-100-1722464092
Switched to a new branch 'scalability-yes-32-1000-100-1722464092'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722464092 4258a1e684] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722464092 dd2c3df939] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:15:20 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:15:20 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-100-1722464092 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-100
+ env
++ date
+ echo Thu Aug 1 12:16:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 12:16:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dd2c3df939 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722464195
+ git checkout -b scalability-yes-0-1000-100-1722464195
Switched to a new branch 'scalability-yes-0-1000-100-1722464195'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722464195 d87fa9cbbc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:17:03 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:17:03 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-100-1722464195 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-100
+ env
++ date
+ echo Thu Aug 1 12:18:19 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 12:18:19 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d87fa9cbbc NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722464299
+ git checkout -b scalability-yes-1-1000-100-1722464299
Switched to a new branch 'scalability-yes-1-1000-100-1722464299'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722464299 1506c41298] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722464299 a205cd4a45] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:18:47 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:18:47 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-100-1722464299 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-100
+ env
++ date
+ echo Thu Aug 1 12:20:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 12:20:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a205cd4a45 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722464403
+ git checkout -b scalability-yes-1024-1000-100-1722464403
Switched to a new branch 'scalability-yes-1024-1000-100-1722464403'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722464403 2f8d43e76a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722464403 49219b94b7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:20:31 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:20:31 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-100-1722464403 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-100
+ env
++ date
+ echo Thu Aug 1 12:21:46 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 12:21:46 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 49219b94b7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722464506
+ git checkout -b scalability-yes-8-1000-100-1722464506
Switched to a new branch 'scalability-yes-8-1000-100-1722464506'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722464506 77f192f848] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722464506 151b4cc5c1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:22:14 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:22:14 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-100-1722464506 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-100
+ env
++ date
+ echo Thu Aug 1 12:23:30 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 12:23:30 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 151b4cc5c1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722464610
+ git checkout -b scalability-yes-512-1000-100-1722464610
Switched to a new branch 'scalability-yes-512-1000-100-1722464610'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722464610 50363485ec] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722464610 32c274bbc1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:23:58 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:23:58 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-100-1722464610 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-100
+ env
++ date
+ echo Thu Aug 1 12:25:14 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 12:25:14 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 32c274bbc1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722464714
+ git checkout -b scalability-yes-128-1000-100-1722464714
Switched to a new branch 'scalability-yes-128-1000-100-1722464714'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722464714 c862e82806] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722464714 3b1281497e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:25:42 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:25:42 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-100-1722464714 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-100
+ env
++ date
+ echo Thu Aug 1 12:26:57 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 12:26:57 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3b1281497e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722464818
+ git checkout -b scalability-no-32-1000-100-1722464818
Switched to a new branch 'scalability-no-32-1000-100-1722464818'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722464818 58d4dee3f2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:27:25 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:27:25 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-100-1722464818 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-100
+ env
++ date
+ echo Thu Aug 1 12:28:41 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 12:28:41 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 58d4dee3f2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722464921
+ git checkout -b scalability-no-0-1000-100-1722464921
Switched to a new branch 'scalability-no-0-1000-100-1722464921'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:29:08 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:29:08 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-100-1722464921 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-100
+ env
++ date
+ echo Thu Aug 1 12:30:24 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 12:30:24 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722465024
+ git checkout -b scalability-no-1-1000-100-1722465024
Switched to a new branch 'scalability-no-1-1000-100-1722465024'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722465024 11c193f5bf] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:30:52 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:30:52 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-100-1722465024 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-100
+ env
++ date
+ echo Thu Aug 1 12:32:07 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 12:32:07 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 11c193f5bf fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722465127
+ git checkout -b scalability-no-1024-1000-100-1722465127
Switched to a new branch 'scalability-no-1024-1000-100-1722465127'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722465127 eb540933a6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:32:35 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:32:35 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-100-1722465127 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-100
+ env
++ date
+ echo Thu Aug 1 12:33:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 12:33:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eb540933a6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722465231
+ git checkout -b scalability-no-8-1000-100-1722465231
Switched to a new branch 'scalability-no-8-1000-100-1722465231'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722465231 321c37f476] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:34:19 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:34:19 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-100-1722465231 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-100
+ env
++ date
+ echo Thu Aug 1 12:35:34 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 12:35:34 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 321c37f476 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722465335
+ git checkout -b scalability-no-512-1000-100-1722465335
Switched to a new branch 'scalability-no-512-1000-100-1722465335'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722465335 aa0615b5f9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:36:02 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:36:02 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-100-1722465335 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-100
+ env
++ date
+ echo Thu Aug 1 12:37:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 12:37:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at aa0615b5f9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722465438
+ git checkout -b scalability-no-128-1000-100-1722465438
Switched to a new branch 'scalability-no-128-1000-100-1722465438'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722465438 0b456c3400] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:37:46 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:37:46 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-100-1722465438 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-100
+ env
++ date
+ echo Thu Aug 1 12:39:01 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 12:39:01 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0b456c3400 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722465541
+ git checkout -b scalability-yes-32-1000-100-1722465541
Switched to a new branch 'scalability-yes-32-1000-100-1722465541'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722465541 3d2dca96dd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722465541 da59d7203f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:39:29 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:39:29 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-100-1722465541 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-100
+ env
++ date
+ echo Thu Aug 1 12:57:44 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 12:57:44 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at da59d7203f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722466664
+ git checkout -b scalability-yes-0-1000-100-1722466664
Switched to a new branch 'scalability-yes-0-1000-100-1722466664'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722466664 65a4f54d26] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:58:11 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 12:58:11 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-100-1722466664 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-100
+ env
++ date
+ echo Thu Aug 1 01:16:20 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 01:16:20 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65a4f54d26 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722467780
+ git checkout -b scalability-yes-1-1000-100-1722467780
Switched to a new branch 'scalability-yes-1-1000-100-1722467780'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722467780 6d4269bb6d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722467780 b1ae45a462] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:16:47 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 01:16:47 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-100-1722467780 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-100
+ env
++ date
+ echo Thu Aug 1 01:34:52 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 01:34:52 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b1ae45a462 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722468892
+ git checkout -b scalability-yes-1024-1000-100-1722468892
Switched to a new branch 'scalability-yes-1024-1000-100-1722468892'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722468892 1b1ae8f3ea] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722468892 c5138c3deb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:35:20 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 01:35:20 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-100-1722468892 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-100
+ env
++ date
+ echo Thu Aug 1 01:53:44 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 01:53:44 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c5138c3deb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722470024
+ git checkout -b scalability-yes-8-1000-100-1722470024
Switched to a new branch 'scalability-yes-8-1000-100-1722470024'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722470024 a17aaf80cc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722470024 ddc868acb2] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:54:12 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 01:54:12 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-100-1722470024 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-100
+ env
++ date
+ echo Thu Aug 1 02:12:27 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 02:12:27 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ddc868acb2 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722471147
+ git checkout -b scalability-yes-512-1000-100-1722471147
Switched to a new branch 'scalability-yes-512-1000-100-1722471147'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722471147 9d360865c8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722471147 07e7917cd4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:12:55 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 02:12:55 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-100-1722471147 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-100
+ env
++ date
+ echo Thu Aug 1 02:31:13 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 02:31:13 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 07e7917cd4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722472273
+ git checkout -b scalability-yes-128-1000-100-1722472273
Switched to a new branch 'scalability-yes-128-1000-100-1722472273'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722472273 c67e198df7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722472273 7a8e43026a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:31:41 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 02:31:41 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-100-1722472273 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-100
+ env
++ date
+ echo Thu Aug 1 02:49:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 02:49:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7a8e43026a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722473400
+ git checkout -b scalability-no-32-1000-100-1722473400
Switched to a new branch 'scalability-no-32-1000-100-1722473400'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722473400 f5e2c8eb8f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:50:27 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 02:50:27 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-100-1722473400 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-100
+ env
++ date
+ echo Thu Aug 1 03:08:38 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 03:08:38 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f5e2c8eb8f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722474518
+ git checkout -b scalability-no-0-1000-100-1722474518
Switched to a new branch 'scalability-no-0-1000-100-1722474518'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:09:06 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 03:09:06 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-100-1722474518 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-100
+ env
++ date
+ echo Thu Aug 1 03:27:17 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 03:27:17 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722475637
+ git checkout -b scalability-no-1-1000-100-1722475637
Switched to a new branch 'scalability-no-1-1000-100-1722475637'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722475637 65ee0ff7b8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:27:45 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 03:27:45 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-100-1722475637 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-100
+ env
++ date
+ echo Thu Aug 1 03:45:57 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 03:45:57 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65ee0ff7b8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722476757
+ git checkout -b scalability-no-1024-1000-100-1722476757
Switched to a new branch 'scalability-no-1024-1000-100-1722476757'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722476757 234b534c80] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:46:25 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 03:46:25 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-100-1722476757 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-100
+ env
++ date
+ echo Thu Aug 1 04:04:46 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 04:04:46 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 234b534c80 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722477886
+ git checkout -b scalability-no-8-1000-100-1722477886
Switched to a new branch 'scalability-no-8-1000-100-1722477886'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722477886 356258d8c5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 04:05:14 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 04:05:14 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-100-1722477886 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-100
+ env
++ date
+ echo Thu Aug 1 04:23:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 04:23:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 356258d8c5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722479005
+ git checkout -b scalability-no-512-1000-100-1722479005
Switched to a new branch 'scalability-no-512-1000-100-1722479005'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722479005 5d692c27bd] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 04:23:52 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 04:23:52 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-100-1722479005 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-100
+ env
++ date
+ echo Thu Aug 1 04:42:05 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 04:42:05 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5d692c27bd fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722480126
+ git checkout -b scalability-no-128-1000-100-1722480126
Switched to a new branch 'scalability-no-128-1000-100-1722480126'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722480126 8ba6a39aae] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 04:42:33 AM CEST 2024 'RUN   files: 1000  partitions: 100'
Thu Aug 1 04:42:33 AM CEST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-100-1722480126 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-10
+ env
++ date
+ echo Thu Aug 1 05:00:47 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 05:00:47 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8ba6a39aae fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722481247
+ git checkout -b scalability-yes-32-1000-10-1722481247
Switched to a new branch 'scalability-yes-32-1000-10-1722481247'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722481247 a449782108] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722481247 97a9ea677a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:01:15 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:01:15 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-10-1722481247 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-10
+ env
++ date
+ echo Thu Aug 1 05:02:31 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 05:02:31 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 97a9ea677a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722481351
+ git checkout -b scalability-yes-0-1000-10-1722481351
Switched to a new branch 'scalability-yes-0-1000-10-1722481351'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722481351 880f35962e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:02:59 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:02:59 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-10-1722481351 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-10
+ env
++ date
+ echo Thu Aug 1 05:04:14 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 05:04:14 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 880f35962e NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722481455
+ git checkout -b scalability-yes-1-1000-10-1722481455
Switched to a new branch 'scalability-yes-1-1000-10-1722481455'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722481455 c044404211] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722481455 80b6665a20] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:04:43 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:04:43 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-10-1722481455 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 05:05:58 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 05:05:58 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 80b6665a20 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722481558
+ git checkout -b scalability-yes-1024-1000-10-1722481558
Switched to a new branch 'scalability-yes-1024-1000-10-1722481558'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722481558 828e0f4d7e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722481558 f882d366bf] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:06:26 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:06:26 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-10-1722481558 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-10
+ env
++ date
+ echo Thu Aug 1 05:07:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 05:07:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f882d366bf fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722481662
+ git checkout -b scalability-yes-8-1000-10-1722481662
Switched to a new branch 'scalability-yes-8-1000-10-1722481662'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722481662 efb5e5f404] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722481662 84c2c5626d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:08:10 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:08:10 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-10-1722481662 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-10
+ env
++ date
+ echo Thu Aug 1 05:09:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 05:09:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 84c2c5626d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722481765
+ git checkout -b scalability-yes-512-1000-10-1722481765
Switched to a new branch 'scalability-yes-512-1000-10-1722481765'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722481765 c4dba88e57] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722481765 e2eb826d87] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:09:54 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:09:54 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-10-1722481765 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-10
+ env
++ date
+ echo Thu Aug 1 05:11:09 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 05:11:09 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e2eb826d87 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722481869
+ git checkout -b scalability-yes-128-1000-10-1722481869
Switched to a new branch 'scalability-yes-128-1000-10-1722481869'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722481869 dca76407b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722481869 2f4363453a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:11:37 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:11:37 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-10-1722481869 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-10
+ env
++ date
+ echo Thu Aug 1 05:12:53 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 05:12:53 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f4363453a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722481973
+ git checkout -b scalability-no-32-1000-10-1722481973
Switched to a new branch 'scalability-no-32-1000-10-1722481973'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722481973 0dde553c77] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:13:21 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:13:21 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-10-1722481973 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-10
+ env
++ date
+ echo Thu Aug 1 05:14:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 05:14:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0dde553c77 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722482076
+ git checkout -b scalability-no-0-1000-10-1722482076
Switched to a new branch 'scalability-no-0-1000-10-1722482076'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:15:04 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:15:04 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-10-1722482076 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-10
+ env
++ date
+ echo Thu Aug 1 05:16:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 05:16:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722482179
+ git checkout -b scalability-no-1-1000-10-1722482179
Switched to a new branch 'scalability-no-1-1000-10-1722482179'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722482179 617f91b2ab] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:16:47 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:16:47 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-10-1722482179 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 05:18:02 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 05:18:02 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 617f91b2ab fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722482282
+ git checkout -b scalability-no-1024-1000-10-1722482282
Switched to a new branch 'scalability-no-1024-1000-10-1722482282'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722482282 9ba6452d9d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:18:30 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:18:30 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-10-1722482282 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-10
+ env
++ date
+ echo Thu Aug 1 05:19:45 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 05:19:45 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9ba6452d9d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722482386
+ git checkout -b scalability-no-8-1000-10-1722482386
Switched to a new branch 'scalability-no-8-1000-10-1722482386'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722482386 0c33727d35] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:20:14 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:20:14 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-10-1722482386 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-10
+ env
++ date
+ echo Thu Aug 1 05:21:29 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 05:21:29 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0c33727d35 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722482489
+ git checkout -b scalability-no-512-1000-10-1722482489
Switched to a new branch 'scalability-no-512-1000-10-1722482489'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722482489 50f7ae19b7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:21:57 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:21:57 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-10-1722482489 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-10
+ env
++ date
+ echo Thu Aug 1 05:23:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 05:23:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 50f7ae19b7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722482592
+ git checkout -b scalability-no-128-1000-10-1722482592
Switched to a new branch 'scalability-no-128-1000-10-1722482592'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722482592 f06269f474] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:23:40 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:23:40 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-10-1722482592 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-10
+ env
++ date
+ echo Thu Aug 1 05:24:55 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 05:24:55 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f06269f474 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722482695
+ git checkout -b scalability-yes-32-1000-10-1722482695
Switched to a new branch 'scalability-yes-32-1000-10-1722482695'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722482695 29ea61e921] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722482695 3adca4ac51] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:25:23 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:25:23 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-10-1722482695 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-10
+ env
++ date
+ echo Thu Aug 1 05:26:42 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 05:26:42 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3adca4ac51 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722482802
+ git checkout -b scalability-yes-0-1000-10-1722482802
Switched to a new branch 'scalability-yes-0-1000-10-1722482802'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722482802 0deb1fadb2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:27:10 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:27:10 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-10-1722482802 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-10
+ env
++ date
+ echo Thu Aug 1 05:28:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 05:28:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0deb1fadb2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722482909
+ git checkout -b scalability-yes-1-1000-10-1722482909
Switched to a new branch 'scalability-yes-1-1000-10-1722482909'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722482909 071b0d1ddd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722482909 26335e4b7f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:28:56 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:28:56 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-10-1722482909 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 05:30:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 05:30:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 26335e4b7f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722483016
+ git checkout -b scalability-yes-1024-1000-10-1722483016
Switched to a new branch 'scalability-yes-1024-1000-10-1722483016'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722483016 11b451102e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722483016 91948fccaa] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:30:44 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:30:44 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-10-1722483016 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-10
+ env
++ date
+ echo Thu Aug 1 05:32:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 05:32:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 91948fccaa fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722483123
+ git checkout -b scalability-yes-8-1000-10-1722483123
Switched to a new branch 'scalability-yes-8-1000-10-1722483123'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722483123 8f1104b5ce] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722483123 a7451e2801] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:32:31 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:32:31 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-10-1722483123 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-10
+ env
++ date
+ echo Thu Aug 1 05:33:50 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 05:33:50 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a7451e2801 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722483230
+ git checkout -b scalability-yes-512-1000-10-1722483230
Switched to a new branch 'scalability-yes-512-1000-10-1722483230'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722483230 b0d099df6b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722483230 e704ab3099] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:34:18 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:34:18 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-10-1722483230 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-10
+ env
++ date
+ echo Thu Aug 1 05:35:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 05:35:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e704ab3099 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722483338
+ git checkout -b scalability-yes-128-1000-10-1722483338
Switched to a new branch 'scalability-yes-128-1000-10-1722483338'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722483338 0ab4c796e4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722483338 4e79859ea7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:36:05 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:36:05 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-10-1722483338 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-10
+ env
++ date
+ echo Thu Aug 1 05:37:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 05:37:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4e79859ea7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722483445
+ git checkout -b scalability-no-32-1000-10-1722483445
Switched to a new branch 'scalability-no-32-1000-10-1722483445'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722483445 587b7c94fc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:37:53 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:37:53 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-10-1722483445 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-10
+ env
++ date
+ echo Thu Aug 1 05:39:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 05:39:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 587b7c94fc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722483552
+ git checkout -b scalability-no-0-1000-10-1722483552
Switched to a new branch 'scalability-no-0-1000-10-1722483552'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:39:40 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:39:40 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-10-1722483552 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-10
+ env
++ date
+ echo Thu Aug 1 05:40:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 05:40:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722483659
+ git checkout -b scalability-no-1-1000-10-1722483659
Switched to a new branch 'scalability-no-1-1000-10-1722483659'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722483659 55f6cea117] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:41:27 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:41:27 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-10-1722483659 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 05:42:46 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 05:42:46 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 55f6cea117 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722483767
+ git checkout -b scalability-no-1024-1000-10-1722483767
Switched to a new branch 'scalability-no-1024-1000-10-1722483767'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722483767 d1ef5c4a2d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:43:15 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:43:15 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-10-1722483767 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-10
+ env
++ date
+ echo Thu Aug 1 05:44:34 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 05:44:34 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d1ef5c4a2d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722483874
+ git checkout -b scalability-no-8-1000-10-1722483874
Switched to a new branch 'scalability-no-8-1000-10-1722483874'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722483874 e1db64d91d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:45:02 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:45:02 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-10-1722483874 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-10
+ env
++ date
+ echo Thu Aug 1 05:46:21 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 05:46:21 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e1db64d91d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722483981
+ git checkout -b scalability-no-512-1000-10-1722483981
Switched to a new branch 'scalability-no-512-1000-10-1722483981'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722483981 df9a560e29] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:46:49 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:46:49 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-10-1722483981 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-10
+ env
++ date
+ echo Thu Aug 1 05:48:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 05:48:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at df9a560e29 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722484088
+ git checkout -b scalability-no-128-1000-10-1722484088
Switched to a new branch 'scalability-no-128-1000-10-1722484088'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722484088 21beaa5f53] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:48:36 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:48:36 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-10-1722484088 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-10
+ env
++ date
+ echo Thu Aug 1 05:49:55 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 05:49:55 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 21beaa5f53 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722484196
+ git checkout -b scalability-yes-32-1000-10-1722484196
Switched to a new branch 'scalability-yes-32-1000-10-1722484196'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722484196 63e89aeb1f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722484196 41b2c8f588] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:50:23 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:50:23 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-10-1722484196 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-10
+ env
++ date
+ echo Thu Aug 1 05:51:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 05:51:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 41b2c8f588 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722484297
+ git checkout -b scalability-yes-0-1000-10-1722484297
Switched to a new branch 'scalability-yes-0-1000-10-1722484297'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722484297 711fbd1b86] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:52:06 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:52:06 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-10-1722484297 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-10
+ env
++ date
+ echo Thu Aug 1 05:53:19 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 05:53:19 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 711fbd1b86 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722484399
+ git checkout -b scalability-yes-1-1000-10-1722484399
Switched to a new branch 'scalability-yes-1-1000-10-1722484399'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722484399 cad1f90e93] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722484399 7eda53eb1b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:53:47 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:53:47 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-10-1722484399 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 05:55:01 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 05:55:01 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7eda53eb1b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722484501
+ git checkout -b scalability-yes-1024-1000-10-1722484501
Switched to a new branch 'scalability-yes-1024-1000-10-1722484501'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722484501 ed47c21404] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722484501 3fbeccb7fa] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:55:29 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:55:29 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-10-1722484501 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-10
+ env
++ date
+ echo Thu Aug 1 05:56:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 05:56:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3fbeccb7fa fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722484603
+ git checkout -b scalability-yes-8-1000-10-1722484603
Switched to a new branch 'scalability-yes-8-1000-10-1722484603'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722484603 9bea08b3e5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722484603 344cb2e3d4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:57:12 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:57:12 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-10-1722484603 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-10
+ env
++ date
+ echo Thu Aug 1 05:58:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 05:58:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 344cb2e3d4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722484705
+ git checkout -b scalability-yes-512-1000-10-1722484705
Switched to a new branch 'scalability-yes-512-1000-10-1722484705'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722484705 52bf9e46e0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722484705 b72b91a77a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:58:53 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 05:58:53 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-10-1722484705 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-10
+ env
++ date
+ echo Thu Aug 1 06:00:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 06:00:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b72b91a77a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722484807
+ git checkout -b scalability-yes-128-1000-10-1722484807
Switched to a new branch 'scalability-yes-128-1000-10-1722484807'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722484807 ddfb2205f4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722484807 6386e7c4df] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:00:35 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:00:35 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-10-1722484807 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-10
+ env
++ date
+ echo Thu Aug 1 06:01:49 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 06:01:49 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6386e7c4df fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722484909
+ git checkout -b scalability-no-32-1000-10-1722484909
Switched to a new branch 'scalability-no-32-1000-10-1722484909'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722484909 ae79a71c54] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:02:17 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:02:17 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-10-1722484909 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-10
+ env
++ date
+ echo Thu Aug 1 06:03:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 06:03:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ae79a71c54 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722485010
+ git checkout -b scalability-no-0-1000-10-1722485010
Switched to a new branch 'scalability-no-0-1000-10-1722485010'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:03:58 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:03:58 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-10-1722485010 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-10
+ env
++ date
+ echo Thu Aug 1 06:05:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 06:05:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722485112
+ git checkout -b scalability-no-1-1000-10-1722485112
Switched to a new branch 'scalability-no-1-1000-10-1722485112'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722485112 c44f87ea66] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:05:40 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:05:40 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-10-1722485112 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 06:06:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 06:06:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c44f87ea66 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722485214
+ git checkout -b scalability-no-1024-1000-10-1722485214
Switched to a new branch 'scalability-no-1024-1000-10-1722485214'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722485214 32620deecb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:07:22 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:07:22 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-10-1722485214 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-10
+ env
++ date
+ echo Thu Aug 1 06:08:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 06:08:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 32620deecb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722485316
+ git checkout -b scalability-no-8-1000-10-1722485316
Switched to a new branch 'scalability-no-8-1000-10-1722485316'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722485316 bfedb3dc79] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:09:05 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:09:05 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-10-1722485316 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-10
+ env
++ date
+ echo Thu Aug 1 06:10:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 06:10:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bfedb3dc79 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722485419
+ git checkout -b scalability-no-512-1000-10-1722485419
Switched to a new branch 'scalability-no-512-1000-10-1722485419'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722485419 a8d3b0b669] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:10:47 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:10:47 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-10-1722485419 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-10
+ env
++ date
+ echo Thu Aug 1 06:12:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 06:12:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a8d3b0b669 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722485520
+ git checkout -b scalability-no-128-1000-10-1722485520
Switched to a new branch 'scalability-no-128-1000-10-1722485520'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722485520 79fb41e7c4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:12:28 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:12:28 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-10-1722485520 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-10
+ env
++ date
+ echo Thu Aug 1 06:13:42 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 06:13:42 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 79fb41e7c4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722485622
+ git checkout -b scalability-yes-32-1000-10-1722485622
Switched to a new branch 'scalability-yes-32-1000-10-1722485622'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722485622 677a5ce9be] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722485622 d4288fb9e6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:14:10 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:14:10 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-10-1722485622 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-10
+ env
++ date
+ echo Thu Aug 1 06:15:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 06:15:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d4288fb9e6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722485725
+ git checkout -b scalability-yes-0-1000-10-1722485725
Switched to a new branch 'scalability-yes-0-1000-10-1722485725'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722485725 4dab8c6df1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:15:54 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:15:54 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-10-1722485725 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-10
+ env
++ date
+ echo Thu Aug 1 06:17:08 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 06:17:08 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4dab8c6df1 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722485828
+ git checkout -b scalability-yes-1-1000-10-1722485828
Switched to a new branch 'scalability-yes-1-1000-10-1722485828'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722485828 3c64ea4f2c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722485828 55543093fe] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:17:36 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:17:36 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-10-1722485828 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 06:18:51 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 06:18:51 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 55543093fe fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722485931
+ git checkout -b scalability-yes-1024-1000-10-1722485931
Switched to a new branch 'scalability-yes-1024-1000-10-1722485931'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722485931 528621cf98] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722485931 9bfc7fb961] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:19:19 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:19:19 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-10-1722485931 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-10
+ env
++ date
+ echo Thu Aug 1 06:20:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 06:20:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9bfc7fb961 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722486034
+ git checkout -b scalability-yes-8-1000-10-1722486034
Switched to a new branch 'scalability-yes-8-1000-10-1722486034'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722486034 1e182ec2fb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722486034 8f16674e6c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:21:02 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:21:02 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-10-1722486034 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-10
+ env
++ date
+ echo Thu Aug 1 06:22:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 06:22:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f16674e6c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722486136
+ git checkout -b scalability-yes-512-1000-10-1722486136
Switched to a new branch 'scalability-yes-512-1000-10-1722486136'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722486136 445f19f79d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722486136 d35e7ad829] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:22:44 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:22:44 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-10-1722486136 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-10
+ env
++ date
+ echo Thu Aug 1 06:23:59 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 06:23:59 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d35e7ad829 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722486239
+ git checkout -b scalability-yes-128-1000-10-1722486239
Switched to a new branch 'scalability-yes-128-1000-10-1722486239'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722486239 ea7c6bf28b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722486239 203fa9c221] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:24:27 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:24:27 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-10-1722486239 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-10
+ env
++ date
+ echo Thu Aug 1 06:25:42 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 06:25:42 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 203fa9c221 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722486342
+ git checkout -b scalability-no-32-1000-10-1722486342
Switched to a new branch 'scalability-no-32-1000-10-1722486342'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722486342 6d211c75d1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:26:10 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:26:10 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-10-1722486342 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-10
+ env
++ date
+ echo Thu Aug 1 06:27:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 06:27:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6d211c75d1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722486445
+ git checkout -b scalability-no-0-1000-10-1722486445
Switched to a new branch 'scalability-no-0-1000-10-1722486445'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:27:53 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:27:53 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-10-1722486445 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-10
+ env
++ date
+ echo Thu Aug 1 06:29:07 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 06:29:07 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722486548
+ git checkout -b scalability-no-1-1000-10-1722486548
Switched to a new branch 'scalability-no-1-1000-10-1722486548'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722486548 36a66a2278] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:29:35 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:29:35 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-10-1722486548 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 06:30:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 06:30:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 36a66a2278 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722486650
+ git checkout -b scalability-no-1024-1000-10-1722486650
Switched to a new branch 'scalability-no-1024-1000-10-1722486650'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722486650 8dba32d49c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:31:18 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:31:18 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-10-1722486650 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-10
+ env
++ date
+ echo Thu Aug 1 06:32:32 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 06:32:32 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8dba32d49c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722486752
+ git checkout -b scalability-no-8-1000-10-1722486752
Switched to a new branch 'scalability-no-8-1000-10-1722486752'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722486752 4da8f3b5e6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:33:00 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:33:00 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-10-1722486752 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-10
+ env
++ date
+ echo Thu Aug 1 06:34:15 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 06:34:15 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4da8f3b5e6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722486855
+ git checkout -b scalability-no-512-1000-10-1722486855
Switched to a new branch 'scalability-no-512-1000-10-1722486855'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722486855 ced69fbf8d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:34:43 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:34:43 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-10-1722486855 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-10
+ env
++ date
+ echo Thu Aug 1 06:35:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 06:35:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ced69fbf8d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722486958
+ git checkout -b scalability-no-128-1000-10-1722486958
Switched to a new branch 'scalability-no-128-1000-10-1722486958'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722486958 26099a2d4f] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:36:25 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:36:25 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-10-1722486958 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-10
+ env
++ date
+ echo Thu Aug 1 06:37:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 06:37:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 26099a2d4f fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722487060
+ git checkout -b scalability-yes-32-1000-10-1722487060
Switched to a new branch 'scalability-yes-32-1000-10-1722487060'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722487060 0508ea11aa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722487060 1262c3084e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:38:08 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:38:08 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-10-1722487060 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-10
+ env
++ date
+ echo Thu Aug 1 06:41:08 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 06:41:08 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1262c3084e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722487268
+ git checkout -b scalability-yes-0-1000-10-1722487268
Switched to a new branch 'scalability-yes-0-1000-10-1722487268'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722487268 4ab0871bd7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:41:36 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:41:36 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-10-1722487268 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-10
+ env
++ date
+ echo Thu Aug 1 06:44:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 06:44:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4ab0871bd7 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722487475
+ git checkout -b scalability-yes-1-1000-10-1722487475
Switched to a new branch 'scalability-yes-1-1000-10-1722487475'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722487475 f0f2de60a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722487475 02378ede82] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:45:04 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:45:04 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-10-1722487475 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 06:48:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 06:48:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 02378ede82 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722487684
+ git checkout -b scalability-yes-1024-1000-10-1722487684
Switched to a new branch 'scalability-yes-1024-1000-10-1722487684'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722487684 d3ac698371] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722487684 b3315518ed] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:48:32 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:48:32 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-10-1722487684 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-10
+ env
++ date
+ echo Thu Aug 1 06:51:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 06:51:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b3315518ed fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722487893
+ git checkout -b scalability-yes-8-1000-10-1722487893
Switched to a new branch 'scalability-yes-8-1000-10-1722487893'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722487893 d9cf97257f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722487893 d58fbf8995] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:52:00 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:52:00 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-10-1722487893 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-10
+ env
++ date
+ echo Thu Aug 1 06:55:01 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 06:55:01 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d58fbf8995 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722488101
+ git checkout -b scalability-yes-512-1000-10-1722488101
Switched to a new branch 'scalability-yes-512-1000-10-1722488101'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722488101 53d26f87fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722488101 925c7ca239] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:55:29 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:55:29 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-10-1722488101 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-10
+ env
++ date
+ echo Thu Aug 1 06:58:30 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 06:58:30 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 925c7ca239 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722488311
+ git checkout -b scalability-yes-128-1000-10-1722488311
Switched to a new branch 'scalability-yes-128-1000-10-1722488311'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722488311 e83def3d98] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722488311 7e3ab400e1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:58:59 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 06:58:59 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-10-1722488311 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-10
+ env
++ date
+ echo Thu Aug 1 07:01:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 07:01:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7e3ab400e1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722488520
+ git checkout -b scalability-no-32-1000-10-1722488520
Switched to a new branch 'scalability-no-32-1000-10-1722488520'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722488520 0ab181bc45] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:02:28 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:02:28 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-10-1722488520 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-10
+ env
++ date
+ echo Thu Aug 1 07:05:28 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 07:05:28 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0ab181bc45 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722488728
+ git checkout -b scalability-no-0-1000-10-1722488728
Switched to a new branch 'scalability-no-0-1000-10-1722488728'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:05:56 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:05:56 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-10-1722488728 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-10
+ env
++ date
+ echo Thu Aug 1 07:08:56 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 07:08:56 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722488937
+ git checkout -b scalability-no-1-1000-10-1722488937
Switched to a new branch 'scalability-no-1-1000-10-1722488937'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722488937 fd84bda6ff] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:09:25 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:09:25 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-10-1722488937 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-10
+ env
++ date
+ echo Thu Aug 1 07:12:25 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 07:12:25 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fd84bda6ff fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722489145
+ git checkout -b scalability-no-1024-1000-10-1722489145
Switched to a new branch 'scalability-no-1024-1000-10-1722489145'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722489145 d70c865969] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:12:53 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:12:53 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-10-1722489145 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-10
+ env
++ date
+ echo Thu Aug 1 07:15:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 07:15:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d70c865969 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722489354
+ git checkout -b scalability-no-8-1000-10-1722489354
Switched to a new branch 'scalability-no-8-1000-10-1722489354'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722489354 72a381c2e3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:16:22 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:16:22 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-10-1722489354 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-10
+ env
++ date
+ echo Thu Aug 1 07:19:22 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 07:19:22 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 72a381c2e3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722489562
+ git checkout -b scalability-no-512-1000-10-1722489562
Switched to a new branch 'scalability-no-512-1000-10-1722489562'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722489562 f8b71df3c6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:19:50 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:19:50 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-10-1722489562 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-10
+ env
++ date
+ echo Thu Aug 1 07:22:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 07:22:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f8b71df3c6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722489770
+ git checkout -b scalability-no-128-1000-10-1722489770
Switched to a new branch 'scalability-no-128-1000-10-1722489770'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722489770 d921491c57] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:23:18 AM CEST 2024 'RUN   files: 1000  partitions: 10'
Thu Aug 1 07:23:18 AM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-10-1722489770 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-1
+ env
++ date
+ echo Thu Aug 1 07:26:19 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 07:26:19 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d921491c57 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722489979
+ git checkout -b scalability-yes-32-1000-1-1722489979
Switched to a new branch 'scalability-yes-32-1000-1-1722489979'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722489979 fae3306975] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722489979 64f8b301f2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:27:07 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:27:07 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-1-1722489979 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-1
+ env
++ date
+ echo Thu Aug 1 07:28:22 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 07:28:22 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 64f8b301f2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722490102
+ git checkout -b scalability-yes-0-1000-1-1722490102
Switched to a new branch 'scalability-yes-0-1000-1-1722490102'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722490102 580ef6cf25] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:29:11 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:29:11 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-1-1722490102 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-1
+ env
++ date
+ echo Thu Aug 1 07:30:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 07:30:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 580ef6cf25 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722490226
+ git checkout -b scalability-yes-1-1000-1-1722490226
Switched to a new branch 'scalability-yes-1-1000-1-1722490226'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722490226 49bef358df] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722490226 beb7419192] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:31:14 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:31:14 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-1-1722490226 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 07:32:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 07:32:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at beb7419192 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722490349
+ git checkout -b scalability-yes-1024-1000-1-1722490349
Switched to a new branch 'scalability-yes-1024-1000-1-1722490349'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722490349 5f6ee6f745] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722490349 fcdf696f88] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:33:17 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:33:17 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-1-1722490349 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-1
+ env
++ date
+ echo Thu Aug 1 07:34:32 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 07:34:32 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fcdf696f88 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722490472
+ git checkout -b scalability-yes-8-1000-1-1722490472
Switched to a new branch 'scalability-yes-8-1000-1-1722490472'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722490472 dd4548d509] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722490472 e1dd246d86] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:35:20 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:35:20 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-1-1722490472 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-1
+ env
++ date
+ echo Thu Aug 1 07:36:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 07:36:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e1dd246d86 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722490595
+ git checkout -b scalability-yes-512-1000-1-1722490595
Switched to a new branch 'scalability-yes-512-1000-1-1722490595'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722490595 d6a060d996] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722490595 9d8aa6e069] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:37:23 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:37:23 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-1-1722490595 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-1
+ env
++ date
+ echo Thu Aug 1 07:38:38 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 07:38:38 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9d8aa6e069 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722490718
+ git checkout -b scalability-yes-128-1000-1-1722490718
Switched to a new branch 'scalability-yes-128-1000-1-1722490718'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722490718 8ca4a1c590] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722490718 a9dfb45813] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:39:26 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:39:26 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-1-1722490718 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-1
+ env
++ date
+ echo Thu Aug 1 07:40:41 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 07:40:41 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a9dfb45813 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722490841
+ git checkout -b scalability-no-32-1000-1-1722490841
Switched to a new branch 'scalability-no-32-1000-1-1722490841'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722490841 a8c9f96a11] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:41:29 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:41:29 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-1-1722490841 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-1
+ env
++ date
+ echo Thu Aug 1 07:42:44 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 07:42:44 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a8c9f96a11 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722490964
+ git checkout -b scalability-no-0-1000-1-1722490964
Switched to a new branch 'scalability-no-0-1000-1-1722490964'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:43:32 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:43:32 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-1-1722490964 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-1
+ env
++ date
+ echo Thu Aug 1 07:44:47 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 07:44:47 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722491087
+ git checkout -b scalability-no-1-1000-1-1722491087
Switched to a new branch 'scalability-no-1-1000-1-1722491087'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722491087 d5fd63745e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:45:35 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:45:35 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-1-1722491087 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 07:46:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 07:46:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d5fd63745e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722491210
+ git checkout -b scalability-no-1024-1000-1-1722491210
Switched to a new branch 'scalability-no-1024-1000-1-1722491210'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/1024/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722491210 31c53fc25a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:47:38 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:47:38 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-1-1722491210 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-1
+ env
++ date
+ echo Thu Aug 1 07:48:53 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 07:48:53 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 31c53fc25a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722491333
+ git checkout -b scalability-no-8-1000-1-1722491333
Switched to a new branch 'scalability-no-8-1000-1-1722491333'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722491333 257b2eb49a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:49:40 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:49:40 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-1-1722491333 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-1
+ env
++ date
+ echo Thu Aug 1 07:50:55 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 07:50:55 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 257b2eb49a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722491455
+ git checkout -b scalability-no-512-1000-1-1722491455
Switched to a new branch 'scalability-no-512-1000-1-1722491455'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722491455 30ab5d8fb4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:51:43 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:51:43 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-1-1722491455 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-1
+ env
++ date
+ echo Thu Aug 1 07:52:57 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 07:52:57 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 30ab5d8fb4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722491577
+ git checkout -b scalability-no-128-1000-1-1722491577
Switched to a new branch 'scalability-no-128-1000-1-1722491577'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722491577 71fca99199] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:53:45 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:53:45 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-1-1722491577 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-1
+ env
++ date
+ echo Thu Aug 1 07:55:00 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 07:55:00 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 71fca99199 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722491700
+ git checkout -b scalability-yes-32-1000-1-1722491700
Switched to a new branch 'scalability-yes-32-1000-1-1722491700'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722491700 efe7b0cf9c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722491700 5d24f336be] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:55:48 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:55:48 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-1-1722491700 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-1
+ env
++ date
+ echo Thu Aug 1 07:57:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 07:57:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5d24f336be fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722491827
+ git checkout -b scalability-yes-0-1000-1-1722491827
Switched to a new branch 'scalability-yes-0-1000-1-1722491827'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722491827 33a0502397] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:57:54 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 07:57:54 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-1-1722491827 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-1
+ env
++ date
+ echo Thu Aug 1 07:59:13 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 07:59:13 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 33a0502397 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722491953
+ git checkout -b scalability-yes-1-1000-1-1722491953
Switched to a new branch 'scalability-yes-1-1000-1-1722491953'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722491953 5015c3ca99] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722491953 a042c258ae] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:00:01 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:00:01 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-1-1722491953 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 08:01:20 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 08:01:20 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a042c258ae fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722492080
+ git checkout -b scalability-yes-1024-1000-1-1722492080
Switched to a new branch 'scalability-yes-1024-1000-1-1722492080'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722492080 1394813a05] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722492080 b9ea208526] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:01:48 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:01:48 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-1-1722492080 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-1
+ env
++ date
+ echo Thu Aug 1 08:03:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 08:03:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b9ea208526 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722492187
+ git checkout -b scalability-yes-8-1000-1-1722492187
Switched to a new branch 'scalability-yes-8-1000-1-1722492187'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722492187 67acab0349] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722492187 6c3d9151e1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:03:35 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:03:35 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-1-1722492187 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-1
+ env
++ date
+ echo Thu Aug 1 08:04:54 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 08:04:54 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6c3d9151e1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722492294
+ git checkout -b scalability-yes-512-1000-1-1722492294
Switched to a new branch 'scalability-yes-512-1000-1-1722492294'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722492294 32809be816] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722492294 a424ee5d31] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:05:22 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:05:22 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-1-1722492294 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-1
+ env
++ date
+ echo Thu Aug 1 08:06:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 08:06:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a424ee5d31 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722492401
+ git checkout -b scalability-yes-128-1000-1-1722492401
Switched to a new branch 'scalability-yes-128-1000-1-1722492401'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722492401 e85c9187a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722492401 ef4afba2ff] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:07:10 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:07:10 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-1-1722492401 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-1
+ env
++ date
+ echo Thu Aug 1 08:08:28 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 08:08:28 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ef4afba2ff fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722492509
+ git checkout -b scalability-no-32-1000-1-1722492509
Switched to a new branch 'scalability-no-32-1000-1-1722492509'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722492509 00a77ecb22] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:08:56 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:08:56 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-1-1722492509 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-1
+ env
++ date
+ echo Thu Aug 1 08:10:15 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 08:10:15 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 00a77ecb22 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722492615
+ git checkout -b scalability-no-0-1000-1-1722492615
Switched to a new branch 'scalability-no-0-1000-1-1722492615'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:10:43 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:10:43 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-1-1722492615 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-1
+ env
++ date
+ echo Thu Aug 1 08:12:02 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 08:12:02 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722492722
+ git checkout -b scalability-no-1-1000-1-1722492722
Switched to a new branch 'scalability-no-1-1000-1-1722492722'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722492722 f66e1be33f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:12:30 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:12:30 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-1-1722492722 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 08:13:49 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 08:13:49 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f66e1be33f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722492829
+ git checkout -b scalability-no-1024-1000-1-1722492829
Switched to a new branch 'scalability-no-1024-1000-1-1722492829'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722492829 fe67784b45] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:14:17 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:14:17 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-1-1722492829 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-1
+ env
++ date
+ echo Thu Aug 1 08:15:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 08:15:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fe67784b45 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722492936
+ git checkout -b scalability-no-8-1000-1-1722492936
Switched to a new branch 'scalability-no-8-1000-1-1722492936'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722492936 27b5ee5b83] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:16:04 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:16:04 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-1-1722492936 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-1
+ env
++ date
+ echo Thu Aug 1 08:17:23 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 08:17:23 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 27b5ee5b83 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722493043
+ git checkout -b scalability-no-512-1000-1-1722493043
Switched to a new branch 'scalability-no-512-1000-1-1722493043'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722493043 ec942eeae4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:17:51 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:17:51 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-1-1722493043 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-1
+ env
++ date
+ echo Thu Aug 1 08:19:10 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 08:19:10 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ec942eeae4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722493150
+ git checkout -b scalability-no-128-1000-1-1722493150
Switched to a new branch 'scalability-no-128-1000-1-1722493150'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722493150 8067f52790] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:19:38 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:19:38 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-1-1722493150 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-1
+ env
++ date
+ echo Thu Aug 1 08:20:57 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 08:20:57 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8067f52790 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722493257
+ git checkout -b scalability-yes-32-1000-1-1722493257
Switched to a new branch 'scalability-yes-32-1000-1-1722493257'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722493257 90baee4da4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722493257 38a01b6f4e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:21:25 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:21:25 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-1-1722493257 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-1
+ env
++ date
+ echo Thu Aug 1 08:22:38 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 08:22:38 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 38a01b6f4e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722493358
+ git checkout -b scalability-yes-0-1000-1-1722493358
Switched to a new branch 'scalability-yes-0-1000-1-1722493358'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722493358 30c1956dad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:23:06 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:23:06 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-1-1722493358 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-1
+ env
++ date
+ echo Thu Aug 1 08:24:20 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 08:24:20 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 30c1956dad NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722493460
+ git checkout -b scalability-yes-1-1000-1-1722493460
Switched to a new branch 'scalability-yes-1-1000-1-1722493460'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722493460 529112cfbf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/1/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722493460 330fa2933a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:24:48 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:24:48 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-1-1722493460 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 08:26:02 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 08:26:02 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 330fa2933a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722493562
+ git checkout -b scalability-yes-1024-1000-1-1722493562
Switched to a new branch 'scalability-yes-1024-1000-1-1722493562'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722493562 476646a5bb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722493562 1b7f837eb4] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:26:30 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:26:30 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-1-1722493562 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-1
+ env
++ date
+ echo Thu Aug 1 08:27:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 08:27:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1b7f837eb4 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722493664
+ git checkout -b scalability-yes-8-1000-1-1722493664
Switched to a new branch 'scalability-yes-8-1000-1-1722493664'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722493664 0e81fa2393] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722493664 e958b7e10d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:28:12 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:28:12 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-1-1722493664 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-1
+ env
++ date
+ echo Thu Aug 1 08:29:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 08:29:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e958b7e10d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722493765
+ git checkout -b scalability-yes-512-1000-1-1722493765
Switched to a new branch 'scalability-yes-512-1000-1-1722493765'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722493765 1a8428d3fd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722493765 4318821db7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:29:53 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:29:53 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-1-1722493765 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-1
+ env
++ date
+ echo Thu Aug 1 08:31:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 08:31:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4318821db7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722493867
+ git checkout -b scalability-yes-128-1000-1-1722493867
Switched to a new branch 'scalability-yes-128-1000-1-1722493867'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722493867 bf1892c3dd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722493867 d6d78a5a39] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:31:35 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:31:35 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-1-1722493867 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-1
+ env
++ date
+ echo Thu Aug 1 08:32:49 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 08:32:49 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d6d78a5a39 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722493969
+ git checkout -b scalability-no-32-1000-1-1722493969
Switched to a new branch 'scalability-no-32-1000-1-1722493969'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722493969 ccf3572985] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:33:16 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:33:16 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-1-1722493969 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-1
+ env
++ date
+ echo Thu Aug 1 08:34:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 08:34:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ccf3572985 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722494070
+ git checkout -b scalability-no-0-1000-1-1722494070
Switched to a new branch 'scalability-no-0-1000-1-1722494070'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:34:58 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:34:58 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-1-1722494070 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-1
+ env
++ date
+ echo Thu Aug 1 08:36:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 08:36:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722494172
+ git checkout -b scalability-no-1-1000-1-1722494172
Switched to a new branch 'scalability-no-1-1000-1-1722494172'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722494172 e0c06434b7] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:36:40 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:36:40 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-1-1722494172 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 08:37:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 08:37:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e0c06434b7 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722494274
+ git checkout -b scalability-no-1024-1000-1-1722494274
Switched to a new branch 'scalability-no-1024-1000-1-1722494274'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722494274 172e678816] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:38:21 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:38:21 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-1-1722494274 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-1
+ env
++ date
+ echo Thu Aug 1 08:39:35 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 08:39:35 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 172e678816 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722494375
+ git checkout -b scalability-no-8-1000-1-1722494375
Switched to a new branch 'scalability-no-8-1000-1-1722494375'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722494375 0e9af90002] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:40:03 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:40:03 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-1-1722494375 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-1
+ env
++ date
+ echo Thu Aug 1 08:41:16 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 08:41:16 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0e9af90002 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722494477
+ git checkout -b scalability-no-512-1000-1-1722494477
Switched to a new branch 'scalability-no-512-1000-1-1722494477'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722494477 cfc80a2b7b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:41:45 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:41:45 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-1-1722494477 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-1
+ env
++ date
+ echo Thu Aug 1 08:42:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 08:42:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cfc80a2b7b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722494579
+ git checkout -b scalability-no-128-1000-1-1722494579
Switched to a new branch 'scalability-no-128-1000-1-1722494579'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722494579 322feaacb9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:43:26 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:43:26 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-1-1722494579 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-1
+ env
++ date
+ echo Thu Aug 1 08:44:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 08:44:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 322feaacb9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722494680
+ git checkout -b scalability-yes-32-1000-1-1722494680
Switched to a new branch 'scalability-yes-32-1000-1-1722494680'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722494680 c35ee75d27] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722494680 a853b07c71] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:45:08 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:45:08 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-1-1722494680 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-1
+ env
++ date
+ echo Thu Aug 1 08:46:23 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 08:46:23 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a853b07c71 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722494783
+ git checkout -b scalability-yes-0-1000-1-1722494783
Switched to a new branch 'scalability-yes-0-1000-1-1722494783'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722494783 ac40a441c2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:46:51 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:46:51 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-1-1722494783 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-1
+ env
++ date
+ echo Thu Aug 1 08:48:05 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 08:48:05 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac40a441c2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722494885
+ git checkout -b scalability-yes-1-1000-1-1722494885
Switched to a new branch 'scalability-yes-1-1000-1-1722494885'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722494885 3b028f43fc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722494885 5808c57514] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:48:34 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:48:34 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-1-1722494885 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 08:49:48 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 08:49:48 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5808c57514 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722494988
+ git checkout -b scalability-yes-1024-1000-1-1722494988
Switched to a new branch 'scalability-yes-1024-1000-1-1722494988'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722494988 c42963d4ed] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722494988 ba4057ca18] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:50:17 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:50:17 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-1-1722494988 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-1
+ env
++ date
+ echo Thu Aug 1 08:51:31 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 08:51:31 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ba4057ca18 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722495091
+ git checkout -b scalability-yes-8-1000-1-1722495091
Switched to a new branch 'scalability-yes-8-1000-1-1722495091'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722495091 de985cb538] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722495091 de7140a34f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:51:59 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:51:59 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-1-1722495091 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-1
+ env
++ date
+ echo Thu Aug 1 08:53:14 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 08:53:14 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at de7140a34f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722495194
+ git checkout -b scalability-yes-512-1000-1-1722495194
Switched to a new branch 'scalability-yes-512-1000-1-1722495194'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722495194 63f71e2466] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722495194 c9a34d147d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:53:42 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:53:42 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-1-1722495194 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-1
+ env
++ date
+ echo Thu Aug 1 08:54:57 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 08:54:57 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c9a34d147d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722495297
+ git checkout -b scalability-yes-128-1000-1-1722495297
Switched to a new branch 'scalability-yes-128-1000-1-1722495297'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722495297 86f0c7fd14] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722495297 2a39df246c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:55:25 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:55:25 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-1-1722495297 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-1
+ env
++ date
+ echo Thu Aug 1 08:56:40 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 08:56:40 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2a39df246c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722495400
+ git checkout -b scalability-no-32-1000-1-1722495400
Switched to a new branch 'scalability-no-32-1000-1-1722495400'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722495400 ff32dbf3db] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:57:08 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:57:08 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-1-1722495400 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-1
+ env
++ date
+ echo Thu Aug 1 08:58:22 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 08:58:22 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ff32dbf3db fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722495502
+ git checkout -b scalability-no-0-1000-1-1722495502
Switched to a new branch 'scalability-no-0-1000-1-1722495502'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:58:50 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 08:58:50 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-1-1722495502 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-1
+ env
++ date
+ echo Thu Aug 1 09:00:04 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 09:00:04 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722495604
+ git checkout -b scalability-no-1-1000-1-1722495604
Switched to a new branch 'scalability-no-1-1000-1-1722495604'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722495604 b983b9be88] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:00:32 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:00:32 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-1-1722495604 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 09:01:46 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 09:01:46 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b983b9be88 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722495706
+ git checkout -b scalability-no-1024-1000-1-1722495706
Switched to a new branch 'scalability-no-1024-1000-1-1722495706'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722495706 fe78f4f830] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:02:14 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:02:14 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-1-1722495706 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-1
+ env
++ date
+ echo Thu Aug 1 09:03:29 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 09:03:29 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fe78f4f830 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722495809
+ git checkout -b scalability-no-8-1000-1-1722495809
Switched to a new branch 'scalability-no-8-1000-1-1722495809'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722495809 39d3fa5344] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:03:57 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:03:57 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-1-1722495809 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-1
+ env
++ date
+ echo Thu Aug 1 09:05:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 09:05:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 39d3fa5344 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722495912
+ git checkout -b scalability-no-512-1000-1-1722495912
Switched to a new branch 'scalability-no-512-1000-1-1722495912'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722495912 4f3deec412] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:05:39 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:05:39 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-1-1722495912 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-1
+ env
++ date
+ echo Thu Aug 1 09:06:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 09:06:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4f3deec412 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722496014
+ git checkout -b scalability-no-128-1000-1-1722496014
Switched to a new branch 'scalability-no-128-1000-1-1722496014'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722496014 178ed0467a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:07:22 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:07:22 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-1-1722496014 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-1
+ env
++ date
+ echo Thu Aug 1 09:08:36 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 09:08:36 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 178ed0467a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722496117
+ git checkout -b scalability-yes-32-1000-1-1722496117
Switched to a new branch 'scalability-yes-32-1000-1-1722496117'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722496117 da654cac51] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722496117 4f02bcb648] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:09:05 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:09:05 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-1-1722496117 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-1
+ env
++ date
+ echo Thu Aug 1 09:10:54 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 09:10:54 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4f02bcb648 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722496254
+ git checkout -b scalability-yes-0-1000-1-1722496254
Switched to a new branch 'scalability-yes-0-1000-1-1722496254'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722496254 58c693cc9d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:11:22 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:11:22 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-1-1722496254 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-1
+ env
++ date
+ echo Thu Aug 1 09:13:12 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 09:13:12 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 58c693cc9d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722496392
+ git checkout -b scalability-yes-1-1000-1-1722496392
Switched to a new branch 'scalability-yes-1-1000-1-1722496392'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722496392 8dda79f4d3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722496392 ebbed09ea2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:13:40 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:13:40 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-1-1722496392 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 09:15:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 09:15:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ebbed09ea2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722496529
+ git checkout -b scalability-yes-1024-1000-1-1722496529
Switched to a new branch 'scalability-yes-1024-1000-1-1722496529'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722496529 4d26e31661] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722496529 ac0c5aaf3c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:15:57 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:15:57 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-1-1722496529 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-1
+ env
++ date
+ echo Thu Aug 1 09:17:47 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 09:17:47 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac0c5aaf3c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722496667
+ git checkout -b scalability-yes-8-1000-1-1722496667
Switched to a new branch 'scalability-yes-8-1000-1-1722496667'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722496667 cb3817ba21] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722496667 423b42ae0c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:18:15 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:18:15 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-1-1722496667 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-1
+ env
++ date
+ echo Thu Aug 1 09:20:04 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 09:20:04 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 423b42ae0c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722496804
+ git checkout -b scalability-yes-512-1000-1-1722496804
Switched to a new branch 'scalability-yes-512-1000-1-1722496804'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722496804 899b7d7efd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722496804 8cda1b1888] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:20:32 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:20:32 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-1-1722496804 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-1
+ env
++ date
+ echo Thu Aug 1 09:22:22 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 09:22:22 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8cda1b1888 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722496942
+ git checkout -b scalability-yes-128-1000-1-1722496942
Switched to a new branch 'scalability-yes-128-1000-1-1722496942'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722496942 68992e8e89] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722496942 eb8a46db2e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:22:51 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:22:51 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-1-1722496942 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-1
+ env
++ date
+ echo Thu Aug 1 09:24:40 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 09:24:40 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eb8a46db2e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722497080
+ git checkout -b scalability-no-32-1000-1-1722497080
Switched to a new branch 'scalability-no-32-1000-1-1722497080'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722497080 dfb9029503] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:25:08 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:25:08 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-1-1722497080 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-1
+ env
++ date
+ echo Thu Aug 1 09:26:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 09:26:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dfb9029503 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722497218
+ git checkout -b scalability-no-0-1000-1-1722497218
Switched to a new branch 'scalability-no-0-1000-1-1722497218'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:27:26 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:27:26 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-1-1722497218 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-1
+ env
++ date
+ echo Thu Aug 1 09:29:15 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 09:29:15 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722497356
+ git checkout -b scalability-no-1-1000-1-1722497356
Switched to a new branch 'scalability-no-1-1000-1-1722497356'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722497356 e06469ab51] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:29:43 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:29:43 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-1-1722497356 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-1
+ env
++ date
+ echo Thu Aug 1 09:31:32 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 09:31:32 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e06469ab51 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722497493
+ git checkout -b scalability-no-1024-1000-1-1722497493
Switched to a new branch 'scalability-no-1024-1000-1-1722497493'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722497493 20c0aa3d36] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:32:01 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:32:01 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-1-1722497493 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-1
+ env
++ date
+ echo Thu Aug 1 09:33:52 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 09:33:52 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 20c0aa3d36 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722497632
+ git checkout -b scalability-no-8-1000-1-1722497632
Switched to a new branch 'scalability-no-8-1000-1-1722497632'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722497632 7b42d69030] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:34:20 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:34:20 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-1-1722497632 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-1
+ env
++ date
+ echo Thu Aug 1 09:36:10 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 09:36:10 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7b42d69030 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722497770
+ git checkout -b scalability-no-512-1000-1-1722497770
Switched to a new branch 'scalability-no-512-1000-1-1722497770'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722497770 ac3ddf6b28] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:36:38 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:36:38 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-1-1722497770 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-1
+ env
++ date
+ echo Thu Aug 1 09:38:28 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 09:38:28 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac3ddf6b28 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722497909
+ git checkout -b scalability-no-128-1000-1-1722497909
Switched to a new branch 'scalability-no-128-1000-1-1722497909'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722497909 d2b2d157a2] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:38:57 AM CEST 2024 'RUN   files: 1000  partitions: 1'
Thu Aug 1 09:38:57 AM CEST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-1-1722497909 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-1000-0
+ env
++ date
+ echo Thu Aug 1 09:40:46 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 09:40:46 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d2b2d157a2 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722498046
+ git checkout -b scalability-yes-32-1000-0-1722498046
Switched to a new branch 'scalability-yes-32-1000-0-1722498046'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722498046 10aa6e0895] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722498046 79fe1fef57] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:41:35 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:41:35 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-0-1722498046 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-1000-0
+ env
++ date
+ echo Thu Aug 1 09:42:49 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 09:42:49 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 79fe1fef57 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722498170
+ git checkout -b scalability-yes-0-1000-0-1722498170
Switched to a new branch 'scalability-yes-0-1000-0-1722498170'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722498170 b353745d50] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:43:38 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:43:38 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-0-1722498170 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-1000-0
+ env
++ date
+ echo Thu Aug 1 09:44:52 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 09:44:52 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b353745d50 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722498292
+ git checkout -b scalability-yes-1-1000-0-1722498292
Switched to a new branch 'scalability-yes-1-1000-0-1722498292'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722498292 48c897a82e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722498292 b149b96a04] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:45:41 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:45:41 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-0-1722498292 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 09:46:56 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 09:46:56 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b149b96a04 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722498416
+ git checkout -b scalability-yes-1024-1000-0-1722498416
Switched to a new branch 'scalability-yes-1024-1000-0-1722498416'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722498416 17822aa9a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722498416 5dcbec54ad] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:47:44 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:47:44 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-0-1722498416 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-1000-0
+ env
++ date
+ echo Thu Aug 1 09:48:59 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 09:48:59 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5dcbec54ad fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722498539
+ git checkout -b scalability-yes-8-1000-0-1722498539
Switched to a new branch 'scalability-yes-8-1000-0-1722498539'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722498539 f2f65808fb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722498539 8296120866] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:49:48 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:49:48 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-0-1722498539 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-1000-0
+ env
++ date
+ echo Thu Aug 1 09:51:02 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 09:51:02 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8296120866 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722498662
+ git checkout -b scalability-yes-512-1000-0-1722498662
Switched to a new branch 'scalability-yes-512-1000-0-1722498662'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722498662 3100985737] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722498662 294aa02392] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:51:51 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:51:51 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-0-1722498662 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-1000-0
+ env
++ date
+ echo Thu Aug 1 09:53:05 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 09:53:05 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 294aa02392 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722498785
+ git checkout -b scalability-yes-128-1000-0-1722498785
Switched to a new branch 'scalability-yes-128-1000-0-1722498785'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722498785 12141f7786] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722498785 94677c2743] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:53:53 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:53:53 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-0-1722498785 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-1000-0
+ env
++ date
+ echo Thu Aug 1 09:55:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 09:55:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 94677c2743 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722498908
+ git checkout -b scalability-no-32-1000-0-1722498908
Switched to a new branch 'scalability-no-32-1000-0-1722498908'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722498908 bd1eee6776] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:55:56 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:55:56 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-0-1722498908 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-1000-0
+ env
++ date
+ echo Thu Aug 1 09:57:11 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 09:57:11 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bd1eee6776 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722499031
+ git checkout -b scalability-no-0-1000-0-1722499031
Switched to a new branch 'scalability-no-0-1000-0-1722499031'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:58:00 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 09:58:00 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-0-1722499031 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-1000-0
+ env
++ date
+ echo Thu Aug 1 09:59:14 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 09:59:14 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722499154
+ git checkout -b scalability-no-1-1000-0-1722499154
Switched to a new branch 'scalability-no-1-1000-0-1722499154'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722499154 1c992e71c9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:00:03 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:00:03 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-0-1722499154 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 10:01:17 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 10:01:17 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1c992e71c9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722499277
+ git checkout -b scalability-no-1024-1000-0-1722499277
Switched to a new branch 'scalability-no-1024-1000-0-1722499277'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722499277 2213219d62] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:02:06 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:02:06 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-0-1722499277 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-1000-0
+ env
++ date
+ echo Thu Aug 1 10:03:21 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 10:03:21 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2213219d62 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722499401
+ git checkout -b scalability-no-8-1000-0-1722499401
Switched to a new branch 'scalability-no-8-1000-0-1722499401'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722499401 5504a0d0a7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:04:08 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:04:08 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-0-1722499401 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-1000-0
+ env
++ date
+ echo Thu Aug 1 10:05:23 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 10:05:23 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5504a0d0a7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722499523
+ git checkout -b scalability-no-512-1000-0-1722499523
Switched to a new branch 'scalability-no-512-1000-0-1722499523'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722499523 1c1a450199] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:06:11 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:06:11 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-0-1722499523 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-1000-0
+ env
++ date
+ echo Thu Aug 1 10:07:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 10:07:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1c1a450199 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722499646
+ git checkout -b scalability-no-128-1000-0-1722499646
Switched to a new branch 'scalability-no-128-1000-0-1722499646'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722499646 556e9a5159] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:08:14 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:08:14 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-0-1722499646 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-1000-0
+ env
++ date
+ echo Thu Aug 1 10:09:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 10:09:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 556e9a5159 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722499769
+ git checkout -b scalability-yes-32-1000-0-1722499769
Switched to a new branch 'scalability-yes-32-1000-0-1722499769'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722499769 81d07bf7eb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722499769 4708a84398] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:09:57 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:09:57 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-0-1722499769 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-1000-0
+ env
++ date
+ echo Thu Aug 1 10:11:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 10:11:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4708a84398 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722499876
+ git checkout -b scalability-yes-0-1000-0-1722499876
Switched to a new branch 'scalability-yes-0-1000-0-1722499876'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722499876 97a52203a5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:11:44 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:11:44 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-0-1722499876 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-1000-0
+ env
++ date
+ echo Thu Aug 1 10:13:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 10:13:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 97a52203a5 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722499983
+ git checkout -b scalability-yes-1-1000-0-1722499983
Switched to a new branch 'scalability-yes-1-1000-0-1722499983'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722499983 4b1dbe4a83] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722499983 ccbd6c4419] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:13:31 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:13:31 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-0-1722499983 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 10:14:50 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 10:14:50 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ccbd6c4419 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722500090
+ git checkout -b scalability-yes-1024-1000-0-1722500090
Switched to a new branch 'scalability-yes-1024-1000-0-1722500090'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722500090 3c347f192c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722500090 b24f87da9a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:15:18 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:15:18 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-0-1722500090 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-1000-0
+ env
++ date
+ echo Thu Aug 1 10:16:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 10:16:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b24f87da9a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722500197
+ git checkout -b scalability-yes-8-1000-0-1722500197
Switched to a new branch 'scalability-yes-8-1000-0-1722500197'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722500197 e08fd49f22] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722500197 7f87c1ba38] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:17:06 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:17:06 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-0-1722500197 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-1000-0
+ env
++ date
+ echo Thu Aug 1 10:18:24 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 10:18:24 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7f87c1ba38 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722500304
+ git checkout -b scalability-yes-512-1000-0-1722500304
Switched to a new branch 'scalability-yes-512-1000-0-1722500304'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722500304 536b76e569] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722500304 b6a4aee021] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:18:52 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:18:52 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-0-1722500304 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-1000-0
+ env
++ date
+ echo Thu Aug 1 10:20:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 10:20:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b6a4aee021 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722500411
+ git checkout -b scalability-yes-128-1000-0-1722500411
Switched to a new branch 'scalability-yes-128-1000-0-1722500411'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722500411 6446fe28ed] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722500411 4c9be886ce] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:20:39 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:20:39 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-0-1722500411 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-1000-0
+ env
++ date
+ echo Thu Aug 1 10:21:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 10:21:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4c9be886ce fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722500518
+ git checkout -b scalability-no-32-1000-0-1722500518
Switched to a new branch 'scalability-no-32-1000-0-1722500518'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722500518 c24f5ba584] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:22:26 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:22:26 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-0-1722500518 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-1000-0
+ env
++ date
+ echo Thu Aug 1 10:23:45 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 10:23:45 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c24f5ba584 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722500625
+ git checkout -b scalability-no-0-1000-0-1722500625
Switched to a new branch 'scalability-no-0-1000-0-1722500625'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:24:12 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:24:12 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-0-1722500625 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-1000-0
+ env
++ date
+ echo Thu Aug 1 10:25:31 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 10:25:31 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722500731
+ git checkout -b scalability-no-1-1000-0-1722500731
Switched to a new branch 'scalability-no-1-1000-0-1722500731'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722500731 2c67c4f048] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:25:59 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:25:59 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-0-1722500731 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 10:27:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 10:27:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2c67c4f048 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722500838
+ git checkout -b scalability-no-1024-1000-0-1722500838
Switched to a new branch 'scalability-no-1024-1000-0-1722500838'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722500838 fb04fb073f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:27:46 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:27:46 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-0-1722500838 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-1000-0
+ env
++ date
+ echo Thu Aug 1 10:29:05 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 10:29:05 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fb04fb073f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722500945
+ git checkout -b scalability-no-8-1000-0-1722500945
Switched to a new branch 'scalability-no-8-1000-0-1722500945'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722500945 5461a5870c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:29:33 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:29:33 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-0-1722500945 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-1000-0
+ env
++ date
+ echo Thu Aug 1 10:30:52 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 10:30:52 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5461a5870c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722501052
+ git checkout -b scalability-no-512-1000-0-1722501052
Switched to a new branch 'scalability-no-512-1000-0-1722501052'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722501052 188b638a65] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:31:20 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:31:20 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-0-1722501052 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-1000-0
+ env
++ date
+ echo Thu Aug 1 10:32:38 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 10:32:38 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 188b638a65 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722501158
+ git checkout -b scalability-no-128-1000-0-1722501158
Switched to a new branch 'scalability-no-128-1000-0-1722501158'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722501158 587e5e6bce] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:33:07 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:33:07 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-0-1722501158 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-1000-0
+ env
++ date
+ echo Thu Aug 1 10:34:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 10:34:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 587e5e6bce fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722501265
+ git checkout -b scalability-yes-32-1000-0-1722501265
Switched to a new branch 'scalability-yes-32-1000-0-1722501265'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722501265 0b5990afad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722501265 b491e0cbcf] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:34:54 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:34:54 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-0-1722501265 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-1000-0
+ env
++ date
+ echo Thu Aug 1 10:36:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 10:36:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b491e0cbcf fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722501368
+ git checkout -b scalability-yes-0-1000-0-1722501368
Switched to a new branch 'scalability-yes-0-1000-0-1722501368'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722501368 679ead2ee1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:36:36 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:36:36 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-0-1722501368 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-1000-0
+ env
++ date
+ echo Thu Aug 1 10:37:49 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 10:37:49 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 679ead2ee1 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722501469
+ git checkout -b scalability-yes-1-1000-0-1722501469
Switched to a new branch 'scalability-yes-1-1000-0-1722501469'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722501469 da17ef5e1f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722501469 38203d6873] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:38:17 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:38:17 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-0-1722501469 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 10:39:31 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 10:39:31 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 38203d6873 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722501571
+ git checkout -b scalability-yes-1024-1000-0-1722501571
Switched to a new branch 'scalability-yes-1024-1000-0-1722501571'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722501571 2c77d3e904] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722501571 87b7d5fdb9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:39:59 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:39:59 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-0-1722501571 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-1000-0
+ env
++ date
+ echo Thu Aug 1 10:41:13 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 10:41:13 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 87b7d5fdb9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722501673
+ git checkout -b scalability-yes-8-1000-0-1722501673
Switched to a new branch 'scalability-yes-8-1000-0-1722501673'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722501673 9b8f1c4e6e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722501673 bc55817abe] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:41:41 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:41:41 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-0-1722501673 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-1000-0
+ env
++ date
+ echo Thu Aug 1 10:42:55 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 10:42:55 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bc55817abe fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722501775
+ git checkout -b scalability-yes-512-1000-0-1722501775
Switched to a new branch 'scalability-yes-512-1000-0-1722501775'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722501775 0dd033a8d9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722501775 c66c8ae705] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:43:23 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:43:23 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-0-1722501775 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-1000-0
+ env
++ date
+ echo Thu Aug 1 10:44:37 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 10:44:37 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c66c8ae705 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722501877
+ git checkout -b scalability-yes-128-1000-0-1722501877
Switched to a new branch 'scalability-yes-128-1000-0-1722501877'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722501877 45e8379bf4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722501877 063b9afde8] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:45:05 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:45:05 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-0-1722501877 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-1000-0
+ env
++ date
+ echo Thu Aug 1 10:46:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 10:46:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 063b9afde8 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722501979
+ git checkout -b scalability-no-32-1000-0-1722501979
Switched to a new branch 'scalability-no-32-1000-0-1722501979'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722501979 96b6e49939] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:46:47 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:46:47 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-0-1722501979 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-1000-0
+ env
++ date
+ echo Thu Aug 1 10:48:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 10:48:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 96b6e49939 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722502080
+ git checkout -b scalability-no-0-1000-0-1722502080
Switched to a new branch 'scalability-no-0-1000-0-1722502080'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:48:28 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:48:28 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-0-1722502080 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-1000-0
+ env
++ date
+ echo Thu Aug 1 10:49:42 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 10:49:42 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722502182
+ git checkout -b scalability-no-1-1000-0-1722502182
Switched to a new branch 'scalability-no-1-1000-0-1722502182'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722502182 830e8dbfb9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:50:10 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:50:10 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-0-1722502182 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 10:51:23 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 10:51:23 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 830e8dbfb9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722502283
+ git checkout -b scalability-no-1024-1000-0-1722502283
Switched to a new branch 'scalability-no-1024-1000-0-1722502283'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722502283 3c4586d460] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:51:52 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:51:52 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-0-1722502283 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-1000-0
+ env
++ date
+ echo Thu Aug 1 10:53:05 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 10:53:05 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3c4586d460 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722502385
+ git checkout -b scalability-no-8-1000-0-1722502385
Switched to a new branch 'scalability-no-8-1000-0-1722502385'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722502385 0b973a3508] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:53:34 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:53:34 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-0-1722502385 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-1000-0
+ env
++ date
+ echo Thu Aug 1 10:54:47 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 10:54:47 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0b973a3508 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722502488
+ git checkout -b scalability-no-512-1000-0-1722502488
Switched to a new branch 'scalability-no-512-1000-0-1722502488'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722502488 dcf3c29cc7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:55:15 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:55:15 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-0-1722502488 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-1000-0
+ env
++ date
+ echo Thu Aug 1 10:56:29 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 10:56:29 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dcf3c29cc7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722502589
+ git checkout -b scalability-no-128-1000-0-1722502589
Switched to a new branch 'scalability-no-128-1000-0-1722502589'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722502589 1d9ab5c1e5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:56:57 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:56:57 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-0-1722502589 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-1000-0
+ env
++ date
+ echo Thu Aug 1 10:58:11 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 10:58:11 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1d9ab5c1e5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722502691
+ git checkout -b scalability-yes-32-1000-0-1722502691
Switched to a new branch 'scalability-yes-32-1000-0-1722502691'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722502691 f79a20f5d4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722502691 1ecf486bf4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:58:39 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 10:58:39 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-0-1722502691 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-1000-0
+ env
++ date
+ echo Thu Aug 1 10:59:53 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 10:59:53 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1ecf486bf4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722502793
+ git checkout -b scalability-yes-0-1000-0-1722502793
Switched to a new branch 'scalability-yes-0-1000-0-1722502793'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722502793 1eafd256a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:00:21 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:00:21 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-0-1722502793 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-1000-0
+ env
++ date
+ echo Thu Aug 1 11:01:36 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 11:01:36 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1eafd256a6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722502896
+ git checkout -b scalability-yes-1-1000-0-1722502896
Switched to a new branch 'scalability-yes-1-1000-0-1722502896'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722502896 7f545b74c2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722502896 f3b5074d1f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:02:04 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:02:04 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-0-1722502896 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 11:03:19 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 11:03:19 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f3b5074d1f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722502999
+ git checkout -b scalability-yes-1024-1000-0-1722502999
Switched to a new branch 'scalability-yes-1024-1000-0-1722502999'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722502999 07f5621369] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722502999 2f164a7550] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:03:47 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:03:47 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-0-1722502999 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-1000-0
+ env
++ date
+ echo Thu Aug 1 11:05:01 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 11:05:01 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f164a7550 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722503101
+ git checkout -b scalability-yes-8-1000-0-1722503101
Switched to a new branch 'scalability-yes-8-1000-0-1722503101'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722503101 7091b6c771] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722503101 88e07d1885] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:05:29 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:05:29 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-0-1722503101 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-1000-0
+ env
++ date
+ echo Thu Aug 1 11:06:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 11:06:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 88e07d1885 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722503204
+ git checkout -b scalability-yes-512-1000-0-1722503204
Switched to a new branch 'scalability-yes-512-1000-0-1722503204'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722503204 27e8e427a4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722503204 89600c9ab6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:07:12 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:07:12 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-0-1722503204 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-1000-0
+ env
++ date
+ echo Thu Aug 1 11:08:26 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 11:08:26 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 89600c9ab6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722503306
+ git checkout -b scalability-yes-128-1000-0-1722503306
Switched to a new branch 'scalability-yes-128-1000-0-1722503306'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722503306 856573a09f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722503306 f35b5d77d1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:08:55 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:08:55 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-0-1722503306 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-1000-0
+ env
++ date
+ echo Thu Aug 1 11:10:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 11:10:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f35b5d77d1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722503409
+ git checkout -b scalability-no-32-1000-0-1722503409
Switched to a new branch 'scalability-no-32-1000-0-1722503409'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722503409 799bdf88fc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:10:37 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:10:37 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-0-1722503409 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-1000-0
+ env
++ date
+ echo Thu Aug 1 11:11:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 11:11:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 799bdf88fc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722503512
+ git checkout -b scalability-no-0-1000-0-1722503512
Switched to a new branch 'scalability-no-0-1000-0-1722503512'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:12:20 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:12:20 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-0-1722503512 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-1000-0
+ env
++ date
+ echo Thu Aug 1 11:13:34 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 11:13:34 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722503614
+ git checkout -b scalability-no-1-1000-0-1722503614
Switched to a new branch 'scalability-no-1-1000-0-1722503614'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722503614 ccff203a9d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:14:02 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:14:02 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-0-1722503614 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 11:15:16 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 11:15:16 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ccff203a9d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722503716
+ git checkout -b scalability-no-1024-1000-0-1722503716
Switched to a new branch 'scalability-no-1024-1000-0-1722503716'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722503716 4f8e0dd421] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:15:44 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:15:44 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-0-1722503716 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-1000-0
+ env
++ date
+ echo Thu Aug 1 11:16:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 11:16:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4f8e0dd421 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722503819
+ git checkout -b scalability-no-8-1000-0-1722503819
Switched to a new branch 'scalability-no-8-1000-0-1722503819'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722503819 a40606b3e2] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:17:27 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:17:27 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-0-1722503819 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-1000-0
+ env
++ date
+ echo Thu Aug 1 11:18:41 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 11:18:41 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a40606b3e2 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722503921
+ git checkout -b scalability-no-512-1000-0-1722503921
Switched to a new branch 'scalability-no-512-1000-0-1722503921'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722503921 e9bb4ee4f8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:19:10 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:19:10 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-0-1722503921 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-1000-0
+ env
++ date
+ echo Thu Aug 1 11:20:24 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 11:20:24 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e9bb4ee4f8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722504024
+ git checkout -b scalability-no-128-1000-0-1722504024
Switched to a new branch 'scalability-no-128-1000-0-1722504024'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722504024 9abb419e16] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:20:52 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:20:52 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-0-1722504024 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-1000-0
+ env
++ date
+ echo Thu Aug 1 11:22:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 11:22:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9abb419e16 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722504127
+ git checkout -b scalability-yes-32-1000-0-1722504127
Switched to a new branch 'scalability-yes-32-1000-0-1722504127'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722504127 f3cf340e5e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722504127 f777e5bb0b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:22:35 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:22:35 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-0-1722504127 1000 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-1000-0
+ env
++ date
+ echo Thu Aug 1 11:22:38 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 11:22:38 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f777e5bb0b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722504158
+ git checkout -b scalability-yes-0-1000-0-1722504158
Switched to a new branch 'scalability-yes-0-1000-0-1722504158'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722504158 074599e158] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:23:06 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:23:06 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-0-1722504158 1000 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-1000-0
+ env
++ date
+ echo Thu Aug 1 11:23:10 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 11:23:10 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 074599e158 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722504190
+ git checkout -b scalability-yes-1-1000-0-1722504190
Switched to a new branch 'scalability-yes-1-1000-0-1722504190'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722504190 8fdf634fa1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722504190 09022df961] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:23:38 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:23:38 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-0-1722504190 1000 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 11:23:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 11:23:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 09022df961 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722504221
+ git checkout -b scalability-yes-1024-1000-0-1722504221
Switched to a new branch 'scalability-yes-1024-1000-0-1722504221'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722504221 1d1b60afa6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722504221 98a1c8f42b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:24:10 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:24:10 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-0-1722504221 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-1000-0
+ env
++ date
+ echo Thu Aug 1 11:24:13 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 11:24:13 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 98a1c8f42b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722504253
+ git checkout -b scalability-yes-8-1000-0-1722504253
Switched to a new branch 'scalability-yes-8-1000-0-1722504253'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722504253 2bf7e58c16] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722504253 92f06d6702] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:24:41 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:24:41 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-0-1722504253 1000 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-1000-0
+ env
++ date
+ echo Thu Aug 1 11:24:45 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 11:24:45 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 92f06d6702 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722504285
+ git checkout -b scalability-yes-512-1000-0-1722504285
Switched to a new branch 'scalability-yes-512-1000-0-1722504285'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722504285 4aa4166828] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722504285 afa81fa1aa] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:25:13 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:25:13 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-0-1722504285 1000 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-1000-0
+ env
++ date
+ echo Thu Aug 1 11:25:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 11:25:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at afa81fa1aa fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722504317
+ git checkout -b scalability-yes-128-1000-0-1722504317
Switched to a new branch 'scalability-yes-128-1000-0-1722504317'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722504317 fac9bc1eb9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722504317 868cf55bdc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:25:45 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:25:45 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-0-1722504317 1000 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-1000-0
+ env
++ date
+ echo Thu Aug 1 11:25:48 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 11:25:48 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 868cf55bdc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722504348
+ git checkout -b scalability-no-32-1000-0-1722504348
Switched to a new branch 'scalability-no-32-1000-0-1722504348'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722504348 d6b2b6d8a1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:26:16 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:26:16 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-0-1722504348 1000 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-1000-0
+ env
++ date
+ echo Thu Aug 1 11:26:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 11:26:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d6b2b6d8a1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722504380
+ git checkout -b scalability-no-0-1000-0-1722504380
Switched to a new branch 'scalability-no-0-1000-0-1722504380'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:26:48 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:26:48 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-0-1722504380 1000 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-1000-0
+ env
++ date
+ echo Thu Aug 1 11:26:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 11:26:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722504411
+ git checkout -b scalability-no-1-1000-0-1722504411
Switched to a new branch 'scalability-no-1-1000-0-1722504411'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722504411 622cdca490] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:27:20 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:27:20 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-0-1722504411 1000 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-1000-0
+ env
++ date
+ echo Thu Aug 1 11:27:23 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 11:27:23 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 622cdca490 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722504443
+ git checkout -b scalability-no-1024-1000-0-1722504443
Switched to a new branch 'scalability-no-1024-1000-0-1722504443'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722504443 dd88653880] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:27:51 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:27:51 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-0-1722504443 1000 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-1000-0
+ env
++ date
+ echo Thu Aug 1 11:27:55 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 11:27:55 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dd88653880 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722504475
+ git checkout -b scalability-no-8-1000-0-1722504475
Switched to a new branch 'scalability-no-8-1000-0-1722504475'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722504475 0ae5d7f5e0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:28:23 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:28:23 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-0-1722504475 1000 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-1000-0
+ env
++ date
+ echo Thu Aug 1 11:28:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 11:28:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0ae5d7f5e0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722504506
+ git checkout -b scalability-no-512-1000-0-1722504506
Switched to a new branch 'scalability-no-512-1000-0-1722504506'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722504506 70bf5c6f3b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:28:54 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:28:54 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-0-1722504506 1000 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-1000-0
+ env
++ date
+ echo Thu Aug 1 11:28:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 11:28:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 70bf5c6f3b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722504538
+ git checkout -b scalability-no-128-1000-0-1722504538
Switched to a new branch 'scalability-no-128-1000-0-1722504538'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722504538 b8a63e8e35] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:29:26 AM CEST 2024 'RUN   files: 1000  partitions: 0'
Thu Aug 1 11:29:26 AM CEST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-0-1722504538 1000 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-1000-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:29:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 11:29:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b8a63e8e35 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722504570
+ git checkout -b scalability-yes-32-32768-1000-1722504570
Switched to a new branch 'scalability-yes-32-32768-1000-1722504570'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722504570 dcc060e31b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722504570 e679a1a7f8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:30:18 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:30:18 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-1000-1722504570 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:32:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 11:32:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e679a1a7f8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722504737
+ git checkout -b scalability-yes-0-32768-1000-1722504737
Switched to a new branch 'scalability-yes-0-32768-1000-1722504737'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722504737 6992467a85] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:33:05 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:33:05 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-1000-1722504737 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:35:03 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 11:35:03 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6992467a85 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722504903
+ git checkout -b scalability-yes-1-32768-1000-1722504903
Switched to a new branch 'scalability-yes-1-32768-1000-1722504903'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722504903 753457a298] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722504903 17c4db5f4b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:35:51 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:35:51 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-1000-1722504903 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:37:50 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 11:37:50 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 17c4db5f4b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722505070
+ git checkout -b scalability-yes-1024-32768-1000-1722505070
Switched to a new branch 'scalability-yes-1024-32768-1000-1722505070'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722505070 f04df2e67b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722505070 1005644c25] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:38:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:38:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-1000-1722505070 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:40:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 11:40:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1005644c25 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722505241
+ git checkout -b scalability-yes-8-32768-1000-1722505241
Switched to a new branch 'scalability-yes-8-32768-1000-1722505241'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722505241 4a42517513] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722505241 28ff72ba1c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:41:30 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:41:30 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-1000-1722505241 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:43:28 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 11:43:28 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 28ff72ba1c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722505408
+ git checkout -b scalability-yes-512-32768-1000-1722505408
Switched to a new branch 'scalability-yes-512-32768-1000-1722505408'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722505408 108d4e4b48] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722505408 f7e825c97c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:44:17 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:44:17 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-1000-1722505408 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:46:16 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 11:46:16 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f7e825c97c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722505576
+ git checkout -b scalability-yes-128-32768-1000-1722505576
Switched to a new branch 'scalability-yes-128-32768-1000-1722505576'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722505576 7883b56926] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722505576 37d2ca38df] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:47:05 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:47:05 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-1000-1722505576 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:49:03 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 11:49:03 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 37d2ca38df fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722505744
+ git checkout -b scalability-no-32-32768-1000-1722505744
Switched to a new branch 'scalability-no-32-32768-1000-1722505744'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722505744 dc6ce23adc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:49:52 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:49:52 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-1000-1722505744 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:51:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 11:51:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dc6ce23adc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722505911
+ git checkout -b scalability-no-0-32768-1000-1722505911
Switched to a new branch 'scalability-no-0-32768-1000-1722505911'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:52:39 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:52:39 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-1000-1722505911 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:54:37 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 11:54:37 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722506078
+ git checkout -b scalability-no-1-32768-1000-1722506078
Switched to a new branch 'scalability-no-1-32768-1000-1722506078'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722506078 dbf1a7ff9e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:55:25 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:55:25 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-1000-1722506078 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 11:57:24 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 11:57:24 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dbf1a7ff9e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722506244
+ git checkout -b scalability-no-1024-32768-1000-1722506244
Switched to a new branch 'scalability-no-1024-32768-1000-1722506244'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722506244 35f8d29049] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:58:12 AM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 11:58:12 AM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-1000-1722506244 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:00:12 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 12:00:12 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 35f8d29049 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722506412
+ git checkout -b scalability-no-8-32768-1000-1722506412
Switched to a new branch 'scalability-no-8-32768-1000-1722506412'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722506412 b95c4689e9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:01:00 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:01:00 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-1000-1722506412 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:02:58 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 12:02:58 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b95c4689e9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722506578
+ git checkout -b scalability-no-512-32768-1000-1722506578
Switched to a new branch 'scalability-no-512-32768-1000-1722506578'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722506578 8db034038a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:03:46 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:03:46 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-1000-1722506578 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:05:47 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 12:05:47 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8db034038a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722506748
+ git checkout -b scalability-no-128-32768-1000-1722506748
Switched to a new branch 'scalability-no-128-32768-1000-1722506748'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722506748 7bbfcd2a8b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:06:36 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:06:36 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-1000-1722506748 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:08:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 12:08:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7bbfcd2a8b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722506914
+ git checkout -b scalability-yes-32-32768-1000-1722506914
Switched to a new branch 'scalability-yes-32-32768-1000-1722506914'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722506914 55b876d492] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722506914 27c81fb2b7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:09:02 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:09:02 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-1000-1722506914 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:10:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 12:10:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 27c81fb2b7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722507034
+ git checkout -b scalability-yes-0-32768-1000-1722507034
Switched to a new branch 'scalability-yes-0-32768-1000-1722507034'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722507034 6f5a2c2326] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:11:01 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:11:01 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-1000-1722507034 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:12:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 12:12:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6f5a2c2326 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722507152
+ git checkout -b scalability-yes-1-32768-1000-1722507152
Switched to a new branch 'scalability-yes-1-32768-1000-1722507152'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722507152 e1fb05c529] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722507152 6a3f11a9b1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:13:00 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:13:00 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-1000-1722507152 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:14:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 12:14:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6a3f11a9b1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722507271
+ git checkout -b scalability-yes-1024-32768-1000-1722507271
Switched to a new branch 'scalability-yes-1024-32768-1000-1722507271'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722507271 fa0510d88c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722507271 d1e4ca76a2] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:14:59 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:14:59 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-1000-1722507271 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:16:30 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 12:16:30 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d1e4ca76a2 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722507390
+ git checkout -b scalability-yes-8-32768-1000-1722507390
Switched to a new branch 'scalability-yes-8-32768-1000-1722507390'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722507390 04dbe1a185] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722507390 92ba021ad9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:16:58 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:16:58 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-1000-1722507390 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:18:28 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 12:18:28 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 92ba021ad9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722507508
+ git checkout -b scalability-yes-512-32768-1000-1722507508
Switched to a new branch 'scalability-yes-512-32768-1000-1722507508'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722507508 2c8d639dfe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722507508 6b91d72a16] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:18:56 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:18:56 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-1000-1722507508 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:20:27 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 12:20:27 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6b91d72a16 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722507627
+ git checkout -b scalability-yes-128-32768-1000-1722507627
Switched to a new branch 'scalability-yes-128-32768-1000-1722507627'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722507627 81657b51ca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722507627 bf1ac10274] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:20:55 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:20:55 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-1000-1722507627 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:22:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 12:22:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bf1ac10274 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722507745
+ git checkout -b scalability-no-32-32768-1000-1722507745
Switched to a new branch 'scalability-no-32-32768-1000-1722507745'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722507745 260e096089] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:22:53 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:22:53 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-1000-1722507745 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:24:23 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 12:24:23 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 260e096089 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722507863
+ git checkout -b scalability-no-0-32768-1000-1722507863
Switched to a new branch 'scalability-no-0-32768-1000-1722507863'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:24:51 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:24:51 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-1000-1722507863 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:26:22 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 12:26:22 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722507982
+ git checkout -b scalability-no-1-32768-1000-1722507982
Switched to a new branch 'scalability-no-1-32768-1000-1722507982'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722507982 05821fa514] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:26:50 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:26:50 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-1000-1722507982 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:28:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 12:28:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05821fa514 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722508101
+ git checkout -b scalability-no-1024-32768-1000-1722508101
Switched to a new branch 'scalability-no-1024-32768-1000-1722508101'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722508101 661ed98ca9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:28:49 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:28:49 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-1000-1722508101 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:30:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 12:30:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 661ed98ca9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722508220
+ git checkout -b scalability-no-8-32768-1000-1722508220
Switched to a new branch 'scalability-no-8-32768-1000-1722508220'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722508220 413de5f288] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:30:48 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:30:48 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-1000-1722508220 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:32:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 12:32:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 413de5f288 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722508338
+ git checkout -b scalability-no-512-32768-1000-1722508338
Switched to a new branch 'scalability-no-512-32768-1000-1722508338'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722508338 826174a5d3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:32:46 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:32:46 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-1000-1722508338 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:34:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 12:34:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 826174a5d3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722508457
+ git checkout -b scalability-no-128-32768-1000-1722508457
Switched to a new branch 'scalability-no-128-32768-1000-1722508457'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722508457 7c2d713dbe] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:34:45 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:34:45 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-1000-1722508457 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:36:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 12:36:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7c2d713dbe fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722508576
+ git checkout -b scalability-yes-32-32768-1000-1722508576
Switched to a new branch 'scalability-yes-32-32768-1000-1722508576'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722508576 2dfad8b062] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722508576 037312914b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:36:44 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:36:44 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-1000-1722508576 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:38:09 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 12:38:09 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 037312914b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722508689
+ git checkout -b scalability-yes-0-32768-1000-1722508689
Switched to a new branch 'scalability-yes-0-32768-1000-1722508689'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722508689 ad3d8e2717] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:38:37 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:38:37 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-1000-1722508689 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:40:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 12:40:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ad3d8e2717 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722508802
+ git checkout -b scalability-yes-1-32768-1000-1722508802
Switched to a new branch 'scalability-yes-1-32768-1000-1722508802'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722508802 bfff3fd0e9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722508802 c3259d93a1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:40:29 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:40:29 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-1000-1722508802 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:41:54 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 12:41:54 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c3259d93a1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722508914
+ git checkout -b scalability-yes-1024-32768-1000-1722508914
Switched to a new branch 'scalability-yes-1024-32768-1000-1722508914'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722508914 3a2d0bad00] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722508914 06e63fd2d7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:42:22 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:42:22 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-1000-1722508914 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:43:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 12:43:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 06e63fd2d7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722509029
+ git checkout -b scalability-yes-8-32768-1000-1722509029
Switched to a new branch 'scalability-yes-8-32768-1000-1722509029'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722509029 f43d1fe23f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722509029 6e0be59bbb] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:44:16 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:44:16 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-1000-1722509029 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:45:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 12:45:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6e0be59bbb fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722509142
+ git checkout -b scalability-yes-512-32768-1000-1722509142
Switched to a new branch 'scalability-yes-512-32768-1000-1722509142'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722509142 c39ca532b2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722509142 113227d93e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:46:09 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:46:09 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-1000-1722509142 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:47:36 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 12:47:36 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 113227d93e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722509256
+ git checkout -b scalability-yes-128-32768-1000-1722509256
Switched to a new branch 'scalability-yes-128-32768-1000-1722509256'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722509256 50d88358a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722509256 87f659a3c9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:48:03 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:48:03 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-1000-1722509256 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:49:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 12:49:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 87f659a3c9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722509368
+ git checkout -b scalability-no-32-32768-1000-1722509368
Switched to a new branch 'scalability-no-32-32768-1000-1722509368'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722509368 82bba0a931] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:49:56 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:49:56 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-1000-1722509368 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:51:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 12:51:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 82bba0a931 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722509481
+ git checkout -b scalability-no-0-32768-1000-1722509481
Switched to a new branch 'scalability-no-0-32768-1000-1722509481'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:51:49 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:51:49 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-1000-1722509481 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:53:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 12:53:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722509593
+ git checkout -b scalability-no-1-32768-1000-1722509593
Switched to a new branch 'scalability-no-1-32768-1000-1722509593'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722509593 23cb2bd734] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:53:41 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:53:41 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-1000-1722509593 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:55:06 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 12:55:06 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 23cb2bd734 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722509706
+ git checkout -b scalability-no-1024-32768-1000-1722509706
Switched to a new branch 'scalability-no-1024-32768-1000-1722509706'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722509706 5aab4e2d70] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:55:34 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:55:34 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-1000-1722509706 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:57:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 12:57:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5aab4e2d70 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722509821
+ git checkout -b scalability-no-8-32768-1000-1722509821
Switched to a new branch 'scalability-no-8-32768-1000-1722509821'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722509821 81c0762bca] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:57:29 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:57:29 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-1000-1722509821 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 12:58:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 12:58:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 81c0762bca fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722509934
+ git checkout -b scalability-no-512-32768-1000-1722509934
Switched to a new branch 'scalability-no-512-32768-1000-1722509934'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722509934 235d648851] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 12:59:21 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 12:59:21 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-1000-1722509934 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:00:47 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 01:00:47 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 235d648851 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722510047
+ git checkout -b scalability-no-128-32768-1000-1722510047
Switched to a new branch 'scalability-no-128-32768-1000-1722510047'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722510047 af3ff997da] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:01:15 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:01:15 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-1000-1722510047 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:02:40 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 01:02:40 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af3ff997da fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722510161
+ git checkout -b scalability-yes-32-32768-1000-1722510161
Switched to a new branch 'scalability-yes-32-32768-1000-1722510161'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722510161 f3c0a54e07] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722510161 8f5f29c8d4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:03:08 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:03:08 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-1000-1722510161 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:04:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 01:04:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f5f29c8d4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722510269
+ git checkout -b scalability-yes-0-32768-1000-1722510269
Switched to a new branch 'scalability-yes-0-32768-1000-1722510269'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722510269 4e9f5c9350] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:04:57 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:04:57 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-1000-1722510269 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:06:17 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 01:06:17 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4e9f5c9350 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722510377
+ git checkout -b scalability-yes-1-32768-1000-1722510377
Switched to a new branch 'scalability-yes-1-32768-1000-1722510377'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722510377 9dc28609cd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722510377 984f448619] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:06:44 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:06:44 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-1000-1722510377 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:08:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 01:08:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 984f448619 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722510485
+ git checkout -b scalability-yes-1024-32768-1000-1722510485
Switched to a new branch 'scalability-yes-1024-32768-1000-1722510485'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722510485 d958155070] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722510485 b5a6d509a8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:08:32 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:08:32 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-1000-1722510485 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:09:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 01:09:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b5a6d509a8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722510593
+ git checkout -b scalability-yes-8-32768-1000-1722510593
Switched to a new branch 'scalability-yes-8-32768-1000-1722510593'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722510593 0ea7ac4b9c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722510593 717f5fe4ae] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:10:21 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:10:21 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-1000-1722510593 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:11:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 01:11:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 717f5fe4ae fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722510701
+ git checkout -b scalability-yes-512-32768-1000-1722510701
Switched to a new branch 'scalability-yes-512-32768-1000-1722510701'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722510701 e845cf26c8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722510701 653f3eb20d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:12:09 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:12:09 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-1000-1722510701 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:13:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 01:13:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 653f3eb20d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722510810
+ git checkout -b scalability-yes-128-32768-1000-1722510810
Switched to a new branch 'scalability-yes-128-32768-1000-1722510810'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722510810 62ddebd3eb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722510810 6488dab9e7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:13:57 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:13:57 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-1000-1722510810 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:15:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 01:15:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6488dab9e7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722510917
+ git checkout -b scalability-no-32-32768-1000-1722510917
Switched to a new branch 'scalability-no-32-32768-1000-1722510917'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722510917 b17f502948] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:15:45 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:15:45 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-1000-1722510917 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:17:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 01:17:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b17f502948 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722511026
+ git checkout -b scalability-no-0-32768-1000-1722511026
Switched to a new branch 'scalability-no-0-32768-1000-1722511026'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:17:33 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:17:33 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-1000-1722511026 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:18:53 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 01:18:53 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722511133
+ git checkout -b scalability-no-1-32768-1000-1722511133
Switched to a new branch 'scalability-no-1-32768-1000-1722511133'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722511133 f7aa9a89a5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:19:21 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:19:21 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-1000-1722511133 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:20:41 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 01:20:41 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f7aa9a89a5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722511241
+ git checkout -b scalability-no-1024-32768-1000-1722511241
Switched to a new branch 'scalability-no-1024-32768-1000-1722511241'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722511241 5147b80cb5] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:21:09 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:21:09 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-1000-1722511241 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:22:29 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 01:22:29 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5147b80cb5 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722511349
+ git checkout -b scalability-no-8-32768-1000-1722511349
Switched to a new branch 'scalability-no-8-32768-1000-1722511349'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722511349 a69d815fb8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:22:57 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:22:57 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-1000-1722511349 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:24:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 01:24:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a69d815fb8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722511457
+ git checkout -b scalability-no-512-32768-1000-1722511457
Switched to a new branch 'scalability-no-512-32768-1000-1722511457'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722511457 7fc381c429] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:24:45 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:24:45 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-1000-1722511457 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:26:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 01:26:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7fc381c429 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722511565
+ git checkout -b scalability-no-128-32768-1000-1722511565
Switched to a new branch 'scalability-no-128-32768-1000-1722511565'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722511565 e0df948535] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:26:33 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:26:33 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-1000-1722511565 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:27:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 01:27:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e0df948535 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722511673
+ git checkout -b scalability-yes-32-32768-1000-1722511673
Switched to a new branch 'scalability-yes-32-32768-1000-1722511673'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722511673 ad35b2c77c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722511673 de85e25f53] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:28:21 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:28:21 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-1000-1722511673 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:28:24 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 01:28:24 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at de85e25f53 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722511704
+ git checkout -b scalability-yes-0-32768-1000-1722511704
Switched to a new branch 'scalability-yes-0-32768-1000-1722511704'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722511704 bc3f4fb90d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:28:53 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:28:53 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-1000-1722511704 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:28:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 01:28:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bc3f4fb90d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722511736
+ git checkout -b scalability-yes-1-32768-1000-1722511736
Switched to a new branch 'scalability-yes-1-32768-1000-1722511736'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722511736 f0ba4af126] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722511736 62b8c05e7f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:29:24 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:29:24 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-1000-1722511736 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:29:28 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 01:29:28 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 62b8c05e7f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722511768
+ git checkout -b scalability-yes-1024-32768-1000-1722511768
Switched to a new branch 'scalability-yes-1024-32768-1000-1722511768'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722511768 0ac83531d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722511768 911744af90] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:29:56 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:29:56 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-1000-1722511768 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:29:59 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 01:29:59 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 911744af90 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722511800
+ git checkout -b scalability-yes-8-32768-1000-1722511800
Switched to a new branch 'scalability-yes-8-32768-1000-1722511800'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722511800 4549c6d3a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722511800 c036e53ffc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:30:28 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:30:28 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-1000-1722511800 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:30:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 01:30:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c036e53ffc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722511831
+ git checkout -b scalability-yes-512-32768-1000-1722511831
Switched to a new branch 'scalability-yes-512-32768-1000-1722511831'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722511831 f5c126de4a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722511831 f36425895b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:30:59 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:30:59 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-1000-1722511831 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:31:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 01:31:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f36425895b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722511863
+ git checkout -b scalability-yes-128-32768-1000-1722511863
Switched to a new branch 'scalability-yes-128-32768-1000-1722511863'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722511863 0abb80dcdf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722511863 fa67b9ad45] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:31:31 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:31:31 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-1000-1722511863 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:31:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 01:31:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fa67b9ad45 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722511895
+ git checkout -b scalability-no-32-32768-1000-1722511895
Switched to a new branch 'scalability-no-32-32768-1000-1722511895'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722511895 d5ac915b4c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:32:03 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:32:03 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-1000-1722511895 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:32:06 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 01:32:06 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d5ac915b4c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722511926
+ git checkout -b scalability-no-0-32768-1000-1722511926
Switched to a new branch 'scalability-no-0-32768-1000-1722511926'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:32:34 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:32:34 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-1000-1722511926 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:32:38 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 01:32:38 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722511958
+ git checkout -b scalability-no-1-32768-1000-1722511958
Switched to a new branch 'scalability-no-1-32768-1000-1722511958'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722511958 9a7b7420ac] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:33:06 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:33:06 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-1000-1722511958 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:33:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 01:33:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9a7b7420ac fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722511990
+ git checkout -b scalability-no-1024-32768-1000-1722511990
Switched to a new branch 'scalability-no-1024-32768-1000-1722511990'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722511990 cf7b5641d6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:33:38 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:33:38 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-1000-1722511990 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:33:41 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 01:33:41 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cf7b5641d6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722512021
+ git checkout -b scalability-no-8-32768-1000-1722512021
Switched to a new branch 'scalability-no-8-32768-1000-1722512021'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722512021 4403ed214f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:34:09 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:34:09 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-1000-1722512021 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:34:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 01:34:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4403ed214f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722512053
+ git checkout -b scalability-no-512-32768-1000-1722512053
Switched to a new branch 'scalability-no-512-32768-1000-1722512053'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722512053 f7c7488a47] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:34:41 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:34:41 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-1000-1722512053 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1000
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1000
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-1000
+ env
++ date
+ echo Thu Aug 1 01:34:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 01:34:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f7c7488a47 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722512084
+ git checkout -b scalability-no-128-32768-1000-1722512084
Switched to a new branch 'scalability-no-128-32768-1000-1722512084'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722512084 2aa8fe3efa] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:35:13 PM CEST 2024 'RUN   files: 32768  partitions: 1000'
Thu Aug 1 01:35:13 PM CEST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-1000-1722512084 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1000 1 10 '1 16 32' 1000
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-100
+ env
++ date
+ echo Thu Aug 1 01:35:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 01:35:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2aa8fe3efa fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722512117
+ git checkout -b scalability-yes-32-32768-100-1722512117
Switched to a new branch 'scalability-yes-32-32768-100-1722512117'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722512117 79a1c79ca4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722512117 f9343d105e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:36:05 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:36:05 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-100-1722512117 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-100
+ env
++ date
+ echo Thu Aug 1 01:37:24 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 01:37:24 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f9343d105e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722512245
+ git checkout -b scalability-yes-0-32768-100-1722512245
Switched to a new branch 'scalability-yes-0-32768-100-1722512245'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722512245 bf4bda9c5b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:38:12 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:38:12 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-100-1722512245 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-100
+ env
++ date
+ echo Thu Aug 1 01:39:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 01:39:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bf4bda9c5b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722512372
+ git checkout -b scalability-yes-1-32768-100-1722512372
Switched to a new branch 'scalability-yes-1-32768-100-1722512372'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722512372 3cdcba9166] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722512372 c9f7cd2b7b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:40:20 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:40:20 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-100-1722512372 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 01:41:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 01:41:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c9f7cd2b7b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722512499
+ git checkout -b scalability-yes-1024-32768-100-1722512499
Switched to a new branch 'scalability-yes-1024-32768-100-1722512499'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722512499 1e56f2257f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722512499 91c6a6467d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:42:27 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:42:27 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-100-1722512499 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-100
+ env
++ date
+ echo Thu Aug 1 01:43:47 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 01:43:47 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 91c6a6467d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722512627
+ git checkout -b scalability-yes-8-32768-100-1722512627
Switched to a new branch 'scalability-yes-8-32768-100-1722512627'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722512627 5c56c437a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722512627 6ab0b68e07] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:44:35 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:44:35 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-100-1722512627 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-100
+ env
++ date
+ echo Thu Aug 1 01:45:54 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 01:45:54 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6ab0b68e07 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722512755
+ git checkout -b scalability-yes-512-32768-100-1722512755
Switched to a new branch 'scalability-yes-512-32768-100-1722512755'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722512755 cca0cf4bd9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722512755 bfe21592de] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:46:43 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:46:43 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-100-1722512755 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-100
+ env
++ date
+ echo Thu Aug 1 01:48:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 01:48:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bfe21592de fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722512883
+ git checkout -b scalability-yes-128-32768-100-1722512883
Switched to a new branch 'scalability-yes-128-32768-100-1722512883'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722512883 2cc0fe2729] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722512883 74298dbc86] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:48:51 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:48:51 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-100-1722512883 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-100
+ env
++ date
+ echo Thu Aug 1 01:50:10 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 01:50:10 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 74298dbc86 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722513010
+ git checkout -b scalability-no-32-32768-100-1722513010
Switched to a new branch 'scalability-no-32-32768-100-1722513010'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722513010 32efaa2ca3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:50:58 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:50:58 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-100-1722513010 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-100
+ env
++ date
+ echo Thu Aug 1 01:52:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 01:52:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 32efaa2ca3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722513138
+ git checkout -b scalability-no-0-32768-100-1722513138
Switched to a new branch 'scalability-no-0-32768-100-1722513138'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:53:06 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:53:06 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-100-1722513138 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-100
+ env
++ date
+ echo Thu Aug 1 01:54:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 01:54:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722513266
+ git checkout -b scalability-no-1-32768-100-1722513266
Switched to a new branch 'scalability-no-1-32768-100-1722513266'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722513266 edbde4895f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:55:14 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:55:14 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-100-1722513266 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 01:56:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 01:56:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at edbde4895f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722513393
+ git checkout -b scalability-no-1024-32768-100-1722513393
Switched to a new branch 'scalability-no-1024-32768-100-1722513393'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722513393 7d324b28ff] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:57:21 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:57:21 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-100-1722513393 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-100
+ env
++ date
+ echo Thu Aug 1 01:58:41 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 01:58:41 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7d324b28ff fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722513521
+ git checkout -b scalability-no-8-32768-100-1722513521
Switched to a new branch 'scalability-no-8-32768-100-1722513521'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722513521 dc9ae8b531] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 01:59:29 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 01:59:29 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-100-1722513521 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-100
+ env
++ date
+ echo Thu Aug 1 02:00:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 02:00:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dc9ae8b531 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722513648
+ git checkout -b scalability-no-512-32768-100-1722513648
Switched to a new branch 'scalability-no-512-32768-100-1722513648'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722513648 ac873be1e1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:01:36 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:01:36 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-100-1722513648 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-100
+ env
++ date
+ echo Thu Aug 1 02:02:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 02:02:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac873be1e1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722513776
+ git checkout -b scalability-no-128-32768-100-1722513776
Switched to a new branch 'scalability-no-128-32768-100-1722513776'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722513776 d4578c144b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:03:44 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:03:44 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-100-1722513776 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-100
+ env
++ date
+ echo Thu Aug 1 02:05:03 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 02:05:03 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d4578c144b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722513904
+ git checkout -b scalability-yes-32-32768-100-1722513904
Switched to a new branch 'scalability-yes-32-32768-100-1722513904'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722513904 1c3e334e69] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722513904 b0436edf93] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:05:32 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:05:32 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-100-1722513904 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-100
+ env
++ date
+ echo Thu Aug 1 02:06:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 02:06:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b0436edf93 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722514012
+ git checkout -b scalability-yes-0-32768-100-1722514012
Switched to a new branch 'scalability-yes-0-32768-100-1722514012'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722514012 ebc459e2a2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:07:21 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:07:21 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-100-1722514012 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-100
+ env
++ date
+ echo Thu Aug 1 02:08:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 02:08:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ebc459e2a2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722514121
+ git checkout -b scalability-yes-1-32768-100-1722514121
Switched to a new branch 'scalability-yes-1-32768-100-1722514121'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722514121 a57308af3e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722514121 9f1bb88273] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:09:09 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:09:09 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-100-1722514121 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 02:10:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 02:10:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9f1bb88273 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722514230
+ git checkout -b scalability-yes-1024-32768-100-1722514230
Switched to a new branch 'scalability-yes-1024-32768-100-1722514230'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722514230 d4c2d478a9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722514230 d6a34e5091] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:10:57 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:10:57 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-100-1722514230 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-100
+ env
++ date
+ echo Thu Aug 1 02:12:18 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 02:12:18 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d6a34e5091 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722514338
+ git checkout -b scalability-yes-8-32768-100-1722514338
Switched to a new branch 'scalability-yes-8-32768-100-1722514338'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722514338 0859bdc16d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722514338 da4bccfb1b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:12:46 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:12:46 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-100-1722514338 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-100
+ env
++ date
+ echo Thu Aug 1 02:14:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 02:14:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at da4bccfb1b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722514447
+ git checkout -b scalability-yes-512-32768-100-1722514447
Switched to a new branch 'scalability-yes-512-32768-100-1722514447'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722514447 5264dc8710] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722514447 e81773b035] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:14:34 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:14:34 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-100-1722514447 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-100
+ env
++ date
+ echo Thu Aug 1 02:15:55 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 02:15:55 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e81773b035 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722514555
+ git checkout -b scalability-yes-128-32768-100-1722514555
Switched to a new branch 'scalability-yes-128-32768-100-1722514555'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722514555 45c4efff2f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722514555 efcb92fd62] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:16:23 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:16:23 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-100-1722514555 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-100
+ env
++ date
+ echo Thu Aug 1 02:17:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 02:17:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at efcb92fd62 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722514663
+ git checkout -b scalability-no-32-32768-100-1722514663
Switched to a new branch 'scalability-no-32-32768-100-1722514663'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722514663 0022c4fae1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:18:11 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:18:11 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-100-1722514663 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-100
+ env
++ date
+ echo Thu Aug 1 02:19:32 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 02:19:32 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0022c4fae1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722514772
+ git checkout -b scalability-no-0-32768-100-1722514772
Switched to a new branch 'scalability-no-0-32768-100-1722514772'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:20:00 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:20:00 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-100-1722514772 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-100
+ env
++ date
+ echo Thu Aug 1 02:21:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 02:21:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722514880
+ git checkout -b scalability-no-1-32768-100-1722514880
Switched to a new branch 'scalability-no-1-32768-100-1722514880'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722514880 ee5393606c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:21:49 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:21:49 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-100-1722514880 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 02:23:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 02:23:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ee5393606c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722514989
+ git checkout -b scalability-no-1024-32768-100-1722514989
Switched to a new branch 'scalability-no-1024-32768-100-1722514989'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722514989 018abd3aef] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:23:37 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:23:37 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-100-1722514989 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-100
+ env
++ date
+ echo Thu Aug 1 02:24:58 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 02:24:58 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 018abd3aef fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722515098
+ git checkout -b scalability-no-8-32768-100-1722515098
Switched to a new branch 'scalability-no-8-32768-100-1722515098'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722515098 da91689569] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:25:26 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:25:26 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-100-1722515098 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-100
+ env
++ date
+ echo Thu Aug 1 02:26:46 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 02:26:46 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at da91689569 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722515207
+ git checkout -b scalability-no-512-32768-100-1722515207
Switched to a new branch 'scalability-no-512-32768-100-1722515207'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722515207 dc4e601cfd] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:27:14 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:27:14 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-100-1722515207 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-100
+ env
++ date
+ echo Thu Aug 1 02:28:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 02:28:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dc4e601cfd fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722515315
+ git checkout -b scalability-no-128-32768-100-1722515315
Switched to a new branch 'scalability-no-128-32768-100-1722515315'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722515315 f783a3507a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:29:03 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:29:03 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-100-1722515315 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-100
+ env
++ date
+ echo Thu Aug 1 02:30:24 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 02:30:24 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f783a3507a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722515424
+ git checkout -b scalability-yes-32-32768-100-1722515424
Switched to a new branch 'scalability-yes-32-32768-100-1722515424'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722515424 d7f5eeb9bb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722515424 76c2d6969e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:30:52 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:30:52 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-100-1722515424 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-100
+ env
++ date
+ echo Thu Aug 1 02:32:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 02:32:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 76c2d6969e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722515526
+ git checkout -b scalability-yes-0-32768-100-1722515526
Switched to a new branch 'scalability-yes-0-32768-100-1722515526'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722515526 ae013880ca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:32:34 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:32:34 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-100-1722515526 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-100
+ env
++ date
+ echo Thu Aug 1 02:33:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 02:33:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ae013880ca NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722515629
+ git checkout -b scalability-yes-1-32768-100-1722515629
Switched to a new branch 'scalability-yes-1-32768-100-1722515629'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722515629 39df3abcef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722515629 7f8e3c569e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:34:17 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:34:17 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-100-1722515629 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 02:35:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 02:35:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7f8e3c569e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722515732
+ git checkout -b scalability-yes-1024-32768-100-1722515732
Switched to a new branch 'scalability-yes-1024-32768-100-1722515732'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722515732 bdcc3845a7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722515732 6ab23ae0df] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:35:59 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:35:59 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-100-1722515732 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-100
+ env
++ date
+ echo Thu Aug 1 02:37:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 02:37:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6ab23ae0df fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722515834
+ git checkout -b scalability-yes-8-32768-100-1722515834
Switched to a new branch 'scalability-yes-8-32768-100-1722515834'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722515834 1730b25d2b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722515834 14b9a4d961] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:37:42 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:37:42 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-100-1722515834 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-100
+ env
++ date
+ echo Thu Aug 1 02:38:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 02:38:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 14b9a4d961 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722515936
+ git checkout -b scalability-yes-512-32768-100-1722515936
Switched to a new branch 'scalability-yes-512-32768-100-1722515936'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722515936 612d17427c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722515936 b523c2d48b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:39:24 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:39:24 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-100-1722515936 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-100
+ env
++ date
+ echo Thu Aug 1 02:40:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 02:40:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b523c2d48b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722516039
+ git checkout -b scalability-yes-128-32768-100-1722516039
Switched to a new branch 'scalability-yes-128-32768-100-1722516039'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722516039 676efffcfe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722516039 954439b599] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:41:08 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:41:08 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-100-1722516039 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-100
+ env
++ date
+ echo Thu Aug 1 02:42:22 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 02:42:22 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 954439b599 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722516143
+ git checkout -b scalability-no-32-32768-100-1722516143
Switched to a new branch 'scalability-no-32-32768-100-1722516143'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722516143 65e1c4cf00] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:42:51 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:42:51 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-100-1722516143 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-100
+ env
++ date
+ echo Thu Aug 1 02:44:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 02:44:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65e1c4cf00 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722516245
+ git checkout -b scalability-no-0-32768-100-1722516245
Switched to a new branch 'scalability-no-0-32768-100-1722516245'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:44:34 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:44:34 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-100-1722516245 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-100
+ env
++ date
+ echo Thu Aug 1 02:45:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 02:45:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722516348
+ git checkout -b scalability-no-1-32768-100-1722516348
Switched to a new branch 'scalability-no-1-32768-100-1722516348'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722516348 e43feec7b5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:46:16 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:46:16 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-100-1722516348 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 02:47:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 02:47:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e43feec7b5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722516451
+ git checkout -b scalability-no-1024-32768-100-1722516451
Switched to a new branch 'scalability-no-1024-32768-100-1722516451'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722516451 cad1d2176c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:47:59 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:47:59 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-100-1722516451 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-100
+ env
++ date
+ echo Thu Aug 1 02:49:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 02:49:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cad1d2176c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722516554
+ git checkout -b scalability-no-8-32768-100-1722516554
Switched to a new branch 'scalability-no-8-32768-100-1722516554'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722516554 0d32a05d8c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:49:42 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:49:42 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-100-1722516554 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-100
+ env
++ date
+ echo Thu Aug 1 02:50:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 02:50:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0d32a05d8c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722516656
+ git checkout -b scalability-no-512-32768-100-1722516656
Switched to a new branch 'scalability-no-512-32768-100-1722516656'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722516656 54bb87244a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:51:23 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:51:23 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-100-1722516656 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-100
+ env
++ date
+ echo Thu Aug 1 02:52:38 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 02:52:38 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 54bb87244a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722516758
+ git checkout -b scalability-no-128-32768-100-1722516758
Switched to a new branch 'scalability-no-128-32768-100-1722516758'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722516758 eb0635a1a7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:53:06 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:53:06 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-100-1722516758 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-100
+ env
++ date
+ echo Thu Aug 1 02:54:21 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 02:54:21 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eb0635a1a7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722516861
+ git checkout -b scalability-yes-32-32768-100-1722516861
Switched to a new branch 'scalability-yes-32-32768-100-1722516861'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722516861 13410a6a9c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722516861 42b5b07878] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:54:49 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:54:49 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-100-1722516861 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-100
+ env
++ date
+ echo Thu Aug 1 02:56:04 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 02:56:04 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 42b5b07878 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722516964
+ git checkout -b scalability-yes-0-32768-100-1722516964
Switched to a new branch 'scalability-yes-0-32768-100-1722516964'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722516964 638412d3b0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:56:33 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:56:33 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-100-1722516964 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-100
+ env
++ date
+ echo Thu Aug 1 02:57:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 02:57:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 638412d3b0 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722517068
+ git checkout -b scalability-yes-1-32768-100-1722517068
Switched to a new branch 'scalability-yes-1-32768-100-1722517068'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722517068 0cce57ff79] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722517068 d09c669b18] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 02:58:16 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 02:58:16 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-100-1722517068 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 02:59:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 02:59:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d09c669b18 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722517172
+ git checkout -b scalability-yes-1024-32768-100-1722517172
Switched to a new branch 'scalability-yes-1024-32768-100-1722517172'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722517172 45558eb865] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722517172 856c09c7cc] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:00:00 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:00:00 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-100-1722517172 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-100
+ env
++ date
+ echo Thu Aug 1 03:01:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 03:01:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 856c09c7cc fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722517276
+ git checkout -b scalability-yes-8-32768-100-1722517276
Switched to a new branch 'scalability-yes-8-32768-100-1722517276'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722517276 4a42fd0d62] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722517276 9fadc7475c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:01:43 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:01:43 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-100-1722517276 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-100
+ env
++ date
+ echo Thu Aug 1 03:02:59 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 03:02:59 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9fadc7475c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722517379
+ git checkout -b scalability-yes-512-32768-100-1722517379
Switched to a new branch 'scalability-yes-512-32768-100-1722517379'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722517379 75e10ff190] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722517379 503bfd926e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:03:27 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:03:27 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-100-1722517379 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-100
+ env
++ date
+ echo Thu Aug 1 03:04:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 03:04:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 503bfd926e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722517483
+ git checkout -b scalability-yes-128-32768-100-1722517483
Switched to a new branch 'scalability-yes-128-32768-100-1722517483'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722517483 93fb717d73] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722517483 93724c9f82] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:05:11 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:05:11 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-100-1722517483 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-100
+ env
++ date
+ echo Thu Aug 1 03:06:26 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 03:06:26 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 93724c9f82 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722517587
+ git checkout -b scalability-no-32-32768-100-1722517587
Switched to a new branch 'scalability-no-32-32768-100-1722517587'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722517587 4bd8370aed] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:06:54 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:06:54 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-100-1722517587 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-100
+ env
++ date
+ echo Thu Aug 1 03:08:10 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 03:08:10 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4bd8370aed fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722517690
+ git checkout -b scalability-no-0-32768-100-1722517690
Switched to a new branch 'scalability-no-0-32768-100-1722517690'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:08:38 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:08:38 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-100-1722517690 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-100
+ env
++ date
+ echo Thu Aug 1 03:09:53 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 03:09:53 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722517793
+ git checkout -b scalability-no-1-32768-100-1722517793
Switched to a new branch 'scalability-no-1-32768-100-1722517793'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722517793 64544fcb53] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:10:21 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:10:21 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-100-1722517793 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 03:11:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 03:11:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 64544fcb53 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722517897
+ git checkout -b scalability-no-1024-32768-100-1722517897
Switched to a new branch 'scalability-no-1024-32768-100-1722517897'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722517897 ad102c8e54] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:12:04 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:12:04 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-100-1722517897 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-100
+ env
++ date
+ echo Thu Aug 1 03:13:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 03:13:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ad102c8e54 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722518000
+ git checkout -b scalability-no-8-32768-100-1722518000
Switched to a new branch 'scalability-no-8-32768-100-1722518000'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722518000 4404417746] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:13:48 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:13:48 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-100-1722518000 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-100
+ env
++ date
+ echo Thu Aug 1 03:15:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 03:15:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4404417746 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722518104
+ git checkout -b scalability-no-512-32768-100-1722518104
Switched to a new branch 'scalability-no-512-32768-100-1722518104'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722518104 093338053e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:15:32 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:15:32 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-100-1722518104 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-100
+ env
++ date
+ echo Thu Aug 1 03:16:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 03:16:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 093338053e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722518208
+ git checkout -b scalability-no-128-32768-100-1722518208
Switched to a new branch 'scalability-no-128-32768-100-1722518208'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722518208 d0b258fec1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:17:15 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:17:15 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-100-1722518208 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-100
+ env
++ date
+ echo Thu Aug 1 03:18:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 03:18:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d0b258fec1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722518311
+ git checkout -b scalability-yes-32-32768-100-1722518311
Switched to a new branch 'scalability-yes-32-32768-100-1722518311'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722518311 4022d6cc50] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722518311 2557cc0392] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:18:59 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:18:59 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-100-1722518311 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-100
+ env
++ date
+ echo Thu Aug 1 03:37:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 03:37:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2557cc0392 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722519426
+ git checkout -b scalability-yes-0-32768-100-1722519426
Switched to a new branch 'scalability-yes-0-32768-100-1722519426'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722519426 d212c31b94] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:37:34 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:37:34 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-100-1722519426 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-100
+ env
++ date
+ echo Thu Aug 1 03:55:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 03:55:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d212c31b94 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722520542
+ git checkout -b scalability-yes-1-32768-100-1722520542
Switched to a new branch 'scalability-yes-1-32768-100-1722520542'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722520542 aa76cbd453] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722520542 ac060179ad] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 03:56:10 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 03:56:10 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-100-1722520542 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 04:14:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 04:14:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac060179ad fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722521661
+ git checkout -b scalability-yes-1024-32768-100-1722521661
Switched to a new branch 'scalability-yes-1024-32768-100-1722521661'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722521661 a94d5c6b2f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722521661 46c8d8343b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 04:14:49 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 04:14:49 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-100-1722521661 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-100
+ env
++ date
+ echo Thu Aug 1 04:33:04 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 04:33:04 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 46c8d8343b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722522784
+ git checkout -b scalability-yes-8-32768-100-1722522784
Switched to a new branch 'scalability-yes-8-32768-100-1722522784'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722522784 061364d071] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722522784 dbe42b3b2e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 04:33:32 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 04:33:32 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-100-1722522784 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-100
+ env
++ date
+ echo Thu Aug 1 04:51:46 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 04:51:46 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dbe42b3b2e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722523906
+ git checkout -b scalability-yes-512-32768-100-1722523906
Switched to a new branch 'scalability-yes-512-32768-100-1722523906'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722523906 260745d4c6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722523906 d64976ea0a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 04:52:14 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 04:52:14 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-100-1722523906 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-100
+ env
++ date
+ echo Thu Aug 1 05:10:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 05:10:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d64976ea0a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722525034
+ git checkout -b scalability-yes-128-32768-100-1722525034
Switched to a new branch 'scalability-yes-128-32768-100-1722525034'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722525034 b5aec1b644] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722525034 0755904ab3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:11:01 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 05:11:01 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-100-1722525034 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-100
+ env
++ date
+ echo Thu Aug 1 05:29:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 05:29:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0755904ab3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722526160
+ git checkout -b scalability-no-32-32768-100-1722526160
Switched to a new branch 'scalability-no-32-32768-100-1722526160'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722526160 d9cfc85540] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:29:48 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 05:29:48 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-100-1722526160 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-100
+ env
++ date
+ echo Thu Aug 1 05:47:59 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 05:47:59 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d9cfc85540 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722527280
+ git checkout -b scalability-no-0-32768-100-1722527280
Switched to a new branch 'scalability-no-0-32768-100-1722527280'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 05:48:28 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 05:48:28 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-100-1722527280 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-100
+ env
++ date
+ echo Thu Aug 1 06:06:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 06:06:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722528400
+ git checkout -b scalability-no-1-32768-100-1722528400
Switched to a new branch 'scalability-no-1-32768-100-1722528400'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722528400 caefb431df] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:07:08 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 06:07:08 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-100-1722528400 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-100
+ env
++ date
+ echo Thu Aug 1 06:25:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 06:25:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at caefb431df fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722529515
+ git checkout -b scalability-no-1024-32768-100-1722529515
Switched to a new branch 'scalability-no-1024-32768-100-1722529515'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722529515 fe7f96693c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:25:43 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 06:25:43 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-100-1722529515 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-100
+ env
++ date
+ echo Thu Aug 1 06:44:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 06:44:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fe7f96693c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722530641
+ git checkout -b scalability-no-8-32768-100-1722530641
Switched to a new branch 'scalability-no-8-32768-100-1722530641'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722530641 e50763ffbf] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 06:44:29 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 06:44:29 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-100-1722530641 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-100
+ env
++ date
+ echo Thu Aug 1 07:02:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 07:02:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e50763ffbf fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722531754
+ git checkout -b scalability-no-512-32768-100-1722531754
Switched to a new branch 'scalability-no-512-32768-100-1722531754'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722531754 860ea82646] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:03:02 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 07:03:02 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-100-1722531754 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-100
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-100
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-100
+ env
++ date
+ echo Thu Aug 1 07:21:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 07:21:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 860ea82646 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722532881
+ git checkout -b scalability-no-128-32768-100-1722532881
Switched to a new branch 'scalability-no-128-32768-100-1722532881'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722532881 66acf9b62b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:21:49 PM CEST 2024 'RUN   files: 32768  partitions: 100'
Thu Aug 1 07:21:49 PM CEST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-100-1722532881 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-100 1 10 '1 16 32' 100
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-10
+ env
++ date
+ echo Thu Aug 1 07:40:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 07:40:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 66acf9b62b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722534002
+ git checkout -b scalability-yes-32-32768-10-1722534002
Switched to a new branch 'scalability-yes-32-32768-10-1722534002'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722534002 7bef0cb64b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722534002 078d2d4d2b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:40:50 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:40:50 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-10-1722534002 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-10
+ env
++ date
+ echo Thu Aug 1 07:42:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 07:42:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 078d2d4d2b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722534127
+ git checkout -b scalability-yes-0-32768-10-1722534127
Switched to a new branch 'scalability-yes-0-32768-10-1722534127'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722534127 82b8b0f9e5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:42:55 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:42:55 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-10-1722534127 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-10
+ env
++ date
+ echo Thu Aug 1 07:44:10 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 07:44:10 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 82b8b0f9e5 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722534250
+ git checkout -b scalability-yes-1-32768-10-1722534250
Switched to a new branch 'scalability-yes-1-32768-10-1722534250'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722534250 c6d4ad3bc0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722534250 5653d69d69] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:44:58 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:44:58 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-10-1722534250 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 07:46:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 07:46:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5653d69d69 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722534373
+ git checkout -b scalability-yes-1024-32768-10-1722534373
Switched to a new branch 'scalability-yes-1024-32768-10-1722534373'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722534373 df5491f5d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722534373 c56af6634c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:47:02 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:47:02 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-10-1722534373 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-10
+ env
++ date
+ echo Thu Aug 1 07:48:17 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 07:48:17 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c56af6634c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722534497
+ git checkout -b scalability-yes-8-32768-10-1722534497
Switched to a new branch 'scalability-yes-8-32768-10-1722534497'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722534497 b9dc8b042a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722534497 22f2693c82] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:49:06 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:49:06 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-10-1722534497 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-10
+ env
++ date
+ echo Thu Aug 1 07:50:21 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 07:50:21 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 22f2693c82 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722534621
+ git checkout -b scalability-yes-512-32768-10-1722534621
Switched to a new branch 'scalability-yes-512-32768-10-1722534621'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722534621 c252500fd3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722534621 1f3d13e2eb] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:51:10 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:51:10 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-10-1722534621 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-10
+ env
++ date
+ echo Thu Aug 1 07:52:25 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 07:52:25 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1f3d13e2eb fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722534745
+ git checkout -b scalability-yes-128-32768-10-1722534745
Switched to a new branch 'scalability-yes-128-32768-10-1722534745'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722534745 bf570891d9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722534745 4180b799cb] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:53:13 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:53:13 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-10-1722534745 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-10
+ env
++ date
+ echo Thu Aug 1 07:54:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 07:54:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4180b799cb fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722534869
+ git checkout -b scalability-no-32-32768-10-1722534869
Switched to a new branch 'scalability-no-32-32768-10-1722534869'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722534869 0036a6b0f2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:55:17 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:55:17 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-10-1722534869 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-10
+ env
++ date
+ echo Thu Aug 1 07:56:32 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 07:56:32 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0036a6b0f2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722534992
+ git checkout -b scalability-no-0-32768-10-1722534992
Switched to a new branch 'scalability-no-0-32768-10-1722534992'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:57:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:57:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-10-1722534992 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-10
+ env
++ date
+ echo Thu Aug 1 07:58:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 07:58:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722535115
+ git checkout -b scalability-no-1-32768-10-1722535115
Switched to a new branch 'scalability-no-1-32768-10-1722535115'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722535115 ebd41b6fde] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 07:59:24 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 07:59:24 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-10-1722535115 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 08:00:39 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 08:00:39 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ebd41b6fde fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722535239
+ git checkout -b scalability-no-1024-32768-10-1722535239
Switched to a new branch 'scalability-no-1024-32768-10-1722535239'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722535239 2c3f6e1399] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:01:27 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:01:27 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-10-1722535239 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-10
+ env
++ date
+ echo Thu Aug 1 08:02:42 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 08:02:42 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2c3f6e1399 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722535363
+ git checkout -b scalability-no-8-32768-10-1722535363
Switched to a new branch 'scalability-no-8-32768-10-1722535363'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722535363 2e03b1f7e2] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:03:30 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:03:30 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-10-1722535363 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-10
+ env
++ date
+ echo Thu Aug 1 08:04:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 08:04:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2e03b1f7e2 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722535485
+ git checkout -b scalability-no-512-32768-10-1722535485
Switched to a new branch 'scalability-no-512-32768-10-1722535485'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722535485 ef1758fc32] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:05:33 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:05:33 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-10-1722535485 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-10
+ env
++ date
+ echo Thu Aug 1 08:06:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 08:06:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ef1758fc32 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722535609
+ git checkout -b scalability-no-128-32768-10-1722535609
Switched to a new branch 'scalability-no-128-32768-10-1722535609'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722535609 6c3d1461ea] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:07:37 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:07:37 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-10-1722535609 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-10
+ env
++ date
+ echo Thu Aug 1 08:08:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 08:08:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6c3d1461ea fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722535732
+ git checkout -b scalability-yes-32-32768-10-1722535732
Switched to a new branch 'scalability-yes-32-32768-10-1722535732'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722535732 e961ac5f5c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722535732 5a3051c932] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:09:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:09:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-10-1722535732 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-10
+ env
++ date
+ echo Thu Aug 1 08:10:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 08:10:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5a3051c932 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722535839
+ git checkout -b scalability-yes-0-32768-10-1722535839
Switched to a new branch 'scalability-yes-0-32768-10-1722535839'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722535839 9031d1c44b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:11:07 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:11:07 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-10-1722535839 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-10
+ env
++ date
+ echo Thu Aug 1 08:12:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 08:12:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9031d1c44b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722535947
+ git checkout -b scalability-yes-1-32768-10-1722535947
Switched to a new branch 'scalability-yes-1-32768-10-1722535947'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722535947 2a58e7bb2d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722535947 e08204058a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:12:55 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:12:55 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-10-1722535947 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 08:14:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 08:14:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e08204058a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722536054
+ git checkout -b scalability-yes-1024-32768-10-1722536054
Switched to a new branch 'scalability-yes-1024-32768-10-1722536054'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722536054 bc5ac9eeaf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722536054 aafca2a1e6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:14:42 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:14:42 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-10-1722536054 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-10
+ env
++ date
+ echo Thu Aug 1 08:16:01 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 08:16:01 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at aafca2a1e6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722536162
+ git checkout -b scalability-yes-8-32768-10-1722536162
Switched to a new branch 'scalability-yes-8-32768-10-1722536162'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722536162 89e40649c3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722536162 2c6047c7b5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:16:29 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:16:29 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-10-1722536162 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-10
+ env
++ date
+ echo Thu Aug 1 08:17:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 08:17:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2c6047c7b5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722536268
+ git checkout -b scalability-yes-512-32768-10-1722536268
Switched to a new branch 'scalability-yes-512-32768-10-1722536268'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722536268 ffa0137224] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722536268 41a047740b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:18:17 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:18:17 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-10-1722536268 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-10
+ env
++ date
+ echo Thu Aug 1 08:19:36 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 08:19:36 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 41a047740b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722536376
+ git checkout -b scalability-yes-128-32768-10-1722536376
Switched to a new branch 'scalability-yes-128-32768-10-1722536376'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722536376 42dc7c7de2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722536376 c10af5bf38] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:20:04 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:20:04 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-10-1722536376 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-10
+ env
++ date
+ echo Thu Aug 1 08:21:23 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 08:21:23 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c10af5bf38 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722536484
+ git checkout -b scalability-no-32-32768-10-1722536484
Switched to a new branch 'scalability-no-32-32768-10-1722536484'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722536484 63bc94b729] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:21:52 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:21:52 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-10-1722536484 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-10
+ env
++ date
+ echo Thu Aug 1 08:23:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 08:23:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 63bc94b729 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722536591
+ git checkout -b scalability-no-0-32768-10-1722536591
Switched to a new branch 'scalability-no-0-32768-10-1722536591'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:23:39 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:23:39 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-10-1722536591 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-10
+ env
++ date
+ echo Thu Aug 1 08:24:58 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 08:24:58 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722536698
+ git checkout -b scalability-no-1-32768-10-1722536698
Switched to a new branch 'scalability-no-1-32768-10-1722536698'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722536698 4d7ac0958f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:25:26 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:25:26 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-10-1722536698 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 08:26:45 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 08:26:45 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4d7ac0958f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722536805
+ git checkout -b scalability-no-1024-32768-10-1722536805
Switched to a new branch 'scalability-no-1024-32768-10-1722536805'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722536805 225e06e4e8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:27:14 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:27:14 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-10-1722536805 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-10
+ env
++ date
+ echo Thu Aug 1 08:28:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 08:28:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 225e06e4e8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722536913
+ git checkout -b scalability-no-8-32768-10-1722536913
Switched to a new branch 'scalability-no-8-32768-10-1722536913'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722536913 a279413dbb] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:29:01 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:29:01 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-10-1722536913 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-10
+ env
++ date
+ echo Thu Aug 1 08:30:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 08:30:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a279413dbb fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722537021
+ git checkout -b scalability-no-512-32768-10-1722537021
Switched to a new branch 'scalability-no-512-32768-10-1722537021'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722537021 23abf35d72] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:30:49 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:30:49 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-10-1722537021 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-10
+ env
++ date
+ echo Thu Aug 1 08:32:08 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 08:32:08 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 23abf35d72 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722537128
+ git checkout -b scalability-no-128-32768-10-1722537128
Switched to a new branch 'scalability-no-128-32768-10-1722537128'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722537128 16b8beacf3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:32:37 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:32:37 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-10-1722537128 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-10
+ env
++ date
+ echo Thu Aug 1 08:33:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 08:33:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 16b8beacf3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722537236
+ git checkout -b scalability-yes-32-32768-10-1722537236
Switched to a new branch 'scalability-yes-32-32768-10-1722537236'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722537236 1db3ce0b89] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722537236 7b7f68603e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:34:24 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:34:24 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-10-1722537236 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-10
+ env
++ date
+ echo Thu Aug 1 08:35:38 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 08:35:38 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7b7f68603e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722537338
+ git checkout -b scalability-yes-0-32768-10-1722537338
Switched to a new branch 'scalability-yes-0-32768-10-1722537338'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722537338 cb83a66012] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:36:06 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:36:06 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-10-1722537338 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-10
+ env
++ date
+ echo Thu Aug 1 08:37:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 08:37:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cb83a66012 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722537439
+ git checkout -b scalability-yes-1-32768-10-1722537439
Switched to a new branch 'scalability-yes-1-32768-10-1722537439'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722537439 e526d63e7b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722537439 59cd6e4d55] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:37:47 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:37:47 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-10-1722537439 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 08:39:01 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 08:39:01 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 59cd6e4d55 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722537541
+ git checkout -b scalability-yes-1024-32768-10-1722537541
Switched to a new branch 'scalability-yes-1024-32768-10-1722537541'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722537541 8452b90f39] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722537541 629e5f56b2] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:39:29 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:39:29 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-10-1722537541 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-10
+ env
++ date
+ echo Thu Aug 1 08:40:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 08:40:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 629e5f56b2 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722537643
+ git checkout -b scalability-yes-8-32768-10-1722537643
Switched to a new branch 'scalability-yes-8-32768-10-1722537643'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722537643 7220e46c94] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722537643 43d475f8f7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:41:11 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:41:11 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-10-1722537643 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-10
+ env
++ date
+ echo Thu Aug 1 08:42:25 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 08:42:25 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 43d475f8f7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722537745
+ git checkout -b scalability-yes-512-32768-10-1722537745
Switched to a new branch 'scalability-yes-512-32768-10-1722537745'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722537745 81d12933d2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722537745 49afc2636e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:42:54 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:42:54 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-10-1722537745 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-10
+ env
++ date
+ echo Thu Aug 1 08:44:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 08:44:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 49afc2636e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722537848
+ git checkout -b scalability-yes-128-32768-10-1722537848
Switched to a new branch 'scalability-yes-128-32768-10-1722537848'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722537848 16ba62fa5d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722537848 d98159e5ea] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:44:36 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:44:36 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-10-1722537848 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-10
+ env
++ date
+ echo Thu Aug 1 08:45:50 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 08:45:50 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d98159e5ea fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722537950
+ git checkout -b scalability-no-32-32768-10-1722537950
Switched to a new branch 'scalability-no-32-32768-10-1722537950'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722537950 79430af29c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:46:18 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:46:18 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-10-1722537950 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-10
+ env
++ date
+ echo Thu Aug 1 08:47:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 08:47:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 79430af29c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722538052
+ git checkout -b scalability-no-0-32768-10-1722538052
Switched to a new branch 'scalability-no-0-32768-10-1722538052'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:47:59 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:47:59 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-10-1722538052 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-10
+ env
++ date
+ echo Thu Aug 1 08:49:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 08:49:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722538153
+ git checkout -b scalability-no-1-32768-10-1722538153
Switched to a new branch 'scalability-no-1-32768-10-1722538153'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722538153 e312fbb781] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:49:41 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:49:41 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-10-1722538153 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 08:50:55 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 08:50:55 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e312fbb781 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722538255
+ git checkout -b scalability-no-1024-32768-10-1722538255
Switched to a new branch 'scalability-no-1024-32768-10-1722538255'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722538255 4049b0e38a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:51:23 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:51:23 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-10-1722538255 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-10
+ env
++ date
+ echo Thu Aug 1 08:52:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 08:52:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4049b0e38a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722538357
+ git checkout -b scalability-no-8-32768-10-1722538357
Switched to a new branch 'scalability-no-8-32768-10-1722538357'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722538357 98759b0380] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:53:05 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:53:05 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-10-1722538357 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-10
+ env
++ date
+ echo Thu Aug 1 08:54:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 08:54:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 98759b0380 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722538459
+ git checkout -b scalability-no-512-32768-10-1722538459
Switched to a new branch 'scalability-no-512-32768-10-1722538459'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722538459 35c2247b11] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:54:46 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:54:46 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-10-1722538459 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-10
+ env
++ date
+ echo Thu Aug 1 08:56:00 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 08:56:00 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 35c2247b11 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722538560
+ git checkout -b scalability-no-128-32768-10-1722538560
Switched to a new branch 'scalability-no-128-32768-10-1722538560'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722538560 5c6f569b86] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:56:28 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:56:28 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-10-1722538560 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-10
+ env
++ date
+ echo Thu Aug 1 08:57:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 08:57:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5c6f569b86 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722538662
+ git checkout -b scalability-yes-32-32768-10-1722538662
Switched to a new branch 'scalability-yes-32-32768-10-1722538662'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722538662 7747e95227] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722538662 0d54209275] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:58:10 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:58:10 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-10-1722538662 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-10
+ env
++ date
+ echo Thu Aug 1 08:59:24 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 08:59:24 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0d54209275 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722538765
+ git checkout -b scalability-yes-0-32768-10-1722538765
Switched to a new branch 'scalability-yes-0-32768-10-1722538765'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722538765 6b55d7d269] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 08:59:52 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 08:59:52 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-10-1722538765 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-10
+ env
++ date
+ echo Thu Aug 1 09:01:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 09:01:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6b55d7d269 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722538867
+ git checkout -b scalability-yes-1-32768-10-1722538867
Switched to a new branch 'scalability-yes-1-32768-10-1722538867'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722538867 d5ad7575b5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722538867 66673dae1d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:01:35 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:01:35 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-10-1722538867 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 09:02:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 09:02:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 66673dae1d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722538970
+ git checkout -b scalability-yes-1024-32768-10-1722538970
Switched to a new branch 'scalability-yes-1024-32768-10-1722538970'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722538970 a6883eb6f8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722538970 4eb3c60735] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:03:17 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:03:17 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-10-1722538970 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-10
+ env
++ date
+ echo Thu Aug 1 09:04:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 09:04:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4eb3c60735 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722539072
+ git checkout -b scalability-yes-8-32768-10-1722539072
Switched to a new branch 'scalability-yes-8-32768-10-1722539072'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722539072 cb1b9b76cb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722539072 8f336ca606] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:05:00 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:05:00 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-10-1722539072 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-10
+ env
++ date
+ echo Thu Aug 1 09:06:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 09:06:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f336ca606 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722539175
+ git checkout -b scalability-yes-512-32768-10-1722539175
Switched to a new branch 'scalability-yes-512-32768-10-1722539175'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722539175 fc6b40a30c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722539175 1ad1d460d8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:06:42 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:06:42 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-10-1722539175 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-10
+ env
++ date
+ echo Thu Aug 1 09:07:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 09:07:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1ad1d460d8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722539277
+ git checkout -b scalability-yes-128-32768-10-1722539277
Switched to a new branch 'scalability-yes-128-32768-10-1722539277'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722539277 d15f4403ef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722539277 b6546c8c10] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:08:25 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:08:25 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-10-1722539277 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-10
+ env
++ date
+ echo Thu Aug 1 09:09:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 09:09:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b6546c8c10 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722539380
+ git checkout -b scalability-no-32-32768-10-1722539380
Switched to a new branch 'scalability-no-32-32768-10-1722539380'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722539380 8648543d27] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:10:08 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:10:08 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-10-1722539380 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-10
+ env
++ date
+ echo Thu Aug 1 09:11:23 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 09:11:23 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8648543d27 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722539483
+ git checkout -b scalability-no-0-32768-10-1722539483
Switched to a new branch 'scalability-no-0-32768-10-1722539483'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:11:51 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:11:51 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-10-1722539483 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-10
+ env
++ date
+ echo Thu Aug 1 09:13:06 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 09:13:06 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722539586
+ git checkout -b scalability-no-1-32768-10-1722539586
Switched to a new branch 'scalability-no-1-32768-10-1722539586'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722539586 f129e768c8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:13:34 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:13:34 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-10-1722539586 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 09:14:49 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 09:14:49 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f129e768c8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722539689
+ git checkout -b scalability-no-1024-32768-10-1722539689
Switched to a new branch 'scalability-no-1024-32768-10-1722539689'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722539689 b8865c7325] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:15:16 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:15:16 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-10-1722539689 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-10
+ env
++ date
+ echo Thu Aug 1 09:16:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 09:16:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b8865c7325 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722539791
+ git checkout -b scalability-no-8-32768-10-1722539791
Switched to a new branch 'scalability-no-8-32768-10-1722539791'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722539791 19bc40b893] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:16:59 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:16:59 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-10-1722539791 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-10
+ env
++ date
+ echo Thu Aug 1 09:18:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 09:18:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 19bc40b893 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722539893
+ git checkout -b scalability-no-512-32768-10-1722539893
Switched to a new branch 'scalability-no-512-32768-10-1722539893'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722539893 73d0a12cb4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:18:42 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:18:42 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-10-1722539893 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-10
+ env
++ date
+ echo Thu Aug 1 09:19:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 09:19:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 73d0a12cb4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722539996
+ git checkout -b scalability-no-128-32768-10-1722539996
Switched to a new branch 'scalability-no-128-32768-10-1722539996'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722539996 9816f5ec2b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:20:24 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:20:24 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-10-1722539996 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-10
+ env
++ date
+ echo Thu Aug 1 09:21:38 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 09:21:38 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9816f5ec2b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722540099
+ git checkout -b scalability-yes-32-32768-10-1722540099
Switched to a new branch 'scalability-yes-32-32768-10-1722540099'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722540099 c2d30b75a0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722540099 2d48d4ac87] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:22:07 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:22:07 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-10-1722540099 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-10
+ env
++ date
+ echo Thu Aug 1 09:25:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 09:25:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2d48d4ac87 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722540307
+ git checkout -b scalability-yes-0-32768-10-1722540307
Switched to a new branch 'scalability-yes-0-32768-10-1722540307'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722540307 8c91e005e3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:25:34 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:25:34 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-10-1722540307 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-10
+ env
++ date
+ echo Thu Aug 1 09:28:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 09:28:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8c91e005e3 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722540515
+ git checkout -b scalability-yes-1-32768-10-1722540515
Switched to a new branch 'scalability-yes-1-32768-10-1722540515'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722540515 0fb35dc70c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722540515 6b187fdf22] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:29:03 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:29:03 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-10-1722540515 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 09:32:03 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 09:32:03 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6b187fdf22 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722540723
+ git checkout -b scalability-yes-1024-32768-10-1722540723
Switched to a new branch 'scalability-yes-1024-32768-10-1722540723'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722540723 a3946e143d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722540723 75adab681d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:32:31 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:32:31 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-10-1722540723 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-10
+ env
++ date
+ echo Thu Aug 1 09:35:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 09:35:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 75adab681d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722540932
+ git checkout -b scalability-yes-8-32768-10-1722540932
Switched to a new branch 'scalability-yes-8-32768-10-1722540932'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722540932 b42c70f5fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722540932 56fafb96ad] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:36:00 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:36:00 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-10-1722540932 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-10
+ env
++ date
+ echo Thu Aug 1 09:39:00 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 09:39:00 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 56fafb96ad fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722541140
+ git checkout -b scalability-yes-512-32768-10-1722541140
Switched to a new branch 'scalability-yes-512-32768-10-1722541140'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722541140 5cb610e82f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722541140 031469c8b4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:39:28 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:39:28 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-10-1722541140 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-10
+ env
++ date
+ echo Thu Aug 1 09:42:28 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 09:42:28 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 031469c8b4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722541348
+ git checkout -b scalability-yes-128-32768-10-1722541348
Switched to a new branch 'scalability-yes-128-32768-10-1722541348'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722541348 34f5d3e434] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722541348 90360c72d1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:42:57 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:42:57 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-10-1722541348 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-10
+ env
++ date
+ echo Thu Aug 1 09:45:56 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 09:45:56 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 90360c72d1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722541557
+ git checkout -b scalability-no-32-32768-10-1722541557
Switched to a new branch 'scalability-no-32-32768-10-1722541557'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722541557 b9f80335b0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:46:25 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:46:25 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-10-1722541557 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-10
+ env
++ date
+ echo Thu Aug 1 09:49:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 09:49:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b9f80335b0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722541765
+ git checkout -b scalability-no-0-32768-10-1722541765
Switched to a new branch 'scalability-no-0-32768-10-1722541765'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:49:53 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:49:53 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-10-1722541765 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-10
+ env
++ date
+ echo Thu Aug 1 09:52:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 09:52:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722541972
+ git checkout -b scalability-no-1-32768-10-1722541972
Switched to a new branch 'scalability-no-1-32768-10-1722541972'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722541972 e5ba26ddb6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:53:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:53:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-10-1722541972 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-10
+ env
++ date
+ echo Thu Aug 1 09:56:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 09:56:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e5ba26ddb6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722542179
+ git checkout -b scalability-no-1024-32768-10-1722542179
Switched to a new branch 'scalability-no-1024-32768-10-1722542179'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722542179 de8331cd21] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 09:56:47 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 09:56:47 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-10-1722542179 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-10
+ env
++ date
+ echo Thu Aug 1 09:59:47 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 09:59:47 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at de8331cd21 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722542387
+ git checkout -b scalability-no-8-32768-10-1722542387
Switched to a new branch 'scalability-no-8-32768-10-1722542387'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722542387 2ee5769963] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:00:15 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 10:00:15 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-10-1722542387 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-10
+ env
++ date
+ echo Thu Aug 1 10:03:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 10:03:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2ee5769963 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722542594
+ git checkout -b scalability-no-512-32768-10-1722542594
Switched to a new branch 'scalability-no-512-32768-10-1722542594'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722542594 3475c5f3fe] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:03:42 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 10:03:42 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-10-1722542594 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-10
+ env
++ date
+ echo Thu Aug 1 10:06:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 10:06:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3475c5f3fe fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722542804
+ git checkout -b scalability-no-128-32768-10-1722542804
Switched to a new branch 'scalability-no-128-32768-10-1722542804'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/128/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722542804 32dae32421] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:07:12 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Thu Aug 1 10:07:12 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-10-1722542804 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-1
+ env
++ date
+ echo Thu Aug 1 10:10:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 10:10:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 32dae32421 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722543012
+ git checkout -b scalability-yes-32-32768-1-1722543012
Switched to a new branch 'scalability-yes-32-32768-1-1722543012'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722543012 fda001faa0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722543012 46905e7be3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:11:00 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:11:00 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-1-1722543012 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-1
+ env
++ date
+ echo Thu Aug 1 10:12:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 10:12:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 46905e7be3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722543135
+ git checkout -b scalability-yes-0-32768-1-1722543135
Switched to a new branch 'scalability-yes-0-32768-1-1722543135'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722543135 18bbf54938] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:13:03 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:13:03 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-1-1722543135 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-1
+ env
++ date
+ echo Thu Aug 1 10:14:18 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 10:14:18 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 18bbf54938 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722543258
+ git checkout -b scalability-yes-1-32768-1-1722543258
Switched to a new branch 'scalability-yes-1-32768-1-1722543258'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722543258 7241b82ffa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722543258 9caf3e00fb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:15:06 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:15:06 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-1-1722543258 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 10:16:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 10:16:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9caf3e00fb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722543381
+ git checkout -b scalability-yes-1024-32768-1-1722543381
Switched to a new branch 'scalability-yes-1024-32768-1-1722543381'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722543381 a302287661] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722543381 e5b0b18215] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:17:09 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:17:09 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-1-1722543381 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-1
+ env
++ date
+ echo Thu Aug 1 10:18:23 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 10:18:23 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e5b0b18215 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722543504
+ git checkout -b scalability-yes-8-32768-1-1722543504
Switched to a new branch 'scalability-yes-8-32768-1-1722543504'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722543504 6d20939c1c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722543504 5e749ef80d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:19:11 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:19:11 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-1-1722543504 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-1
+ env
++ date
+ echo Thu Aug 1 10:20:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 10:20:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5e749ef80d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722543626
+ git checkout -b scalability-yes-512-32768-1-1722543626
Switched to a new branch 'scalability-yes-512-32768-1-1722543626'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722543626 56d6117bb4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722543626 948be1de7e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:21:14 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:21:14 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-1-1722543626 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-1
+ env
++ date
+ echo Thu Aug 1 10:22:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 10:22:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 948be1de7e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722543749
+ git checkout -b scalability-yes-128-32768-1-1722543749
Switched to a new branch 'scalability-yes-128-32768-1-1722543749'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722543749 3006aa5e97] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722543749 fb7472162c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:23:17 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:23:17 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-1-1722543749 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-1
+ env
++ date
+ echo Thu Aug 1 10:24:31 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 10:24:31 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fb7472162c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722543872
+ git checkout -b scalability-no-32-32768-1-1722543872
Switched to a new branch 'scalability-no-32-32768-1-1722543872'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722543872 de5d677563] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:25:20 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:25:20 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-1-1722543872 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-1
+ env
++ date
+ echo Thu Aug 1 10:26:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 10:26:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at de5d677563 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722543995
+ git checkout -b scalability-no-0-32768-1-1722543995
Switched to a new branch 'scalability-no-0-32768-1-1722543995'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:27:23 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:27:23 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-1-1722543995 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-1
+ env
++ date
+ echo Thu Aug 1 10:28:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 10:28:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722544118
+ git checkout -b scalability-no-1-32768-1-1722544118
Switched to a new branch 'scalability-no-1-32768-1-1722544118'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722544118 58776ad5e8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:29:26 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:29:26 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-1-1722544118 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 10:30:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 10:30:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 58776ad5e8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722544240
+ git checkout -b scalability-no-1024-32768-1-1722544240
Switched to a new branch 'scalability-no-1024-32768-1-1722544240'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722544240 f5ea54e878] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:31:29 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:31:29 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-1-1722544240 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-1
+ env
++ date
+ echo Thu Aug 1 10:32:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 10:32:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f5ea54e878 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722544364
+ git checkout -b scalability-no-8-32768-1-1722544364
Switched to a new branch 'scalability-no-8-32768-1-1722544364'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/8/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722544364 870e31758f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:33:32 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:33:32 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-1-1722544364 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-1
+ env
++ date
+ echo Thu Aug 1 10:34:47 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 10:34:47 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 870e31758f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722544487
+ git checkout -b scalability-no-512-32768-1-1722544487
Switched to a new branch 'scalability-no-512-32768-1-1722544487'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722544487 c17d2be123] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:35:34 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:35:34 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-1-1722544487 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-1
+ env
++ date
+ echo Thu Aug 1 10:36:49 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 10:36:49 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c17d2be123 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722544609
+ git checkout -b scalability-no-128-32768-1-1722544609
Switched to a new branch 'scalability-no-128-32768-1-1722544609'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722544609 17ccb9a8c3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:37:37 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:37:37 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-1-1722544609 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-1
+ env
++ date
+ echo Thu Aug 1 10:38:51 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 10:38:51 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 17ccb9a8c3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722544732
+ git checkout -b scalability-yes-32-32768-1-1722544732
Switched to a new branch 'scalability-yes-32-32768-1-1722544732'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722544732 f5d231c8a0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722544732 1a36191e73] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:39:19 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:39:19 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-1-1722544732 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-1
+ env
++ date
+ echo Thu Aug 1 10:40:38 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 10:40:38 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1a36191e73 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722544838
+ git checkout -b scalability-yes-0-32768-1-1722544838
Switched to a new branch 'scalability-yes-0-32768-1-1722544838'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722544838 817c6427f6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:41:07 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:41:07 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-1-1722544838 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-1
+ env
++ date
+ echo Thu Aug 1 10:42:25 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 10:42:25 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 817c6427f6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722544945
+ git checkout -b scalability-yes-1-32768-1-1722544945
Switched to a new branch 'scalability-yes-1-32768-1-1722544945'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722544945 242222743e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722544945 9418162c08] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:42:54 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:42:54 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-1-1722544945 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 10:44:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 10:44:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9418162c08 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722545052
+ git checkout -b scalability-yes-1024-32768-1-1722545052
Switched to a new branch 'scalability-yes-1024-32768-1-1722545052'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722545052 a98c3fad40] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722545052 bbc9c93119] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:44:40 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:44:40 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-1-1722545052 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-1
+ env
++ date
+ echo Thu Aug 1 10:45:59 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 10:45:59 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bbc9c93119 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722545159
+ git checkout -b scalability-yes-8-32768-1-1722545159
Switched to a new branch 'scalability-yes-8-32768-1-1722545159'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722545159 9498f7d752] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722545159 b6cc1c15a7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:46:27 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:46:27 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-1-1722545159 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-1
+ env
++ date
+ echo Thu Aug 1 10:47:46 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 10:47:46 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b6cc1c15a7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722545266
+ git checkout -b scalability-yes-512-32768-1-1722545266
Switched to a new branch 'scalability-yes-512-32768-1-1722545266'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722545266 795948bc06] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722545266 69d4de8ca0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:48:15 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:48:15 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-1-1722545266 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-1
+ env
++ date
+ echo Thu Aug 1 10:49:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 10:49:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 69d4de8ca0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722545374
+ git checkout -b scalability-yes-128-32768-1-1722545374
Switched to a new branch 'scalability-yes-128-32768-1-1722545374'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722545374 46450a5d4a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722545374 a2e4dffe5a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:50:01 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:50:01 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-1-1722545374 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-1
+ env
++ date
+ echo Thu Aug 1 10:51:20 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 10:51:20 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a2e4dffe5a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722545480
+ git checkout -b scalability-no-32-32768-1-1722545480
Switched to a new branch 'scalability-no-32-32768-1-1722545480'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722545480 f3ef716540] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:51:48 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:51:48 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-1-1722545480 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-1
+ env
++ date
+ echo Thu Aug 1 10:53:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 10:53:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f3ef716540 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722545587
+ git checkout -b scalability-no-0-32768-1-1722545587
Switched to a new branch 'scalability-no-0-32768-1-1722545587'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:53:35 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:53:35 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-1-1722545587 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-1
+ env
++ date
+ echo Thu Aug 1 10:54:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 10:54:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722545694
+ git checkout -b scalability-no-1-32768-1-1722545694
Switched to a new branch 'scalability-no-1-32768-1-1722545694'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722545694 1679b37187] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:55:22 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:55:22 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-1-1722545694 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 10:56:41 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 10:56:41 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1679b37187 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722545801
+ git checkout -b scalability-no-1024-32768-1-1722545801
Switched to a new branch 'scalability-no-1024-32768-1-1722545801'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722545801 a5d6f722ce] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:57:09 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:57:09 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-1-1722545801 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-1
+ env
++ date
+ echo Thu Aug 1 10:58:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 10:58:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a5d6f722ce fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722545908
+ git checkout -b scalability-no-8-32768-1-1722545908
Switched to a new branch 'scalability-no-8-32768-1-1722545908'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722545908 9fa4057b8f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 10:58:56 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 10:58:56 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-1-1722545908 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-1
+ env
++ date
+ echo Thu Aug 1 11:00:15 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 11:00:15 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9fa4057b8f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722546015
+ git checkout -b scalability-no-512-32768-1-1722546015
Switched to a new branch 'scalability-no-512-32768-1-1722546015'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722546015 a3333b2f15] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:00:42 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:00:42 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-1-1722546015 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-1
+ env
++ date
+ echo Thu Aug 1 11:02:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 11:02:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a3333b2f15 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722546121
+ git checkout -b scalability-no-128-32768-1-1722546121
Switched to a new branch 'scalability-no-128-32768-1-1722546121'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722546121 cc0b382e69] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:02:29 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:02:29 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-1-1722546121 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-1
+ env
++ date
+ echo Thu Aug 1 11:03:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 11:03:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cc0b382e69 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722546228
+ git checkout -b scalability-yes-32-32768-1-1722546228
Switched to a new branch 'scalability-yes-32-32768-1-1722546228'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722546228 0987259c17] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722546228 65ddf68713] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:04:16 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:04:16 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-1-1722546228 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-1
+ env
++ date
+ echo Thu Aug 1 11:05:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 11:05:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 65ddf68713 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722546330
+ git checkout -b scalability-yes-0-32768-1-1722546330
Switched to a new branch 'scalability-yes-0-32768-1-1722546330'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722546330 4f61b5cc5f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:05:57 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:05:57 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-1-1722546330 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-1
+ env
++ date
+ echo Thu Aug 1 11:07:11 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 11:07:11 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4f61b5cc5f NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722546431
+ git checkout -b scalability-yes-1-32768-1-1722546431
Switched to a new branch 'scalability-yes-1-32768-1-1722546431'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722546431 b100933cb7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722546431 a1e2df26f2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:07:39 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:07:39 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-1-1722546431 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 11:08:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 11:08:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a1e2df26f2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722546533
+ git checkout -b scalability-yes-1024-32768-1-1722546533
Switched to a new branch 'scalability-yes-1024-32768-1-1722546533'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722546533 bd5a67aa35] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722546533 a4f5ff6a94] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:09:20 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:09:20 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-1-1722546533 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-1
+ env
++ date
+ echo Thu Aug 1 11:10:34 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 11:10:34 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a4f5ff6a94 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722546634
+ git checkout -b scalability-yes-8-32768-1-1722546634
Switched to a new branch 'scalability-yes-8-32768-1-1722546634'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722546634 a5ee191e8a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722546634 8fc2247dd9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:11:02 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:11:02 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-1-1722546634 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-1
+ env
++ date
+ echo Thu Aug 1 11:12:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 11:12:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8fc2247dd9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722546736
+ git checkout -b scalability-yes-512-32768-1-1722546736
Switched to a new branch 'scalability-yes-512-32768-1-1722546736'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722546736 62089d9b9e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722546736 fd7dda9ff1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:12:44 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:12:44 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-1-1722546736 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-1
+ env
++ date
+ echo Thu Aug 1 11:13:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 11:13:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fd7dda9ff1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722546837
+ git checkout -b scalability-yes-128-32768-1-1722546837
Switched to a new branch 'scalability-yes-128-32768-1-1722546837'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722546837 1bd34ac4e7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722546837 927d4ba0c6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:14:25 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:14:25 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-1-1722546837 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-1
+ env
++ date
+ echo Thu Aug 1 11:15:39 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 11:15:39 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 927d4ba0c6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722546939
+ git checkout -b scalability-no-32-32768-1-1722546939
Switched to a new branch 'scalability-no-32-32768-1-1722546939'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722546939 d684f456c6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:16:07 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:16:07 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-1-1722546939 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-1
+ env
++ date
+ echo Thu Aug 1 11:17:21 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 11:17:21 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d684f456c6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722547041
+ git checkout -b scalability-no-0-32768-1-1722547041
Switched to a new branch 'scalability-no-0-32768-1-1722547041'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:17:48 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:17:48 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-1-1722547041 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-1
+ env
++ date
+ echo Thu Aug 1 11:19:02 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 11:19:02 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722547142
+ git checkout -b scalability-no-1-32768-1-1722547142
Switched to a new branch 'scalability-no-1-32768-1-1722547142'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722547142 53e012d29d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:19:30 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:19:30 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-1-1722547142 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 11:20:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 11:20:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 53e012d29d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722547244
+ git checkout -b scalability-no-1024-32768-1-1722547244
Switched to a new branch 'scalability-no-1024-32768-1-1722547244'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722547244 aa25d537c7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:21:11 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:21:11 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-1-1722547244 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-1
+ env
++ date
+ echo Thu Aug 1 11:22:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 11:22:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at aa25d537c7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722547345
+ git checkout -b scalability-no-8-32768-1-1722547345
Switched to a new branch 'scalability-no-8-32768-1-1722547345'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722547345 0515855f6b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:22:53 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:22:53 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-1-1722547345 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-1
+ env
++ date
+ echo Thu Aug 1 11:24:06 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 11:24:06 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0515855f6b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722547447
+ git checkout -b scalability-no-512-32768-1-1722547447
Switched to a new branch 'scalability-no-512-32768-1-1722547447'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722547447 5e73e70b73] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:24:34 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:24:34 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-1-1722547447 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-1
+ env
++ date
+ echo Thu Aug 1 11:25:48 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 11:25:48 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5e73e70b73 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722547548
+ git checkout -b scalability-no-128-32768-1-1722547548
Switched to a new branch 'scalability-no-128-32768-1-1722547548'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722547548 d4bbb6c15e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:26:16 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:26:16 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-1-1722547548 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-1
+ env
++ date
+ echo Thu Aug 1 11:27:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 11:27:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d4bbb6c15e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722547650
+ git checkout -b scalability-yes-32-32768-1-1722547650
Switched to a new branch 'scalability-yes-32-32768-1-1722547650'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722547650 0a15fc94cd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722547650 a21a2f84ee] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:27:57 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:27:57 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-1-1722547650 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-1
+ env
++ date
+ echo Thu Aug 1 11:29:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 11:29:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a21a2f84ee fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722547752
+ git checkout -b scalability-yes-0-32768-1-1722547752
Switched to a new branch 'scalability-yes-0-32768-1-1722547752'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722547752 6fa3a16d6a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:29:40 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:29:40 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-1-1722547752 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-1
+ env
++ date
+ echo Thu Aug 1 11:30:54 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 11:30:54 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6fa3a16d6a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722547854
+ git checkout -b scalability-yes-1-32768-1-1722547854
Switched to a new branch 'scalability-yes-1-32768-1-1722547854'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722547854 bc1e3e5731] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722547854 37e5000b7c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:31:22 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:31:22 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-1-1722547854 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 11:32:37 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 11:32:37 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 37e5000b7c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722547957
+ git checkout -b scalability-yes-1024-32768-1-1722547957
Switched to a new branch 'scalability-yes-1024-32768-1-1722547957'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722547957 60b80e5416] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722547957 25ff8fe8f4] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:33:04 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:33:04 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-1-1722547957 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-1
+ env
++ date
+ echo Thu Aug 1 11:34:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu Aug 1 11:34:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 25ff8fe8f4 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722548059
+ git checkout -b scalability-yes-8-32768-1-1722548059
Switched to a new branch 'scalability-yes-8-32768-1-1722548059'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722548059 64790e735e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722548059 14ef083cf6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:34:47 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:34:47 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-1-1722548059 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-1
+ env
++ date
+ echo Thu Aug 1 11:36:02 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu Aug 1 11:36:02 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 14ef083cf6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722548162
+ git checkout -b scalability-yes-512-32768-1-1722548162
Switched to a new branch 'scalability-yes-512-32768-1-1722548162'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722548162 0924b8c660] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/512/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722548162 8f8b5f0fc9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:36:30 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:36:30 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-1-1722548162 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-1
+ env
++ date
+ echo Thu Aug 1 11:37:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu Aug 1 11:37:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f8b5f0fc9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722548265
+ git checkout -b scalability-yes-128-32768-1-1722548265
Switched to a new branch 'scalability-yes-128-32768-1-1722548265'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722548265 989eec2bfd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722548265 abb1696c26] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:38:12 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:38:12 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-1-1722548265 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-1
+ env
++ date
+ echo Thu Aug 1 11:39:26 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu Aug 1 11:39:26 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at abb1696c26 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722548367
+ git checkout -b scalability-no-32-32768-1-1722548367
Switched to a new branch 'scalability-no-32-32768-1-1722548367'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722548367 3f758d9f10] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:39:55 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:39:55 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-1-1722548367 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-1
+ env
++ date
+ echo Thu Aug 1 11:41:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu Aug 1 11:41:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3f758d9f10 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722548469
+ git checkout -b scalability-no-0-32768-1-1722548469
Switched to a new branch 'scalability-no-0-32768-1-1722548469'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:41:36 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:41:36 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-1-1722548469 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-1
+ env
++ date
+ echo Thu Aug 1 11:42:51 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu Aug 1 11:42:51 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722548571
+ git checkout -b scalability-no-1-32768-1-1722548571
Switched to a new branch 'scalability-no-1-32768-1-1722548571'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722548571 8eb462be1c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:43:19 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:43:19 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-1-1722548571 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 11:44:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu Aug 1 11:44:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8eb462be1c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722548674
+ git checkout -b scalability-no-1024-32768-1-1722548674
Switched to a new branch 'scalability-no-1024-32768-1-1722548674'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722548674 2b8f8ef7e7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:45:01 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:45:01 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-1-1722548674 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-1
+ env
++ date
+ echo Thu Aug 1 11:46:15 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu Aug 1 11:46:15 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2b8f8ef7e7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722548776
+ git checkout -b scalability-no-8-32768-1-1722548776
Switched to a new branch 'scalability-no-8-32768-1-1722548776'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722548776 4449b16a94] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:46:43 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:46:43 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-1-1722548776 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-1
+ env
++ date
+ echo Thu Aug 1 11:47:58 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu Aug 1 11:47:58 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4449b16a94 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722548878
+ git checkout -b scalability-no-512-32768-1-1722548878
Switched to a new branch 'scalability-no-512-32768-1-1722548878'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722548878 40d7b555b5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:48:26 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:48:26 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-1-1722548878 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-1
+ env
++ date
+ echo Thu Aug 1 11:49:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu Aug 1 11:49:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 40d7b555b5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722548980
+ git checkout -b scalability-no-128-32768-1-1722548980
Switched to a new branch 'scalability-no-128-32768-1-1722548980'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722548980 b9be47b588] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:50:08 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:50:08 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-1-1722548980 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-1
+ env
++ date
+ echo Thu Aug 1 11:51:23 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu Aug 1 11:51:23 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b9be47b588 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722549083
+ git checkout -b scalability-yes-32-32768-1-1722549083
Switched to a new branch 'scalability-yes-32-32768-1-1722549083'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722549083 ee8343467d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722549083 469cacca0e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:51:51 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:51:51 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-1-1722549083 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-1
+ env
++ date
+ echo Thu Aug 1 11:53:39 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu Aug 1 11:53:39 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 469cacca0e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722549220
+ git checkout -b scalability-yes-0-32768-1-1722549220
Switched to a new branch 'scalability-yes-0-32768-1-1722549220'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722549220 a6e0ac5bba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:54:07 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:54:07 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-1-1722549220 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-1
+ env
++ date
+ echo Thu Aug 1 11:55:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu Aug 1 11:55:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a6e0ac5bba NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722549357
+ git checkout -b scalability-yes-1-32768-1-1722549357
Switched to a new branch 'scalability-yes-1-32768-1-1722549357'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722549357 e7bdb72ae1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722549357 860ac9ec74] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:56:25 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:56:25 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-1-1722549357 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-1
+ env
++ date
+ echo Thu Aug 1 11:58:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu Aug 1 11:58:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 860ac9ec74 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722549494
+ git checkout -b scalability-yes-1024-32768-1-1722549494
Switched to a new branch 'scalability-yes-1024-32768-1-1722549494'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722549494 f748ace907] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722549494 2dc87d4166] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Thu Aug 1 11:58:42 PM CEST 2024 'RUN   files: 32768  partitions: 1'
Thu Aug 1 11:58:42 PM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-1-1722549494 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-1
+ env
++ date
+ echo Fri Aug 2 12:00:30 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Fri Aug 2 12:00:30 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2dc87d4166 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722549630
+ git checkout -b scalability-yes-8-32768-1-1722549630
Switched to a new branch 'scalability-yes-8-32768-1-1722549630'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722549630 420b3a9da7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722549630 224e965067] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:00:58 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:00:58 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-1-1722549630 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-1
+ env
++ date
+ echo Fri Aug 2 12:02:48 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Fri Aug 2 12:02:48 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 224e965067 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722549768
+ git checkout -b scalability-yes-512-32768-1-1722549768
Switched to a new branch 'scalability-yes-512-32768-1-1722549768'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722549768 1da9892c15] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722549768 2d2d8524c9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:03:16 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:03:16 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-1-1722549768 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-1
+ env
++ date
+ echo Fri Aug 2 12:05:06 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Fri Aug 2 12:05:06 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2d2d8524c9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722549906
+ git checkout -b scalability-yes-128-32768-1-1722549906
Switched to a new branch 'scalability-yes-128-32768-1-1722549906'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722549906 5e89022d43] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722549906 8653cb820b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:05:34 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:05:34 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-1-1722549906 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-1
+ env
++ date
+ echo Fri Aug 2 12:07:24 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Fri Aug 2 12:07:24 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8653cb820b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722550044
+ git checkout -b scalability-no-32-32768-1-1722550044
Switched to a new branch 'scalability-no-32-32768-1-1722550044'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722550044 6d9159125c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:07:52 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:07:52 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-1-1722550044 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-1
+ env
++ date
+ echo Fri Aug 2 12:09:42 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Fri Aug 2 12:09:42 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6d9159125c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722550182
+ git checkout -b scalability-no-0-32768-1-1722550182
Switched to a new branch 'scalability-no-0-32768-1-1722550182'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:10:10 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:10:10 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-1-1722550182 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-1
+ env
++ date
+ echo Fri Aug 2 12:11:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Fri Aug 2 12:11:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722550319
+ git checkout -b scalability-no-1-32768-1-1722550319
Switched to a new branch 'scalability-no-1-32768-1-1722550319'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722550319 4d1d87451f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:12:27 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:12:27 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-1-1722550319 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-1
+ env
++ date
+ echo Fri Aug 2 12:14:17 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Fri Aug 2 12:14:17 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4d1d87451f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722550457
+ git checkout -b scalability-no-1024-32768-1-1722550457
Switched to a new branch 'scalability-no-1024-32768-1-1722550457'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722550457 83712f92f9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:14:45 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:14:45 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-1-1722550457 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-1
+ env
++ date
+ echo Fri Aug 2 12:16:34 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Fri Aug 2 12:16:34 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 83712f92f9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722550594
+ git checkout -b scalability-no-8-32768-1-1722550594
Switched to a new branch 'scalability-no-8-32768-1-1722550594'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722550594 36b02caff3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:17:02 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:17:02 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-1-1722550594 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-1
+ env
++ date
+ echo Fri Aug 2 12:18:52 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Fri Aug 2 12:18:52 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 36b02caff3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722550732
+ git checkout -b scalability-no-512-32768-1-1722550732
Switched to a new branch 'scalability-no-512-32768-1-1722550732'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722550732 5a6169a63e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:19:20 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:19:20 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-1-1722550732 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-1
+ env
++ date
+ echo Fri Aug 2 12:21:09 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Fri Aug 2 12:21:09 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5a6169a63e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722550869
+ git checkout -b scalability-no-128-32768-1-1722550869
Switched to a new branch 'scalability-no-128-32768-1-1722550869'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722550869 2072ea8a95] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:21:37 AM CEST 2024 'RUN   files: 32768  partitions: 1'
Fri Aug 2 12:21:37 AM CEST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-1-1722550869 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-1 1 10 '1 16 32' 1
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-32-32768-0
+ env
++ date
+ echo Fri Aug 2 12:23:27 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Fri Aug 2 12:23:27 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2072ea8a95 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722551007
+ git checkout -b scalability-yes-32-32768-0-1722551007
Switched to a new branch 'scalability-yes-32-32768-0-1722551007'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722551007 3a811b8e44] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722551007 e721e9dbd0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:24:15 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:24:15 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-0-1722551007 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-0-32768-0
+ env
++ date
+ echo Fri Aug 2 12:25:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Fri Aug 2 12:25:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e721e9dbd0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722551130
+ git checkout -b scalability-yes-0-32768-0-1722551130
Switched to a new branch 'scalability-yes-0-32768-0-1722551130'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722551130 813d25db6b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:26:17 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:26:17 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-0-1722551130 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1-32768-0
+ env
++ date
+ echo Fri Aug 2 12:27:31 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Fri Aug 2 12:27:31 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 813d25db6b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722551252
+ git checkout -b scalability-yes-1-32768-0-1722551252
Switched to a new branch 'scalability-yes-1-32768-0-1722551252'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722551252 ff89176dae] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722551252 0285164221] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:28:20 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:28:20 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-0-1722551252 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 12:29:35 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Fri Aug 2 12:29:35 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0285164221 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722551375
+ git checkout -b scalability-yes-1024-32768-0-1722551375
Switched to a new branch 'scalability-yes-1024-32768-0-1722551375'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722551375 9254d1630e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722551375 49dd15e1ad] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:30:23 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:30:23 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-0-1722551375 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-8-32768-0
+ env
++ date
+ echo Fri Aug 2 12:31:38 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Fri Aug 2 12:31:38 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 49dd15e1ad fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722551498
+ git checkout -b scalability-yes-8-32768-0-1722551498
Switched to a new branch 'scalability-yes-8-32768-0-1722551498'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722551498 b08604911e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722551498 ac8ab15c4e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:32:27 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:32:27 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-0-1722551498 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-512-32768-0
+ env
++ date
+ echo Fri Aug 2 12:33:41 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Fri Aug 2 12:33:41 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ac8ab15c4e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722551621
+ git checkout -b scalability-yes-512-32768-0-1722551621
Switched to a new branch 'scalability-yes-512-32768-0-1722551621'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722551621 74629b780d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722551621 0189e27597] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:34:29 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:34:29 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-0-1722551621 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-yes-128-32768-0
+ env
++ date
+ echo Fri Aug 2 12:35:44 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Fri Aug 2 12:35:44 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0189e27597 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722551744
+ git checkout -b scalability-yes-128-32768-0-1722551744
Switched to a new branch 'scalability-yes-128-32768-0-1722551744'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722551744 af23d518a7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722551744 c7811a893d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:36:32 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:36:32 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-0-1722551744 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-32-32768-0
+ env
++ date
+ echo Fri Aug 2 12:37:47 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Fri Aug 2 12:37:47 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c7811a893d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722551867
+ git checkout -b scalability-no-32-32768-0-1722551867
Switched to a new branch 'scalability-no-32-32768-0-1722551867'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722551867 5b26b2b01b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:38:35 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:38:35 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-0-1722551867 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-0-32768-0
+ env
++ date
+ echo Fri Aug 2 12:39:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Fri Aug 2 12:39:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5b26b2b01b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722551990
+ git checkout -b scalability-no-0-32768-0-1722551990
Switched to a new branch 'scalability-no-0-32768-0-1722551990'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:40:38 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:40:38 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-0-1722551990 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1-32768-0
+ env
++ date
+ echo Fri Aug 2 12:41:53 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Fri Aug 2 12:41:53 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722552113
+ git checkout -b scalability-no-1-32768-0-1722552113
Switched to a new branch 'scalability-no-1-32768-0-1722552113'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722552113 d015d6cf7e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:42:41 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:42:41 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-0-1722552113 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 12:43:55 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Fri Aug 2 12:43:55 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d015d6cf7e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722552236
+ git checkout -b scalability-no-1024-32768-0-1722552236
Switched to a new branch 'scalability-no-1024-32768-0-1722552236'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722552236 a5886ec88f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:44:43 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:44:43 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-0-1722552236 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-8-32768-0
+ env
++ date
+ echo Fri Aug 2 12:45:58 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Fri Aug 2 12:45:58 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a5886ec88f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722552358
+ git checkout -b scalability-no-8-32768-0-1722552358
Switched to a new branch 'scalability-no-8-32768-0-1722552358'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722552358 0c66d35a37] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:46:46 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:46:46 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-0-1722552358 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-512-32768-0
+ env
++ date
+ echo Fri Aug 2 12:48:00 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Fri Aug 2 12:48:00 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0c66d35a37 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722552481
+ git checkout -b scalability-no-512-32768-0-1722552481
Switched to a new branch 'scalability-no-512-32768-0-1722552481'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722552481 47c9aa355e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:48:49 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:48:49 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-0-1722552481 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/index-no-128-32768-0
+ env
++ date
+ echo Fri Aug 2 12:50:03 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Fri Aug 2 12:50:03 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 47c9aa355e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722552604
+ git checkout -b scalability-no-128-32768-0-1722552604
Switched to a new branch 'scalability-no-128-32768-0-1722552604'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722552604 4760822e10] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:50:52 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:50:52 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-0-1722552604 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/index-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-32-32768-0
+ env
++ date
+ echo Fri Aug 2 12:52:06 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Fri Aug 2 12:52:06 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4760822e10 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722552726
+ git checkout -b scalability-yes-32-32768-0-1722552726
Switched to a new branch 'scalability-yes-32-32768-0-1722552726'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722552726 9610dd0beb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722552726 e754d87ec8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:52:34 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:52:34 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-0-1722552726 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-0-32768-0
+ env
++ date
+ echo Fri Aug 2 12:53:53 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Fri Aug 2 12:53:53 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e754d87ec8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722552833
+ git checkout -b scalability-yes-0-32768-0-1722552833
Switched to a new branch 'scalability-yes-0-32768-0-1722552833'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722552833 6f8bd81750] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:54:20 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:54:20 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-0-1722552833 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1-32768-0
+ env
++ date
+ echo Fri Aug 2 12:55:39 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Fri Aug 2 12:55:39 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6f8bd81750 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722552939
+ git checkout -b scalability-yes-1-32768-0-1722552939
Switched to a new branch 'scalability-yes-1-32768-0-1722552939'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722552939 d6525fa724] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722552939 6838b519b8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:56:07 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:56:07 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-0-1722552939 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 12:57:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Fri Aug 2 12:57:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6838b519b8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722553045
+ git checkout -b scalability-yes-1024-32768-0-1722553045
Switched to a new branch 'scalability-yes-1024-32768-0-1722553045'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722553045 d48354936a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722553045 889a3794fb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:57:53 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:57:53 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-0-1722553045 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-8-32768-0
+ env
++ date
+ echo Fri Aug 2 12:59:12 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Fri Aug 2 12:59:12 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 889a3794fb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722553152
+ git checkout -b scalability-yes-8-32768-0-1722553152
Switched to a new branch 'scalability-yes-8-32768-0-1722553152'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722553152 51c80c4950] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722553152 3b8ec67710] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 12:59:40 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 12:59:40 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-0-1722553152 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-512-32768-0
+ env
++ date
+ echo Fri Aug 2 01:00:59 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Fri Aug 2 01:00:59 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3b8ec67710 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722553259
+ git checkout -b scalability-yes-512-32768-0-1722553259
Switched to a new branch 'scalability-yes-512-32768-0-1722553259'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722553259 8870eb3be3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722553259 8d18f5c86d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:01:27 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:01:27 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-0-1722553259 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-yes-128-32768-0
+ env
++ date
+ echo Fri Aug 2 01:02:45 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Fri Aug 2 01:02:45 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8d18f5c86d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722553365
+ git checkout -b scalability-yes-128-32768-0-1722553365
Switched to a new branch 'scalability-yes-128-32768-0-1722553365'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722553365 c6ae5257a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722553365 daa2340272] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:03:13 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:03:13 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-0-1722553365 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-32-32768-0
+ env
++ date
+ echo Fri Aug 2 01:04:32 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Fri Aug 2 01:04:32 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at daa2340272 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722553472
+ git checkout -b scalability-no-32-32768-0-1722553472
Switched to a new branch 'scalability-no-32-32768-0-1722553472'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722553472 416dc5debf] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:05:00 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:05:00 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-0-1722553472 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-0-32768-0
+ env
++ date
+ echo Fri Aug 2 01:06:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Fri Aug 2 01:06:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 416dc5debf fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722553578
+ git checkout -b scalability-no-0-32768-0-1722553578
Switched to a new branch 'scalability-no-0-32768-0-1722553578'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:06:46 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:06:46 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-0-1722553578 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1-32768-0
+ env
++ date
+ echo Fri Aug 2 01:08:05 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Fri Aug 2 01:08:05 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722553685
+ git checkout -b scalability-no-1-32768-0-1722553685
Switched to a new branch 'scalability-no-1-32768-0-1722553685'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722553685 72aff81974] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:08:32 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:08:32 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-0-1722553685 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 01:09:51 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Fri Aug 2 01:09:51 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 72aff81974 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722553791
+ git checkout -b scalability-no-1024-32768-0-1722553791
Switched to a new branch 'scalability-no-1024-32768-0-1722553791'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722553791 d2de3f2002] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:10:19 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:10:19 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-0-1722553791 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-8-32768-0
+ env
++ date
+ echo Fri Aug 2 01:11:38 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Fri Aug 2 01:11:38 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d2de3f2002 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722553898
+ git checkout -b scalability-no-8-32768-0-1722553898
Switched to a new branch 'scalability-no-8-32768-0-1722553898'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722553898 617c505873] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:12:05 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:12:05 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-0-1722553898 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-512-32768-0
+ env
++ date
+ echo Fri Aug 2 01:13:24 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Fri Aug 2 01:13:24 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 617c505873 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722554004
+ git checkout -b scalability-no-512-32768-0-1722554004
Switched to a new branch 'scalability-no-512-32768-0-1722554004'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722554004 736146abbf] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:13:52 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:13:52 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-0-1722554004 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/join-no-128-32768-0
+ env
++ date
+ echo Fri Aug 2 01:15:11 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Fri Aug 2 01:15:11 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 736146abbf fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722554111
+ git checkout -b scalability-no-128-32768-0-1722554111
Switched to a new branch 'scalability-no-128-32768-0-1722554111'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/128/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722554111 baed2a0245] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:15:39 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:15:39 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-0-1722554111 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/join-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-32-32768-0
+ env
++ date
+ echo Fri Aug 2 01:16:57 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Fri Aug 2 01:16:57 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at baed2a0245 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722554218
+ git checkout -b scalability-yes-32-32768-0-1722554218
Switched to a new branch 'scalability-yes-32-32768-0-1722554218'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722554218 4f325624eb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722554218 5a300f51eb] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:17:25 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:17:25 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-0-1722554218 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-0-32768-0
+ env
++ date
+ echo Fri Aug 2 01:18:39 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Fri Aug 2 01:18:39 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5a300f51eb fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722554319
+ git checkout -b scalability-yes-0-32768-0-1722554319
Switched to a new branch 'scalability-yes-0-32768-0-1722554319'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722554319 219f8c31cb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:19:06 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:19:06 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-0-1722554319 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1-32768-0
+ env
++ date
+ echo Fri Aug 2 01:20:20 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Fri Aug 2 01:20:20 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 219f8c31cb NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722554420
+ git checkout -b scalability-yes-1-32768-0-1722554420
Switched to a new branch 'scalability-yes-1-32768-0-1722554420'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722554420 3c4f797250] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722554420 6391ec1840] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:20:48 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:20:48 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-0-1722554420 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 01:22:02 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Fri Aug 2 01:22:02 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6391ec1840 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722554522
+ git checkout -b scalability-yes-1024-32768-0-1722554522
Switched to a new branch 'scalability-yes-1024-32768-0-1722554522'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722554522 94ddc0fe4d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722554522 b9b76744c8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:22:30 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:22:30 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-0-1722554522 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-8-32768-0
+ env
++ date
+ echo Fri Aug 2 01:23:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Fri Aug 2 01:23:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b9b76744c8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722554624
+ git checkout -b scalability-yes-8-32768-0-1722554624
Switched to a new branch 'scalability-yes-8-32768-0-1722554624'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722554624 a7d3bb8153] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722554624 53301f4e70] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:24:11 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:24:11 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-0-1722554624 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-512-32768-0
+ env
++ date
+ echo Fri Aug 2 01:25:25 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Fri Aug 2 01:25:25 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 53301f4e70 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722554725
+ git checkout -b scalability-yes-512-32768-0-1722554725
Switched to a new branch 'scalability-yes-512-32768-0-1722554725'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722554725 484fe5df29] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722554725 086feef017] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:25:53 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:25:53 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-0-1722554725 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-yes-128-32768-0
+ env
++ date
+ echo Fri Aug 2 01:27:07 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Fri Aug 2 01:27:07 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 086feef017 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722554827
+ git checkout -b scalability-yes-128-32768-0-1722554827
Switched to a new branch 'scalability-yes-128-32768-0-1722554827'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722554827 a24fd98893] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722554827 746ed31402] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:27:35 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:27:35 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-0-1722554827 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-32-32768-0
+ env
++ date
+ echo Fri Aug 2 01:28:48 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Fri Aug 2 01:28:48 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 746ed31402 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722554929
+ git checkout -b scalability-no-32-32768-0-1722554929
Switched to a new branch 'scalability-no-32-32768-0-1722554929'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722554929 9ad7841c14] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:29:17 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:29:17 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-0-1722554929 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-0-32768-0
+ env
++ date
+ echo Fri Aug 2 01:30:30 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Fri Aug 2 01:30:30 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9ad7841c14 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722555030
+ git checkout -b scalability-no-0-32768-0-1722555030
Switched to a new branch 'scalability-no-0-32768-0-1722555030'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:30:58 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:30:58 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-0-1722555030 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1-32768-0
+ env
++ date
+ echo Fri Aug 2 01:32:12 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Fri Aug 2 01:32:12 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722555132
+ git checkout -b scalability-no-1-32768-0-1722555132
Switched to a new branch 'scalability-no-1-32768-0-1722555132'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722555132 11cf1518bc] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:32:40 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:32:40 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-0-1722555132 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 01:33:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Fri Aug 2 01:33:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 11cf1518bc fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722555234
+ git checkout -b scalability-no-1024-32768-0-1722555234
Switched to a new branch 'scalability-no-1024-32768-0-1722555234'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722555234 dbe7fa3158] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:34:22 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:34:22 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-0-1722555234 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-8-32768-0
+ env
++ date
+ echo Fri Aug 2 01:35:35 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Fri Aug 2 01:35:35 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dbe7fa3158 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722555336
+ git checkout -b scalability-no-8-32768-0-1722555336
Switched to a new branch 'scalability-no-8-32768-0-1722555336'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722555336 a509602769] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:36:03 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:36:03 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-0-1722555336 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-512-32768-0
+ env
++ date
+ echo Fri Aug 2 01:37:17 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Fri Aug 2 01:37:17 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a509602769 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722555437
+ git checkout -b scalability-no-512-32768-0-1722555437
Switched to a new branch 'scalability-no-512-32768-0-1722555437'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722555437 5ea39e7f17] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:37:45 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:37:45 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-0-1722555437 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/count-no-128-32768-0
+ env
++ date
+ echo Fri Aug 2 01:38:59 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Fri Aug 2 01:38:59 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5ea39e7f17 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722555539
+ git checkout -b scalability-no-128-32768-0-1722555539
Switched to a new branch 'scalability-no-128-32768-0-1722555539'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722555539 200964e68d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:39:26 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:39:26 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-0-1722555539 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/count-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-32-32768-0
+ env
++ date
+ echo Fri Aug 2 01:40:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Fri Aug 2 01:40:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 200964e68d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722555640
+ git checkout -b scalability-yes-32-32768-0-1722555640
Switched to a new branch 'scalability-yes-32-32768-0-1722555640'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722555640 671d810019] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722555640 c188bd6770] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:41:08 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:41:08 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-0-1722555640 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-0-32768-0
+ env
++ date
+ echo Fri Aug 2 01:42:22 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Fri Aug 2 01:42:22 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c188bd6770 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722555742
+ git checkout -b scalability-yes-0-32768-0-1722555742
Switched to a new branch 'scalability-yes-0-32768-0-1722555742'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722555742 3ae0696541] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:42:50 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:42:50 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-0-1722555742 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1-32768-0
+ env
++ date
+ echo Fri Aug 2 01:44:05 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Fri Aug 2 01:44:05 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3ae0696541 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722555845
+ git checkout -b scalability-yes-1-32768-0-1722555845
Switched to a new branch 'scalability-yes-1-32768-0-1722555845'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722555845 19279448fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722555845 b49aee135f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:44:33 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:44:33 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-0-1722555845 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 01:45:47 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Fri Aug 2 01:45:47 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b49aee135f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722555947
+ git checkout -b scalability-yes-1024-32768-0-1722555947
Switched to a new branch 'scalability-yes-1024-32768-0-1722555947'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722555947 ae580e2e7c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722555947 3725759002] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:46:15 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:46:15 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-0-1722555947 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-8-32768-0
+ env
++ date
+ echo Fri Aug 2 01:47:29 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Fri Aug 2 01:47:29 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3725759002 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722556049
+ git checkout -b scalability-yes-8-32768-0-1722556049
Switched to a new branch 'scalability-yes-8-32768-0-1722556049'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722556049 092f530e08] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722556049 0d7c268910] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:47:57 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:47:57 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-0-1722556049 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-512-32768-0
+ env
++ date
+ echo Fri Aug 2 01:49:12 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Fri Aug 2 01:49:12 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0d7c268910 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722556152
+ git checkout -b scalability-yes-512-32768-0-1722556152
Switched to a new branch 'scalability-yes-512-32768-0-1722556152'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722556152 06d94550b7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722556152 94e108e7f0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:49:40 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:49:40 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-0-1722556152 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-yes-128-32768-0
+ env
++ date
+ echo Fri Aug 2 01:50:54 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Fri Aug 2 01:50:54 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 94e108e7f0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722556254
+ git checkout -b scalability-yes-128-32768-0-1722556254
Switched to a new branch 'scalability-yes-128-32768-0-1722556254'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722556254 45922532ce] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722556254 84790654a9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:51:22 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:51:22 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-0-1722556254 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-32-32768-0
+ env
++ date
+ echo Fri Aug 2 01:52:36 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Fri Aug 2 01:52:36 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 84790654a9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722556356
+ git checkout -b scalability-no-32-32768-0-1722556356
Switched to a new branch 'scalability-no-32-32768-0-1722556356'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722556356 2230c0b91c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:53:05 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:53:05 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-0-1722556356 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-0-32768-0
+ env
++ date
+ echo Fri Aug 2 01:54:19 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Fri Aug 2 01:54:19 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2230c0b91c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722556459
+ git checkout -b scalability-no-0-32768-0-1722556459
Switched to a new branch 'scalability-no-0-32768-0-1722556459'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:54:47 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:54:47 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-0-1722556459 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1-32768-0
+ env
++ date
+ echo Fri Aug 2 01:56:01 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Fri Aug 2 01:56:01 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722556561
+ git checkout -b scalability-no-1-32768-0-1722556561
Switched to a new branch 'scalability-no-1-32768-0-1722556561'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722556561 5db0446231] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:56:29 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:56:29 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-0-1722556561 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 01:57:43 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Fri Aug 2 01:57:43 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5db0446231 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722556664
+ git checkout -b scalability-no-1024-32768-0-1722556664
Switched to a new branch 'scalability-no-1024-32768-0-1722556664'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722556664 00c1256679] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:58:11 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:58:11 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-0-1722556664 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-8-32768-0
+ env
++ date
+ echo Fri Aug 2 01:59:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Fri Aug 2 01:59:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 00c1256679 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722556766
+ git checkout -b scalability-no-8-32768-0-1722556766
Switched to a new branch 'scalability-no-8-32768-0-1722556766'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722556766 3e6a0d7cc4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 01:59:53 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 01:59:53 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-0-1722556766 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-512-32768-0
+ env
++ date
+ echo Fri Aug 2 02:01:08 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Fri Aug 2 02:01:08 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3e6a0d7cc4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722556868
+ git checkout -b scalability-no-512-32768-0-1722556868
Switched to a new branch 'scalability-no-512-32768-0-1722556868'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722556868 ddc9b22d12] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:01:36 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:01:36 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-0-1722556868 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/pgbench-no-128-32768-0
+ env
++ date
+ echo Fri Aug 2 02:02:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Fri Aug 2 02:02:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ddc9b22d12 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722556971
+ git checkout -b scalability-no-128-32768-0-1722556971
Switched to a new branch 'scalability-no-128-32768-0-1722556971'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722556971 74a1b7d9fc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:03:18 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:03:18 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-0-1722556971 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/pgbench-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-32-32768-0
+ env
++ date
+ echo Fri Aug 2 02:04:33 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Fri Aug 2 02:04:33 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 74a1b7d9fc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722557073
+ git checkout -b scalability-yes-32-32768-0-1722557073
Switched to a new branch 'scalability-yes-32-32768-0-1722557073'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722557073 ad16274d5a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722557073 f31dc6731b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:05:01 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:05:01 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-0-1722557073 32768 yes 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-0-32768-0
+ env
++ date
+ echo Fri Aug 2 02:05:04 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Fri Aug 2 02:05:04 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f31dc6731b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722557105
+ git checkout -b scalability-yes-0-32768-0-1722557105
Switched to a new branch 'scalability-yes-0-32768-0-1722557105'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722557105 41b5b8ed0d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:05:33 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:05:33 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-0-1722557105 32768 yes 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1-32768-0
+ env
++ date
+ echo Fri Aug 2 02:05:36 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Fri Aug 2 02:05:36 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 41b5b8ed0d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722557136
+ git checkout -b scalability-yes-1-32768-0-1722557136
Switched to a new branch 'scalability-yes-1-32768-0-1722557136'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722557136 8179b82ed4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722557136 601a3ad1d2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:06:05 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:06:05 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-0-1722557136 32768 yes 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 02:06:08 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Fri Aug 2 02:06:08 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 601a3ad1d2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722557168
+ git checkout -b scalability-yes-1024-32768-0-1722557168
Switched to a new branch 'scalability-yes-1024-32768-0-1722557168'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722557168 f5d2babe39] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722557168 3d8353f051] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:06:37 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:06:37 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-0-1722557168 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-8-32768-0
+ env
++ date
+ echo Fri Aug 2 02:06:40 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Fri Aug 2 02:06:40 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3d8353f051 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722557200
+ git checkout -b scalability-yes-8-32768-0-1722557200
Switched to a new branch 'scalability-yes-8-32768-0-1722557200'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722557200 2523e60784] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722557200 ddab94b232] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:07:09 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:07:09 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-0-1722557200 32768 yes 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-512-32768-0
+ env
++ date
+ echo Fri Aug 2 02:07:12 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Fri Aug 2 02:07:12 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ddab94b232 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722557232
+ git checkout -b scalability-yes-512-32768-0-1722557232
Switched to a new branch 'scalability-yes-512-32768-0-1722557232'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722557232 7b9636356b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722557232 dec44c5cc3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:07:40 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:07:40 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-0-1722557232 32768 yes 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-yes-128-32768-0
+ env
++ date
+ echo Fri Aug 2 02:07:43 AM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Fri Aug 2 02:07:43 AM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at dec44c5cc3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722557264
+ git checkout -b scalability-yes-128-32768-0-1722557264
Switched to a new branch 'scalability-yes-128-32768-0-1722557264'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722557264 6a3a811b8f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722557264 1cbc427742] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:08:12 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:08:12 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-0-1722557264 32768 yes 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-yes-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-32-32768-0
+ env
++ date
+ echo Fri Aug 2 02:08:15 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Fri Aug 2 02:08:15 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1cbc427742 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722557295
+ git checkout -b scalability-no-32-32768-0-1722557295
Switched to a new branch 'scalability-no-32-32768-0-1722557295'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722557295 a3a6aada1b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:08:44 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:08:44 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-0-1722557295 32768 no 32 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-32-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-0-32768-0
+ env
++ date
+ echo Fri Aug 2 02:08:47 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Fri Aug 2 02:08:47 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a3a6aada1b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722557327
+ git checkout -b scalability-no-0-32768-0-1722557327
Switched to a new branch 'scalability-no-0-32768-0-1722557327'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:09:15 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:09:15 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-0-1722557327 32768 no 0 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-0-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1-32768-0
+ env
++ date
+ echo Fri Aug 2 02:09:18 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Fri Aug 2 02:09:18 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722557359
+ git checkout -b scalability-no-1-32768-0-1722557359
Switched to a new branch 'scalability-no-1-32768-0-1722557359'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722557359 684edb43e5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:09:47 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:09:47 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-0-1722557359 32768 no 1 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-1024-32768-0
+ env
++ date
+ echo Fri Aug 2 02:09:50 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Fri Aug 2 02:09:50 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 684edb43e5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722557390
+ git checkout -b scalability-no-1024-32768-0-1722557390
Switched to a new branch 'scalability-no-1024-32768-0-1722557390'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722557390 4a3a99be1e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:10:19 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:10:19 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-0-1722557390 32768 no 1024 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-1024-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-8-32768-0
+ env
++ date
+ echo Fri Aug 2 02:10:22 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Fri Aug 2 02:10:22 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4a3a99be1e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722557422
+ git checkout -b scalability-no-8-32768-0-1722557422
Switched to a new branch 'scalability-no-8-32768-0-1722557422'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722557422 da9bc577aa] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:10:50 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:10:50 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-0-1722557422 32768 no 8 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-8-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-512-32768-0
+ env
++ date
+ echo Fri Aug 2 02:10:54 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Fri Aug 2 02:10:54 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at da9bc577aa fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722557454
+ git checkout -b scalability-no-512-32768-0-1722557454
Switched to a new branch 'scalability-no-512-32768-0-1722557454'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722557454 2853f0d610] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:11:23 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:11:23 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-0-1722557454 32768 no 512 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-512-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-0
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-0
+ mkdir -p /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/results/star-no-128-32768-0
+ env
++ date
+ echo Fri Aug 2 02:11:26 AM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Fri Aug 2 02:11:26 AM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2853f0d610 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722557486
+ git checkout -b scalability-no-128-32768-0-1722557486
Switched to a new branch 'scalability-no-128-32768-0-1722557486'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722557486 f69ac5b5f4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Fri Aug 2 02:11:54 AM CEST 2024 'RUN   files: 32768  partitions: 0'
Fri Aug 2 02:11:54 AM CEST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-0-1722557486 32768 no 128 /home/tomas/lock-scalability-test/20240731-2049-glibc-tuned/logs/star-no-128-32768-0 1 10 '1 16 32' 0
+ pg_ctl -D /mnt/pgdata/data-test stop
