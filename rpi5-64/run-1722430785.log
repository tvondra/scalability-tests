+ set -e
+ LABEL=glibc-tuned
+ MACHINE=rpi5-64
+ DBNAME=test
+ RUNS=1
+ DURATION=10
+ CLIENTS='1 4 8'
+ PARTITIONS='1000 100 10 1 0'
+ BUILDS=/mnt/data/builds
+ SOURCE=/mnt/data/postgres
+ PATH_OLD=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
++ date +%Y%m%d-%H%M
+ DATE=20240731-1359
++ pwd
+ PATCHES=/mnt/data/lock-scalability-test/patches
++ pwd
+ LOGS=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs
++ pwd
+ RESULTS=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results
+ DATADIR=/mnt/data/data-test
+ ulimit -n 35000
+ export MALLOC_TOP_PAD_=67108864
+ MALLOC_TOP_PAD_=67108864
+ export MALLOC_MMAP_THRESHOLD_=1048576
+ MALLOC_MMAP_THRESHOLD_=1048576
+ export MALLOC_TRIM_THRESHOLD_=1048576
+ MALLOC_TRIM_THRESHOLD_=1048576
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 13:59:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 13:59:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e8c0c87788 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722430785
+ git checkout -b scalability-yes-32-1000-1000-1722430785
Switched to a new branch 'scalability-yes-32-1000-1000-1722430785'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722430785 1d65501bd9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722430785 b0705b9c48] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:00:37 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:00:37 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-1000-1722430785 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:02:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 14:02:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b0705b9c48 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722430926
+ git checkout -b scalability-yes-0-1000-1000-1722430926
Switched to a new branch 'scalability-yes-0-1000-1000-1722430926'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722430926 3d37435a94] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:02:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:02:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-1000-1722430926 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:04:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 14:04:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3d37435a94 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722431065
+ git checkout -b scalability-yes-1-1000-1000-1722431065
Switched to a new branch 'scalability-yes-1-1000-1000-1722431065'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722431065 d7beb09c39] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722431065 7cf5a94a3b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:05:16 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:05:16 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-1000-1722431065 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:06:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 14:06:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7cf5a94a3b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722431204
+ git checkout -b scalability-yes-1024-1000-1000-1722431204
Switched to a new branch 'scalability-yes-1024-1000-1000-1722431204'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722431204 4bfa6820f9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722431204 81de796437] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:07:36 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:07:36 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-1000-1722431204 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:09:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 14:09:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 81de796437 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722431344
+ git checkout -b scalability-yes-8-1000-1000-1722431344
Switched to a new branch 'scalability-yes-8-1000-1000-1722431344'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722431344 2ed781d082] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722431344 8aabd99034] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:09:56 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:09:56 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-1000-1722431344 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:11:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 14:11:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8aabd99034 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722431485
+ git checkout -b scalability-yes-512-1000-1000-1722431485
Switched to a new branch 'scalability-yes-512-1000-1000-1722431485'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722431485 529296cf41] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722431485 48118a642e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:12:16 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:12:16 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-1000-1722431485 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:13:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 14:13:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 48118a642e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722431624
+ git checkout -b scalability-yes-128-1000-1000-1722431624
Switched to a new branch 'scalability-yes-128-1000-1000-1722431624'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722431624 65854e1a9b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722431624 b6ab9ab784] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:14:37 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:14:37 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-1000-1722431624 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:16:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 14:16:05 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b6ab9ab784 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722431765
+ git checkout -b scalability-no-32-1000-1000-1722431765
Switched to a new branch 'scalability-no-32-1000-1000-1722431765'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722431765 2b7df9fd60] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:16:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:16:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-1000-1722431765 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:18:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 14:18:25 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2b7df9fd60 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722431905
+ git checkout -b scalability-no-0-1000-1000-1722431905
Switched to a new branch 'scalability-no-0-1000-1000-1722431905'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:19:17 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:19:17 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-1000-1722431905 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:20:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 14:20:44 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722432044
+ git checkout -b scalability-no-1-1000-1000-1722432044
Switched to a new branch 'scalability-no-1-1000-1000-1722432044'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722432044 55c75b4c33] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:21:36 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:21:36 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-1000-1722432044 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:23:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 14:23:05 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 55c75b4c33 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722432185
+ git checkout -b scalability-no-1024-1000-1000-1722432185
Switched to a new branch 'scalability-no-1024-1000-1000-1722432185'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722432185 e705efbf4f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:23:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:23:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-1000-1722432185 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:25:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 14:25:25 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e705efbf4f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722432325
+ git checkout -b scalability-no-8-1000-1000-1722432325
Switched to a new branch 'scalability-no-8-1000-1000-1722432325'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722432325 08d8377e0c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:26:17 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:26:17 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-1000-1722432325 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:27:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 14:27:44 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 08d8377e0c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722432464
+ git checkout -b scalability-no-512-1000-1000-1722432464
Switched to a new branch 'scalability-no-512-1000-1000-1722432464'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722432464 8a30d8d892] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:28:36 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:28:36 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-1000-1722432464 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:30:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 14:30:04 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8a30d8d892 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722432604
+ git checkout -b scalability-no-128-1000-1000-1722432604
Switched to a new branch 'scalability-no-128-1000-1000-1722432604'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722432604 bb7c20bdda] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:30:56 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:30:56 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-1000-1722432604 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:32:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 14:32:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bb7c20bdda fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722432745
+ git checkout -b scalability-yes-32-1000-1000-1722432745
Switched to a new branch 'scalability-yes-32-1000-1000-1722432745'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722432745 c0072fe05a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722432745 fbc802bf8f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:32:53 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:32:53 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-1000-1722432745 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:34:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 14:34:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fbc802bf8f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722432875
+ git checkout -b scalability-yes-0-1000-1000-1722432875
Switched to a new branch 'scalability-yes-0-1000-1000-1722432875'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722432875 a378c78124] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:35:04 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:35:04 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-1000-1722432875 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:36:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 14:36:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a378c78124 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722433005
+ git checkout -b scalability-yes-1-1000-1000-1722433005
Switched to a new branch 'scalability-yes-1-1000-1000-1722433005'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722433005 8a0fb2af8c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722433005 5f6c44ebd8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:37:13 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:37:13 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-1000-1722433005 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:38:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 14:38:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5f6c44ebd8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722433133
+ git checkout -b scalability-yes-1024-1000-1000-1722433133
Switched to a new branch 'scalability-yes-1024-1000-1000-1722433133'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722433133 a3b882ea68] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722433133 ad96b665e8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:39:21 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:39:21 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-1000-1722433133 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:41:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 14:41:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ad96b665e8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722433266
+ git checkout -b scalability-yes-8-1000-1000-1722433266
Switched to a new branch 'scalability-yes-8-1000-1000-1722433266'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722433266 1014f7475c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722433266 74b8caa1ee] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:41:33 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:41:33 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-1000-1722433266 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:43:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 14:43:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 74b8caa1ee fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722433395
+ git checkout -b scalability-yes-512-1000-1000-1722433395
Switched to a new branch 'scalability-yes-512-1000-1000-1722433395'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722433395 3e4b879b25] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722433395 701b4d54f9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:43:42 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:43:42 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-1000-1722433395 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:45:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 14:45:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 701b4d54f9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722433526
+ git checkout -b scalability-yes-128-1000-1000-1722433526
Switched to a new branch 'scalability-yes-128-1000-1000-1722433526'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722433526 495f424d30] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722433526 2aeedff51a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:45:53 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:45:53 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-1000-1722433526 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:47:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 14:47:36 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2aeedff51a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722433656
+ git checkout -b scalability-no-32-1000-1000-1722433656
Switched to a new branch 'scalability-no-32-1000-1000-1722433656'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722433656 6e5f59fc88] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:48:03 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:48:03 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-1000-1722433656 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:49:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 14:49:45 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6e5f59fc88 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722433785
+ git checkout -b scalability-no-0-1000-1000-1722433785
Switched to a new branch 'scalability-no-0-1000-1000-1722433785'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:50:12 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:50:12 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-1000-1722433785 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:51:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 14:51:51 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722433911
+ git checkout -b scalability-no-1-1000-1000-1722433911
Switched to a new branch 'scalability-no-1-1000-1000-1722433911'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722433911 4257b8c711] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:52:18 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:52:18 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-1000-1722433911 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:53:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 14:53:59 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4257b8c711 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722434039
+ git checkout -b scalability-no-1024-1000-1000-1722434039
Switched to a new branch 'scalability-no-1024-1000-1000-1722434039'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722434039 857cef175f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:54:26 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:54:26 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-1000-1722434039 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:56:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 14:56:06 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 857cef175f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722434167
+ git checkout -b scalability-no-8-1000-1000-1722434167
Switched to a new branch 'scalability-no-8-1000-1000-1722434167'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722434167 015055c899] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:56:33 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:56:33 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-1000-1722434167 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 14:58:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 14:58:14 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 015055c899 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722434294
+ git checkout -b scalability-no-512-1000-1000-1722434294
Switched to a new branch 'scalability-no-512-1000-1000-1722434294'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722434294 376dcb7c61] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 14:58:42 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 14:58:42 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-1000-1722434294 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:00:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 15:00:24 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 376dcb7c61 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722434425
+ git checkout -b scalability-no-128-1000-1000-1722434425
Switched to a new branch 'scalability-no-128-1000-1000-1722434425'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722434425 eaef842a62] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:00:52 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:00:52 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-1000-1722434425 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:02:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 15:02:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eaef842a62 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722434557
+ git checkout -b scalability-yes-32-1000-1000-1722434557
Switched to a new branch 'scalability-yes-32-1000-1000-1722434557'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722434557 701acf5e3e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722434557 e6073cdeb5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:03:04 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:03:04 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-1000-1722434557 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:04:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 15:04:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e6073cdeb5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722434669
+ git checkout -b scalability-yes-0-1000-1000-1722434669
Switched to a new branch 'scalability-yes-0-1000-1000-1722434669'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722434669 48ddbf9f80] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:04:56 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:04:56 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-1000-1722434669 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:06:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 15:06:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 48ddbf9f80 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722434779
+ git checkout -b scalability-yes-1-1000-1000-1722434779
Switched to a new branch 'scalability-yes-1-1000-1000-1722434779'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722434779 6ef58bfcb2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722434779 a96f6bc867] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:06:47 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:06:47 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-1000-1722434779 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:08:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 15:08:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a96f6bc867 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722434891
+ git checkout -b scalability-yes-1024-1000-1000-1722434891
Switched to a new branch 'scalability-yes-1024-1000-1000-1722434891'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722434891 c272a0d906] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722434891 ff5c78204c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:08:38 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:08:38 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-1000-1722434891 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:10:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 15:10:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ff5c78204c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722435003
+ git checkout -b scalability-yes-8-1000-1000-1722435003
Switched to a new branch 'scalability-yes-8-1000-1000-1722435003'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722435003 a02440f03f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722435003 e498342f31] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:10:31 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:10:31 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-1000-1722435003 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:11:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 15:11:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e498342f31 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722435115
+ git checkout -b scalability-yes-512-1000-1000-1722435115
Switched to a new branch 'scalability-yes-512-1000-1000-1722435115'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722435115 417b5911db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722435115 5435f62b21] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:12:22 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:12:22 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-1000-1722435115 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:13:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 15:13:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5435f62b21 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722435227
+ git checkout -b scalability-yes-128-1000-1000-1722435227
Switched to a new branch 'scalability-yes-128-1000-1000-1722435227'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722435227 034b2312a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722435227 bdf9b4fe1e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:14:15 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:14:15 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-1000-1722435227 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:15:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 15:15:39 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bdf9b4fe1e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722435339
+ git checkout -b scalability-no-32-1000-1000-1722435339
Switched to a new branch 'scalability-no-32-1000-1000-1722435339'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722435339 a234b381c7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:16:06 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:16:06 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-1000-1722435339 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:17:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 15:17:30 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a234b381c7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722435450
+ git checkout -b scalability-no-0-1000-1000-1722435450
Switched to a new branch 'scalability-no-0-1000-1000-1722435450'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:17:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:17:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-1000-1722435450 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:19:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 15:19:23 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722435563
+ git checkout -b scalability-no-1-1000-1000-1722435563
Switched to a new branch 'scalability-no-1-1000-1000-1722435563'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722435563 8f24e4d2e1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:19:50 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:19:50 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-1000-1722435563 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:21:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 15:21:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8f24e4d2e1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722435676
+ git checkout -b scalability-no-1024-1000-1000-1722435676
Switched to a new branch 'scalability-no-1024-1000-1000-1722435676'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722435676 bbd26197bb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:21:43 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:21:43 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-1000-1722435676 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:23:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 15:23:08 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bbd26197bb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722435788
+ git checkout -b scalability-no-8-1000-1000-1722435788
Switched to a new branch 'scalability-no-8-1000-1000-1722435788'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722435788 d40885254b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:23:35 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:23:35 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-1000-1722435788 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:25:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 15:25:00 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d40885254b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722435900
+ git checkout -b scalability-no-512-1000-1000-1722435900
Switched to a new branch 'scalability-no-512-1000-1000-1722435900'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722435900 fb718fea27] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:25:27 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:25:27 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-1000-1722435900 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:26:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 15:26:53 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fb718fea27 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722436013
+ git checkout -b scalability-no-128-1000-1000-1722436013
Switched to a new branch 'scalability-no-128-1000-1000-1722436013'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722436013 6ae9540b36] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:27:20 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:27:20 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-1000-1722436013 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:28:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 15:28:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6ae9540b36 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722436125
+ git checkout -b scalability-yes-32-1000-1000-1722436125
Switched to a new branch 'scalability-yes-32-1000-1000-1722436125'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722436125 3e78ae4b17] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722436125 1a9f27f57f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:29:12 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:29:12 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-1000-1722436125 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:30:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 15:30:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1a9f27f57f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722436238
+ git checkout -b scalability-yes-0-1000-1000-1722436238
Switched to a new branch 'scalability-yes-0-1000-1000-1722436238'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722436238 021a5d21a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:31:05 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:31:05 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-1000-1722436238 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:32:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 15:32:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 021a5d21a6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722436349
+ git checkout -b scalability-yes-1-1000-1000-1722436349
Switched to a new branch 'scalability-yes-1-1000-1000-1722436349'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722436349 1698a441b9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722436349 c5c22bdaf2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:32:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:32:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-1000-1722436349 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:34:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 15:34:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c5c22bdaf2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722436462
+ git checkout -b scalability-yes-1024-1000-1000-1722436462
Switched to a new branch 'scalability-yes-1024-1000-1000-1722436462'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722436462 7259f6c832] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722436462 1137ce4205] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:34:49 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:34:49 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-1000-1722436462 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:36:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 15:36:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1137ce4205 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722436574
+ git checkout -b scalability-yes-8-1000-1000-1722436574
Switched to a new branch 'scalability-yes-8-1000-1000-1722436574'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722436574 6817c1be0a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722436574 affc78b773] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:36:41 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:36:41 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-1000-1722436574 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:38:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 15:38:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at affc78b773 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722436686
+ git checkout -b scalability-yes-512-1000-1000-1722436686
Switched to a new branch 'scalability-yes-512-1000-1000-1722436686'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722436686 6915199c49] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722436686 9013299a1e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:38:33 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:38:33 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-1000-1722436686 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:39:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 15:39:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9013299a1e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722436799
+ git checkout -b scalability-yes-128-1000-1000-1722436799
Switched to a new branch 'scalability-yes-128-1000-1000-1722436799'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722436799 efe9e81aa2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722436799 582358186a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:40:27 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:40:27 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-1000-1722436799 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:41:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 15:41:51 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 582358186a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722436911
+ git checkout -b scalability-no-32-1000-1000-1722436911
Switched to a new branch 'scalability-no-32-1000-1000-1722436911'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722436911 43bb1842d6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:42:19 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:42:19 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-1000-1722436911 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:43:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 15:43:44 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 43bb1842d6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722437024
+ git checkout -b scalability-no-0-1000-1000-1722437024
Switched to a new branch 'scalability-no-0-1000-1000-1722437024'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:44:11 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:44:11 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-1000-1722437024 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:45:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 15:45:36 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722437136
+ git checkout -b scalability-no-1-1000-1000-1722437136
Switched to a new branch 'scalability-no-1-1000-1000-1722437136'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722437136 b852b438c8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:46:03 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:46:03 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-1000-1722437136 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:47:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 15:47:28 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b852b438c8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722437248
+ git checkout -b scalability-no-1024-1000-1000-1722437248
Switched to a new branch 'scalability-no-1024-1000-1000-1722437248'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722437248 61a3e60178] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:47:55 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:47:55 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-1000-1722437248 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:49:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 15:49:21 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 61a3e60178 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722437361
+ git checkout -b scalability-no-8-1000-1000-1722437361
Switched to a new branch 'scalability-no-8-1000-1000-1722437361'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722437361 fde44fd7f4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:49:48 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:49:48 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-1000-1722437361 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:51:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 15:51:12 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fde44fd7f4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722437472
+ git checkout -b scalability-no-512-1000-1000-1722437472
Switched to a new branch 'scalability-no-512-1000-1000-1722437472'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722437472 03aaf67f27] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:51:39 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:51:39 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-1000-1722437472 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:53:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 15:53:05 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 03aaf67f27 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722437586
+ git checkout -b scalability-no-128-1000-1000-1722437586
Switched to a new branch 'scalability-no-128-1000-1000-1722437586'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722437586 3d944798f5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:53:32 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:53:32 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-1000-1722437586 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:54:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 15:54:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3d944798f5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722437697
+ git checkout -b scalability-yes-32-1000-1000-1722437697
Switched to a new branch 'scalability-yes-32-1000-1000-1722437697'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722437697 b85c9c4994] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722437697 ba8474b187] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:55:24 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:55:24 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-1000-1722437697 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:55:28 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 15:55:28 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ba8474b187 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722437728
+ git checkout -b scalability-yes-0-1000-1000-1722437728
Switched to a new branch 'scalability-yes-0-1000-1000-1722437728'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722437728 2604f144db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:55:56 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:55:56 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-1000-1722437728 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:55:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 15:55:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2604f144db NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722437759
+ git checkout -b scalability-yes-1-1000-1000-1722437759
Switched to a new branch 'scalability-yes-1-1000-1000-1722437759'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722437759 a5ed0fe620] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722437759 f7fb2189cc] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:56:27 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:56:27 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-1000-1722437759 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:56:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 15:56:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f7fb2189cc fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722437790
+ git checkout -b scalability-yes-1024-1000-1000-1722437790
Switched to a new branch 'scalability-yes-1024-1000-1000-1722437790'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722437790 47961c9ca5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722437790 216d86dea6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:57:00 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:57:00 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-1000-1722437790 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:57:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 15:57:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 216d86dea6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722437823
+ git checkout -b scalability-yes-8-1000-1000-1722437823
Switched to a new branch 'scalability-yes-8-1000-1000-1722437823'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722437823 9012407012] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722437823 71f7be476d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:57:32 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:57:32 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-1000-1722437823 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:57:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 15:57:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 71f7be476d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722437855
+ git checkout -b scalability-yes-512-1000-1000-1722437855
Switched to a new branch 'scalability-yes-512-1000-1000-1722437855'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722437855 7d475371db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722437855 39303b3b05] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:58:02 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:58:02 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-1000-1722437855 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:58:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 15:58:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 39303b3b05 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722437885
+ git checkout -b scalability-yes-128-1000-1000-1722437885
Switched to a new branch 'scalability-yes-128-1000-1000-1722437885'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722437885 c6c83e4cad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722437885 b4b9343ec9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:58:32 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:58:32 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-1000-1722437885 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:58:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 15:58:35 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b4b9343ec9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722437915
+ git checkout -b scalability-no-32-1000-1000-1722437915
Switched to a new branch 'scalability-no-32-1000-1000-1722437915'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722437915 0d75fb4d86] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:59:03 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:59:03 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-1000-1722437915 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:59:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 15:59:06 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0d75fb4d86 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722437946
+ git checkout -b scalability-no-0-1000-1000-1722437946
Switched to a new branch 'scalability-no-0-1000-1000-1722437946'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 15:59:33 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 15:59:33 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-1000-1722437946 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-1000
+ env
++ date
+ echo Wed 31 Jul 15:59:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 15:59:36 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722437976
+ git checkout -b scalability-no-1-1000-1000-1722437976
Switched to a new branch 'scalability-no-1-1000-1000-1722437976'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722437976 e249af36eb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:00:04 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 16:00:04 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-1000-1722437976 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-1000
+ env
++ date
+ echo Wed 31 Jul 16:00:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 16:00:07 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e249af36eb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722438008
+ git checkout -b scalability-no-1024-1000-1000-1722438008
Switched to a new branch 'scalability-no-1024-1000-1000-1722438008'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722438008 148cebe736] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:00:35 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 16:00:35 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-1000-1722438008 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-1000
+ env
++ date
+ echo Wed 31 Jul 16:00:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 16:00:38 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 148cebe736 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722438039
+ git checkout -b scalability-no-8-1000-1000-1722438039
Switched to a new branch 'scalability-no-8-1000-1000-1722438039'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722438039 9d497033ae] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:01:06 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 16:01:06 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-1000-1722438039 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-1000
+ env
++ date
+ echo Wed 31 Jul 16:01:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 16:01:09 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9d497033ae fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722438070
+ git checkout -b scalability-no-512-1000-1000-1722438070
Switched to a new branch 'scalability-no-512-1000-1000-1722438070'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722438070 78c3298f3d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:01:37 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 16:01:37 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-1000-1722438070 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-1000
+ env
++ date
+ echo Wed 31 Jul 16:01:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 16:01:40 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 78c3298f3d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722438101
+ git checkout -b scalability-no-128-1000-1000-1722438101
Switched to a new branch 'scalability-no-128-1000-1000-1722438101'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722438101 6883135a8e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:02:08 BST 2024 'RUN   files: 1000  partitions: 1000'
Wed 31 Jul 16:02:08 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-1000-1722438101 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:02:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 16:02:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6883135a8e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722438131
+ git checkout -b scalability-yes-32-1000-100-1722438131
Switched to a new branch 'scalability-yes-32-1000-100-1722438131'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722438131 60d3b2fead] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722438131 3fe95cee25] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:03:03 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:03:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-100-1722438131 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:04:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 16:04:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3fe95cee25 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722438259
+ git checkout -b scalability-yes-0-1000-100-1722438259
Switched to a new branch 'scalability-yes-0-1000-100-1722438259'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722438259 a344919e2d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:05:10 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:05:10 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-100-1722438259 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:06:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 16:06:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a344919e2d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722438385
+ git checkout -b scalability-yes-1-1000-100-1722438385
Switched to a new branch 'scalability-yes-1-1000-100-1722438385'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722438385 9d6f6c4e6d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722438385 4d8cb99ec5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:07:17 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:07:17 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-100-1722438385 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:08:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 16:08:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4d8cb99ec5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722438512
+ git checkout -b scalability-yes-1024-1000-100-1722438512
Switched to a new branch 'scalability-yes-1024-1000-100-1722438512'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722438512 27c0652281] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722438512 b8dbee5472] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:09:24 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:09:24 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-100-1722438512 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:10:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 16:10:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b8dbee5472 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722438640
+ git checkout -b scalability-yes-8-1000-100-1722438640
Switched to a new branch 'scalability-yes-8-1000-100-1722438640'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722438640 c9c196ce79] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722438640 65c098a664] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:11:32 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:11:32 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-100-1722438640 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:12:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 16:12:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 65c098a664 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722438767
+ git checkout -b scalability-yes-512-1000-100-1722438767
Switched to a new branch 'scalability-yes-512-1000-100-1722438767'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722438767 d01cf9c025] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722438767 69ff1d9d87] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:13:38 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:13:38 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-100-1722438767 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:14:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 16:14:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 69ff1d9d87 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722438894
+ git checkout -b scalability-yes-128-1000-100-1722438894
Switched to a new branch 'scalability-yes-128-1000-100-1722438894'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722438894 21f6397f38] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722438894 3e80d4ab62] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:15:46 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:15:46 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-100-1722438894 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:17:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 16:17:01 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3e80d4ab62 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722439021
+ git checkout -b scalability-no-32-1000-100-1722439021
Switched to a new branch 'scalability-no-32-1000-100-1722439021'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722439021 5c9e045ce7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:17:52 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:17:52 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-100-1722439021 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:19:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 16:19:07 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5c9e045ce7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722439148
+ git checkout -b scalability-no-0-1000-100-1722439148
Switched to a new branch 'scalability-no-0-1000-100-1722439148'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:19:58 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:19:58 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-100-1722439148 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:21:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 16:21:14 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722439274
+ git checkout -b scalability-no-1-1000-100-1722439274
Switched to a new branch 'scalability-no-1-1000-100-1722439274'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722439274 19374720ac] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:22:05 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:22:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-100-1722439274 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:23:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 16:23:20 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 19374720ac fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722439400
+ git checkout -b scalability-no-1024-1000-100-1722439400
Switched to a new branch 'scalability-no-1024-1000-100-1722439400'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722439400 d47f397f9c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:24:11 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:24:11 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-100-1722439400 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:25:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 16:25:28 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d47f397f9c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722439528
+ git checkout -b scalability-no-8-1000-100-1722439528
Switched to a new branch 'scalability-no-8-1000-100-1722439528'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722439528 fabd566370] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:26:20 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:26:20 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-100-1722439528 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:27:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 16:27:35 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fabd566370 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722439655
+ git checkout -b scalability-no-512-1000-100-1722439655
Switched to a new branch 'scalability-no-512-1000-100-1722439655'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722439655 cb4e2d1d81] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:28:25 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:28:25 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-100-1722439655 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:29:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 16:29:43 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cb4e2d1d81 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722439783
+ git checkout -b scalability-no-128-1000-100-1722439783
Switched to a new branch 'scalability-no-128-1000-100-1722439783'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722439783 8bf1f784eb] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:30:36 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:30:36 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-100-1722439783 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:31:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 16:31:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8bf1f784eb fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722439912
+ git checkout -b scalability-yes-32-1000-100-1722439912
Switched to a new branch 'scalability-yes-32-1000-100-1722439912'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722439912 8da4070d51] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722439912 c23ae473f0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:32:23 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:32:23 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-100-1722439912 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:33:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 16:33:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c23ae473f0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722440022
+ git checkout -b scalability-yes-0-1000-100-1722440022
Switched to a new branch 'scalability-yes-0-1000-100-1722440022'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722440022 3df9bea859] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:34:14 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:34:14 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-100-1722440022 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:35:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 16:35:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3df9bea859 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722440132
+ git checkout -b scalability-yes-1-1000-100-1722440132
Switched to a new branch 'scalability-yes-1-1000-100-1722440132'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722440132 c125ba3958] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722440132 ec4a6f6030] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:36:04 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:36:04 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-100-1722440132 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:37:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 16:37:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ec4a6f6030 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722440243
+ git checkout -b scalability-yes-1024-1000-100-1722440243
Switched to a new branch 'scalability-yes-1024-1000-100-1722440243'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722440243 7c7511b315] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722440243 48ff792ffa] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:37:50 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:37:50 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-100-1722440243 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:39:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 16:39:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 48ff792ffa fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722440351
+ git checkout -b scalability-yes-8-1000-100-1722440351
Switched to a new branch 'scalability-yes-8-1000-100-1722440351'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722440351 f69705c7a1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722440351 50ac5f5896] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:39:38 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:39:38 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-100-1722440351 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:40:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 16:40:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 50ac5f5896 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722440459
+ git checkout -b scalability-yes-512-1000-100-1722440459
Switched to a new branch 'scalability-yes-512-1000-100-1722440459'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722440459 560c52d356] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722440459 0c3e98b3c9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:41:26 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:41:26 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-100-1722440459 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:42:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 16:42:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0c3e98b3c9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722440565
+ git checkout -b scalability-yes-128-1000-100-1722440565
Switched to a new branch 'scalability-yes-128-1000-100-1722440565'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722440565 a2b7e02e60] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722440565 a71f287540] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:43:12 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:43:12 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-100-1722440565 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:44:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 16:44:31 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a71f287540 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722440671
+ git checkout -b scalability-no-32-1000-100-1722440671
Switched to a new branch 'scalability-no-32-1000-100-1722440671'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722440671 2389e34374] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:44:59 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:44:59 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-100-1722440671 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:46:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 16:46:18 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2389e34374 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722440778
+ git checkout -b scalability-no-0-1000-100-1722440778
Switched to a new branch 'scalability-no-0-1000-100-1722440778'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:46:45 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:46:45 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-100-1722440778 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:48:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 16:48:05 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722440885
+ git checkout -b scalability-no-1-1000-100-1722440885
Switched to a new branch 'scalability-no-1-1000-100-1722440885'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722440885 af02274281] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:48:32 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:48:32 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-100-1722440885 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:49:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 16:49:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at af02274281 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722440991
+ git checkout -b scalability-no-1024-1000-100-1722440991
Switched to a new branch 'scalability-no-1024-1000-100-1722440991'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722440991 c42fececb0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:50:17 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:50:17 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-100-1722440991 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:51:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 16:51:36 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c42fececb0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722441097
+ git checkout -b scalability-no-8-1000-100-1722441097
Switched to a new branch 'scalability-no-8-1000-100-1722441097'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722441097 e7c1088e52] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:52:03 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:52:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-100-1722441097 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:53:22 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 16:53:22 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e7c1088e52 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722441202
+ git checkout -b scalability-no-512-1000-100-1722441202
Switched to a new branch 'scalability-no-512-1000-100-1722441202'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722441202 4d3279dc40] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:53:49 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:53:49 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-100-1722441202 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:55:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 16:55:08 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4d3279dc40 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722441308
+ git checkout -b scalability-no-128-1000-100-1722441308
Switched to a new branch 'scalability-no-128-1000-100-1722441308'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722441308 d6cb7b2347] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:55:35 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:55:35 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-100-1722441308 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:56:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 16:56:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6cb7b2347 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722441414
+ git checkout -b scalability-yes-32-1000-100-1722441414
Switched to a new branch 'scalability-yes-32-1000-100-1722441414'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722441414 14951c736e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722441414 8baf422bde] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:57:21 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:57:21 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-100-1722441414 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 16:58:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 16:58:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8baf422bde fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722441516
+ git checkout -b scalability-yes-0-1000-100-1722441516
Switched to a new branch 'scalability-yes-0-1000-100-1722441516'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722441516 b415869cb4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 16:59:03 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 16:59:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-100-1722441516 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:00:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 17:00:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b415869cb4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722441618
+ git checkout -b scalability-yes-1-1000-100-1722441618
Switched to a new branch 'scalability-yes-1-1000-100-1722441618'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722441618 aeab8c2885] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722441618 0cff3565e7] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:00:45 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:00:45 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-100-1722441618 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:01:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 17:01:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0cff3565e7 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722441719
+ git checkout -b scalability-yes-1024-1000-100-1722441719
Switched to a new branch 'scalability-yes-1024-1000-100-1722441719'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722441719 771d73b5e6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722441719 48f2483310] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:02:26 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:02:26 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-100-1722441719 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:03:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 17:03:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 48f2483310 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722441821
+ git checkout -b scalability-yes-8-1000-100-1722441821
Switched to a new branch 'scalability-yes-8-1000-100-1722441821'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722441821 4a735be3cf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722441821 2520457bc3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:04:08 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:04:08 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-100-1722441821 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:05:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 17:05:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2520457bc3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722441922
+ git checkout -b scalability-yes-512-1000-100-1722441922
Switched to a new branch 'scalability-yes-512-1000-100-1722441922'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722441922 ae3a0a7bca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722441922 fc2cf61909] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:05:49 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:05:49 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-100-1722441922 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:07:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 17:07:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc2cf61909 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722442023
+ git checkout -b scalability-yes-128-1000-100-1722442023
Switched to a new branch 'scalability-yes-128-1000-100-1722442023'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722442023 f1d2e5f59b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722442023 37025f84a4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:07:30 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:07:30 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-100-1722442023 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:08:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 17:08:44 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 37025f84a4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722442125
+ git checkout -b scalability-no-32-1000-100-1722442125
Switched to a new branch 'scalability-no-32-1000-100-1722442125'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722442125 81c5c8e1be] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:09:11 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:09:11 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-100-1722442125 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:10:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 17:10:26 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 81c5c8e1be fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722442226
+ git checkout -b scalability-no-0-1000-100-1722442226
Switched to a new branch 'scalability-no-0-1000-100-1722442226'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:10:53 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:10:53 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-100-1722442226 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:12:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 17:12:08 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722442328
+ git checkout -b scalability-no-1-1000-100-1722442328
Switched to a new branch 'scalability-no-1-1000-100-1722442328'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722442328 143418c5a3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:12:35 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:12:35 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-100-1722442328 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:13:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 17:13:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 143418c5a3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722442430
+ git checkout -b scalability-no-1024-1000-100-1722442430
Switched to a new branch 'scalability-no-1024-1000-100-1722442430'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722442430 d04a6639cd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:14:17 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:14:17 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-100-1722442430 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:15:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 17:15:32 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d04a6639cd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722442532
+ git checkout -b scalability-no-8-1000-100-1722442532
Switched to a new branch 'scalability-no-8-1000-100-1722442532'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722442532 eac4c90cd1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:15:59 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:15:59 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-100-1722442532 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:17:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 17:17:13 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eac4c90cd1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722442633
+ git checkout -b scalability-no-512-1000-100-1722442633
Switched to a new branch 'scalability-no-512-1000-100-1722442633'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722442633 58f1afa2e7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:17:40 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:17:40 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-100-1722442633 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:18:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 17:18:55 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 58f1afa2e7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722442735
+ git checkout -b scalability-no-128-1000-100-1722442735
Switched to a new branch 'scalability-no-128-1000-100-1722442735'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722442735 edfb3581b4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:19:21 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:19:21 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-100-1722442735 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:20:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 17:20:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at edfb3581b4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722442836
+ git checkout -b scalability-yes-32-1000-100-1722442836
Switched to a new branch 'scalability-yes-32-1000-100-1722442836'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722442836 7b30c72b37] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722442836 6351b61836] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:21:03 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:21:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-100-1722442836 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:22:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 17:22:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6351b61836 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722442938
+ git checkout -b scalability-yes-0-1000-100-1722442938
Switched to a new branch 'scalability-yes-0-1000-100-1722442938'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722442938 0c74f536eb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:22:45 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:22:45 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-100-1722442938 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:24:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 17:24:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0c74f536eb NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722443040
+ git checkout -b scalability-yes-1-1000-100-1722443040
Switched to a new branch 'scalability-yes-1-1000-100-1722443040'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722443040 73d368e4ff] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722443040 4077c5b3fc] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:24:27 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:24:27 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-100-1722443040 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:25:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 17:25:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4077c5b3fc fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722443143
+ git checkout -b scalability-yes-1024-1000-100-1722443143
Switched to a new branch 'scalability-yes-1024-1000-100-1722443143'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722443143 11ae5deb7c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722443143 85786872cf] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:26:09 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:26:09 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-100-1722443143 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:27:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 17:27:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 85786872cf fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722443245
+ git checkout -b scalability-yes-8-1000-100-1722443245
Switched to a new branch 'scalability-yes-8-1000-100-1722443245'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722443245 ac7d81c848] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722443245 e515569ae5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:27:52 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:27:52 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-100-1722443245 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:29:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 17:29:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e515569ae5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722443348
+ git checkout -b scalability-yes-512-1000-100-1722443348
Switched to a new branch 'scalability-yes-512-1000-100-1722443348'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722443348 87c17f6be6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722443348 d830b25fa6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:29:35 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:29:35 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-100-1722443348 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:30:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 17:30:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d830b25fa6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722443451
+ git checkout -b scalability-yes-128-1000-100-1722443451
Switched to a new branch 'scalability-yes-128-1000-100-1722443451'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722443451 b3cd80c0f1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722443451 5991b4e7fa] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:31:17 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:31:17 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-100-1722443451 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:32:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 17:32:33 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5991b4e7fa fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722443553
+ git checkout -b scalability-no-32-1000-100-1722443553
Switched to a new branch 'scalability-no-32-1000-100-1722443553'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722443553 72ded2e416] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:33:00 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:33:00 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-100-1722443553 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:34:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 17:34:16 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 72ded2e416 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722443656
+ git checkout -b scalability-no-0-1000-100-1722443656
Switched to a new branch 'scalability-no-0-1000-100-1722443656'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:34:43 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:34:43 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-100-1722443656 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:35:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 17:35:58 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722443758
+ git checkout -b scalability-no-1-1000-100-1722443758
Switched to a new branch 'scalability-no-1-1000-100-1722443758'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722443758 ad80ef469e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:36:25 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:36:25 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-100-1722443758 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:37:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 17:37:41 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ad80ef469e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722443861
+ git checkout -b scalability-no-1024-1000-100-1722443861
Switched to a new branch 'scalability-no-1024-1000-100-1722443861'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722443861 c6036d1b2b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:38:08 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:38:08 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-100-1722443861 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:39:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 17:39:23 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c6036d1b2b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722443963
+ git checkout -b scalability-no-8-1000-100-1722443963
Switched to a new branch 'scalability-no-8-1000-100-1722443963'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722443963 e5940c9564] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:39:50 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:39:50 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-100-1722443963 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:41:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 17:41:06 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e5940c9564 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722444066
+ git checkout -b scalability-no-512-1000-100-1722444066
Switched to a new branch 'scalability-no-512-1000-100-1722444066'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722444066 d6e75f0dac] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:41:33 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:41:33 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-100-1722444066 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:42:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 17:42:48 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6e75f0dac fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722444168
+ git checkout -b scalability-no-128-1000-100-1722444168
Switched to a new branch 'scalability-no-128-1000-100-1722444168'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722444168 8096b90184] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:43:15 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:43:15 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-100-1722444168 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:44:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 17:44:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8096b90184 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722444270
+ git checkout -b scalability-yes-32-1000-100-1722444270
Switched to a new branch 'scalability-yes-32-1000-100-1722444270'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722444270 95ad1e54bf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722444270 9723f7f543] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:44:57 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:44:57 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-100-1722444270 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:48:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 17:48:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9723f7f543 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722444518
+ git checkout -b scalability-yes-0-1000-100-1722444518
Switched to a new branch 'scalability-yes-0-1000-100-1722444518'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722444518 76be456b23] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:49:05 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:49:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-100-1722444518 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:52:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 17:52:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 76be456b23 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722444760
+ git checkout -b scalability-yes-1-1000-100-1722444760
Switched to a new branch 'scalability-yes-1-1000-100-1722444760'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722444760 c44dd37fd1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722444760 aff2a0de08] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:53:07 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:53:07 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-100-1722444760 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 17:56:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 17:56:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at aff2a0de08 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722445006
+ git checkout -b scalability-yes-1024-1000-100-1722445006
Switched to a new branch 'scalability-yes-1024-1000-100-1722445006'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722445006 abd1097276] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722445006 41e3a501a2] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 17:57:13 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 17:57:13 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-100-1722445006 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:00:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 18:00:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 41e3a501a2 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722445250
+ git checkout -b scalability-yes-8-1000-100-1722445250
Switched to a new branch 'scalability-yes-8-1000-100-1722445250'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722445250 9b9cdff282] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722445250 420759ff90] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:01:19 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:01:19 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-100-1722445250 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:04:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 18:04:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 420759ff90 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722445494
+ git checkout -b scalability-yes-512-1000-100-1722445494
Switched to a new branch 'scalability-yes-512-1000-100-1722445494'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722445494 99b64260fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722445494 fe6cca480d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:05:21 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:05:21 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-100-1722445494 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:09:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 18:09:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fe6cca480d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722445743
+ git checkout -b scalability-yes-128-1000-100-1722445743
Switched to a new branch 'scalability-yes-128-1000-100-1722445743'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722445743 964f05fef5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722445743 520acd2218] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:09:31 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:09:31 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-100-1722445743 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:13:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 18:13:14 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 520acd2218 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722445994
+ git checkout -b scalability-no-32-1000-100-1722445994
Switched to a new branch 'scalability-no-32-1000-100-1722445994'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722445994 3150d520cc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:13:42 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:13:42 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-100-1722445994 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:17:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 18:17:35 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3150d520cc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722446255
+ git checkout -b scalability-no-0-1000-100-1722446255
Switched to a new branch 'scalability-no-0-1000-100-1722446255'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:18:03 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:18:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-100-1722446255 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:21:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 18:21:48 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722446508
+ git checkout -b scalability-no-1-1000-100-1722446508
Switched to a new branch 'scalability-no-1-1000-100-1722446508'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722446508 bfc8689101] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:22:16 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:22:16 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-100-1722446508 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:26:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 18:26:04 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bfc8689101 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722446764
+ git checkout -b scalability-no-1024-1000-100-1722446764
Switched to a new branch 'scalability-no-1024-1000-100-1722446764'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722446764 59097f031d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:26:33 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:26:33 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-100-1722446764 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:30:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 18:30:29 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 59097f031d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722447029
+ git checkout -b scalability-no-8-1000-100-1722447029
Switched to a new branch 'scalability-no-8-1000-100-1722447029'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722447029 2b1eb62638] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:30:56 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:30:56 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-100-1722447029 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:34:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 18:34:38 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2b1eb62638 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722447278
+ git checkout -b scalability-no-512-1000-100-1722447278
Switched to a new branch 'scalability-no-512-1000-100-1722447278'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722447278 fced74175f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:35:06 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:35:06 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-100-1722447278 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-100
+ env
++ date
+ echo Wed 31 Jul 18:38:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 18:38:47 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fced74175f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722447527
+ git checkout -b scalability-no-128-1000-100-1722447527
Switched to a new branch 'scalability-no-128-1000-100-1722447527'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722447527 794833c8ce] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:39:14 BST 2024 'RUN   files: 1000  partitions: 100'
Wed 31 Jul 18:39:14 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-100-1722447527 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:43:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 18:43:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 794833c8ce fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722447789
+ git checkout -b scalability-yes-32-1000-10-1722447789
Switched to a new branch 'scalability-yes-32-1000-10-1722447789'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722447789 9e2c79f87b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722447789 887bae5b46] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:43:43 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:43:43 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-10-1722447789 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:44:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 18:44:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 887bae5b46 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722447898
+ git checkout -b scalability-yes-0-1000-10-1722447898
Switched to a new branch 'scalability-yes-0-1000-10-1722447898'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722447898 e0a9c4d402] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:45:30 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:45:30 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-10-1722447898 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:46:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 18:46:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e0a9c4d402 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722448004
+ git checkout -b scalability-yes-1-1000-10-1722448004
Switched to a new branch 'scalability-yes-1-1000-10-1722448004'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722448004 a88eb8ddcb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722448004 237edafad4] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:47:16 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:47:16 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-10-1722448004 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:48:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 18:48:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 237edafad4 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722448110
+ git checkout -b scalability-yes-1024-1000-10-1722448110
Switched to a new branch 'scalability-yes-1024-1000-10-1722448110'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722448110 2bed2d8683] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722448110 53801a5a3d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:49:02 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:49:02 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-10-1722448110 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:50:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 18:50:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 53801a5a3d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722448217
+ git checkout -b scalability-yes-8-1000-10-1722448217
Switched to a new branch 'scalability-yes-8-1000-10-1722448217'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722448217 966af0a22a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722448217 753703fcd2] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:50:50 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:50:50 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-10-1722448217 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:52:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 18:52:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 753703fcd2 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722448324
+ git checkout -b scalability-yes-512-1000-10-1722448324
Switched to a new branch 'scalability-yes-512-1000-10-1722448324'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722448324 310c9a939e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722448324 af049f7aa9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:52:36 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:52:36 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-10-1722448324 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:53:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 18:53:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at af049f7aa9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722448430
+ git checkout -b scalability-yes-128-1000-10-1722448430
Switched to a new branch 'scalability-yes-128-1000-10-1722448430'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722448430 d35af30774] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722448430 69cffe4a2c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:54:22 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:54:22 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-10-1722448430 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:55:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 18:55:37 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 69cffe4a2c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722448537
+ git checkout -b scalability-no-32-1000-10-1722448537
Switched to a new branch 'scalability-no-32-1000-10-1722448537'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722448537 66f19e12b3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:56:09 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:56:09 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-10-1722448537 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:57:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 18:57:23 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 66f19e12b3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722448643
+ git checkout -b scalability-no-0-1000-10-1722448643
Switched to a new branch 'scalability-no-0-1000-10-1722448643'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:57:56 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:57:56 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-10-1722448643 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 18:59:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 18:59:11 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722448751
+ git checkout -b scalability-no-1-1000-10-1722448751
Switched to a new branch 'scalability-no-1-1000-10-1722448751'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722448751 295d32e302] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 18:59:43 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 18:59:43 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-10-1722448751 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:00:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 19:00:57 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 295d32e302 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722448857
+ git checkout -b scalability-no-1024-1000-10-1722448857
Switched to a new branch 'scalability-no-1024-1000-10-1722448857'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722448857 e32bc959cd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:01:29 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:01:29 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-10-1722448857 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:02:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 19:02:43 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e32bc959cd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722448963
+ git checkout -b scalability-no-8-1000-10-1722448963
Switched to a new branch 'scalability-no-8-1000-10-1722448963'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722448963 f55879ddee] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:03:15 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:03:15 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-10-1722448963 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:04:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 19:04:29 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f55879ddee fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722449069
+ git checkout -b scalability-no-512-1000-10-1722449069
Switched to a new branch 'scalability-no-512-1000-10-1722449069'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722449069 09149bba9c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:05:01 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:05:01 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-10-1722449069 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:06:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 19:06:15 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 09149bba9c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722449175
+ git checkout -b scalability-no-128-1000-10-1722449175
Switched to a new branch 'scalability-no-128-1000-10-1722449175'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722449175 eb89074617] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:06:48 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:06:48 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-10-1722449175 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:08:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 19:08:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eb89074617 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722449282
+ git checkout -b scalability-yes-32-1000-10-1722449282
Switched to a new branch 'scalability-yes-32-1000-10-1722449282'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722449282 de95429235] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722449282 53509d771a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:08:29 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:08:29 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-10-1722449282 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:09:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 19:09:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 53509d771a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722449385
+ git checkout -b scalability-yes-0-1000-10-1722449385
Switched to a new branch 'scalability-yes-0-1000-10-1722449385'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722449385 32f4d151ad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:10:13 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:10:13 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-10-1722449385 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:11:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 19:11:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 32f4d151ad NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722449490
+ git checkout -b scalability-yes-1-1000-10-1722449490
Switched to a new branch 'scalability-yes-1-1000-10-1722449490'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722449490 ebb0841bda] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722449490 1093c59e07] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:11:57 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:11:57 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-10-1722449490 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:13:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 19:13:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1093c59e07 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722449593
+ git checkout -b scalability-yes-1024-1000-10-1722449593
Switched to a new branch 'scalability-yes-1024-1000-10-1722449593'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722449593 461ba2d98f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722449593 c1727c7364] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:13:40 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:13:40 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-10-1722449593 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:14:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 19:14:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c1727c7364 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722449697
+ git checkout -b scalability-yes-8-1000-10-1722449697
Switched to a new branch 'scalability-yes-8-1000-10-1722449697'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722449697 1a71402d97] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722449697 059a3928b8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:15:24 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:15:24 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-10-1722449697 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:16:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 19:16:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 059a3928b8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722449801
+ git checkout -b scalability-yes-512-1000-10-1722449801
Switched to a new branch 'scalability-yes-512-1000-10-1722449801'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722449801 b87e8a860b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722449801 07d4acadca] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:17:08 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:17:08 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-10-1722449801 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:18:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 19:18:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 07d4acadca fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722449905
+ git checkout -b scalability-yes-128-1000-10-1722449905
Switched to a new branch 'scalability-yes-128-1000-10-1722449905'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722449905 186bf0c09d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722449905 0151b5b6f5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:18:52 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:18:52 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-10-1722449905 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:20:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 19:20:09 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0151b5b6f5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722450009
+ git checkout -b scalability-no-32-1000-10-1722450009
Switched to a new branch 'scalability-no-32-1000-10-1722450009'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722450009 7e7185605f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:20:37 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:20:37 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-10-1722450009 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:21:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 19:21:55 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7e7185605f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722450115
+ git checkout -b scalability-no-0-1000-10-1722450115
Switched to a new branch 'scalability-no-0-1000-10-1722450115'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:22:23 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:22:23 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-10-1722450115 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:23:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 19:23:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722450219
+ git checkout -b scalability-no-1-1000-10-1722450219
Switched to a new branch 'scalability-no-1-1000-10-1722450219'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722450219 b3279dc853] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:24:07 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:24:07 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-10-1722450219 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:25:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 19:25:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b3279dc853 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722450325
+ git checkout -b scalability-no-1024-1000-10-1722450325
Switched to a new branch 'scalability-no-1024-1000-10-1722450325'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722450325 12f72da452] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:25:52 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:25:52 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-10-1722450325 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:27:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 19:27:09 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 12f72da452 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722450429
+ git checkout -b scalability-no-8-1000-10-1722450429
Switched to a new branch 'scalability-no-8-1000-10-1722450429'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722450429 1b8576e42d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:27:36 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:27:36 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-10-1722450429 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:28:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 19:28:56 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1b8576e42d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722450536
+ git checkout -b scalability-no-512-1000-10-1722450536
Switched to a new branch 'scalability-no-512-1000-10-1722450536'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722450536 eaf690cdf6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:29:24 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:29:24 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-10-1722450536 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:30:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 19:30:42 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eaf690cdf6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722450642
+ git checkout -b scalability-no-128-1000-10-1722450642
Switched to a new branch 'scalability-no-128-1000-10-1722450642'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722450642 7e9f8d4c15] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:31:09 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:31:09 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-10-1722450642 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:32:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 19:32:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7e9f8d4c15 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722450746
+ git checkout -b scalability-yes-32-1000-10-1722450746
Switched to a new branch 'scalability-yes-32-1000-10-1722450746'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722450746 86fd595182] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722450746 632f8a355c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:32:53 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:32:53 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-10-1722450746 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:34:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 19:34:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 632f8a355c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722450847
+ git checkout -b scalability-yes-0-1000-10-1722450847
Switched to a new branch 'scalability-yes-0-1000-10-1722450847'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722450847 a5298f056b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:34:34 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:34:34 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-10-1722450847 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:35:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 19:35:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a5298f056b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722450948
+ git checkout -b scalability-yes-1-1000-10-1722450948
Switched to a new branch 'scalability-yes-1-1000-10-1722450948'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722450948 8e7c409b25] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722450948 589e0f2be0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:36:15 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:36:15 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-10-1722450948 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:37:28 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 19:37:28 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 589e0f2be0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722451048
+ git checkout -b scalability-yes-1024-1000-10-1722451048
Switched to a new branch 'scalability-yes-1024-1000-10-1722451048'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722451048 89d6a64d67] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722451048 97f2f2a8a6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:37:56 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:37:56 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-10-1722451048 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:39:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 19:39:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 97f2f2a8a6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722451149
+ git checkout -b scalability-yes-8-1000-10-1722451149
Switched to a new branch 'scalability-yes-8-1000-10-1722451149'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722451149 eea3990d3f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722451149 3acd2a1608] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:39:36 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:39:36 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-10-1722451149 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:40:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 19:40:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3acd2a1608 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722451251
+ git checkout -b scalability-yes-512-1000-10-1722451251
Switched to a new branch 'scalability-yes-512-1000-10-1722451251'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722451251 11c7c9045c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722451251 2ce9dbcf86] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:41:18 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:41:18 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-10-1722451251 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:42:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 19:42:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2ce9dbcf86 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722451353
+ git checkout -b scalability-yes-128-1000-10-1722451353
Switched to a new branch 'scalability-yes-128-1000-10-1722451353'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722451353 c21e2c6e13] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722451353 4c47c48860] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:43:00 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:43:00 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-10-1722451353 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:44:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 19:44:14 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c47c48860 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722451454
+ git checkout -b scalability-no-32-1000-10-1722451454
Switched to a new branch 'scalability-no-32-1000-10-1722451454'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722451454 c5511be2b4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:44:41 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:44:41 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-10-1722451454 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:45:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 19:45:55 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c5511be2b4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722451555
+ git checkout -b scalability-no-0-1000-10-1722451555
Switched to a new branch 'scalability-no-0-1000-10-1722451555'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:46:22 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:46:22 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-10-1722451555 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:47:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 19:47:35 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722451655
+ git checkout -b scalability-no-1-1000-10-1722451655
Switched to a new branch 'scalability-no-1-1000-10-1722451655'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722451655 18f866b6ad] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:48:02 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:48:02 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-10-1722451655 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:49:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 19:49:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 18f866b6ad fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722451756
+ git checkout -b scalability-no-1024-1000-10-1722451756
Switched to a new branch 'scalability-no-1024-1000-10-1722451756'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722451756 fb3a332f4e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:49:43 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:49:43 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-10-1722451756 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:50:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 19:50:57 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fb3a332f4e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722451857
+ git checkout -b scalability-no-8-1000-10-1722451857
Switched to a new branch 'scalability-no-8-1000-10-1722451857'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722451857 28bbbae1da] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:51:24 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:51:24 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-10-1722451857 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:52:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 19:52:38 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 28bbbae1da fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722451958
+ git checkout -b scalability-no-512-1000-10-1722451958
Switched to a new branch 'scalability-no-512-1000-10-1722451958'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722451958 f8be3f2e5e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:53:05 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:53:05 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-10-1722451958 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:54:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 19:54:18 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f8be3f2e5e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722452058
+ git checkout -b scalability-no-128-1000-10-1722452058
Switched to a new branch 'scalability-no-128-1000-10-1722452058'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722452058 c520d6a7bc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:54:45 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:54:45 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-10-1722452058 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:55:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 19:55:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c520d6a7bc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722452159
+ git checkout -b scalability-yes-32-1000-10-1722452159
Switched to a new branch 'scalability-yes-32-1000-10-1722452159'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722452159 1b9cae528f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722452159 2e202a0b0b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:56:26 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:56:26 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-10-1722452159 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:57:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 19:57:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2e202a0b0b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722452261
+ git checkout -b scalability-yes-0-1000-10-1722452261
Switched to a new branch 'scalability-yes-0-1000-10-1722452261'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722452261 49acafe0dc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:58:08 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:58:08 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-10-1722452261 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 19:59:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 19:59:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 49acafe0dc NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722452363
+ git checkout -b scalability-yes-1-1000-10-1722452363
Switched to a new branch 'scalability-yes-1-1000-10-1722452363'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722452363 5767a45e49] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722452363 548abb5e5b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 19:59:50 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 19:59:50 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-10-1722452363 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:01:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 20:01:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 548abb5e5b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722452464
+ git checkout -b scalability-yes-1024-1000-10-1722452464
Switched to a new branch 'scalability-yes-1024-1000-10-1722452464'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722452464 74f04147d7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722452464 d916901c23] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:01:31 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:01:31 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-10-1722452464 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:02:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 20:02:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d916901c23 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722452565
+ git checkout -b scalability-yes-8-1000-10-1722452565
Switched to a new branch 'scalability-yes-8-1000-10-1722452565'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722452565 175c55f141] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722452565 565b045f05] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:03:13 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:03:13 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-10-1722452565 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:04:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 20:04:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 565b045f05 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722452667
+ git checkout -b scalability-yes-512-1000-10-1722452667
Switched to a new branch 'scalability-yes-512-1000-10-1722452667'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722452667 76d56c2635] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722452667 adc4716414] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:04:54 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:04:54 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-10-1722452667 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:06:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 20:06:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at adc4716414 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722452768
+ git checkout -b scalability-yes-128-1000-10-1722452768
Switched to a new branch 'scalability-yes-128-1000-10-1722452768'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722452768 4e9fc530a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722452768 50459910fe] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:06:35 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:06:35 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-10-1722452768 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:07:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 20:07:51 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 50459910fe fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722452871
+ git checkout -b scalability-no-32-1000-10-1722452871
Switched to a new branch 'scalability-no-32-1000-10-1722452871'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722452871 1adbb88955] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:08:18 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:08:18 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-10-1722452871 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:09:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 20:09:32 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1adbb88955 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722452972
+ git checkout -b scalability-no-0-1000-10-1722452972
Switched to a new branch 'scalability-no-0-1000-10-1722452972'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:09:59 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:09:59 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-10-1722452972 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:11:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 20:11:13 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722453073
+ git checkout -b scalability-no-1-1000-10-1722453073
Switched to a new branch 'scalability-no-1-1000-10-1722453073'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722453073 7d5690e10e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:11:40 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:11:40 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-10-1722453073 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:12:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 20:12:55 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7d5690e10e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722453175
+ git checkout -b scalability-no-1024-1000-10-1722453175
Switched to a new branch 'scalability-no-1024-1000-10-1722453175'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722453175 da7394fc48] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:13:22 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:13:22 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-10-1722453175 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:14:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 20:14:36 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at da7394fc48 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722453276
+ git checkout -b scalability-no-8-1000-10-1722453276
Switched to a new branch 'scalability-no-8-1000-10-1722453276'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722453276 ea8849f1c6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:15:03 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:15:03 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-10-1722453276 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:16:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 20:16:17 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ea8849f1c6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722453377
+ git checkout -b scalability-no-512-1000-10-1722453377
Switched to a new branch 'scalability-no-512-1000-10-1722453377'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722453377 1c70cb5a88] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:16:44 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:16:44 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-10-1722453377 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:17:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 20:17:59 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1c70cb5a88 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722453479
+ git checkout -b scalability-no-128-1000-10-1722453479
Switched to a new branch 'scalability-no-128-1000-10-1722453479'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722453479 9136fa7553] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:18:26 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:18:26 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-10-1722453479 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:19:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 20:19:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9136fa7553 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722453581
+ git checkout -b scalability-yes-32-1000-10-1722453581
Switched to a new branch 'scalability-yes-32-1000-10-1722453581'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722453581 841bac65a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722453581 48bc5a47fe] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:20:08 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:20:08 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-10-1722453581 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:21:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 20:21:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 48bc5a47fe fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722453705
+ git checkout -b scalability-yes-0-1000-10-1722453705
Switched to a new branch 'scalability-yes-0-1000-10-1722453705'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722453705 cccd218141] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:22:12 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:22:12 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-10-1722453705 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:23:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 20:23:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cccd218141 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722453826
+ git checkout -b scalability-yes-1-1000-10-1722453826
Switched to a new branch 'scalability-yes-1-1000-10-1722453826'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722453826 1492679657] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722453826 2eb550cf09] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:24:13 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:24:13 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-10-1722453826 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:25:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 20:25:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2eb550cf09 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722453945
+ git checkout -b scalability-yes-1024-1000-10-1722453945
Switched to a new branch 'scalability-yes-1024-1000-10-1722453945'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722453945 a7b128d6b9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722453945 8822023b7a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:26:13 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:26:13 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-10-1722453945 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:27:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 20:27:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8822023b7a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722454063
+ git checkout -b scalability-yes-8-1000-10-1722454063
Switched to a new branch 'scalability-yes-8-1000-10-1722454063'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722454063 7d0b5e6d84] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722454063 0be396acae] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:28:10 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:28:10 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-10-1722454063 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:29:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 20:29:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0be396acae fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722454182
+ git checkout -b scalability-yes-512-1000-10-1722454182
Switched to a new branch 'scalability-yes-512-1000-10-1722454182'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722454182 298974275a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722454182 09236d5bee] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:30:09 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:30:09 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-10-1722454182 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:31:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 20:31:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 09236d5bee fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722454302
+ git checkout -b scalability-yes-128-1000-10-1722454302
Switched to a new branch 'scalability-yes-128-1000-10-1722454302'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722454302 77bf7e949a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722454302 54637d3c1b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:32:09 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:32:09 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-10-1722454302 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:33:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 20:33:39 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 54637d3c1b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722454419
+ git checkout -b scalability-no-32-1000-10-1722454419
Switched to a new branch 'scalability-no-32-1000-10-1722454419'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722454419 d7e1227837] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:34:06 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:34:06 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-10-1722454419 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:35:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 20:35:38 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d7e1227837 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722454538
+ git checkout -b scalability-no-0-1000-10-1722454538
Switched to a new branch 'scalability-no-0-1000-10-1722454538'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:36:05 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:36:05 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-10-1722454538 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:37:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 20:37:38 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722454658
+ git checkout -b scalability-no-1-1000-10-1722454658
Switched to a new branch 'scalability-no-1-1000-10-1722454658'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722454658 ce9b7b4ca8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:38:05 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:38:05 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-10-1722454658 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:39:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 20:39:38 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ce9b7b4ca8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722454778
+ git checkout -b scalability-no-1024-1000-10-1722454778
Switched to a new branch 'scalability-no-1024-1000-10-1722454778'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722454778 d6e21cea5d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:40:05 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:40:05 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-10-1722454778 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:41:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 20:41:39 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6e21cea5d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722454899
+ git checkout -b scalability-no-8-1000-10-1722454899
Switched to a new branch 'scalability-no-8-1000-10-1722454899'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722454899 0bf93069b0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:42:06 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:42:06 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-10-1722454899 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:43:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 20:43:39 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0bf93069b0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722455019
+ git checkout -b scalability-no-512-1000-10-1722455019
Switched to a new branch 'scalability-no-512-1000-10-1722455019'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722455019 178c03fa99] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:44:06 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:44:06 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-10-1722455019 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 20:45:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 20:45:40 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 178c03fa99 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722455140
+ git checkout -b scalability-no-128-1000-10-1722455140
Switched to a new branch 'scalability-no-128-1000-10-1722455140'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722455140 799cfa760b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:46:07 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 20:46:07 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-10-1722455140 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 20:47:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 20:47:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 799cfa760b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722455259
+ git checkout -b scalability-yes-32-1000-1-1722455259
Switched to a new branch 'scalability-yes-32-1000-1-1722455259'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722455259 06fe11d8f5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722455259 9ed38fc81e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:48:31 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 20:48:31 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-1-1722455259 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 20:49:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 20:49:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9ed38fc81e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722455385
+ git checkout -b scalability-yes-0-1000-1-1722455385
Switched to a new branch 'scalability-yes-0-1000-1-1722455385'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722455385 92c2834bc9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:50:37 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 20:50:37 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-1-1722455385 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 20:51:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 20:51:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 92c2834bc9 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722455511
+ git checkout -b scalability-yes-1-1000-1-1722455511
Switched to a new branch 'scalability-yes-1-1000-1-1722455511'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722455511 90c5a1359b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722455511 e9d806348b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:52:43 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 20:52:43 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-1-1722455511 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 20:53:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 20:53:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e9d806348b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722455637
+ git checkout -b scalability-yes-1024-1000-1-1722455637
Switched to a new branch 'scalability-yes-1024-1000-1-1722455637'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722455637 3dfd1ce696] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722455637 2958404eff] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:54:48 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 20:54:48 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-1-1722455637 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 20:56:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 20:56:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2958404eff fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722455762
+ git checkout -b scalability-yes-8-1000-1-1722455762
Switched to a new branch 'scalability-yes-8-1000-1-1722455762'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722455762 18998afa50] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722455762 9bd4f7b439] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:56:53 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 20:56:53 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-1-1722455762 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 20:58:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 20:58:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9bd4f7b439 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722455888
+ git checkout -b scalability-yes-512-1000-1-1722455888
Switched to a new branch 'scalability-yes-512-1000-1-1722455888'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722455888 c1fa7d5a34] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722455888 7f112c7b49] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 20:58:58 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 20:58:58 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-1-1722455888 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:00:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 21:00:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7f112c7b49 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722456013
+ git checkout -b scalability-yes-128-1000-1-1722456013
Switched to a new branch 'scalability-yes-128-1000-1-1722456013'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722456013 ceab3c3d9b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722456013 ea561b537b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:01:03 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:01:03 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-1-1722456013 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:02:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 21:02:17 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ea561b537b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722456137
+ git checkout -b scalability-no-32-1000-1-1722456137
Switched to a new branch 'scalability-no-32-1000-1-1722456137'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722456137 d2b2cfc0f7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:03:07 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:03:07 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-1-1722456137 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:04:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 21:04:21 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d2b2cfc0f7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722456261
+ git checkout -b scalability-no-0-1000-1-1722456261
Switched to a new branch 'scalability-no-0-1000-1-1722456261'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:05:11 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:05:11 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-1-1722456261 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:06:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 21:06:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722456385
+ git checkout -b scalability-no-1-1000-1-1722456385
Switched to a new branch 'scalability-no-1-1000-1-1722456385'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ sed s/MY_PLACEHOLDER/1/
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722456385 b4269ff10f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:07:16 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:07:16 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-1-1722456385 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:08:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 21:08:31 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b4269ff10f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722456511
+ git checkout -b scalability-no-1024-1000-1-1722456511
Switched to a new branch 'scalability-no-1024-1000-1-1722456511'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722456511 16b4f99daa] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:09:22 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:09:22 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-1-1722456511 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:10:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 21:10:37 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 16b4f99daa fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722456637
+ git checkout -b scalability-no-8-1000-1-1722456637
Switched to a new branch 'scalability-no-8-1000-1-1722456637'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722456637 317a32fb89] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:11:27 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:11:27 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-1-1722456637 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:12:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 21:12:41 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 317a32fb89 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722456761
+ git checkout -b scalability-no-512-1000-1-1722456761
Switched to a new branch 'scalability-no-512-1000-1-1722456761'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722456761 99b111010e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:13:31 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:13:31 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-1-1722456761 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:14:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 21:14:45 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 99b111010e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722456885
+ git checkout -b scalability-no-128-1000-1-1722456885
Switched to a new branch 'scalability-no-128-1000-1-1722456885'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722456885 4c6f7d7327] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:15:36 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:15:36 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-1-1722456885 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:16:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 21:16:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c6f7d7327 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722457010
+ git checkout -b scalability-yes-32-1000-1-1722457010
Switched to a new branch 'scalability-yes-32-1000-1-1722457010'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722457010 f5b3119c06] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722457010 d72ed20977] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:17:36 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:17:36 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-1-1722457010 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:18:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 21:18:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d72ed20977 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722457133
+ git checkout -b scalability-yes-0-1000-1-1722457133
Switched to a new branch 'scalability-yes-0-1000-1-1722457133'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722457133 94ff047dbf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:19:38 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:19:38 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-1-1722457133 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:20:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 21:20:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 94ff047dbf NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722457254
+ git checkout -b scalability-yes-1-1000-1-1722457254
Switched to a new branch 'scalability-yes-1-1000-1-1722457254'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722457254 af16d7be44] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722457254 68b25320d3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:21:39 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:21:39 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-1-1722457254 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:22:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 21:22:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 68b25320d3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722457376
+ git checkout -b scalability-yes-1024-1000-1-1722457376
Switched to a new branch 'scalability-yes-1024-1000-1-1722457376'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722457376 bbc7a0e207] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722457376 da2f80b7f3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:23:23 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:23:23 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-1-1722457376 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:24:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 21:24:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at da2f80b7f3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722457479
+ git checkout -b scalability-yes-8-1000-1-1722457479
Switched to a new branch 'scalability-yes-8-1000-1-1722457479'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722457479 c4de1195cb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722457479 317115803f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:25:06 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:25:06 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-1-1722457479 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:26:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 21:26:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 317115803f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722457582
+ git checkout -b scalability-yes-512-1000-1-1722457582
Switched to a new branch 'scalability-yes-512-1000-1-1722457582'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722457582 49a0a38b53] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722457582 565119ffed] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:26:48 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:26:48 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-1-1722457582 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:28:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 21:28:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 565119ffed fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722457686
+ git checkout -b scalability-yes-128-1000-1-1722457686
Switched to a new branch 'scalability-yes-128-1000-1-1722457686'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722457686 acfafc6bfa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722457686 ead24577e1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:28:33 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:28:33 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-1-1722457686 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:29:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 21:29:49 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ead24577e1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722457789
+ git checkout -b scalability-no-32-1000-1-1722457789
Switched to a new branch 'scalability-no-32-1000-1-1722457789'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722457789 f6edcebb83] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:30:16 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:30:16 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-1-1722457789 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:31:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 21:31:33 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f6edcebb83 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722457893
+ git checkout -b scalability-no-0-1000-1-1722457893
Switched to a new branch 'scalability-no-0-1000-1-1722457893'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:32:00 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:32:00 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-1-1722457893 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:33:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 21:33:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722457996
+ git checkout -b scalability-no-1-1000-1-1722457996
Switched to a new branch 'scalability-no-1-1000-1-1722457996'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722457996 ba180e8d09] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:33:43 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:33:43 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-1-1722457996 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:34:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 21:34:59 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ba180e8d09 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722458099
+ git checkout -b scalability-no-1024-1000-1-1722458099
Switched to a new branch 'scalability-no-1024-1000-1-1722458099'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722458099 01c5e6e92c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:35:26 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:35:26 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-1-1722458099 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:36:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 21:36:42 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 01c5e6e92c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722458203
+ git checkout -b scalability-no-8-1000-1-1722458203
Switched to a new branch 'scalability-no-8-1000-1-1722458203'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722458203 42c320a339] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:37:10 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:37:10 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-1-1722458203 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:38:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 21:38:26 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 42c320a339 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722458306
+ git checkout -b scalability-no-512-1000-1-1722458306
Switched to a new branch 'scalability-no-512-1000-1-1722458306'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722458306 5400c94ab2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:38:52 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:38:52 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-1-1722458306 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:40:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 21:40:08 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5400c94ab2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722458409
+ git checkout -b scalability-no-128-1000-1-1722458409
Switched to a new branch 'scalability-no-128-1000-1-1722458409'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722458409 38ec335a50] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:40:35 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:40:35 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-1-1722458409 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:41:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 21:41:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 38ec335a50 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722458511
+ git checkout -b scalability-yes-32-1000-1-1722458511
Switched to a new branch 'scalability-yes-32-1000-1-1722458511'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722458511 727bfad81a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722458511 1754873f8b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:42:18 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:42:18 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-1-1722458511 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:43:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 21:43:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1754873f8b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722458611
+ git checkout -b scalability-yes-0-1000-1-1722458611
Switched to a new branch 'scalability-yes-0-1000-1-1722458611'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722458611 23f0f7b56a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:43:58 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:43:58 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-1-1722458611 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:45:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 21:45:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 23f0f7b56a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722458712
+ git checkout -b scalability-yes-1-1000-1-1722458712
Switched to a new branch 'scalability-yes-1-1000-1-1722458712'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722458712 b519cdd1cd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722458712 ee56520a89] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:45:38 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:45:38 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-1-1722458712 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:46:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 21:46:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ee56520a89 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722458812
+ git checkout -b scalability-yes-1024-1000-1-1722458812
Switched to a new branch 'scalability-yes-1024-1000-1-1722458812'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722458812 47b920daab] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722458812 cd8a25ad95] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:47:19 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:47:19 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-1-1722458812 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:48:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 21:48:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cd8a25ad95 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722458913
+ git checkout -b scalability-yes-8-1000-1-1722458913
Switched to a new branch 'scalability-yes-8-1000-1-1722458913'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722458913 d9b8ac74e1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722458913 62a0bab9ee] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:48:59 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:48:59 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-1-1722458913 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:50:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 21:50:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 62a0bab9ee fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722459013
+ git checkout -b scalability-yes-512-1000-1-1722459013
Switched to a new branch 'scalability-yes-512-1000-1-1722459013'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722459013 09d7047e5c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722459013 138ba2bbad] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:50:39 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:50:39 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-1-1722459013 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:51:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 21:51:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 138ba2bbad fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722459113
+ git checkout -b scalability-yes-128-1000-1-1722459113
Switched to a new branch 'scalability-yes-128-1000-1-1722459113'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722459113 6d93757555] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722459113 60264146ce] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:52:20 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:52:20 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-1-1722459113 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:53:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 21:53:33 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 60264146ce fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722459213
+ git checkout -b scalability-no-32-1000-1-1722459213
Switched to a new branch 'scalability-no-32-1000-1-1722459213'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722459213 5421101a66] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:54:00 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:54:00 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-1-1722459213 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:55:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 21:55:13 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5421101a66 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722459313
+ git checkout -b scalability-no-0-1000-1-1722459313
Switched to a new branch 'scalability-no-0-1000-1-1722459313'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:55:40 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:55:40 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-1-1722459313 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:56:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 21:56:53 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722459413
+ git checkout -b scalability-no-1-1000-1-1722459413
Switched to a new branch 'scalability-no-1-1000-1-1722459413'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722459413 c017808ee6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:57:20 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:57:20 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-1-1722459413 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 21:58:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 21:58:33 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c017808ee6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722459513
+ git checkout -b scalability-no-1024-1000-1-1722459513
Switched to a new branch 'scalability-no-1024-1000-1-1722459513'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722459513 904bdc608b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 21:59:00 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 21:59:00 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-1-1722459513 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:00:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 22:00:13 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 904bdc608b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722459613
+ git checkout -b scalability-no-8-1000-1-1722459613
Switched to a new branch 'scalability-no-8-1000-1-1722459613'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722459613 9de68d6d29] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:00:40 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:00:40 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-1-1722459613 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:01:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 22:01:53 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9de68d6d29 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722459713
+ git checkout -b scalability-no-512-1000-1-1722459713
Switched to a new branch 'scalability-no-512-1000-1-1722459713'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722459713 a44e010d49] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:02:20 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:02:20 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-1-1722459713 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:03:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 22:03:33 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a44e010d49 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722459813
+ git checkout -b scalability-no-128-1000-1-1722459813
Switched to a new branch 'scalability-no-128-1000-1-1722459813'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722459813 7205737446] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:04:00 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:04:00 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-1-1722459813 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:05:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 22:05:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7205737446 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722459914
+ git checkout -b scalability-yes-32-1000-1-1722459914
Switched to a new branch 'scalability-yes-32-1000-1-1722459914'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722459914 09bb9913c7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722459914 bc748accee] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:05:41 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:05:41 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-1-1722459914 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:06:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 22:06:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bc748accee fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722460014
+ git checkout -b scalability-yes-0-1000-1-1722460014
Switched to a new branch 'scalability-yes-0-1000-1-1722460014'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722460014 5d72569562] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:07:21 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:07:21 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-1-1722460014 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:08:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 22:08:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5d72569562 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722460115
+ git checkout -b scalability-yes-1-1000-1-1722460115
Switched to a new branch 'scalability-yes-1-1000-1-1722460115'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722460115 c94751f309] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722460115 26c835d370] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:09:01 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:09:01 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-1-1722460115 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:10:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 22:10:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 26c835d370 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722460215
+ git checkout -b scalability-yes-1024-1000-1-1722460215
Switched to a new branch 'scalability-yes-1024-1000-1-1722460215'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722460215 556d3fee80] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722460215 cef9f36c8e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:10:42 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:10:42 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-1-1722460215 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:11:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 22:11:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cef9f36c8e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722460316
+ git checkout -b scalability-yes-8-1000-1-1722460316
Switched to a new branch 'scalability-yes-8-1000-1-1722460316'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722460316 85423197ba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722460316 fddbc9b342] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:12:23 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:12:23 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-1-1722460316 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:13:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 22:13:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fddbc9b342 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722460417
+ git checkout -b scalability-yes-512-1000-1-1722460417
Switched to a new branch 'scalability-yes-512-1000-1-1722460417'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722460417 67b1cf5565] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722460417 a42e4d62c2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:14:03 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:14:03 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-1-1722460417 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:15:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 22:15:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a42e4d62c2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722460517
+ git checkout -b scalability-yes-128-1000-1-1722460517
Switched to a new branch 'scalability-yes-128-1000-1-1722460517'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722460517 881d92c7e9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722460517 89ad9b365d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:15:43 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:15:43 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-1-1722460517 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:16:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 22:16:57 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 89ad9b365d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722460617
+ git checkout -b scalability-no-32-1000-1-1722460617
Switched to a new branch 'scalability-no-32-1000-1-1722460617'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722460617 5adb090652] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:17:23 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:17:23 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-1-1722460617 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:18:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 22:18:37 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5adb090652 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722460717
+ git checkout -b scalability-no-0-1000-1-1722460717
Switched to a new branch 'scalability-no-0-1000-1-1722460717'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:19:04 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:19:04 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-1-1722460717 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:20:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 22:20:17 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722460818
+ git checkout -b scalability-no-1-1000-1-1722460818
Switched to a new branch 'scalability-no-1-1000-1-1722460818'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722460818 34e7c692ce] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:20:45 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:20:45 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-1-1722460818 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:21:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 22:21:58 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 34e7c692ce fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722460919
+ git checkout -b scalability-no-1024-1000-1-1722460919
Switched to a new branch 'scalability-no-1024-1000-1-1722460919'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722460919 c64330661d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:22:25 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:22:25 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-1-1722460919 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:23:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 22:23:40 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c64330661d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722461020
+ git checkout -b scalability-no-8-1000-1-1722461020
Switched to a new branch 'scalability-no-8-1000-1-1722461020'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722461020 c1f66702a6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:24:06 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:24:06 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-1-1722461020 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:25:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 22:25:20 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c1f66702a6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722461120
+ git checkout -b scalability-no-512-1000-1-1722461120
Switched to a new branch 'scalability-no-512-1000-1-1722461120'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722461120 9d61b0dc1b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:25:47 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:25:47 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-1-1722461120 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:27:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 22:27:01 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9d61b0dc1b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722461221
+ git checkout -b scalability-no-128-1000-1-1722461221
Switched to a new branch 'scalability-no-128-1000-1-1722461221'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722461221 e58f71365b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:27:27 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:27:27 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-1-1722461221 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:28:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 22:28:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e58f71365b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722461321
+ git checkout -b scalability-yes-32-1000-1-1722461321
Switched to a new branch 'scalability-yes-32-1000-1-1722461321'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722461321 27cba7e30c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722461321 41c099cf2a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:29:07 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:29:07 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-1-1722461321 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:30:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 22:30:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 41c099cf2a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722461427
+ git checkout -b scalability-yes-0-1000-1-1722461427
Switched to a new branch 'scalability-yes-0-1000-1-1722461427'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722461427 2efe8fb83d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:30:53 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:30:53 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-1-1722461427 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:32:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 22:32:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2efe8fb83d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722461533
+ git checkout -b scalability-yes-1-1000-1-1722461533
Switched to a new branch 'scalability-yes-1-1000-1-1722461533'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722461533 283b4ff5ae] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722461533 ff1ab04163] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:32:40 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:32:40 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-1-1722461533 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:33:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 22:33:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ff1ab04163 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722461640
+ git checkout -b scalability-yes-1024-1000-1-1722461640
Switched to a new branch 'scalability-yes-1024-1000-1-1722461640'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722461640 8b4bc2f95f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722461640 c310cf4342] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:34:26 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:34:26 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-1-1722461640 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:35:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 22:35:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c310cf4342 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722461748
+ git checkout -b scalability-yes-8-1000-1-1722461748
Switched to a new branch 'scalability-yes-8-1000-1-1722461748'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722461748 4027fdc978] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722461748 f73ee6fd59] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:36:15 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:36:15 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-1-1722461748 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:37:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 22:37:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f73ee6fd59 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722461855
+ git checkout -b scalability-yes-512-1000-1-1722461855
Switched to a new branch 'scalability-yes-512-1000-1-1722461855'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722461855 48759ddf35] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722461855 3101b02186] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:38:02 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:38:02 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-1-1722461855 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:39:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 22:39:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3101b02186 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722461962
+ git checkout -b scalability-yes-128-1000-1-1722461962
Switched to a new branch 'scalability-yes-128-1000-1-1722461962'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722461962 971c22fcda] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722461962 ac23b79dbc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:39:49 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:39:49 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-1-1722461962 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:41:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 22:41:11 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ac23b79dbc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722462072
+ git checkout -b scalability-no-32-1000-1-1722462072
Switched to a new branch 'scalability-no-32-1000-1-1722462072'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722462072 e696fc6f53] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:41:38 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:41:38 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-1-1722462072 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:42:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 22:42:59 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e696fc6f53 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722462179
+ git checkout -b scalability-no-0-1000-1-1722462179
Switched to a new branch 'scalability-no-0-1000-1-1722462179'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:43:25 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:43:25 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-1-1722462179 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:44:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 22:44:45 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722462285
+ git checkout -b scalability-no-1-1000-1-1722462285
Switched to a new branch 'scalability-no-1-1000-1-1722462285'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722462285 e96522a25f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:45:11 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:45:11 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-1-1722462285 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:46:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 22:46:36 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e96522a25f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722462396
+ git checkout -b scalability-no-1024-1000-1-1722462396
Switched to a new branch 'scalability-no-1024-1000-1-1722462396'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722462396 456ac794e8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:47:02 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:47:02 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-1-1722462396 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:48:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 22:48:23 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 456ac794e8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722462503
+ git checkout -b scalability-no-8-1000-1-1722462503
Switched to a new branch 'scalability-no-8-1000-1-1722462503'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722462503 67c58007ca] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:48:49 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:48:49 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-1-1722462503 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:50:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 22:50:09 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 67c58007ca fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722462609
+ git checkout -b scalability-no-512-1000-1-1722462609
Switched to a new branch 'scalability-no-512-1000-1-1722462609'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722462609 769bb6e162] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:50:36 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:50:36 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-1-1722462609 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-1
+ env
++ date
+ echo Wed 31 Jul 22:51:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 22:51:58 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 769bb6e162 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722462718
+ git checkout -b scalability-no-128-1000-1-1722462718
Switched to a new branch 'scalability-no-128-1000-1-1722462718'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722462718 5427077879] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:52:25 BST 2024 'RUN   files: 1000  partitions: 1'
Wed 31 Jul 22:52:25 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-1-1722462718 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-1000-0
+ env
++ date
+ echo Wed 31 Jul 22:53:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 22:53:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5427077879 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722462827
+ git checkout -b scalability-yes-32-1000-0-1722462827
Switched to a new branch 'scalability-yes-32-1000-0-1722462827'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722462827 0c188f3e34] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722462827 26fb9c7020] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:54:38 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 22:54:38 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-0-1722462827 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-1000-0
+ env
++ date
+ echo Wed 31 Jul 22:55:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 22:55:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 26fb9c7020 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722462952
+ git checkout -b scalability-yes-0-1000-0-1722462952
Switched to a new branch 'scalability-yes-0-1000-0-1722462952'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722462952 10ee8b8b07] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:56:43 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 22:56:43 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-0-1722462952 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-1000-0
+ env
++ date
+ echo Wed 31 Jul 22:57:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 22:57:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 10ee8b8b07 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722463077
+ git checkout -b scalability-yes-1-1000-0-1722463077
Switched to a new branch 'scalability-yes-1-1000-0-1722463077'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722463077 6195e793c2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722463077 a7c6326bcb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 22:58:47 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 22:58:47 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-0-1722463077 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:00:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 23:00:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a7c6326bcb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722463202
+ git checkout -b scalability-yes-1024-1000-0-1722463202
Switched to a new branch 'scalability-yes-1024-1000-0-1722463202'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722463202 4870e6277c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722463202 a352387bba] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:00:55 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:00:55 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-0-1722463202 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:02:10 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 23:02:10 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a352387bba fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722463330
+ git checkout -b scalability-yes-8-1000-0-1722463330
Switched to a new branch 'scalability-yes-8-1000-0-1722463330'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722463330 556c8e5a74] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722463330 627c0cb98e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:03:00 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:03:00 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-0-1722463330 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:04:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 23:04:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 627c0cb98e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722463454
+ git checkout -b scalability-yes-512-1000-0-1722463454
Switched to a new branch 'scalability-yes-512-1000-0-1722463454'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722463454 b826f4fe83] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722463454 eb4c40dba9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:05:05 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:05:05 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-0-1722463454 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:06:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 23:06:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eb4c40dba9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722463579
+ git checkout -b scalability-yes-128-1000-0-1722463579
Switched to a new branch 'scalability-yes-128-1000-0-1722463579'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722463579 f50e8a2aaa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722463579 54b2be02ff] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:07:11 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:07:11 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-0-1722463579 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:08:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 23:08:25 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 54b2be02ff fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722463705
+ git checkout -b scalability-no-32-1000-0-1722463705
Switched to a new branch 'scalability-no-32-1000-0-1722463705'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722463705 fd90afb3ad] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:09:16 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:09:16 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-0-1722463705 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:10:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 23:10:30 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fd90afb3ad fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722463830
+ git checkout -b scalability-no-0-1000-0-1722463830
Switched to a new branch 'scalability-no-0-1000-0-1722463830'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:11:22 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:11:22 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-0-1722463830 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:12:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 23:12:36 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722463956
+ git checkout -b scalability-no-1-1000-0-1722463956
Switched to a new branch 'scalability-no-1-1000-0-1722463956'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722463956 647ae0350f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:13:27 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:13:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-0-1722463956 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:14:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 23:14:41 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 647ae0350f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722464081
+ git checkout -b scalability-no-1024-1000-0-1722464081
Switched to a new branch 'scalability-no-1024-1000-0-1722464081'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722464081 8917d02049] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:15:32 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:15:32 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-0-1722464081 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:16:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 23:16:46 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8917d02049 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722464207
+ git checkout -b scalability-no-8-1000-0-1722464207
Switched to a new branch 'scalability-no-8-1000-0-1722464207'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722464207 79db6f906c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:17:38 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:17:38 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-0-1722464207 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:18:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 23:18:52 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79db6f906c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722464332
+ git checkout -b scalability-no-512-1000-0-1722464332
Switched to a new branch 'scalability-no-512-1000-0-1722464332'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722464332 b708141c10] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:19:43 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:19:43 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-0-1722464332 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:20:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 23:20:57 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b708141c10 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722464457
+ git checkout -b scalability-no-128-1000-0-1722464457
Switched to a new branch 'scalability-no-128-1000-0-1722464457'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722464457 9891861b86] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:21:49 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:21:49 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-0-1722464457 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:23:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 23:23:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9891861b86 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722464583
+ git checkout -b scalability-yes-32-1000-0-1722464583
Switched to a new branch 'scalability-yes-32-1000-0-1722464583'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722464583 b4941a8485] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722464583 46cd6976a5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:23:29 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:23:29 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-0-1722464583 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:24:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 23:24:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 46cd6976a5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722464685
+ git checkout -b scalability-yes-0-1000-0-1722464685
Switched to a new branch 'scalability-yes-0-1000-0-1722464685'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722464685 00a83c3fc2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:25:13 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:25:13 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-0-1722464685 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:26:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 23:26:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 00a83c3fc2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722464789
+ git checkout -b scalability-yes-1-1000-0-1722464789
Switched to a new branch 'scalability-yes-1-1000-0-1722464789'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722464789 a700a1b598] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722464789 57b6122513] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:26:56 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:26:56 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-0-1722464789 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:28:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 23:28:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 57b6122513 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722464892
+ git checkout -b scalability-yes-1024-1000-0-1722464892
Switched to a new branch 'scalability-yes-1024-1000-0-1722464892'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722464892 47470a7bcf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722464892 8a7a15f8ba] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:28:39 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:28:39 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-0-1722464892 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:29:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 23:29:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8a7a15f8ba fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722464995
+ git checkout -b scalability-yes-8-1000-0-1722464995
Switched to a new branch 'scalability-yes-8-1000-0-1722464995'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722464995 df9c96c2a9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722464995 0e6a5037c3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:30:22 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:30:22 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-0-1722464995 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:31:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 23:31:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0e6a5037c3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722465098
+ git checkout -b scalability-yes-512-1000-0-1722465098
Switched to a new branch 'scalability-yes-512-1000-0-1722465098'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722465098 78ecce09d5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722465098 c6a2d429a5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:32:05 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:32:05 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-0-1722465098 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:33:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 23:33:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c6a2d429a5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722465202
+ git checkout -b scalability-yes-128-1000-0-1722465202
Switched to a new branch 'scalability-yes-128-1000-0-1722465202'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722465202 540885e448] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722465202 745c0a3583] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:33:49 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:33:49 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-0-1722465202 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:35:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 23:35:05 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 745c0a3583 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722465305
+ git checkout -b scalability-no-32-1000-0-1722465305
Switched to a new branch 'scalability-no-32-1000-0-1722465305'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722465305 924a3ef469] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:35:32 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:35:32 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-0-1722465305 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:36:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 23:36:48 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 924a3ef469 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722465408
+ git checkout -b scalability-no-0-1000-0-1722465408
Switched to a new branch 'scalability-no-0-1000-0-1722465408'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:37:15 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:37:15 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-0-1722465408 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:38:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 23:38:31 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722465511
+ git checkout -b scalability-no-1-1000-0-1722465511
Switched to a new branch 'scalability-no-1-1000-0-1722465511'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722465511 36e66b50c2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:38:57 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:38:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-0-1722465511 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:40:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 23:40:14 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 36e66b50c2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722465614
+ git checkout -b scalability-no-1024-1000-0-1722465614
Switched to a new branch 'scalability-no-1024-1000-0-1722465614'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722465614 65f1d0dae3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:40:41 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:40:41 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-0-1722465614 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:41:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 23:41:57 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 65f1d0dae3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722465717
+ git checkout -b scalability-no-8-1000-0-1722465717
Switched to a new branch 'scalability-no-8-1000-0-1722465717'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722465717 e56c2246b5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:42:23 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:42:23 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-0-1722465717 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:43:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 23:43:39 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e56c2246b5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722465820
+ git checkout -b scalability-no-512-1000-0-1722465820
Switched to a new branch 'scalability-no-512-1000-0-1722465820'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722465820 ee26607911] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:44:06 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:44:06 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-0-1722465820 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:45:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 23:45:23 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ee26607911 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722465923
+ git checkout -b scalability-no-128-1000-0-1722465923
Switched to a new branch 'scalability-no-128-1000-0-1722465923'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722465923 d8342499d0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:45:49 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:45:49 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-0-1722465923 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:47:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 23:47:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d8342499d0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722466026
+ git checkout -b scalability-yes-32-1000-0-1722466026
Switched to a new branch 'scalability-yes-32-1000-0-1722466026'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722466026 463ae1dac5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722466026 ef4c0fa928] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:47:33 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:47:33 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-0-1722466026 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:48:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 23:48:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef4c0fa928 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722466127
+ git checkout -b scalability-yes-0-1000-0-1722466127
Switched to a new branch 'scalability-yes-0-1000-0-1722466127'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722466127 cca7902ecc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:49:13 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:49:13 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-0-1722466127 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:50:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 23:50:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cca7902ecc NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722466227
+ git checkout -b scalability-yes-1-1000-0-1722466227
Switched to a new branch 'scalability-yes-1-1000-0-1722466227'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722466227 8358b7b2a9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722466227 4fdc168920] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:50:53 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:50:53 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-0-1722466227 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:52:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 23:52:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4fdc168920 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722466327
+ git checkout -b scalability-yes-1024-1000-0-1722466327
Switched to a new branch 'scalability-yes-1024-1000-0-1722466327'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722466327 25b3f59b95] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722466327 0bbec1ff59] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:52:33 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:52:33 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-0-1722466327 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:53:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 23:53:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0bbec1ff59 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722466427
+ git checkout -b scalability-yes-8-1000-0-1722466427
Switched to a new branch 'scalability-yes-8-1000-0-1722466427'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722466427 fe7d578978] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722466427 fc3bb0f5e3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:54:14 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:54:14 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-0-1722466427 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:55:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 23:55:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc3bb0f5e3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722466528
+ git checkout -b scalability-yes-512-1000-0-1722466528
Switched to a new branch 'scalability-yes-512-1000-0-1722466528'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722466528 61744d4b28] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722466528 7682e47638] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:55:54 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:55:54 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-0-1722466528 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:57:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 23:57:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7682e47638 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722466628
+ git checkout -b scalability-yes-128-1000-0-1722466628
Switched to a new branch 'scalability-yes-128-1000-0-1722466628'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722466628 367fd52ca7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722466628 4616b401ad] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:57:35 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:57:35 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-0-1722466628 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-1000-0
+ env
++ date
+ echo Wed 31 Jul 23:58:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 23:58:49 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4616b401ad fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722466729
+ git checkout -b scalability-no-32-1000-0-1722466729
Switched to a new branch 'scalability-no-32-1000-0-1722466729'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722466729 80589081ea] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 23:59:15 BST 2024 'RUN   files: 1000  partitions: 0'
Wed 31 Jul 23:59:15 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-0-1722466729 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:00:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 00:00:29 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 80589081ea fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722466830
+ git checkout -b scalability-no-0-1000-0-1722466830
Switched to a new branch 'scalability-no-0-1000-0-1722466830'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:00:56 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:00:56 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-0-1722466830 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:02:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 00:02:09 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722466930
+ git checkout -b scalability-no-1-1000-0-1722466930
Switched to a new branch 'scalability-no-1-1000-0-1722466930'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722466930 8af0d56c7b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:02:36 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:02:36 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-0-1722466930 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:03:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 00:03:49 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8af0d56c7b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722467029
+ git checkout -b scalability-no-1024-1000-0-1722467029
Switched to a new branch 'scalability-no-1024-1000-0-1722467029'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722467029 4c3959a0c5] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:04:16 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:04:16 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-0-1722467029 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:05:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 00:05:30 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c3959a0c5 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722467130
+ git checkout -b scalability-no-8-1000-0-1722467130
Switched to a new branch 'scalability-no-8-1000-0-1722467130'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722467130 b06e9cbc27] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:05:57 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:05:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-0-1722467130 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:07:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 00:07:10 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b06e9cbc27 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722467231
+ git checkout -b scalability-no-512-1000-0-1722467231
Switched to a new branch 'scalability-no-512-1000-0-1722467231'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722467231 41f11ef75d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:07:37 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:07:37 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-0-1722467231 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:08:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 00:08:51 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 41f11ef75d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722467331
+ git checkout -b scalability-no-128-1000-0-1722467331
Switched to a new branch 'scalability-no-128-1000-0-1722467331'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722467331 60aadd10de] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:09:17 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:09:17 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-0-1722467331 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:10:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 00:10:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 60aadd10de fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722467431
+ git checkout -b scalability-yes-32-1000-0-1722467431
Switched to a new branch 'scalability-yes-32-1000-0-1722467431'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722467431 1bf97d5ec9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722467431 2734a45a96] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:10:57 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:10:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-0-1722467431 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:12:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 00:12:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2734a45a96 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722467531
+ git checkout -b scalability-yes-0-1000-0-1722467531
Switched to a new branch 'scalability-yes-0-1000-0-1722467531'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722467531 f1555220d3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:12:39 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:12:39 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-0-1722467531 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:13:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 00:13:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f1555220d3 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722467634
+ git checkout -b scalability-yes-1-1000-0-1722467634
Switched to a new branch 'scalability-yes-1-1000-0-1722467634'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722467634 b8877f4249] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722467634 689724224f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:14:21 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:14:21 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-0-1722467634 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:15:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 00:15:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 689724224f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722467734
+ git checkout -b scalability-yes-1024-1000-0-1722467734
Switched to a new branch 'scalability-yes-1024-1000-0-1722467734'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722467734 03aee8fd98] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722467734 2f97dd0825] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:16:01 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:16:01 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-0-1722467734 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:17:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 00:17:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2f97dd0825 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722467835
+ git checkout -b scalability-yes-8-1000-0-1722467835
Switched to a new branch 'scalability-yes-8-1000-0-1722467835'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722467835 ff1586026a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722467835 6536fa0339] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:17:41 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:17:41 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-0-1722467835 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:18:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 00:18:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6536fa0339 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722467935
+ git checkout -b scalability-yes-512-1000-0-1722467935
Switched to a new branch 'scalability-yes-512-1000-0-1722467935'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722467935 195b26e936] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722467935 dbdc7ef0a0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:19:22 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:19:22 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-0-1722467935 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:20:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 00:20:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dbdc7ef0a0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722468036
+ git checkout -b scalability-yes-128-1000-0-1722468036
Switched to a new branch 'scalability-yes-128-1000-0-1722468036'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722468036 89aaebf8a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722468036 239d1e948b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:21:03 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:21:03 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-0-1722468036 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:22:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 00:22:16 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 239d1e948b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722468136
+ git checkout -b scalability-no-32-1000-0-1722468136
Switched to a new branch 'scalability-no-32-1000-0-1722468136'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722468136 a40c782961] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:22:44 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:22:44 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-0-1722468136 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:23:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 00:23:59 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a40c782961 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722468239
+ git checkout -b scalability-no-0-1000-0-1722468239
Switched to a new branch 'scalability-no-0-1000-0-1722468239'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:24:25 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:24:25 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-0-1722468239 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:25:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 00:25:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722468339
+ git checkout -b scalability-no-1-1000-0-1722468339
Switched to a new branch 'scalability-no-1-1000-0-1722468339'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722468339 d5314c99b2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:26:06 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:26:06 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-0-1722468339 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:27:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 00:27:19 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d5314c99b2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722468440
+ git checkout -b scalability-no-1024-1000-0-1722468440
Switched to a new branch 'scalability-no-1024-1000-0-1722468440'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722468440 019dc0e5ff] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:27:46 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:27:46 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-0-1722468440 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:29:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 00:29:00 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 019dc0e5ff fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722468540
+ git checkout -b scalability-no-8-1000-0-1722468540
Switched to a new branch 'scalability-no-8-1000-0-1722468540'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722468540 82d3c94cf8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:29:27 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:29:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-0-1722468540 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:30:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 00:30:41 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 82d3c94cf8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722468641
+ git checkout -b scalability-no-512-1000-0-1722468641
Switched to a new branch 'scalability-no-512-1000-0-1722468641'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722468641 42503ebea2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:31:07 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:31:07 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-0-1722468641 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:32:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 00:32:21 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 42503ebea2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722468741
+ git checkout -b scalability-no-128-1000-0-1722468741
Switched to a new branch 'scalability-no-128-1000-0-1722468741'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722468741 b92d081839] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:32:48 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:32:48 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-0-1722468741 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:34:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 00:34:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b92d081839 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722468842
+ git checkout -b scalability-yes-32-1000-0-1722468842
Switched to a new branch 'scalability-yes-32-1000-0-1722468842'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722468842 6956813d08] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722468842 7970c67512] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:34:28 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:34:28 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-0-1722468842 1000 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:34:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 00:34:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7970c67512 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722468871
+ git checkout -b scalability-yes-0-1000-0-1722468871
Switched to a new branch 'scalability-yes-0-1000-0-1722468871'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722468871 1adb5e1564] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:34:59 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:34:59 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-0-1722468871 1000 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:35:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 00:35:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1adb5e1564 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722468902
+ git checkout -b scalability-yes-1-1000-0-1722468902
Switched to a new branch 'scalability-yes-1-1000-0-1722468902'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722468902 f3d0a92122] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722468902 d58d3c2cae] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:35:29 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:35:29 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-0-1722468902 1000 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:35:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 00:35:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d58d3c2cae fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722468932
+ git checkout -b scalability-yes-1024-1000-0-1722468932
Switched to a new branch 'scalability-yes-1024-1000-0-1722468932'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722468932 95f302aa5a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722468932 0eade5f4ff] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:35:59 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:35:59 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-0-1722468932 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:36:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 00:36:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0eade5f4ff fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722468963
+ git checkout -b scalability-yes-8-1000-0-1722468963
Switched to a new branch 'scalability-yes-8-1000-0-1722468963'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722468963 0299e3fcc4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722468963 4d8a16bac2] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:36:32 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:36:32 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-0-1722468963 1000 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:36:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 00:36:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4d8a16bac2 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722468995
+ git checkout -b scalability-yes-512-1000-0-1722468995
Switched to a new branch 'scalability-yes-512-1000-0-1722468995'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722468995 518bd896cd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722468995 1d15f10d8d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:37:03 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:37:03 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-0-1722468995 1000 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:37:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 00:37:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1d15f10d8d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722469026
+ git checkout -b scalability-yes-128-1000-0-1722469026
Switched to a new branch 'scalability-yes-128-1000-0-1722469026'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722469026 460e952fab] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722469026 fe4b6d0e86] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:37:33 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:37:33 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-0-1722469026 1000 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:37:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 00:37:36 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fe4b6d0e86 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722469056
+ git checkout -b scalability-no-32-1000-0-1722469056
Switched to a new branch 'scalability-no-32-1000-0-1722469056'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722469056 60fad43592] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:38:02 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:38:02 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-0-1722469056 1000 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:38:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 00:38:06 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 60fad43592 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722469086
+ git checkout -b scalability-no-0-1000-0-1722469086
Switched to a new branch 'scalability-no-0-1000-0-1722469086'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:38:33 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:38:33 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-0-1722469086 1000 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:38:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 00:38:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722469119
+ git checkout -b scalability-no-1-1000-0-1722469119
Switched to a new branch 'scalability-no-1-1000-0-1722469119'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722469119 10f4d6d9a2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:39:06 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:39:06 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-0-1722469119 1000 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:39:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 00:39:10 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 10f4d6d9a2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722469150
+ git checkout -b scalability-no-1024-1000-0-1722469150
Switched to a new branch 'scalability-no-1024-1000-0-1722469150'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722469150 4b90dac8a0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:39:37 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:39:37 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-0-1722469150 1000 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:39:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 00:39:41 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4b90dac8a0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722469181
+ git checkout -b scalability-no-8-1000-0-1722469181
Switched to a new branch 'scalability-no-8-1000-0-1722469181'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722469181 ef61a10a1c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:40:11 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:40:11 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-0-1722469181 1000 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:40:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 00:40:14 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef61a10a1c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722469214
+ git checkout -b scalability-no-512-1000-0-1722469214
Switched to a new branch 'scalability-no-512-1000-0-1722469214'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722469214 f30ad63853] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:40:42 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:40:42 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-0-1722469214 1000 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-1000-0
+ env
++ date
+ echo Thu 1 Aug 00:40:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 00:40:45 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f30ad63853 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722469245
+ git checkout -b scalability-no-128-1000-0-1722469245
Switched to a new branch 'scalability-no-128-1000-0-1722469245'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722469245 4c41211708] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:41:13 BST 2024 'RUN   files: 1000  partitions: 0'
Thu 1 Aug 00:41:13 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-0-1722469245 1000 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:41:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 00:41:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c41211708 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722469276
+ git checkout -b scalability-yes-32-32768-1000-1722469276
Switched to a new branch 'scalability-yes-32-32768-1000-1722469276'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722469276 c71e963145] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722469276 9806319255] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:42:09 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:42:09 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-1000-1722469276 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:43:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 00:43:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9806319255 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722469418
+ git checkout -b scalability-yes-0-32768-1000-1722469418
Switched to a new branch 'scalability-yes-0-32768-1000-1722469418'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722469418 c2b2be9603] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:44:29 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:44:29 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-1000-1722469418 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:45:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 00:45:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c2b2be9603 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722469556
+ git checkout -b scalability-yes-1-32768-1000-1722469556
Switched to a new branch 'scalability-yes-1-32768-1000-1722469556'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722469556 c476201daa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722469556 be219e298c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:46:48 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:46:48 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-1000-1722469556 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:48:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 00:48:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at be219e298c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722469697
+ git checkout -b scalability-yes-1024-32768-1000-1722469697
Switched to a new branch 'scalability-yes-1024-32768-1000-1722469697'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722469697 49bc30805f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722469697 2e859e2702] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:49:10 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:49:10 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-1000-1722469697 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:50:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 00:50:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2e859e2702 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722469839
+ git checkout -b scalability-yes-8-32768-1000-1722469839
Switched to a new branch 'scalability-yes-8-32768-1000-1722469839'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722469839 25c658b13b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722469839 38d3042f0a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:51:30 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:51:30 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-1000-1722469839 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:52:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 00:52:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 38d3042f0a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722469978
+ git checkout -b scalability-yes-512-32768-1000-1722469978
Switched to a new branch 'scalability-yes-512-32768-1000-1722469978'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722469978 50a6abcb5d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722469978 da2e28fe24] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:53:50 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:53:50 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-1000-1722469978 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:55:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 00:55:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at da2e28fe24 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722470118
+ git checkout -b scalability-yes-128-32768-1000-1722470118
Switched to a new branch 'scalability-yes-128-32768-1000-1722470118'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722470118 d0a066e314] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722470118 ba4bd384c0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:56:10 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:56:10 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-1000-1722470118 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:57:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 00:57:37 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ba4bd384c0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722470258
+ git checkout -b scalability-no-32-32768-1000-1722470258
Switched to a new branch 'scalability-no-32-32768-1000-1722470258'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722470258 a15e600fbf] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 00:58:30 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 00:58:30 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-1000-1722470258 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 00:59:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 00:59:58 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a15e600fbf fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722470398
+ git checkout -b scalability-no-0-32768-1000-1722470398
Switched to a new branch 'scalability-no-0-32768-1000-1722470398'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:00:49 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:00:49 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-1000-1722470398 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:02:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 01:02:18 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722470538
+ git checkout -b scalability-no-1-32768-1000-1722470538
Switched to a new branch 'scalability-no-1-32768-1000-1722470538'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722470538 434a907e4c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:03:11 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:03:11 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-1000-1722470538 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:04:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 01:04:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 434a907e4c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722470679
+ git checkout -b scalability-no-1024-32768-1000-1722470679
Switched to a new branch 'scalability-no-1024-32768-1000-1722470679'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722470679 dbcbd97254] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:05:31 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:05:31 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-1000-1722470679 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:06:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 01:06:59 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dbcbd97254 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722470819
+ git checkout -b scalability-no-8-32768-1000-1722470819
Switched to a new branch 'scalability-no-8-32768-1000-1722470819'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722470819 d31cdc118d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:07:51 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:07:51 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-1000-1722470819 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:09:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 01:09:19 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d31cdc118d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722470959
+ git checkout -b scalability-no-512-32768-1000-1722470959
Switched to a new branch 'scalability-no-512-32768-1000-1722470959'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722470959 46332dad17] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:10:11 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:10:11 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-1000-1722470959 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:11:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 01:11:39 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 46332dad17 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722471099
+ git checkout -b scalability-no-128-32768-1000-1722471099
Switched to a new branch 'scalability-no-128-32768-1000-1722471099'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722471099 0ae58a1324] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:12:31 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:12:31 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-1000-1722471099 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:13:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 01:13:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0ae58a1324 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722471239
+ git checkout -b scalability-yes-32-32768-1000-1722471239
Switched to a new branch 'scalability-yes-32-32768-1000-1722471239'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722471239 ad19c95951] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722471239 91567fcf66] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:14:26 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:14:26 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-1000-1722471239 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:16:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 01:16:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 91567fcf66 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722471375
+ git checkout -b scalability-yes-0-32768-1000-1722471375
Switched to a new branch 'scalability-yes-0-32768-1000-1722471375'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722471375 0022255eed] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:16:42 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:16:42 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-1000-1722471375 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:18:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 01:18:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0022255eed NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722471511
+ git checkout -b scalability-yes-1-32768-1000-1722471511
Switched to a new branch 'scalability-yes-1-32768-1000-1722471511'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722471511 162165e84b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722471511 f369849627] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:18:59 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:18:59 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-1000-1722471511 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:20:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 01:20:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f369849627 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722471647
+ git checkout -b scalability-yes-1024-32768-1000-1722471647
Switched to a new branch 'scalability-yes-1024-32768-1000-1722471647'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722471647 2c195360c0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722471647 7d19355ed3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:21:14 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:21:14 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-1000-1722471647 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:23:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 01:23:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7d19355ed3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722471783
+ git checkout -b scalability-yes-8-32768-1000-1722471783
Switched to a new branch 'scalability-yes-8-32768-1000-1722471783'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722471783 884333f3a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722471783 185715ad11] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:23:30 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:23:30 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-1000-1722471783 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:25:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 01:25:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 185715ad11 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722471913
+ git checkout -b scalability-yes-512-32768-1000-1722471913
Switched to a new branch 'scalability-yes-512-32768-1000-1722471913'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722471913 c9cff441e2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722471913 308d2e043a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:25:41 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:25:41 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-1000-1722471913 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:27:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 01:27:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 308d2e043a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722472044
+ git checkout -b scalability-yes-128-32768-1000-1722472044
Switched to a new branch 'scalability-yes-128-32768-1000-1722472044'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722472044 3f892a350d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722472044 6db5690cfa] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:27:51 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:27:51 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-1000-1722472044 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:29:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 01:29:34 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6db5690cfa fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722472175
+ git checkout -b scalability-no-32-32768-1000-1722472175
Switched to a new branch 'scalability-no-32-32768-1000-1722472175'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722472175 56ec338193] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:30:02 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:30:02 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-1000-1722472175 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:31:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 01:31:47 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 56ec338193 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722472307
+ git checkout -b scalability-no-0-32768-1000-1722472307
Switched to a new branch 'scalability-no-0-32768-1000-1722472307'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:32:14 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:32:14 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-1000-1722472307 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:33:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 01:33:58 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722472438
+ git checkout -b scalability-no-1-32768-1000-1722472438
Switched to a new branch 'scalability-no-1-32768-1000-1722472438'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722472438 2f65b94402] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:34:25 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:34:25 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-1000-1722472438 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:36:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 01:36:11 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2f65b94402 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722472571
+ git checkout -b scalability-no-1024-32768-1000-1722472571
Switched to a new branch 'scalability-no-1024-32768-1000-1722472571'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722472571 d455909135] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:36:38 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:36:38 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-1000-1722472571 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:38:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 01:38:26 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d455909135 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722472706
+ git checkout -b scalability-no-8-32768-1000-1722472706
Switched to a new branch 'scalability-no-8-32768-1000-1722472706'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722472706 a9c555059f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:38:53 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:38:53 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-1000-1722472706 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:40:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 01:40:37 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a9c555059f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722472837
+ git checkout -b scalability-no-512-32768-1000-1722472837
Switched to a new branch 'scalability-no-512-32768-1000-1722472837'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722472837 404370113e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:41:04 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:41:04 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-1000-1722472837 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:42:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 01:42:45 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 404370113e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722472965
+ git checkout -b scalability-no-128-32768-1000-1722472965
Switched to a new branch 'scalability-no-128-32768-1000-1722472965'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722472965 34c2a01b32] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:43:12 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:43:12 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-1000-1722472965 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:44:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 01:44:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 34c2a01b32 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722473097
+ git checkout -b scalability-yes-32-32768-1000-1722473097
Switched to a new branch 'scalability-yes-32-32768-1000-1722473097'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722473097 3d00b8adce] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722473097 1ba927f128] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:45:24 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:45:24 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-1000-1722473097 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:46:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 01:46:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1ba927f128 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722473208
+ git checkout -b scalability-yes-0-32768-1000-1722473208
Switched to a new branch 'scalability-yes-0-32768-1000-1722473208'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722473208 4bc5f3965b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:47:15 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:47:15 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-1000-1722473208 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:48:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 01:48:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4bc5f3965b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722473320
+ git checkout -b scalability-yes-1-32768-1000-1722473320
Switched to a new branch 'scalability-yes-1-32768-1000-1722473320'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722473320 099d79cc4c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722473320 42d4d44080] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:49:07 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:49:07 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-1000-1722473320 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:50:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 01:50:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 42d4d44080 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722473433
+ git checkout -b scalability-yes-1024-32768-1000-1722473433
Switched to a new branch 'scalability-yes-1024-32768-1000-1722473433'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722473433 ca07a50eaf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722473433 ae8b9288b1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:51:01 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:51:01 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-1000-1722473433 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:52:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 01:52:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ae8b9288b1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722473546
+ git checkout -b scalability-yes-8-32768-1000-1722473546
Switched to a new branch 'scalability-yes-8-32768-1000-1722473546'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722473546 997ce326ed] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722473546 1d52ef0ea3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:52:53 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:52:53 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-1000-1722473546 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:54:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 01:54:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1d52ef0ea3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722473660
+ git checkout -b scalability-yes-512-32768-1000-1722473660
Switched to a new branch 'scalability-yes-512-32768-1000-1722473660'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722473660 d1e796ea46] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722473660 3a8781693b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:54:47 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:54:47 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-1000-1722473660 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:56:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 01:56:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3a8781693b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722473774
+ git checkout -b scalability-yes-128-32768-1000-1722473774
Switched to a new branch 'scalability-yes-128-32768-1000-1722473774'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722473774 a3fe84285c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722473774 3fb32cbbd4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:56:40 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:56:40 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-1000-1722473774 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:58:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 01:58:06 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3fb32cbbd4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722473886
+ git checkout -b scalability-no-32-32768-1000-1722473886
Switched to a new branch 'scalability-no-32-32768-1000-1722473886'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722473886 f944e7c4d5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 01:58:33 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 01:58:33 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-1000-1722473886 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 01:59:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 01:59:58 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f944e7c4d5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722473998
+ git checkout -b scalability-no-0-32768-1000-1722473998
Switched to a new branch 'scalability-no-0-32768-1000-1722473998'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:00:25 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:00:25 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-1000-1722473998 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:01:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 02:01:49 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722474109
+ git checkout -b scalability-no-1-32768-1000-1722474109
Switched to a new branch 'scalability-no-1-32768-1000-1722474109'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722474109 a9f035248d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:02:16 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:02:16 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-1000-1722474109 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:03:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 02:03:41 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a9f035248d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722474221
+ git checkout -b scalability-no-1024-32768-1000-1722474221
Switched to a new branch 'scalability-no-1024-32768-1000-1722474221'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722474221 eb1ff8cbd8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:04:08 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:04:08 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-1000-1722474221 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:05:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 02:05:33 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eb1ff8cbd8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722474333
+ git checkout -b scalability-no-8-32768-1000-1722474333
Switched to a new branch 'scalability-no-8-32768-1000-1722474333'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722474333 16eaa709c5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:06:00 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:06:00 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-1000-1722474333 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:07:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 02:07:26 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 16eaa709c5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722474446
+ git checkout -b scalability-no-512-32768-1000-1722474446
Switched to a new branch 'scalability-no-512-32768-1000-1722474446'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722474446 3b23507edc] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:07:54 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:07:54 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-1000-1722474446 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:09:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 02:09:19 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3b23507edc fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722474559
+ git checkout -b scalability-no-128-32768-1000-1722474559
Switched to a new branch 'scalability-no-128-32768-1000-1722474559'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722474559 71f5c4baf1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:09:46 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:09:46 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-1000-1722474559 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:11:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 02:11:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 71f5c4baf1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722474671
+ git checkout -b scalability-yes-32-32768-1000-1722474671
Switched to a new branch 'scalability-yes-32-32768-1000-1722474671'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722474671 dfec0a6e42] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722474671 3056a3e7b0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:11:38 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:11:38 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-1000-1722474671 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:13:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 02:13:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3056a3e7b0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722474789
+ git checkout -b scalability-yes-0-32768-1000-1722474789
Switched to a new branch 'scalability-yes-0-32768-1000-1722474789'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722474789 bb4fca1d3a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:13:37 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:13:37 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-1000-1722474789 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:15:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 02:15:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bb4fca1d3a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722474902
+ git checkout -b scalability-yes-1-32768-1000-1722474902
Switched to a new branch 'scalability-yes-1-32768-1000-1722474902'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722474902 030d61d2c7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722474902 d9497c34f9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:15:29 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:15:29 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-1000-1722474902 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:16:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 02:16:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d9497c34f9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722475015
+ git checkout -b scalability-yes-1024-32768-1000-1722475015
Switched to a new branch 'scalability-yes-1024-32768-1000-1722475015'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722475015 901182901a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722475015 4dea1cc56e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:17:22 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:17:22 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-1000-1722475015 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:18:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 02:18:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4dea1cc56e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722475127
+ git checkout -b scalability-yes-8-32768-1000-1722475127
Switched to a new branch 'scalability-yes-8-32768-1000-1722475127'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722475127 d844144f3f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722475127 a7c7f8ff44] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:19:14 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:19:14 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-1000-1722475127 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:20:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 02:20:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a7c7f8ff44 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722475240
+ git checkout -b scalability-yes-512-32768-1000-1722475240
Switched to a new branch 'scalability-yes-512-32768-1000-1722475240'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722475240 040edd6045] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722475240 bb39832437] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:21:07 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:21:07 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-1000-1722475240 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:22:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 02:22:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bb39832437 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722475352
+ git checkout -b scalability-yes-128-32768-1000-1722475352
Switched to a new branch 'scalability-yes-128-32768-1000-1722475352'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722475352 f689aac986] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722475352 245c69c76f] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:22:59 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:22:59 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-1000-1722475352 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:24:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 02:24:32 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 245c69c76f fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722475472
+ git checkout -b scalability-no-32-32768-1000-1722475472
Switched to a new branch 'scalability-no-32-32768-1000-1722475472'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722475472 c2fc917a09] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:24:59 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:24:59 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-1000-1722475472 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:26:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 02:26:24 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c2fc917a09 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722475584
+ git checkout -b scalability-no-0-32768-1000-1722475584
Switched to a new branch 'scalability-no-0-32768-1000-1722475584'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:26:51 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:26:51 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-1000-1722475584 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:28:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 02:28:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722475696
+ git checkout -b scalability-no-1-32768-1000-1722475696
Switched to a new branch 'scalability-no-1-32768-1000-1722475696'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722475696 4b212fb787] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:28:43 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:28:43 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-1000-1722475696 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:30:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 02:30:07 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4b212fb787 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722475807
+ git checkout -b scalability-no-1024-32768-1000-1722475807
Switched to a new branch 'scalability-no-1024-32768-1000-1722475807'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722475807 4859fe6e3f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:30:34 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:30:34 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-1000-1722475807 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:32:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 02:32:02 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4859fe6e3f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722475922
+ git checkout -b scalability-no-8-32768-1000-1722475922
Switched to a new branch 'scalability-no-8-32768-1000-1722475922'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722475922 ac85385881] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:32:30 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:32:30 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-1000-1722475922 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:33:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 02:33:55 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ac85385881 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722476035
+ git checkout -b scalability-no-512-32768-1000-1722476035
Switched to a new branch 'scalability-no-512-32768-1000-1722476035'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722476035 28e66ef360] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:34:22 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:34:22 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-1000-1722476035 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:35:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 02:35:47 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 28e66ef360 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722476147
+ git checkout -b scalability-no-128-32768-1000-1722476147
Switched to a new branch 'scalability-no-128-32768-1000-1722476147'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722476147 28ce15a8b6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:36:14 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:36:14 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-1000-1722476147 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:37:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 02:37:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 28ce15a8b6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722476258
+ git checkout -b scalability-yes-32-32768-1000-1722476258
Switched to a new branch 'scalability-yes-32-32768-1000-1722476258'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722476258 ee0ab11ffd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722476258 60bbaa6ecb] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:38:05 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:38:05 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-1000-1722476258 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:38:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 02:38:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 60bbaa6ecb fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722476289
+ git checkout -b scalability-yes-0-32768-1000-1722476289
Switched to a new branch 'scalability-yes-0-32768-1000-1722476289'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722476289 89796303eb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:38:38 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:38:38 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-1000-1722476289 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:38:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 02:38:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 89796303eb NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722476321
+ git checkout -b scalability-yes-1-32768-1000-1722476321
Switched to a new branch 'scalability-yes-1-32768-1000-1722476321'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722476321 0538b979ea] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722476321 b779460ac8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:39:08 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:39:08 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-1000-1722476321 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:39:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 02:39:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b779460ac8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722476352
+ git checkout -b scalability-yes-1024-32768-1000-1722476352
Switched to a new branch 'scalability-yes-1024-32768-1000-1722476352'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722476352 0f50d795b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722476352 8e470b034a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:39:38 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:39:38 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-1000-1722476352 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:39:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 02:39:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8e470b034a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722476382
+ git checkout -b scalability-yes-8-32768-1000-1722476382
Switched to a new branch 'scalability-yes-8-32768-1000-1722476382'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722476382 08f292c2c4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722476382 6cbab4079b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:40:09 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:40:09 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-1000-1722476382 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:40:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 02:40:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6cbab4079b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722476412
+ git checkout -b scalability-yes-512-32768-1000-1722476412
Switched to a new branch 'scalability-yes-512-32768-1000-1722476412'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722476412 def70d1d96] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722476412 c3a2fc80f9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:40:41 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:40:41 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-1000-1722476412 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:40:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 02:40:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c3a2fc80f9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722476444
+ git checkout -b scalability-yes-128-32768-1000-1722476444
Switched to a new branch 'scalability-yes-128-32768-1000-1722476444'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722476444 3dec0e3667] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722476444 2d05bbf9d0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:41:11 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:41:11 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-1000-1722476444 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:41:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 02:41:15 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2d05bbf9d0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722476475
+ git checkout -b scalability-no-32-32768-1000-1722476475
Switched to a new branch 'scalability-no-32-32768-1000-1722476475'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722476475 4558214827] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:41:43 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:41:43 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-1000-1722476475 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:41:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 02:41:46 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4558214827 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722476506
+ git checkout -b scalability-no-0-32768-1000-1722476506
Switched to a new branch 'scalability-no-0-32768-1000-1722476506'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:42:15 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:42:15 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-1000-1722476506 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:42:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 02:42:18 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722476539
+ git checkout -b scalability-no-1-32768-1000-1722476539
Switched to a new branch 'scalability-no-1-32768-1000-1722476539'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722476539 c4e84ecabb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:42:46 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:42:46 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-1000-1722476539 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:42:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 02:42:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c4e84ecabb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722476570
+ git checkout -b scalability-no-1024-32768-1000-1722476570
Switched to a new branch 'scalability-no-1024-32768-1000-1722476570'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722476570 43785644fe] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:43:17 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:43:17 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-1000-1722476570 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:43:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 02:43:21 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 43785644fe fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722476601
+ git checkout -b scalability-no-8-32768-1000-1722476601
Switched to a new branch 'scalability-no-8-32768-1000-1722476601'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722476601 15f395fad1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:43:49 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:43:49 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-1000-1722476601 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:43:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 02:43:52 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 15f395fad1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722476632
+ git checkout -b scalability-no-512-32768-1000-1722476632
Switched to a new branch 'scalability-no-512-32768-1000-1722476632'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722476632 a8253b9f1c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:44:19 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:44:19 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-1000-1722476632 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-1000
+ env
++ date
+ echo Thu 1 Aug 02:44:22 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 02:44:22 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a8253b9f1c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722476662
+ git checkout -b scalability-no-128-32768-1000-1722476662
Switched to a new branch 'scalability-no-128-32768-1000-1722476662'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722476662 f4b189cb2e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:44:49 BST 2024 'RUN   files: 32768  partitions: 1000'
Thu 1 Aug 02:44:49 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-1000-1722476662 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:44:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 02:44:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f4b189cb2e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722476692
+ git checkout -b scalability-yes-32-32768-100-1722476692
Switched to a new branch 'scalability-yes-32-32768-100-1722476692'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722476692 aa8ef4449f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722476692 d15df29d1f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:45:44 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:45:44 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-100-1722476692 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:46:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 02:46:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d15df29d1f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722476819
+ git checkout -b scalability-yes-0-32768-100-1722476819
Switched to a new branch 'scalability-yes-0-32768-100-1722476819'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722476819 f14dbb48b0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:47:50 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:47:50 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-100-1722476819 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:49:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 02:49:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f14dbb48b0 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722476946
+ git checkout -b scalability-yes-1-32768-100-1722476946
Switched to a new branch 'scalability-yes-1-32768-100-1722476946'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722476946 5b21f3e31a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722476946 088270a622] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:49:57 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:49:57 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-100-1722476946 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:51:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 02:51:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 088270a622 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722477074
+ git checkout -b scalability-yes-1024-32768-100-1722477074
Switched to a new branch 'scalability-yes-1024-32768-100-1722477074'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722477074 487d5ed77d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722477074 d435c9de18] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:52:05 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:52:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-100-1722477074 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:53:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 02:53:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d435c9de18 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722477201
+ git checkout -b scalability-yes-8-32768-100-1722477201
Switched to a new branch 'scalability-yes-8-32768-100-1722477201'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722477201 7a5bf00ad4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722477201 15b14b1579] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:54:12 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:54:12 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-100-1722477201 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:55:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 02:55:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 15b14b1579 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722477328
+ git checkout -b scalability-yes-512-32768-100-1722477328
Switched to a new branch 'scalability-yes-512-32768-100-1722477328'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722477328 816aaf4e52] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722477328 e4fe1357e3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:56:19 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:56:19 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-100-1722477328 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:57:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 02:57:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e4fe1357e3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722477454
+ git checkout -b scalability-yes-128-32768-100-1722477454
Switched to a new branch 'scalability-yes-128-32768-100-1722477454'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722477454 ee9f688247] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722477454 d30aea42ed] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 02:58:25 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 02:58:25 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-100-1722477454 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 02:59:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 02:59:41 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d30aea42ed fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722477581
+ git checkout -b scalability-no-32-32768-100-1722477581
Switched to a new branch 'scalability-no-32-32768-100-1722477581'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722477581 36aec08d3b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:00:33 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:00:33 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-100-1722477581 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:01:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 03:01:48 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 36aec08d3b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722477708
+ git checkout -b scalability-no-0-32768-100-1722477708
Switched to a new branch 'scalability-no-0-32768-100-1722477708'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:02:39 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:02:39 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-100-1722477708 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:03:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 03:03:54 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722477834
+ git checkout -b scalability-no-1-32768-100-1722477834
Switched to a new branch 'scalability-no-1-32768-100-1722477834'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722477834 e48cd78237] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:04:45 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:04:45 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-100-1722477834 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:06:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 03:06:00 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e48cd78237 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722477960
+ git checkout -b scalability-no-1024-32768-100-1722477960
Switched to a new branch 'scalability-no-1024-32768-100-1722477960'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722477960 9d03511f2b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:06:51 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:06:51 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-100-1722477960 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:08:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 03:08:06 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9d03511f2b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722478086
+ git checkout -b scalability-no-8-32768-100-1722478086
Switched to a new branch 'scalability-no-8-32768-100-1722478086'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722478086 365c3cb415] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:08:57 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:08:57 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-100-1722478086 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:10:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 03:10:12 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 365c3cb415 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722478213
+ git checkout -b scalability-no-512-32768-100-1722478213
Switched to a new branch 'scalability-no-512-32768-100-1722478213'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722478213 cff556f43e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:11:03 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:11:03 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-100-1722478213 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:12:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 03:12:19 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cff556f43e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722478340
+ git checkout -b scalability-no-128-32768-100-1722478340
Switched to a new branch 'scalability-no-128-32768-100-1722478340'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722478340 9804c1281d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:13:12 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:13:12 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-100-1722478340 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:14:28 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 03:14:28 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9804c1281d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722478468
+ git checkout -b scalability-yes-32-32768-100-1722478468
Switched to a new branch 'scalability-yes-32-32768-100-1722478468'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722478468 8101922503] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722478468 55bfac7d7e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:14:55 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:14:55 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-100-1722478468 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:16:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 03:16:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 55bfac7d7e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722478576
+ git checkout -b scalability-yes-0-32768-100-1722478576
Switched to a new branch 'scalability-yes-0-32768-100-1722478576'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722478576 f905e1030f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:16:43 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:16:43 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-100-1722478576 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:18:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 03:18:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f905e1030f NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722478682
+ git checkout -b scalability-yes-1-32768-100-1722478682
Switched to a new branch 'scalability-yes-1-32768-100-1722478682'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722478682 991a753b21] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722478682 c745baf4f7] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:18:29 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:18:29 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-100-1722478682 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:19:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 03:19:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c745baf4f7 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722478791
+ git checkout -b scalability-yes-1024-32768-100-1722478791
Switched to a new branch 'scalability-yes-1024-32768-100-1722478791'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722478791 39fa7ee060] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722478791 137a025e21] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:20:18 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:20:18 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-100-1722478791 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:21:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 03:21:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 137a025e21 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722478897
+ git checkout -b scalability-yes-8-32768-100-1722478897
Switched to a new branch 'scalability-yes-8-32768-100-1722478897'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722478897 ee09bff56a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722478897 6206bd8ab7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:22:04 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:22:04 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-100-1722478897 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:23:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 03:23:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6206bd8ab7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722479004
+ git checkout -b scalability-yes-512-32768-100-1722479004
Switched to a new branch 'scalability-yes-512-32768-100-1722479004'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722479004 e9c7edb712] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722479004 f628004597] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:23:51 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:23:51 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-100-1722479004 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:25:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 03:25:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f628004597 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722479112
+ git checkout -b scalability-yes-128-32768-100-1722479112
Switched to a new branch 'scalability-yes-128-32768-100-1722479112'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722479112 c92ee4a32a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722479112 575df6829b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:25:39 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:25:39 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-100-1722479112 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:26:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 03:26:58 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 575df6829b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722479218
+ git checkout -b scalability-no-32-32768-100-1722479218
Switched to a new branch 'scalability-no-32-32768-100-1722479218'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722479218 0478ad163f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:27:26 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:27:26 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-100-1722479218 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:28:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 03:28:44 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0478ad163f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722479325
+ git checkout -b scalability-no-0-32768-100-1722479325
Switched to a new branch 'scalability-no-0-32768-100-1722479325'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:29:11 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:29:11 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-100-1722479325 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:30:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 03:30:30 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722479431
+ git checkout -b scalability-no-1-32768-100-1722479431
Switched to a new branch 'scalability-no-1-32768-100-1722479431'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722479431 86877af648] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:30:57 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:30:57 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-100-1722479431 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:32:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 03:32:18 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 86877af648 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722479539
+ git checkout -b scalability-no-1024-32768-100-1722479539
Switched to a new branch 'scalability-no-1024-32768-100-1722479539'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722479539 eb5477e0c7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:32:46 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:32:46 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-100-1722479539 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:34:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 03:34:04 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eb5477e0c7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722479645
+ git checkout -b scalability-no-8-32768-100-1722479645
Switched to a new branch 'scalability-no-8-32768-100-1722479645'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722479645 5181a4aa11] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:34:31 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:34:31 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-100-1722479645 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:35:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 03:35:50 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5181a4aa11 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722479750
+ git checkout -b scalability-no-512-32768-100-1722479750
Switched to a new branch 'scalability-no-512-32768-100-1722479750'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722479750 fb578e92a8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:36:18 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:36:18 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-100-1722479750 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:37:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 03:37:39 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fb578e92a8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722479859
+ git checkout -b scalability-no-128-32768-100-1722479859
Switched to a new branch 'scalability-no-128-32768-100-1722479859'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722479859 2be6b412d1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:38:07 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:38:07 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-100-1722479859 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:39:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 03:39:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2be6b412d1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722479970
+ git checkout -b scalability-yes-32-32768-100-1722479970
Switched to a new branch 'scalability-yes-32-32768-100-1722479970'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722479970 cdfdedc6ea] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722479970 c16933b4ab] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:39:57 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:39:57 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-100-1722479970 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:41:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 03:41:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c16933b4ab fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722480071
+ git checkout -b scalability-yes-0-32768-100-1722480071
Switched to a new branch 'scalability-yes-0-32768-100-1722480071'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722480071 dd0f0df414] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:41:38 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:41:38 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-100-1722480071 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:42:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 03:42:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dd0f0df414 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722480173
+ git checkout -b scalability-yes-1-32768-100-1722480173
Switched to a new branch 'scalability-yes-1-32768-100-1722480173'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722480173 0dae43262f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722480173 44f382eab0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:43:19 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:43:19 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-100-1722480173 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:44:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 03:44:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 44f382eab0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722480274
+ git checkout -b scalability-yes-1024-32768-100-1722480274
Switched to a new branch 'scalability-yes-1024-32768-100-1722480274'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722480274 49e1107bf0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722480274 8c78bbcd6b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:45:01 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:45:01 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-100-1722480274 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:46:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 03:46:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8c78bbcd6b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722480376
+ git checkout -b scalability-yes-8-32768-100-1722480376
Switched to a new branch 'scalability-yes-8-32768-100-1722480376'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722480376 80baf84c15] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722480376 581ddf05b5] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:46:43 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:46:43 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-100-1722480376 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:47:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 03:47:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 581ddf05b5 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722480478
+ git checkout -b scalability-yes-512-32768-100-1722480478
Switched to a new branch 'scalability-yes-512-32768-100-1722480478'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722480478 8f06feff19] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722480478 2740ce8a9f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:48:25 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:48:25 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-100-1722480478 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:49:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 03:49:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2740ce8a9f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722480582
+ git checkout -b scalability-yes-128-32768-100-1722480582
Switched to a new branch 'scalability-yes-128-32768-100-1722480582'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722480582 b8b93eaf31] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722480582 74c33df767] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:50:09 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:50:09 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-100-1722480582 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:51:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 03:51:24 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 74c33df767 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722480684
+ git checkout -b scalability-no-32-32768-100-1722480684
Switched to a new branch 'scalability-no-32-32768-100-1722480684'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722480684 6ffc61a666] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:51:51 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:51:51 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-100-1722480684 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:53:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 03:53:06 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6ffc61a666 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722480786
+ git checkout -b scalability-no-0-32768-100-1722480786
Switched to a new branch 'scalability-no-0-32768-100-1722480786'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:53:33 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:53:33 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-100-1722480786 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:54:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 03:54:48 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722480888
+ git checkout -b scalability-no-1-32768-100-1722480888
Switched to a new branch 'scalability-no-1-32768-100-1722480888'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722480888 053565ad6c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:55:15 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:55:15 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-100-1722480888 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:56:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 03:56:29 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 053565ad6c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722480989
+ git checkout -b scalability-no-1024-32768-100-1722480989
Switched to a new branch 'scalability-no-1024-32768-100-1722480989'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722480989 ff9d9d1944] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:56:56 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:56:56 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-100-1722480989 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:58:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 03:58:11 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ff9d9d1944 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722481091
+ git checkout -b scalability-no-8-32768-100-1722481091
Switched to a new branch 'scalability-no-8-32768-100-1722481091'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722481091 b633506950] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 03:58:38 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 03:58:38 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-100-1722481091 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 03:59:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 03:59:53 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b633506950 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722481193
+ git checkout -b scalability-no-512-32768-100-1722481193
Switched to a new branch 'scalability-no-512-32768-100-1722481193'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722481193 a49e39afc6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:00:20 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:00:20 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-100-1722481193 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:01:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 04:01:35 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a49e39afc6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722481295
+ git checkout -b scalability-no-128-32768-100-1722481295
Switched to a new branch 'scalability-no-128-32768-100-1722481295'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722481295 757df8741a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:02:02 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:02:02 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-100-1722481295 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:03:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 04:03:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 757df8741a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722481398
+ git checkout -b scalability-yes-32-32768-100-1722481398
Switched to a new branch 'scalability-yes-32-32768-100-1722481398'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722481398 806ec67318] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722481398 e8b61d9851] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:03:44 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:03:44 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-100-1722481398 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:05:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 04:05:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e8b61d9851 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722481501
+ git checkout -b scalability-yes-0-32768-100-1722481501
Switched to a new branch 'scalability-yes-0-32768-100-1722481501'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722481501 46beef0977] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:05:28 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:05:28 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-100-1722481501 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:06:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 04:06:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 46beef0977 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722481603
+ git checkout -b scalability-yes-1-32768-100-1722481603
Switched to a new branch 'scalability-yes-1-32768-100-1722481603'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722481603 e9c5db0db4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722481603 eb4b432659] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:07:10 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:07:10 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-100-1722481603 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:08:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 04:08:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eb4b432659 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722481706
+ git checkout -b scalability-yes-1024-32768-100-1722481706
Switched to a new branch 'scalability-yes-1024-32768-100-1722481706'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722481706 2e62dc3324] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722481706 83b3e0adc2] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:08:53 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:08:53 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-100-1722481706 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:10:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 04:10:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 83b3e0adc2 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722481809
+ git checkout -b scalability-yes-8-32768-100-1722481809
Switched to a new branch 'scalability-yes-8-32768-100-1722481809'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722481809 f29a596ccd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722481809 4095104aa0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:10:36 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:10:36 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-100-1722481809 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:11:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 04:11:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4095104aa0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722481911
+ git checkout -b scalability-yes-512-32768-100-1722481911
Switched to a new branch 'scalability-yes-512-32768-100-1722481911'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722481911 7e1f18a7c9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722481911 fafce20524] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:12:18 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:12:18 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-100-1722481911 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:13:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 04:13:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fafce20524 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722482013
+ git checkout -b scalability-yes-128-32768-100-1722482013
Switched to a new branch 'scalability-yes-128-32768-100-1722482013'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722482013 80db2462e0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722482013 4203a9de4d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:14:00 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:14:00 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-100-1722482013 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:15:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 04:15:17 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4203a9de4d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722482117
+ git checkout -b scalability-no-32-32768-100-1722482117
Switched to a new branch 'scalability-no-32-32768-100-1722482117'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722482117 43422a9fa4] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:15:44 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:15:44 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-100-1722482117 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:17:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 04:17:01 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 43422a9fa4 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722482221
+ git checkout -b scalability-no-0-32768-100-1722482221
Switched to a new branch 'scalability-no-0-32768-100-1722482221'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:17:28 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:17:28 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-100-1722482221 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:18:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 04:18:44 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722482324
+ git checkout -b scalability-no-1-32768-100-1722482324
Switched to a new branch 'scalability-no-1-32768-100-1722482324'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722482324 ee2edd96a2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:19:11 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:19:11 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-100-1722482324 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:20:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 04:20:26 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ee2edd96a2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722482426
+ git checkout -b scalability-no-1024-32768-100-1722482426
Switched to a new branch 'scalability-no-1024-32768-100-1722482426'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722482426 19c74a2cd6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:20:53 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:20:53 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-100-1722482426 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:22:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 04:22:08 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 19c74a2cd6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722482528
+ git checkout -b scalability-no-8-32768-100-1722482528
Switched to a new branch 'scalability-no-8-32768-100-1722482528'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722482528 61ab1ffd45] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:22:35 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:22:35 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-100-1722482528 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:23:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 04:23:50 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 61ab1ffd45 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722482630
+ git checkout -b scalability-no-512-32768-100-1722482630
Switched to a new branch 'scalability-no-512-32768-100-1722482630'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722482630 d805808d54] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:24:17 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:24:17 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-100-1722482630 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:25:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 04:25:34 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d805808d54 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722482734
+ git checkout -b scalability-no-128-32768-100-1722482734
Switched to a new branch 'scalability-no-128-32768-100-1722482734'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722482734 5fcdf1ba94] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:26:01 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:26:01 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-100-1722482734 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:27:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 04:27:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5fcdf1ba94 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722482837
+ git checkout -b scalability-yes-32-32768-100-1722482837
Switched to a new branch 'scalability-yes-32-32768-100-1722482837'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722482837 41e8495f0a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722482837 76e57ad46b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:27:45 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:27:45 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-100-1722482837 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:31:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 04:31:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 76e57ad46b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722483110
+ git checkout -b scalability-yes-0-32768-100-1722483110
Switched to a new branch 'scalability-yes-0-32768-100-1722483110'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722483110 42d9a2ead6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:32:18 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:32:18 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-100-1722483110 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:36:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 04:36:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 42d9a2ead6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722483366
+ git checkout -b scalability-yes-1-32768-100-1722483366
Switched to a new branch 'scalability-yes-1-32768-100-1722483366'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722483366 3538082974] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722483366 d3eca7f8ba] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:36:33 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:36:33 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-100-1722483366 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:40:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 04:40:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d3eca7f8ba fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722483620
+ git checkout -b scalability-yes-1024-32768-100-1722483620
Switched to a new branch 'scalability-yes-1024-32768-100-1722483620'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722483620 34053210de] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722483620 2e05134699] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:40:47 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:40:47 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-100-1722483620 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:44:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 04:44:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2e05134699 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722483880
+ git checkout -b scalability-yes-8-32768-100-1722483880
Switched to a new branch 'scalability-yes-8-32768-100-1722483880'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722483880 67f3d8277f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722483880 ed7d0bc501] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:45:07 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:45:07 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-100-1722483880 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:48:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 04:48:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ed7d0bc501 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722484126
+ git checkout -b scalability-yes-512-32768-100-1722484126
Switched to a new branch 'scalability-yes-512-32768-100-1722484126'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722484126 14599efcd5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722484126 674675e7c2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:49:14 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:49:14 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-100-1722484126 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:52:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 04:52:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 674675e7c2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722484378
+ git checkout -b scalability-yes-128-32768-100-1722484378
Switched to a new branch 'scalability-yes-128-32768-100-1722484378'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722484378 64eafa96db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722484378 0eaee746f8] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:53:25 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:53:25 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-100-1722484378 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-100
+ env
++ date
+ echo Thu 1 Aug 04:57:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 04:57:09 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0eaee746f8 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722484629
+ git checkout -b scalability-no-32-32768-100-1722484629
Switched to a new branch 'scalability-no-32-32768-100-1722484629'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722484629 0f31bd6adb] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 04:57:37 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 04:57:37 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-100-1722484629 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-100
+ env
++ date
+ echo Thu 1 Aug 05:01:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 05:01:30 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0f31bd6adb fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722484890
+ git checkout -b scalability-no-0-32768-100-1722484890
Switched to a new branch 'scalability-no-0-32768-100-1722484890'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:01:58 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 05:01:58 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-100-1722484890 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-100
+ env
++ date
+ echo Thu 1 Aug 05:05:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 05:05:54 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722485154
+ git checkout -b scalability-no-1-32768-100-1722485154
Switched to a new branch 'scalability-no-1-32768-100-1722485154'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722485154 f208354b7e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:06:21 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 05:06:21 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-100-1722485154 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-100
+ env
++ date
+ echo Thu 1 Aug 05:10:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 05:10:13 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f208354b7e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722485413
+ git checkout -b scalability-no-1024-32768-100-1722485413
Switched to a new branch 'scalability-no-1024-32768-100-1722485413'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722485413 97d6fd3bbd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:10:41 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 05:10:41 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-100-1722485413 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-100
+ env
++ date
+ echo Thu 1 Aug 05:14:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 05:14:45 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 97d6fd3bbd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722485685
+ git checkout -b scalability-no-8-32768-100-1722485685
Switched to a new branch 'scalability-no-8-32768-100-1722485685'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722485685 b0e5f33471] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:15:12 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 05:15:12 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-100-1722485685 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-100
+ env
++ date
+ echo Thu 1 Aug 05:19:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 05:19:04 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b0e5f33471 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722485944
+ git checkout -b scalability-no-512-32768-100-1722485944
Switched to a new branch 'scalability-no-512-32768-100-1722485944'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722485944 17d614b4bd] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:19:31 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 05:19:31 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-100-1722485944 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-100
+ env
++ date
+ echo Thu 1 Aug 05:23:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 05:23:42 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 17d614b4bd fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722486222
+ git checkout -b scalability-no-128-32768-100-1722486222
Switched to a new branch 'scalability-no-128-32768-100-1722486222'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722486222 4e9df15071] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:24:09 BST 2024 'RUN   files: 32768  partitions: 100'
Thu 1 Aug 05:24:09 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-100-1722486222 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:28:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 05:28:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4e9df15071 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722486483
+ git checkout -b scalability-yes-32-32768-10-1722486483
Switched to a new branch 'scalability-yes-32-32768-10-1722486483'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722486483 dcec64ee10] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722486483 f25a82ac71] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:28:55 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:28:55 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-10-1722486483 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:30:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 05:30:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f25a82ac71 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722486609
+ git checkout -b scalability-yes-0-32768-10-1722486609
Switched to a new branch 'scalability-yes-0-32768-10-1722486609'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722486609 2cb91398b1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:31:00 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:31:00 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-10-1722486609 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:32:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 05:32:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2cb91398b1 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722486734
+ git checkout -b scalability-yes-1-32768-10-1722486734
Switched to a new branch 'scalability-yes-1-32768-10-1722486734'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722486734 b639fa2476] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722486734 030f0759f0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:33:06 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:33:06 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-10-1722486734 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:34:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 05:34:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 030f0759f0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722486861
+ git checkout -b scalability-yes-1024-32768-10-1722486861
Switched to a new branch 'scalability-yes-1024-32768-10-1722486861'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722486861 48306b2b30] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722486861 e982562182] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:35:12 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:35:12 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-10-1722486861 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:36:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 05:36:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e982562182 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722486986
+ git checkout -b scalability-yes-8-32768-10-1722486986
Switched to a new branch 'scalability-yes-8-32768-10-1722486986'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722486986 7ffa743421] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722486986 ebd48e6496] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:37:18 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:37:18 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-10-1722486986 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:38:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 05:38:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ebd48e6496 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722487112
+ git checkout -b scalability-yes-512-32768-10-1722487112
Switched to a new branch 'scalability-yes-512-32768-10-1722487112'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722487112 6c11ebf058] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722487112 9c48eb404a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:39:23 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:39:23 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-10-1722487112 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:40:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 05:40:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9c48eb404a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722487238
+ git checkout -b scalability-yes-128-32768-10-1722487238
Switched to a new branch 'scalability-yes-128-32768-10-1722487238'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722487238 106d2bff4a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722487238 54999b52f3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:41:29 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:41:29 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-10-1722487238 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:42:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 05:42:43 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 54999b52f3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722487363
+ git checkout -b scalability-no-32-32768-10-1722487363
Switched to a new branch 'scalability-no-32-32768-10-1722487363'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722487363 66bf9a1822] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:43:35 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:43:35 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-10-1722487363 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:44:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 05:44:50 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 66bf9a1822 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722487490
+ git checkout -b scalability-no-0-32768-10-1722487490
Switched to a new branch 'scalability-no-0-32768-10-1722487490'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:45:41 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:45:41 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-10-1722487490 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:46:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 05:46:55 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722487615
+ git checkout -b scalability-no-1-32768-10-1722487615
Switched to a new branch 'scalability-no-1-32768-10-1722487615'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722487615 1e30194ea4] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:47:47 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:47:47 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-10-1722487615 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:49:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 05:49:01 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1e30194ea4 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722487741
+ git checkout -b scalability-no-1024-32768-10-1722487741
Switched to a new branch 'scalability-no-1024-32768-10-1722487741'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722487741 f4f2ed6c8a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:49:52 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:49:52 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-10-1722487741 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:51:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 05:51:06 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f4f2ed6c8a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722487867
+ git checkout -b scalability-no-8-32768-10-1722487867
Switched to a new branch 'scalability-no-8-32768-10-1722487867'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722487867 3d7bfd7e65] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:51:58 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:51:58 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-10-1722487867 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:53:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 05:53:12 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3d7bfd7e65 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722487992
+ git checkout -b scalability-no-512-32768-10-1722487992
Switched to a new branch 'scalability-no-512-32768-10-1722487992'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722487992 c4ab60ac0d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:54:04 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:54:04 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-10-1722487992 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:55:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 05:55:18 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c4ab60ac0d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722488118
+ git checkout -b scalability-no-128-32768-10-1722488118
Switched to a new branch 'scalability-no-128-32768-10-1722488118'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722488118 b0504723d2] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:56:09 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:56:09 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-10-1722488118 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:57:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 05:57:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b0504723d2 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722488243
+ git checkout -b scalability-yes-32-32768-10-1722488243
Switched to a new branch 'scalability-yes-32-32768-10-1722488243'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722488243 d021d64bf3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722488243 9dc93666fe] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:57:50 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:57:50 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-10-1722488243 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 05:59:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 05:59:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9dc93666fe fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722488347
+ git checkout -b scalability-yes-0-32768-10-1722488347
Switched to a new branch 'scalability-yes-0-32768-10-1722488347'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722488347 6e4be2c6bd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 05:59:34 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 05:59:34 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-10-1722488347 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:00:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 06:00:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6e4be2c6bd NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722488451
+ git checkout -b scalability-yes-1-32768-10-1722488451
Switched to a new branch 'scalability-yes-1-32768-10-1722488451'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722488451 17254adbb1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722488451 25a8f0ee1b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:01:18 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:01:18 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-10-1722488451 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:02:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 06:02:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 25a8f0ee1b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722488555
+ git checkout -b scalability-yes-1024-32768-10-1722488555
Switched to a new branch 'scalability-yes-1024-32768-10-1722488555'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722488555 6623878ec8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722488555 539a55b62f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:03:02 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:03:02 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-10-1722488555 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:04:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 06:04:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 539a55b62f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722488658
+ git checkout -b scalability-yes-8-32768-10-1722488658
Switched to a new branch 'scalability-yes-8-32768-10-1722488658'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722488658 009e4ff10e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722488658 a0a955c21d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:04:45 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:04:45 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-10-1722488658 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:06:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 06:06:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a0a955c21d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722488762
+ git checkout -b scalability-yes-512-32768-10-1722488762
Switched to a new branch 'scalability-yes-512-32768-10-1722488762'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722488762 2a7bba110c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722488762 e20050b905] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:06:29 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:06:29 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-10-1722488762 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:07:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 06:07:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e20050b905 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722488865
+ git checkout -b scalability-yes-128-32768-10-1722488865
Switched to a new branch 'scalability-yes-128-32768-10-1722488865'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722488865 d390635580] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722488865 757204dc09] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:08:12 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:08:12 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-10-1722488865 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:09:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 06:09:32 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 757204dc09 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722488972
+ git checkout -b scalability-no-32-32768-10-1722488972
Switched to a new branch 'scalability-no-32-32768-10-1722488972'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722488972 877b7abdbf] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:09:59 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:09:59 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-10-1722488972 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:11:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 06:11:16 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 877b7abdbf fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722489076
+ git checkout -b scalability-no-0-32768-10-1722489076
Switched to a new branch 'scalability-no-0-32768-10-1722489076'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:11:43 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:11:43 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-10-1722489076 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:12:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 06:12:59 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722489179
+ git checkout -b scalability-no-1-32768-10-1722489179
Switched to a new branch 'scalability-no-1-32768-10-1722489179'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722489179 5480d318ff] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:13:27 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:13:27 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-10-1722489179 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:14:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 06:14:44 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5480d318ff fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722489284
+ git checkout -b scalability-no-1024-32768-10-1722489284
Switched to a new branch 'scalability-no-1024-32768-10-1722489284'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722489284 58d0ce45f2] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:15:11 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:15:11 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-10-1722489284 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:16:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 06:16:29 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 58d0ce45f2 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722489389
+ git checkout -b scalability-no-8-32768-10-1722489389
Switched to a new branch 'scalability-no-8-32768-10-1722489389'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722489389 0705bd6a5d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:16:56 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:16:56 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-10-1722489389 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:18:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 06:18:12 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0705bd6a5d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722489493
+ git checkout -b scalability-no-512-32768-10-1722489493
Switched to a new branch 'scalability-no-512-32768-10-1722489493'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722489493 8d707df93b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:18:40 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:18:40 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-10-1722489493 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:20:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 06:20:00 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8d707df93b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722489600
+ git checkout -b scalability-no-128-32768-10-1722489600
Switched to a new branch 'scalability-no-128-32768-10-1722489600'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722489600 f0fe4f459a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:20:27 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:20:27 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-10-1722489600 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:21:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 06:21:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f0fe4f459a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722489703
+ git checkout -b scalability-yes-32-32768-10-1722489703
Switched to a new branch 'scalability-yes-32-32768-10-1722489703'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722489703 487234608a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722489703 0a864451e2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:22:10 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:22:10 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-10-1722489703 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:23:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 06:23:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0a864451e2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722489804
+ git checkout -b scalability-yes-0-32768-10-1722489804
Switched to a new branch 'scalability-yes-0-32768-10-1722489804'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722489804 fc86606650] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:23:51 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:23:51 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-10-1722489804 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:25:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 06:25:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc86606650 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722489905
+ git checkout -b scalability-yes-1-32768-10-1722489905
Switched to a new branch 'scalability-yes-1-32768-10-1722489905'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722489905 0d4631b144] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722489905 2dfa75c0ac] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:25:32 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:25:32 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-10-1722489905 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:26:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 06:26:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2dfa75c0ac fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722490006
+ git checkout -b scalability-yes-1024-32768-10-1722490006
Switched to a new branch 'scalability-yes-1024-32768-10-1722490006'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722490006 e3501dec70] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722490006 7927111c35] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:27:13 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:27:13 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-10-1722490006 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:28:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 06:28:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7927111c35 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722490106
+ git checkout -b scalability-yes-8-32768-10-1722490106
Switched to a new branch 'scalability-yes-8-32768-10-1722490106'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722490106 fe2159210b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722490106 a7e6bc98a1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:28:54 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:28:54 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-10-1722490106 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:30:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 06:30:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a7e6bc98a1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722490208
+ git checkout -b scalability-yes-512-32768-10-1722490208
Switched to a new branch 'scalability-yes-512-32768-10-1722490208'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722490208 db1dbcf95d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722490208 0bd77a3174] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:30:35 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:30:35 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-10-1722490208 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:31:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 06:31:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0bd77a3174 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722490309
+ git checkout -b scalability-yes-128-32768-10-1722490309
Switched to a new branch 'scalability-yes-128-32768-10-1722490309'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722490309 fd3e58b543] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722490309 495a5be7c5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:32:16 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:32:16 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-10-1722490309 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:33:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 06:33:30 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 495a5be7c5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722490410
+ git checkout -b scalability-no-32-32768-10-1722490410
Switched to a new branch 'scalability-no-32-32768-10-1722490410'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722490410 15d4da2687] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:33:57 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:33:57 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-10-1722490410 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:35:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 06:35:11 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 15d4da2687 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722490511
+ git checkout -b scalability-no-0-32768-10-1722490511
Switched to a new branch 'scalability-no-0-32768-10-1722490511'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:35:38 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:35:38 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-10-1722490511 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:36:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 06:36:52 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722490612
+ git checkout -b scalability-no-1-32768-10-1722490612
Switched to a new branch 'scalability-no-1-32768-10-1722490612'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722490612 fc67bfaacc] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:37:19 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:37:19 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-10-1722490612 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:38:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 06:38:32 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc67bfaacc fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722490712
+ git checkout -b scalability-no-1024-32768-10-1722490712
Switched to a new branch 'scalability-no-1024-32768-10-1722490712'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722490712 0a46eadd53] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:38:59 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:38:59 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-10-1722490712 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:40:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 06:40:14 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0a46eadd53 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722490814
+ git checkout -b scalability-no-8-32768-10-1722490814
Switched to a new branch 'scalability-no-8-32768-10-1722490814'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722490814 9ed27a7504] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:40:41 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:40:41 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-10-1722490814 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:41:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 06:41:54 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9ed27a7504 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722490914
+ git checkout -b scalability-no-512-32768-10-1722490914
Switched to a new branch 'scalability-no-512-32768-10-1722490914'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722490914 0aa93d95a0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:42:22 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:42:22 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-10-1722490914 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:43:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 06:43:36 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0aa93d95a0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722491016
+ git checkout -b scalability-no-128-32768-10-1722491016
Switched to a new branch 'scalability-no-128-32768-10-1722491016'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722491016 d8460de98e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:44:03 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:44:03 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-10-1722491016 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:45:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 06:45:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d8460de98e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722491117
+ git checkout -b scalability-yes-32-32768-10-1722491117
Switched to a new branch 'scalability-yes-32-32768-10-1722491117'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722491117 4d55f9c2bb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722491117 7b0e2d10b8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:45:44 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:45:44 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-10-1722491117 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:47:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 06:47:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7b0e2d10b8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722491220
+ git checkout -b scalability-yes-0-32768-10-1722491220
Switched to a new branch 'scalability-yes-0-32768-10-1722491220'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722491220 1676aa6e3a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:47:27 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:47:27 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-10-1722491220 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:48:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 06:48:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1676aa6e3a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722491321
+ git checkout -b scalability-yes-1-32768-10-1722491321
Switched to a new branch 'scalability-yes-1-32768-10-1722491321'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722491321 9bba46b973] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722491321 a9c7ab4b2e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:49:09 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:49:09 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-10-1722491321 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:50:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 06:50:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a9c7ab4b2e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722491424
+ git checkout -b scalability-yes-1024-32768-10-1722491424
Switched to a new branch 'scalability-yes-1024-32768-10-1722491424'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722491424 1eaab7eb18] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722491424 e08807f621] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:50:51 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:50:51 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-10-1722491424 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:52:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 06:52:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e08807f621 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722491526
+ git checkout -b scalability-yes-8-32768-10-1722491526
Switched to a new branch 'scalability-yes-8-32768-10-1722491526'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722491526 7cbe775494] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722491526 52c448f574] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:52:33 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:52:33 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-10-1722491526 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:53:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 06:53:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 52c448f574 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722491627
+ git checkout -b scalability-yes-512-32768-10-1722491627
Switched to a new branch 'scalability-yes-512-32768-10-1722491627'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722491627 41e2fc1b69] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722491627 6a916b8389] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:54:15 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:54:15 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-10-1722491627 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:55:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 06:55:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6a916b8389 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722491729
+ git checkout -b scalability-yes-128-32768-10-1722491729
Switched to a new branch 'scalability-yes-128-32768-10-1722491729'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722491729 3b78c919df] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722491729 3173459086] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:55:57 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:55:57 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-10-1722491729 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:57:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 06:57:12 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3173459086 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722491832
+ git checkout -b scalability-no-32-32768-10-1722491832
Switched to a new branch 'scalability-no-32-32768-10-1722491832'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722491832 e6156880ec] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:57:39 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:57:39 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-10-1722491832 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 06:58:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 06:58:53 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e6156880ec fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722491933
+ git checkout -b scalability-no-0-32768-10-1722491933
Switched to a new branch 'scalability-no-0-32768-10-1722491933'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 06:59:20 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 06:59:20 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-10-1722491933 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:00:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 07:00:34 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722492034
+ git checkout -b scalability-no-1-32768-10-1722492034
Switched to a new branch 'scalability-no-1-32768-10-1722492034'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722492034 d8e79daa22] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:01:01 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:01:01 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-10-1722492034 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:02:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 07:02:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d8e79daa22 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722492136
+ git checkout -b scalability-no-1024-32768-10-1722492136
Switched to a new branch 'scalability-no-1024-32768-10-1722492136'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722492136 68a0f9ff91] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:02:44 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:02:44 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-10-1722492136 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:03:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 07:03:58 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 68a0f9ff91 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722492238
+ git checkout -b scalability-no-8-32768-10-1722492238
Switched to a new branch 'scalability-no-8-32768-10-1722492238'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722492238 ef2836ef53] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:04:25 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:04:25 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-10-1722492238 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:05:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 07:05:39 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef2836ef53 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722492339
+ git checkout -b scalability-no-512-32768-10-1722492339
Switched to a new branch 'scalability-no-512-32768-10-1722492339'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722492339 fb6872141b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:06:06 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:06:06 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-10-1722492339 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:07:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 07:07:21 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fb6872141b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722492441
+ git checkout -b scalability-no-128-32768-10-1722492441
Switched to a new branch 'scalability-no-128-32768-10-1722492441'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722492441 581de74028] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:07:49 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:07:49 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-10-1722492441 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:09:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 07:09:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 581de74028 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722492543
+ git checkout -b scalability-yes-32-32768-10-1722492543
Switched to a new branch 'scalability-yes-32-32768-10-1722492543'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722492543 f7cd8b9970] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722492543 b2e5cfd5b8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:09:30 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:09:30 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-10-1722492543 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:11:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 07:11:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b2e5cfd5b8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722492669
+ git checkout -b scalability-yes-0-32768-10-1722492669
Switched to a new branch 'scalability-yes-0-32768-10-1722492669'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722492669 e2d93887a4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:11:36 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:11:36 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-10-1722492669 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:13:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 07:13:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e2d93887a4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722492795
+ git checkout -b scalability-yes-1-32768-10-1722492795
Switched to a new branch 'scalability-yes-1-32768-10-1722492795'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722492795 82af11dea3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722492795 79f44a2536] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:13:42 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:13:42 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-10-1722492795 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:15:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 07:15:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79f44a2536 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722492915
+ git checkout -b scalability-yes-1024-32768-10-1722492915
Switched to a new branch 'scalability-yes-1024-32768-10-1722492915'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722492915 06fab2e5ad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722492915 8f73463296] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:15:42 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:15:42 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-10-1722492915 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:17:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 07:17:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8f73463296 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722493039
+ git checkout -b scalability-yes-8-32768-10-1722493039
Switched to a new branch 'scalability-yes-8-32768-10-1722493039'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722493039 7f48175246] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722493039 94a2919abf] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:17:45 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:17:45 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-10-1722493039 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:19:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 07:19:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 94a2919abf fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722493164
+ git checkout -b scalability-yes-512-32768-10-1722493164
Switched to a new branch 'scalability-yes-512-32768-10-1722493164'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722493164 5e5eab5966] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722493164 720e45ec82] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:19:51 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:19:51 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-10-1722493164 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:21:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 07:21:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 720e45ec82 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722493290
+ git checkout -b scalability-yes-128-32768-10-1722493290
Switched to a new branch 'scalability-yes-128-32768-10-1722493290'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722493290 1132b531b8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722493290 c4231dbdae] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:21:57 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:21:57 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-10-1722493290 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:23:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 07:23:34 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c4231dbdae fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722493414
+ git checkout -b scalability-no-32-32768-10-1722493414
Switched to a new branch 'scalability-no-32-32768-10-1722493414'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722493414 41dac8da17] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:24:01 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:24:01 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-10-1722493414 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:25:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 07:25:39 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 41dac8da17 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722493539
+ git checkout -b scalability-no-0-32768-10-1722493539
Switched to a new branch 'scalability-no-0-32768-10-1722493539'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:26:08 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:26:08 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-10-1722493539 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:27:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 07:27:42 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722493662
+ git checkout -b scalability-no-1-32768-10-1722493662
Switched to a new branch 'scalability-no-1-32768-10-1722493662'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722493662 fde4593be8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:28:09 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:28:09 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-10-1722493662 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:29:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 07:29:46 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fde4593be8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722493786
+ git checkout -b scalability-no-1024-32768-10-1722493786
Switched to a new branch 'scalability-no-1024-32768-10-1722493786'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722493786 cde2c523df] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:30:13 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:30:13 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-10-1722493786 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:31:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 07:31:47 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cde2c523df fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722493907
+ git checkout -b scalability-no-8-32768-10-1722493907
Switched to a new branch 'scalability-no-8-32768-10-1722493907'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722493907 1eb9ddf6e1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:32:14 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:32:14 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-10-1722493907 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:33:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 07:33:44 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1eb9ddf6e1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722494024
+ git checkout -b scalability-no-512-32768-10-1722494024
Switched to a new branch 'scalability-no-512-32768-10-1722494024'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722494024 8ec062d499] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:34:11 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:34:11 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-10-1722494024 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-10
+ env
++ date
+ echo Thu 1 Aug 07:35:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 07:35:46 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8ec062d499 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722494146
+ git checkout -b scalability-no-128-32768-10-1722494146
Switched to a new branch 'scalability-no-128-32768-10-1722494146'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722494146 b831432aac] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:36:13 BST 2024 'RUN   files: 32768  partitions: 10'
Thu 1 Aug 07:36:13 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-10-1722494146 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:37:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 07:37:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b831432aac fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722494265
+ git checkout -b scalability-yes-32-32768-1-1722494265
Switched to a new branch 'scalability-yes-32-32768-1-1722494265'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722494265 18d5de8ffa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722494265 3be82308e6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:38:37 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:38:37 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-1-1722494265 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:39:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 07:39:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3be82308e6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722494391
+ git checkout -b scalability-yes-0-32768-1-1722494391
Switched to a new branch 'scalability-yes-0-32768-1-1722494391'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722494391 ea21f595f6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:40:42 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:40:42 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-1-1722494391 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:41:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 07:41:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ea21f595f6 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722494516
+ git checkout -b scalability-yes-1-32768-1-1722494516
Switched to a new branch 'scalability-yes-1-32768-1-1722494516'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722494516 181f5f34bb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722494516 52f450be3f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:42:48 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:42:48 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-1-1722494516 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:44:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 07:44:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 52f450be3f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722494642
+ git checkout -b scalability-yes-1024-32768-1-1722494642
Switched to a new branch 'scalability-yes-1024-32768-1-1722494642'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722494642 5ee5efcd86] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722494642 23ea210054] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:44:53 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:44:53 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-1-1722494642 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:46:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 07:46:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 23ea210054 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722494767
+ git checkout -b scalability-yes-8-32768-1-1722494767
Switched to a new branch 'scalability-yes-8-32768-1-1722494767'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722494767 7d839f99e1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722494767 ef158124f8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:46:59 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:46:59 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-1-1722494767 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:48:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 07:48:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef158124f8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722494893
+ git checkout -b scalability-yes-512-32768-1-1722494893
Switched to a new branch 'scalability-yes-512-32768-1-1722494893'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722494893 e9c25f4b8d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722494893 8b52ebef85] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:49:04 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:49:04 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-1-1722494893 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:50:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 07:50:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8b52ebef85 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722495018
+ git checkout -b scalability-yes-128-32768-1-1722495018
Switched to a new branch 'scalability-yes-128-32768-1-1722495018'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722495018 4cf910dc6a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722495018 cf5c8fe1d4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:51:08 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:51:08 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-1-1722495018 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:52:22 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 07:52:22 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cf5c8fe1d4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722495142
+ git checkout -b scalability-no-32-32768-1-1722495142
Switched to a new branch 'scalability-no-32-32768-1-1722495142'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722495142 164b3f3634] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:53:13 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:53:13 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-1-1722495142 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:54:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 07:54:26 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 164b3f3634 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722495267
+ git checkout -b scalability-no-0-32768-1-1722495267
Switched to a new branch 'scalability-no-0-32768-1-1722495267'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:55:17 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:55:17 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-1-1722495267 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:56:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 07:56:32 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722495392
+ git checkout -b scalability-no-1-32768-1-1722495392
Switched to a new branch 'scalability-no-1-32768-1-1722495392'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722495392 3c66f09a7e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:57:22 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:57:22 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-1-1722495392 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 07:58:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 07:58:36 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3c66f09a7e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722495516
+ git checkout -b scalability-no-1024-32768-1-1722495516
Switched to a new branch 'scalability-no-1024-32768-1-1722495516'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722495516 9cd6131275] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 07:59:28 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 07:59:28 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-1-1722495516 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:00:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 08:00:42 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9cd6131275 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722495642
+ git checkout -b scalability-no-8-32768-1-1722495642
Switched to a new branch 'scalability-no-8-32768-1-1722495642'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722495642 8777c462c3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:01:33 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:01:33 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-1-1722495642 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:02:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 08:02:47 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8777c462c3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722495767
+ git checkout -b scalability-no-512-32768-1-1722495767
Switched to a new branch 'scalability-no-512-32768-1-1722495767'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722495767 866488af2e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:03:37 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:03:37 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-1-1722495767 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:04:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 08:04:51 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 866488af2e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722495891
+ git checkout -b scalability-no-128-32768-1-1722495891
Switched to a new branch 'scalability-no-128-32768-1-1722495891'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722495891 d4da64d0ea] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:05:42 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:05:42 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-1-1722495891 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:06:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 08:06:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d4da64d0ea fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722496016
+ git checkout -b scalability-yes-32-32768-1-1722496016
Switched to a new branch 'scalability-yes-32-32768-1-1722496016'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722496016 d0982ff432] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722496016 bff0e36b97] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:07:27 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:07:27 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-1-1722496016 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:08:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 08:08:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bff0e36b97 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722496123
+ git checkout -b scalability-yes-0-32768-1-1722496123
Switched to a new branch 'scalability-yes-0-32768-1-1722496123'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722496123 62308650b4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:09:14 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:09:14 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-1-1722496123 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:10:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 08:10:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 62308650b4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722496231
+ git checkout -b scalability-yes-1-32768-1-1722496231
Switched to a new branch 'scalability-yes-1-32768-1-1722496231'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722496231 e9000f913b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722496231 012f289edb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:11:02 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:11:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-1-1722496231 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:12:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 08:12:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 012f289edb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722496338
+ git checkout -b scalability-yes-1024-32768-1-1722496338
Switched to a new branch 'scalability-yes-1024-32768-1-1722496338'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722496338 2f0400048f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722496338 97d5a79ea7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:12:45 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:12:45 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-1-1722496338 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:14:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 08:14:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 97d5a79ea7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722496443
+ git checkout -b scalability-yes-8-32768-1-1722496443
Switched to a new branch 'scalability-yes-8-32768-1-1722496443'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722496443 eb792fa895] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722496443 3d27c4c9bf] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:14:30 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:14:30 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-1-1722496443 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:15:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 08:15:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3d27c4c9bf fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722496546
+ git checkout -b scalability-yes-512-32768-1-1722496546
Switched to a new branch 'scalability-yes-512-32768-1-1722496546'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722496546 8ddd4fc9a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722496546 04da19a739] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:16:13 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:16:13 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-1-1722496546 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:17:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 08:17:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 04da19a739 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722496651
+ git checkout -b scalability-yes-128-32768-1-1722496651
Switched to a new branch 'scalability-yes-128-32768-1-1722496651'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722496651 b1f1dd6b00] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722496651 c6bfc78c82] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:17:58 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:17:58 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-1-1722496651 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:19:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 08:19:14 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c6bfc78c82 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722496754
+ git checkout -b scalability-no-32-32768-1-1722496754
Switched to a new branch 'scalability-no-32-32768-1-1722496754'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722496754 19cb71100f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:19:42 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:19:42 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-1-1722496754 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:21:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 08:21:00 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 19cb71100f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722496860
+ git checkout -b scalability-no-0-32768-1-1722496860
Switched to a new branch 'scalability-no-0-32768-1-1722496860'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:21:27 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:21:27 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-1-1722496860 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:22:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 08:22:43 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722496963
+ git checkout -b scalability-no-1-32768-1-1722496963
Switched to a new branch 'scalability-no-1-32768-1-1722496963'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722496963 3003ef716b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:23:10 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:23:10 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-1-1722496963 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:24:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 08:24:29 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3003ef716b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722497069
+ git checkout -b scalability-no-1024-32768-1-1722497069
Switched to a new branch 'scalability-no-1024-32768-1-1722497069'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722497069 302d045f64] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:24:55 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:24:55 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-1-1722497069 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:26:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 08:26:12 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 302d045f64 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722497172
+ git checkout -b scalability-no-8-32768-1-1722497172
Switched to a new branch 'scalability-no-8-32768-1-1722497172'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722497172 a5bb4b5abb] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:26:39 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:26:39 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-1-1722497172 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:27:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 08:27:55 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a5bb4b5abb fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722497275
+ git checkout -b scalability-no-512-32768-1-1722497275
Switched to a new branch 'scalability-no-512-32768-1-1722497275'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722497275 0fa4ed5e0e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:28:22 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:28:22 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-1-1722497275 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:29:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 08:29:38 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0fa4ed5e0e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722497378
+ git checkout -b scalability-no-128-32768-1-1722497378
Switched to a new branch 'scalability-no-128-32768-1-1722497378'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722497378 8c9ab71206] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:30:05 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:30:05 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-1-1722497378 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:31:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 08:31:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8c9ab71206 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722497481
+ git checkout -b scalability-yes-32-32768-1-1722497481
Switched to a new branch 'scalability-yes-32-32768-1-1722497481'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722497481 079337fab6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722497481 59c5dad1e6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:31:48 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:31:48 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-1-1722497481 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:33:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 08:33:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 59c5dad1e6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722497582
+ git checkout -b scalability-yes-0-32768-1-1722497582
Switched to a new branch 'scalability-yes-0-32768-1-1722497582'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722497582 e592e219e9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:33:28 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:33:28 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-1-1722497582 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:34:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 08:34:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e592e219e9 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722497682
+ git checkout -b scalability-yes-1-32768-1-1722497682
Switched to a new branch 'scalability-yes-1-32768-1-1722497682'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722497682 49e8fec514] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722497682 c0bac2b33b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:35:09 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:35:09 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-1-1722497682 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:36:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 08:36:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c0bac2b33b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722497783
+ git checkout -b scalability-yes-1024-32768-1-1722497783
Switched to a new branch 'scalability-yes-1024-32768-1-1722497783'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722497783 13fd88ebd5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722497783 38f854298e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:36:51 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:36:51 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-1-1722497783 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:38:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 08:38:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 38f854298e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722497885
+ git checkout -b scalability-yes-8-32768-1-1722497885
Switched to a new branch 'scalability-yes-8-32768-1-1722497885'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722497885 b4567941be] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722497885 3bbade7952] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:38:32 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:38:32 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-1-1722497885 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:39:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 08:39:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3bbade7952 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722497985
+ git checkout -b scalability-yes-512-32768-1-1722497985
Switched to a new branch 'scalability-yes-512-32768-1-1722497985'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722497985 5f3ac4c27f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722497985 e3908b4163] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:40:12 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:40:12 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-1-1722497985 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:41:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 08:41:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e3908b4163 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722498086
+ git checkout -b scalability-yes-128-32768-1-1722498086
Switched to a new branch 'scalability-yes-128-32768-1-1722498086'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722498086 856df29f9d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722498086 024af34dd9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:41:52 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:41:52 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-1-1722498086 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:43:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 08:43:06 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 024af34dd9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722498186
+ git checkout -b scalability-no-32-32768-1-1722498186
Switched to a new branch 'scalability-no-32-32768-1-1722498186'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722498186 d70a4f7bce] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:43:32 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:43:32 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-1-1722498186 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:44:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 08:44:46 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d70a4f7bce fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722498286
+ git checkout -b scalability-no-0-32768-1-1722498286
Switched to a new branch 'scalability-no-0-32768-1-1722498286'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:45:12 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:45:12 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-1-1722498286 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:46:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 08:46:26 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722498386
+ git checkout -b scalability-no-1-32768-1-1722498386
Switched to a new branch 'scalability-no-1-32768-1-1722498386'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722498386 cc336a382a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:46:52 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:46:52 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-1-1722498386 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:48:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 08:48:06 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cc336a382a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722498486
+ git checkout -b scalability-no-1024-32768-1-1722498486
Switched to a new branch 'scalability-no-1024-32768-1-1722498486'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722498486 78fc6eaec4] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:48:32 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:48:32 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-1-1722498486 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:49:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 08:49:46 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 78fc6eaec4 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722498586
+ git checkout -b scalability-no-8-32768-1-1722498586
Switched to a new branch 'scalability-no-8-32768-1-1722498586'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722498586 d27b21a928] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:50:13 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:50:13 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-1-1722498586 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:51:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 08:51:26 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d27b21a928 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722498686
+ git checkout -b scalability-no-512-32768-1-1722498686
Switched to a new branch 'scalability-no-512-32768-1-1722498686'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722498686 4fc46e91c2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:51:53 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:51:53 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-1-1722498686 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:53:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 08:53:07 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4fc46e91c2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722498787
+ git checkout -b scalability-no-128-32768-1-1722498787
Switched to a new branch 'scalability-no-128-32768-1-1722498787'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722498787 9089c09d8a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:53:33 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:53:33 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-1-1722498787 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:54:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 08:54:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9089c09d8a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722498887
+ git checkout -b scalability-yes-32-32768-1-1722498887
Switched to a new branch 'scalability-yes-32-32768-1-1722498887'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722498887 5fbb7954b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722498887 cf3bccad20] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:55:14 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:55:14 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-1-1722498887 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:56:28 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 08:56:28 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cf3bccad20 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722498988
+ git checkout -b scalability-yes-0-32768-1-1722498988
Switched to a new branch 'scalability-yes-0-32768-1-1722498988'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722498988 1117db7bca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:56:54 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:56:54 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-1-1722498988 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:58:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 08:58:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1117db7bca NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722499088
+ git checkout -b scalability-yes-1-32768-1-1722499088
Switched to a new branch 'scalability-yes-1-32768-1-1722499088'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722499088 d49e024983] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722499088 7c391393be] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 08:58:35 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 08:58:35 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-1-1722499088 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 08:59:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 08:59:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7c391393be fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722499190
+ git checkout -b scalability-yes-1024-32768-1-1722499190
Switched to a new branch 'scalability-yes-1024-32768-1-1722499190'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722499190 6abe50e499] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722499190 3963e48a20] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:00:16 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:00:16 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-1-1722499190 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:01:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 09:01:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3963e48a20 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722499290
+ git checkout -b scalability-yes-8-32768-1-1722499290
Switched to a new branch 'scalability-yes-8-32768-1-1722499290'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722499290 ba247ca7e3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722499290 9f156d4a1e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:01:56 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:01:56 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-1-1722499290 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:03:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 09:03:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9f156d4a1e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722499391
+ git checkout -b scalability-yes-512-32768-1-1722499391
Switched to a new branch 'scalability-yes-512-32768-1-1722499391'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722499391 9005c57602] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722499391 7f5c228bfe] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:03:38 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:03:38 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-1-1722499391 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:04:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 09:04:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7f5c228bfe fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722499493
+ git checkout -b scalability-yes-128-32768-1-1722499493
Switched to a new branch 'scalability-yes-128-32768-1-1722499493'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722499493 aa21ed91d5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722499493 a1a161d6ef] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:05:20 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:05:20 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-1-1722499493 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:06:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 09:06:33 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a1a161d6ef fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722499594
+ git checkout -b scalability-no-32-32768-1-1722499594
Switched to a new branch 'scalability-no-32-32768-1-1722499594'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722499594 2a9f131ad7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:07:00 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:07:00 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-1-1722499594 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:08:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 09:08:14 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2a9f131ad7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722499695
+ git checkout -b scalability-no-0-32768-1-1722499695
Switched to a new branch 'scalability-no-0-32768-1-1722499695'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:08:41 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:08:41 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-1-1722499695 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:09:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 09:09:55 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722499795
+ git checkout -b scalability-no-1-32768-1-1722499795
Switched to a new branch 'scalability-no-1-32768-1-1722499795'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722499795 d0046bc047] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:10:22 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:10:22 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-1-1722499795 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:11:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 09:11:35 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d0046bc047 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722499895
+ git checkout -b scalability-no-1024-32768-1-1722499895
Switched to a new branch 'scalability-no-1024-32768-1-1722499895'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722499895 698b61809c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:12:02 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:12:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-1-1722499895 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:13:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 09:13:16 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 698b61809c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722499996
+ git checkout -b scalability-no-8-32768-1-1722499996
Switched to a new branch 'scalability-no-8-32768-1-1722499996'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722499996 9509c28d63] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:13:42 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:13:42 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-1-1722499996 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:14:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 09:14:57 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9509c28d63 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722500097
+ git checkout -b scalability-no-512-32768-1-1722500097
Switched to a new branch 'scalability-no-512-32768-1-1722500097'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722500097 155d215aa8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:15:24 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:15:24 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-1-1722500097 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:16:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 09:16:37 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 155d215aa8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722500198
+ git checkout -b scalability-no-128-32768-1-1722500198
Switched to a new branch 'scalability-no-128-32768-1-1722500198'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722500198 cd19540724] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:17:04 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:17:04 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-1-1722500198 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:18:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 09:18:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cd19540724 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722500298
+ git checkout -b scalability-yes-32-32768-1-1722500298
Switched to a new branch 'scalability-yes-32-32768-1-1722500298'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722500298 da88d32040] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722500298 6fd8de3bb7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:18:45 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:18:45 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-1-1722500298 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:20:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 09:20:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6fd8de3bb7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722500406
+ git checkout -b scalability-yes-0-32768-1-1722500406
Switched to a new branch 'scalability-yes-0-32768-1-1722500406'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722500406 1cf464d6e3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:20:33 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:20:33 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-1-1722500406 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:21:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 09:21:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1cf464d6e3 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722500516
+ git checkout -b scalability-yes-1-32768-1-1722500516
Switched to a new branch 'scalability-yes-1-32768-1-1722500516'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722500516 5074f075fc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722500516 85b0516312] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:22:23 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:22:23 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-1-1722500516 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:23:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 09:23:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 85b0516312 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722500622
+ git checkout -b scalability-yes-1024-32768-1-1722500622
Switched to a new branch 'scalability-yes-1024-32768-1-1722500622'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722500622 18b1e5e0e7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722500622 d3bc1c136d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:24:09 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:24:09 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-1-1722500622 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:25:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 09:25:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d3bc1c136d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722500733
+ git checkout -b scalability-yes-8-32768-1-1722500733
Switched to a new branch 'scalability-yes-8-32768-1-1722500733'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722500733 f8069c6fb7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722500733 f3c2ba248a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:26:00 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:26:00 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-1-1722500733 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:27:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 09:27:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f3c2ba248a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722500840
+ git checkout -b scalability-yes-512-32768-1-1722500840
Switched to a new branch 'scalability-yes-512-32768-1-1722500840'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722500840 edd8179fcc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722500840 18663de7d4] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:27:47 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:27:47 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-1-1722500840 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:29:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 09:29:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 18663de7d4 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722500947
+ git checkout -b scalability-yes-128-32768-1-1722500947
Switched to a new branch 'scalability-yes-128-32768-1-1722500947'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722500947 ad64daccca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722500947 28debe7822] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:29:33 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:29:33 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-1-1722500947 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:30:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 09:30:59 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 28debe7822 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722501059
+ git checkout -b scalability-no-32-32768-1-1722501059
Switched to a new branch 'scalability-no-32-32768-1-1722501059'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/32/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722501059 89bc641ec7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:31:26 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:31:26 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-1-1722501059 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:32:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 09:32:50 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 89bc641ec7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722501171
+ git checkout -b scalability-no-0-32768-1-1722501171
Switched to a new branch 'scalability-no-0-32768-1-1722501171'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:33:17 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:33:17 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-1-1722501171 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:34:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 09:34:37 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722501277
+ git checkout -b scalability-no-1-32768-1-1722501277
Switched to a new branch 'scalability-no-1-32768-1-1722501277'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722501277 81b37ef9ad] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:35:04 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:35:04 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-1-1722501277 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:36:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 09:36:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 81b37ef9ad fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722501385
+ git checkout -b scalability-no-1024-32768-1-1722501385
Switched to a new branch 'scalability-no-1024-32768-1-1722501385'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722501385 c977e1146e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:36:52 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:36:52 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-1-1722501385 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:38:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 09:38:17 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c977e1146e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722501497
+ git checkout -b scalability-no-8-32768-1-1722501497
Switched to a new branch 'scalability-no-8-32768-1-1722501497'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722501497 f3dcb120e0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:38:44 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:38:44 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-1-1722501497 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:40:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 09:40:04 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f3dcb120e0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722501604
+ git checkout -b scalability-no-512-32768-1-1722501604
Switched to a new branch 'scalability-no-512-32768-1-1722501604'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722501604 bd02d05c80] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:40:30 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:40:30 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-1-1722501604 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-1
+ env
++ date
+ echo Thu 1 Aug 09:41:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 09:41:56 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bd02d05c80 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722501716
+ git checkout -b scalability-no-128-32768-1-1722501716
Switched to a new branch 'scalability-no-128-32768-1-1722501716'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722501716 789959b62a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:42:23 BST 2024 'RUN   files: 32768  partitions: 1'
Thu 1 Aug 09:42:23 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-1-1722501716 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:43:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 09:43:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 789959b62a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722501823
+ git checkout -b scalability-yes-32-32768-0-1722501823
Switched to a new branch 'scalability-yes-32-32768-0-1722501823'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722501823 d629431cc9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722501823 b8096340ac] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:44:34 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:44:34 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-0-1722501823 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:45:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 09:45:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b8096340ac fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722501948
+ git checkout -b scalability-yes-0-32768-0-1722501948
Switched to a new branch 'scalability-yes-0-32768-0-1722501948'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722501948 83e58483b5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:46:38 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:46:38 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-0-1722501948 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:47:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 09:47:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 83e58483b5 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722502075
+ git checkout -b scalability-yes-1-32768-0-1722502075
Switched to a new branch 'scalability-yes-1-32768-0-1722502075'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722502075 2cce43bfba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722502075 29cc728b08] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:48:48 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:48:48 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-0-1722502075 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:50:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 09:50:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 29cc728b08 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722502202
+ git checkout -b scalability-yes-1024-32768-0-1722502202
Switched to a new branch 'scalability-yes-1024-32768-0-1722502202'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722502202 eea6e4dfa0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722502202 a43aa944f8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:50:52 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:50:52 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-0-1722502202 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:52:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 09:52:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a43aa944f8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722502326
+ git checkout -b scalability-yes-8-32768-0-1722502326
Switched to a new branch 'scalability-yes-8-32768-0-1722502326'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722502326 773e5cadc7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722502326 09456a8238] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:52:57 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:52:57 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-0-1722502326 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:54:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 09:54:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 09456a8238 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722502451
+ git checkout -b scalability-yes-512-32768-0-1722502451
Switched to a new branch 'scalability-yes-512-32768-0-1722502451'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722502451 5d5f3fc72c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722502451 623f23d2b6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:55:02 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:55:02 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-0-1722502451 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-yes-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:56:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 09:56:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 623f23d2b6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722502576
+ git checkout -b scalability-yes-128-32768-0-1722502576
Switched to a new branch 'scalability-yes-128-32768-0-1722502576'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722502576 3a9b3bf0e1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722502576 5c40c44dfb] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:57:07 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:57:07 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-0-1722502576 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 09:58:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 09:58:21 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5c40c44dfb fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722502702
+ git checkout -b scalability-no-32-32768-0-1722502702
Switched to a new branch 'scalability-no-32-32768-0-1722502702'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722502702 e8ac8fcc47] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 09:59:13 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 09:59:13 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-0-1722502702 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:00:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 10:00:26 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e8ac8fcc47 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722502826
+ git checkout -b scalability-no-0-32768-0-1722502826
Switched to a new branch 'scalability-no-0-32768-0-1722502826'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:01:20 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:01:20 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-0-1722502826 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:02:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 10:02:34 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722502954
+ git checkout -b scalability-no-1-32768-0-1722502954
Switched to a new branch 'scalability-no-1-32768-0-1722502954'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722502954 a04df83b34] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:03:27 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:03:27 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-0-1722502954 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:04:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 10:04:41 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a04df83b34 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722503081
+ git checkout -b scalability-no-1024-32768-0-1722503081
Switched to a new branch 'scalability-no-1024-32768-0-1722503081'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722503081 a383c1ceae] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:05:32 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:05:32 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-0-1722503081 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:06:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 10:06:48 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a383c1ceae fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722503208
+ git checkout -b scalability-no-8-32768-0-1722503208
Switched to a new branch 'scalability-no-8-32768-0-1722503208'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722503208 96af08a9cd] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:07:40 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:07:40 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-0-1722503208 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:08:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 10:08:53 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 96af08a9cd fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722503334
+ git checkout -b scalability-no-512-32768-0-1722503334
Switched to a new branch 'scalability-no-512-32768-0-1722503334'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722503334 79e3fb2cea] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:09:46 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:09:46 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-0-1722503334 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/index-no-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:11:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 10:11:00 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79e3fb2cea fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722503460
+ git checkout -b scalability-no-128-32768-0-1722503460
Switched to a new branch 'scalability-no-128-32768-0-1722503460'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722503460 cb68498639] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:11:51 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:11:51 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-0-1722503460 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/index-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:13:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 10:13:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cb68498639 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722503586
+ git checkout -b scalability-yes-32-32768-0-1722503586
Switched to a new branch 'scalability-yes-32-32768-0-1722503586'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722503586 a49a4776f6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722503586 721f9e34e6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:13:34 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:13:34 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-0-1722503586 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:14:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 10:14:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 721f9e34e6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722503693
+ git checkout -b scalability-yes-0-32768-0-1722503693
Switched to a new branch 'scalability-yes-0-32768-0-1722503693'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722503693 ad6fb4df61] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:15:20 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:15:20 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-0-1722503693 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:16:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 10:16:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ad6fb4df61 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722503796
+ git checkout -b scalability-yes-1-32768-0-1722503796
Switched to a new branch 'scalability-yes-1-32768-0-1722503796'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722503796 9b23338d18] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722503796 cc4dfbd586] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:17:02 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:17:02 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-0-1722503796 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:18:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 10:18:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cc4dfbd586 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722503901
+ git checkout -b scalability-yes-1024-32768-0-1722503901
Switched to a new branch 'scalability-yes-1024-32768-0-1722503901'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722503901 b115df7fa0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722503901 f49c865249] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:18:48 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:18:48 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-0-1722503901 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:20:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 10:20:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f49c865249 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722504005
+ git checkout -b scalability-yes-8-32768-0-1722504005
Switched to a new branch 'scalability-yes-8-32768-0-1722504005'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722504005 f4b437eae6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722504005 962db7dc45] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:20:31 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:20:31 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-0-1722504005 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:21:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 10:21:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 962db7dc45 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722504107
+ git checkout -b scalability-yes-512-32768-0-1722504107
Switched to a new branch 'scalability-yes-512-32768-0-1722504107'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722504107 44fef7a7a2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722504107 e281df96ad] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:22:15 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:22:15 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-0-1722504107 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-yes-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:23:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 10:23:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e281df96ad fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722504213
+ git checkout -b scalability-yes-128-32768-0-1722504213
Switched to a new branch 'scalability-yes-128-32768-0-1722504213'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722504213 a5243e9009] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722504213 bc743cfaee] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:24:00 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:24:00 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-0-1722504213 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:25:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 10:25:17 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bc743cfaee fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722504317
+ git checkout -b scalability-no-32-32768-0-1722504317
Switched to a new branch 'scalability-no-32-32768-0-1722504317'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722504317 5e7f700813] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:25:44 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:25:44 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-0-1722504317 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:27:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 10:27:01 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5e7f700813 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722504421
+ git checkout -b scalability-no-0-32768-0-1722504421
Switched to a new branch 'scalability-no-0-32768-0-1722504421'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:27:27 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:27:27 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-0-1722504421 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:28:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 10:28:43 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722504523
+ git checkout -b scalability-no-1-32768-0-1722504523
Switched to a new branch 'scalability-no-1-32768-0-1722504523'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722504523 b8651d8a0e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:29:10 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:29:10 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-0-1722504523 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:30:27 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 10:30:27 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b8651d8a0e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722504627
+ git checkout -b scalability-no-1024-32768-0-1722504627
Switched to a new branch 'scalability-no-1024-32768-0-1722504627'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722504627 16cfa5f0b1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:30:54 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:30:54 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-0-1722504627 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:32:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 10:32:10 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 16cfa5f0b1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722504730
+ git checkout -b scalability-no-8-32768-0-1722504730
Switched to a new branch 'scalability-no-8-32768-0-1722504730'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722504730 6480832a98] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:32:37 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:32:37 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-0-1722504730 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:33:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 10:33:53 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6480832a98 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722504833
+ git checkout -b scalability-no-512-32768-0-1722504833
Switched to a new branch 'scalability-no-512-32768-0-1722504833'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722504833 664e4c17b7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:34:20 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:34:20 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-0-1722504833 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/join-no-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:35:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 10:35:37 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 664e4c17b7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722504937
+ git checkout -b scalability-no-128-32768-0-1722504937
Switched to a new branch 'scalability-no-128-32768-0-1722504937'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722504937 95582c595b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:36:04 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:36:04 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-0-1722504937 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/join-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:37:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 10:37:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 95582c595b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722505040
+ git checkout -b scalability-yes-32-32768-0-1722505040
Switched to a new branch 'scalability-yes-32-32768-0-1722505040'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722505040 06c63f0cb9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722505040 fea03acd2f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:37:47 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:37:47 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-0-1722505040 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:39:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 10:39:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fea03acd2f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722505141
+ git checkout -b scalability-yes-0-32768-0-1722505141
Switched to a new branch 'scalability-yes-0-32768-0-1722505141'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722505141 ba2fd99684] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:39:28 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:39:28 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-0-1722505141 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:40:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 10:40:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ba2fd99684 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722505241
+ git checkout -b scalability-yes-1-32768-0-1722505241
Switched to a new branch 'scalability-yes-1-32768-0-1722505241'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722505241 bf3952c38e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722505241 1636231e1c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:41:08 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:41:08 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-0-1722505241 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:42:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 10:42:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1636231e1c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722505342
+ git checkout -b scalability-yes-1024-32768-0-1722505342
Switched to a new branch 'scalability-yes-1024-32768-0-1722505342'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722505342 de897eeb61] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722505342 5d789a5dc1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:42:48 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:42:48 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-0-1722505342 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:44:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 10:44:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5d789a5dc1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722505442
+ git checkout -b scalability-yes-8-32768-0-1722505442
Switched to a new branch 'scalability-yes-8-32768-0-1722505442'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722505442 49ad1bf957] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722505442 97e1ac0e6c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:44:29 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:44:29 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-0-1722505442 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:45:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 10:45:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 97e1ac0e6c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722505543
+ git checkout -b scalability-yes-512-32768-0-1722505543
Switched to a new branch 'scalability-yes-512-32768-0-1722505543'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722505543 dae209d12d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722505543 455441bb77] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:46:10 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:46:10 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-0-1722505543 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-yes-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:47:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 10:47:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 455441bb77 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722505643
+ git checkout -b scalability-yes-128-32768-0-1722505643
Switched to a new branch 'scalability-yes-128-32768-0-1722505643'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722505643 672c04b18b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722505643 77bc7308c6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:47:50 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:47:50 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-0-1722505643 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:49:03 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 10:49:03 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 77bc7308c6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722505744
+ git checkout -b scalability-no-32-32768-0-1722505744
Switched to a new branch 'scalability-no-32-32768-0-1722505744'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722505744 6b936e7aa8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:49:31 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:49:31 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-0-1722505744 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:50:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 10:50:44 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6b936e7aa8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722505844
+ git checkout -b scalability-no-0-32768-0-1722505844
Switched to a new branch 'scalability-no-0-32768-0-1722505844'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:51:11 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:51:11 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-0-1722505844 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:52:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 10:52:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722505945
+ git checkout -b scalability-no-1-32768-0-1722505945
Switched to a new branch 'scalability-no-1-32768-0-1722505945'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722505945 58e26227a6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:52:52 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:52:52 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-0-1722505945 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:54:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 10:54:05 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 58e26227a6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722506046
+ git checkout -b scalability-no-1024-32768-0-1722506046
Switched to a new branch 'scalability-no-1024-32768-0-1722506046'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722506046 ec79a5a64b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:54:32 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:54:32 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-0-1722506046 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:55:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 10:55:46 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ec79a5a64b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722506146
+ git checkout -b scalability-no-8-32768-0-1722506146
Switched to a new branch 'scalability-no-8-32768-0-1722506146'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722506146 2af3778444] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:56:12 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:56:12 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-0-1722506146 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:57:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 10:57:26 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2af3778444 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722506246
+ git checkout -b scalability-no-512-32768-0-1722506246
Switched to a new branch 'scalability-no-512-32768-0-1722506246'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722506246 d7d47a9695] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:57:53 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:57:53 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-0-1722506246 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/count-no-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 10:59:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 10:59:06 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d7d47a9695 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722506346
+ git checkout -b scalability-no-128-32768-0-1722506346
Switched to a new branch 'scalability-no-128-32768-0-1722506346'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722506346 af5fc96807] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 10:59:33 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 10:59:33 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-0-1722506346 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/count-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:00:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 11:00:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at af5fc96807 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722506446
+ git checkout -b scalability-yes-32-32768-0-1722506446
Switched to a new branch 'scalability-yes-32-32768-0-1722506446'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722506446 1765e39602] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722506446 a1abfc2a9c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:01:13 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:01:13 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-0-1722506446 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:02:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 11:02:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a1abfc2a9c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722506549
+ git checkout -b scalability-yes-0-32768-0-1722506549
Switched to a new branch 'scalability-yes-0-32768-0-1722506549'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722506549 59912fb5f0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:02:55 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:02:55 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-0-1722506549 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:04:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 11:04:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 59912fb5f0 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722506649
+ git checkout -b scalability-yes-1-32768-0-1722506649
Switched to a new branch 'scalability-yes-1-32768-0-1722506649'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722506649 89a9df82ee] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722506649 18223017a0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:04:36 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:04:36 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-0-1722506649 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:05:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 11:05:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 18223017a0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722506750
+ git checkout -b scalability-yes-1024-32768-0-1722506750
Switched to a new branch 'scalability-yes-1024-32768-0-1722506750'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722506750 12e2ef16fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722506750 f70021b698] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:06:17 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:06:17 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-0-1722506750 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:07:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 11:07:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f70021b698 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722506852
+ git checkout -b scalability-yes-8-32768-0-1722506852
Switched to a new branch 'scalability-yes-8-32768-0-1722506852'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722506852 132f65768c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722506852 14c7a46e27] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:07:59 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:07:59 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-0-1722506852 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:09:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 11:09:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 14c7a46e27 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722506953
+ git checkout -b scalability-yes-512-32768-0-1722506953
Switched to a new branch 'scalability-yes-512-32768-0-1722506953'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722506953 43f2f8c5a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722506953 666ceb8c6a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:09:40 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:09:40 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-0-1722506953 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-yes-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:10:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 11:10:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 666ceb8c6a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722507054
+ git checkout -b scalability-yes-128-32768-0-1722507054
Switched to a new branch 'scalability-yes-128-32768-0-1722507054'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722507054 58402853da] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722507054 be84338ba9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:11:21 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:11:21 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-0-1722507054 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:12:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 11:12:35 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at be84338ba9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722507156
+ git checkout -b scalability-no-32-32768-0-1722507156
Switched to a new branch 'scalability-no-32-32768-0-1722507156'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722507156 bbb5a95844] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:13:02 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:13:02 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-0-1722507156 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:14:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 11:14:17 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bbb5a95844 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722507257
+ git checkout -b scalability-no-0-32768-0-1722507257
Switched to a new branch 'scalability-no-0-32768-0-1722507257'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:14:44 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:14:44 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-0-1722507257 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:15:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 11:15:58 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722507358
+ git checkout -b scalability-no-1-32768-0-1722507358
Switched to a new branch 'scalability-no-1-32768-0-1722507358'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722507358 880f5bacf8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:16:25 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:16:25 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-0-1722507358 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:17:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 11:17:38 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 880f5bacf8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722507458
+ git checkout -b scalability-no-1024-32768-0-1722507458
Switched to a new branch 'scalability-no-1024-32768-0-1722507458'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722507458 f86df6f01c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:18:05 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:18:05 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-0-1722507458 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:19:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 11:19:20 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f86df6f01c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722507560
+ git checkout -b scalability-no-8-32768-0-1722507560
Switched to a new branch 'scalability-no-8-32768-0-1722507560'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722507560 bd3497df96] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:19:46 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:19:46 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-0-1722507560 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:21:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 11:21:00 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bd3497df96 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722507661
+ git checkout -b scalability-no-512-32768-0-1722507661
Switched to a new branch 'scalability-no-512-32768-0-1722507661'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722507661 cd8cb27bb3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:21:28 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:21:28 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-0-1722507661 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/pgbench-no-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:22:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 11:22:42 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cd8cb27bb3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722507763
+ git checkout -b scalability-no-128-32768-0-1722507763
Switched to a new branch 'scalability-no-128-32768-0-1722507763'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722507763 dbfba50a99] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:23:09 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:23:09 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-0-1722507763 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/pgbench-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:24:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Thu 1 Aug 11:24:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dbfba50a99 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722507863
+ git checkout -b scalability-yes-32-32768-0-1722507863
Switched to a new branch 'scalability-yes-32-32768-0-1722507863'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722507863 6c5819463b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722507863 5bd5631034] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:24:50 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:24:50 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-0-1722507863 32768 yes 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:24:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Thu 1 Aug 11:24:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5bd5631034 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722507893
+ git checkout -b scalability-yes-0-32768-0-1722507893
Switched to a new branch 'scalability-yes-0-32768-0-1722507893'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722507893 3b3a0e78db] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:25:21 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:25:21 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-0-1722507893 32768 yes 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:25:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Thu 1 Aug 11:25:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3b3a0e78db NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722507924
+ git checkout -b scalability-yes-1-32768-0-1722507924
Switched to a new branch 'scalability-yes-1-32768-0-1722507924'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722507924 a25612719e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722507924 63726a9f19] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:25:50 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:25:50 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-0-1722507924 32768 yes 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:25:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Thu 1 Aug 11:25:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 63726a9f19 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722507954
+ git checkout -b scalability-yes-1024-32768-0-1722507954
Switched to a new branch 'scalability-yes-1024-32768-0-1722507954'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722507954 d0ffb750ec] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722507954 87e56d1b92] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:26:21 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:26:21 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-0-1722507954 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:26:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Thu 1 Aug 11:26:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 87e56d1b92 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722507984
+ git checkout -b scalability-yes-8-32768-0-1722507984
Switched to a new branch 'scalability-yes-8-32768-0-1722507984'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722507984 55cdc199b0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722507984 8363564898] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:26:51 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:26:51 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-0-1722507984 32768 yes 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:26:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Thu 1 Aug 11:26:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8363564898 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722508014
+ git checkout -b scalability-yes-512-32768-0-1722508014
Switched to a new branch 'scalability-yes-512-32768-0-1722508014'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722508014 be692b5989] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722508014 164053f747] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:27:21 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:27:21 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-0-1722508014 32768 yes 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-yes-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:27:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Thu 1 Aug 11:27:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 164053f747 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722508044
+ git checkout -b scalability-yes-128-32768-0-1722508044
Switched to a new branch 'scalability-yes-128-32768-0-1722508044'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722508044 e96ff688bf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722508044 61c46f5e18] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:27:52 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:27:52 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-0-1722508044 32768 yes 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-32-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:27:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Thu 1 Aug 11:27:56 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 61c46f5e18 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722508076
+ git checkout -b scalability-no-32-32768-0-1722508076
Switched to a new branch 'scalability-no-32-32768-0-1722508076'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722508076 407b1f7e96] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:28:24 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:28:24 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-0-1722508076 32768 no 32 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-0-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:28:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Thu 1 Aug 11:28:28 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 407b1f7e96 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722508108
+ git checkout -b scalability-no-0-32768-0-1722508108
Switched to a new branch 'scalability-no-0-32768-0-1722508108'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:28:55 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:28:55 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-0-1722508108 32768 no 0 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:28:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Thu 1 Aug 11:28:58 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722508138
+ git checkout -b scalability-no-1-32768-0-1722508138
Switched to a new branch 'scalability-no-1-32768-0-1722508138'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722508138 8340a80fe3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:29:26 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:29:26 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-0-1722508138 32768 no 1 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-1024-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:29:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Thu 1 Aug 11:29:29 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8340a80fe3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722508169
+ git checkout -b scalability-no-1024-32768-0-1722508169
Switched to a new branch 'scalability-no-1024-32768-0-1722508169'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722508169 94e91d965a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:29:56 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:29:56 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-0-1722508169 32768 no 1024 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-8-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:29:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Thu 1 Aug 11:29:59 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 94e91d965a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722508199
+ git checkout -b scalability-no-8-32768-0-1722508199
Switched to a new branch 'scalability-no-8-32768-0-1722508199'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722508199 db80fec406] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:30:26 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:30:26 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-0-1722508199 32768 no 8 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-512-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:30:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Thu 1 Aug 11:30:29 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at db80fec406 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722508230
+ git checkout -b scalability-no-512-32768-0-1722508230
Switched to a new branch 'scalability-no-512-32768-0-1722508230'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722508230 6c856babb0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:30:56 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:30:56 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-0-1722508230 32768 no 512 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/results/star-no-128-32768-0
+ env
++ date
+ echo Thu 1 Aug 11:31:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Thu 1 Aug 11:31:00 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6c856babb0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722508260
+ git checkout -b scalability-no-128-32768-0-1722508260
Switched to a new branch 'scalability-no-128-32768-0-1722508260'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722508260 8dc5cd46c9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Thu 1 Aug 11:31:26 BST 2024 'RUN   files: 32768  partitions: 0'
Thu 1 Aug 11:31:26 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-0-1722508260 32768 no 128 /mnt/data/lock-scalability-test/20240731-1359-glibc-tuned/logs/star-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
