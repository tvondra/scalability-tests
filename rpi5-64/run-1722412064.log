+ set -e
+ LABEL=glibc-default
+ MACHINE=rpi5-64
+ DBNAME=test
+ RUNS=1
+ DURATION=10
+ CLIENTS='1 4 8'
+ PARTITIONS=10
+ BUILDS=/mnt/data/builds
+ SOURCE=/mnt/data/postgres
+ PATH_OLD=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
++ date +%Y%m%d-%H%M
+ DATE=20240731-0847
++ pwd
+ PATCHES=/mnt/data/lock-scalability-test/patches
++ pwd
+ LOGS=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs
++ pwd
+ RESULTS=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results
+ DATADIR=/mnt/data/data-test
+ ulimit -n 35000
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 08:47:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 08:47:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 83a08e2b77 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722412064
+ git checkout -b scalability-yes-32-1000-10-1722412064
Switched to a new branch 'scalability-yes-32-1000-10-1722412064'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722412064 0dac15813e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722412064 0d71854039] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 08:48:11 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 08:48:11 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-10-1722412064 1000 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 08:49:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 08:49:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0d71854039 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722412165
+ git checkout -b scalability-yes-0-1000-10-1722412165
Switched to a new branch 'scalability-yes-0-1000-10-1722412165'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722412165 e3ad5a9ac4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 08:50:22 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 08:50:22 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-10-1722412165 1000 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 08:51:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 08:51:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e3ad5a9ac4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722412296
+ git checkout -b scalability-yes-1-1000-10-1722412296
Switched to a new branch 'scalability-yes-1-1000-10-1722412296'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722412296 f3693d28d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722412296 db86895c10] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 08:52:33 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 08:52:33 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-10-1722412296 1000 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 08:53:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 08:53:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at db86895c10 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722412427
+ git checkout -b scalability-yes-1024-1000-10-1722412427
Switched to a new branch 'scalability-yes-1024-1000-10-1722412427'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722412427 f921e1aff6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722412427 acb2d89624] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 08:54:44 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 08:54:44 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-10-1722412427 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 08:55:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 08:55:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at acb2d89624 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722412558
+ git checkout -b scalability-yes-8-1000-10-1722412558
Switched to a new branch 'scalability-yes-8-1000-10-1722412558'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722412558 79dd9514cc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722412558 a6c25b5cd7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 08:56:54 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 08:56:54 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-10-1722412558 1000 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 08:58:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 08:58:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a6c25b5cd7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722412688
+ git checkout -b scalability-yes-512-1000-10-1722412688
Switched to a new branch 'scalability-yes-512-1000-10-1722412688'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722412688 40ba9c050b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722412688 0381f0b731] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 08:59:05 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 08:59:05 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-10-1722412688 1000 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:00:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 09:00:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0381f0b731 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722412819
+ git checkout -b scalability-yes-128-1000-10-1722412819
Switched to a new branch 'scalability-yes-128-1000-10-1722412819'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722412819 b264e6b7df] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722412819 cb04ba8182] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:01:15 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:01:15 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-10-1722412819 1000 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:02:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 09:02:29 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cb04ba8182 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722412949
+ git checkout -b scalability-no-32-1000-10-1722412949
Switched to a new branch 'scalability-no-32-1000-10-1722412949'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722412949 61c754fe33] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:03:26 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:03:26 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-10-1722412949 1000 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:04:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 09:04:40 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 61c754fe33 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722413080
+ git checkout -b scalability-no-0-1000-10-1722413080
Switched to a new branch 'scalability-no-0-1000-10-1722413080'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:05:36 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:05:36 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-10-1722413080 1000 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:06:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 09:06:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722413210
+ git checkout -b scalability-no-1-1000-10-1722413210
Switched to a new branch 'scalability-no-1-1000-10-1722413210'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722413210 8482254b93] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:07:47 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:07:47 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-10-1722413210 1000 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:09:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 09:09:01 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8482254b93 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722413341
+ git checkout -b scalability-no-1024-1000-10-1722413341
Switched to a new branch 'scalability-no-1024-1000-10-1722413341'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722413341 7584eca048] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:09:59 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:09:59 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-10-1722413341 1000 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:11:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 09:11:13 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7584eca048 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722413473
+ git checkout -b scalability-no-8-1000-10-1722413473
Switched to a new branch 'scalability-no-8-1000-10-1722413473'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722413473 c9d65bd54e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:12:10 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:12:10 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-10-1722413473 1000 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:13:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 09:13:24 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c9d65bd54e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722413604
+ git checkout -b scalability-no-512-1000-10-1722413604
Switched to a new branch 'scalability-no-512-1000-10-1722413604'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722413604 33efbe59d3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:14:21 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:14:21 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-10-1722413604 1000 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:15:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 09:15:35 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 33efbe59d3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722413735
+ git checkout -b scalability-no-128-1000-10-1722413735
Switched to a new branch 'scalability-no-128-1000-10-1722413735'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722413735 cae83fa744] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:16:33 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:16:33 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-10-1722413735 1000 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:17:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 09:17:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cae83fa744 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722413867
+ git checkout -b scalability-yes-32-1000-10-1722413867
Switched to a new branch 'scalability-yes-32-1000-10-1722413867'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722413867 cae5c77e27] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722413867 9fa745db52] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:18:14 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:18:14 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-10-1722413867 1000 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:19:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 09:19:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9fa745db52 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722413971
+ git checkout -b scalability-yes-0-1000-10-1722413971
Switched to a new branch 'scalability-yes-0-1000-10-1722413971'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722413971 73f6ac7ce4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:19:58 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:19:58 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-10-1722413971 1000 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:21:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 09:21:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 73f6ac7ce4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722414077
+ git checkout -b scalability-yes-1-1000-10-1722414077
Switched to a new branch 'scalability-yes-1-1000-10-1722414077'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722414077 57cbdc2cc1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722414077 3c70c4993a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:21:44 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:21:44 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-10-1722414077 1000 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:23:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 09:23:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3c70c4993a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722414181
+ git checkout -b scalability-yes-1024-1000-10-1722414181
Switched to a new branch 'scalability-yes-1024-1000-10-1722414181'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722414181 52dea4de4e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722414181 6bf27bea81] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:23:28 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:23:28 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-10-1722414181 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:24:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 09:24:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6bf27bea81 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722414284
+ git checkout -b scalability-yes-8-1000-10-1722414284
Switched to a new branch 'scalability-yes-8-1000-10-1722414284'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722414284 1f7ad767a0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722414284 de2da449c4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:25:11 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:25:11 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-10-1722414284 1000 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:26:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 09:26:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at de2da449c4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722414388
+ git checkout -b scalability-yes-512-1000-10-1722414388
Switched to a new branch 'scalability-yes-512-1000-10-1722414388'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722414388 7824facb33] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722414388 ed9b974e8d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:26:55 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:26:55 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-10-1722414388 1000 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:28:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 09:28:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ed9b974e8d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722414491
+ git checkout -b scalability-yes-128-1000-10-1722414491
Switched to a new branch 'scalability-yes-128-1000-10-1722414491'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722414491 186f6ecbc8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722414491 c40f10d544] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:28:38 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:28:38 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-10-1722414491 1000 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:29:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 09:29:55 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c40f10d544 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722414595
+ git checkout -b scalability-no-32-1000-10-1722414595
Switched to a new branch 'scalability-no-32-1000-10-1722414595'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722414595 e86cf0c548] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:30:22 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:30:22 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-10-1722414595 1000 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:31:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 09:31:39 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e86cf0c548 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722414699
+ git checkout -b scalability-no-0-1000-10-1722414699
Switched to a new branch 'scalability-no-0-1000-10-1722414699'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:32:06 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:32:06 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-10-1722414699 1000 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:33:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 09:33:23 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722414803
+ git checkout -b scalability-no-1-1000-10-1722414803
Switched to a new branch 'scalability-no-1-1000-10-1722414803'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722414803 bbd76b3b0f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:33:50 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:33:50 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-10-1722414803 1000 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:35:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 09:35:06 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bbd76b3b0f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722414906
+ git checkout -b scalability-no-1024-1000-10-1722414906
Switched to a new branch 'scalability-no-1024-1000-10-1722414906'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722414906 efd7235a63] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:35:34 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:35:34 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-10-1722414906 1000 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:36:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 09:36:52 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at efd7235a63 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722415012
+ git checkout -b scalability-no-8-1000-10-1722415012
Switched to a new branch 'scalability-no-8-1000-10-1722415012'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722415012 c36f569351] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:37:19 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:37:19 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-10-1722415012 1000 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:38:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 09:38:37 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c36f569351 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722415117
+ git checkout -b scalability-no-512-1000-10-1722415117
Switched to a new branch 'scalability-no-512-1000-10-1722415117'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722415117 53047f7440] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:39:04 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:39:04 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-10-1722415117 1000 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:40:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 09:40:20 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 53047f7440 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722415220
+ git checkout -b scalability-no-128-1000-10-1722415220
Switched to a new branch 'scalability-no-128-1000-10-1722415220'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722415220 0f03b5a8ce] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:40:47 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:40:47 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-10-1722415220 1000 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:42:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 09:42:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0f03b5a8ce fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722415324
+ git checkout -b scalability-yes-32-1000-10-1722415324
Switched to a new branch 'scalability-yes-32-1000-10-1722415324'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722415324 eacfd78f3e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722415324 52558d7cac] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:42:30 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:42:30 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-10-1722415324 1000 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:43:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 09:43:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 52558d7cac fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722415424
+ git checkout -b scalability-yes-0-1000-10-1722415424
Switched to a new branch 'scalability-yes-0-1000-10-1722415424'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722415424 3dbcecf7a3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:44:11 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:44:11 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-10-1722415424 1000 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:45:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 09:45:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3dbcecf7a3 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722415525
+ git checkout -b scalability-yes-1-1000-10-1722415525
Switched to a new branch 'scalability-yes-1-1000-10-1722415525'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722415525 d6b41148ad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722415525 afa79f3675] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:45:51 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:45:51 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-10-1722415525 1000 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:47:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 09:47:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at afa79f3675 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722415625
+ git checkout -b scalability-yes-1024-1000-10-1722415625
Switched to a new branch 'scalability-yes-1024-1000-10-1722415625'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722415625 14669efab9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722415625 936ef0e9d0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:47:32 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:47:32 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-10-1722415625 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:48:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 09:48:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 936ef0e9d0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722415726
+ git checkout -b scalability-yes-8-1000-10-1722415726
Switched to a new branch 'scalability-yes-8-1000-10-1722415726'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722415726 3e8c460c75] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722415726 ce6dc6cb83] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:49:12 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:49:12 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-10-1722415726 1000 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:50:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 09:50:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ce6dc6cb83 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722415826
+ git checkout -b scalability-yes-512-1000-10-1722415826
Switched to a new branch 'scalability-yes-512-1000-10-1722415826'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722415826 1afa75ead2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722415826 e64c9b29e7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:50:53 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:50:53 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-10-1722415826 1000 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:52:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 09:52:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e64c9b29e7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722415928
+ git checkout -b scalability-yes-128-1000-10-1722415928
Switched to a new branch 'scalability-yes-128-1000-10-1722415928'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722415928 1642b4aa10] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722415928 b0b53b9512] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:52:34 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:52:34 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-10-1722415928 1000 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:53:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 09:53:48 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b0b53b9512 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722416028
+ git checkout -b scalability-no-32-1000-10-1722416028
Switched to a new branch 'scalability-no-32-1000-10-1722416028'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722416028 364d8a8434] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:54:15 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:54:15 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-10-1722416028 1000 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:55:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 09:55:28 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 364d8a8434 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722416128
+ git checkout -b scalability-no-0-1000-10-1722416128
Switched to a new branch 'scalability-no-0-1000-10-1722416128'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:55:55 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:55:55 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-10-1722416128 1000 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:57:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 09:57:09 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722416229
+ git checkout -b scalability-no-1-1000-10-1722416229
Switched to a new branch 'scalability-no-1-1000-10-1722416229'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722416229 7a635214fb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:57:35 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:57:35 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-10-1722416229 1000 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 09:58:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 09:58:49 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7a635214fb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722416329
+ git checkout -b scalability-no-1024-1000-10-1722416329
Switched to a new branch 'scalability-no-1024-1000-10-1722416329'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722416329 a3855d331b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 09:59:16 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 09:59:16 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-10-1722416329 1000 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:00:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 10:00:30 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a3855d331b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722416430
+ git checkout -b scalability-no-8-1000-10-1722416430
Switched to a new branch 'scalability-no-8-1000-10-1722416430'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722416430 d6c90e2d34] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:00:56 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:00:56 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-10-1722416430 1000 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:02:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 10:02:10 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6c90e2d34 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722416530
+ git checkout -b scalability-no-512-1000-10-1722416530
Switched to a new branch 'scalability-no-512-1000-10-1722416530'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722416530 70faaaeb4d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:02:37 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:02:37 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-10-1722416530 1000 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:03:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 10:03:50 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 70faaaeb4d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722416630
+ git checkout -b scalability-no-128-1000-10-1722416630
Switched to a new branch 'scalability-no-128-1000-10-1722416630'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722416630 9b6b0fa17e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:04:18 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:04:18 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-10-1722416630 1000 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:05:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 10:05:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9b6b0fa17e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722416731
+ git checkout -b scalability-yes-32-1000-10-1722416731
Switched to a new branch 'scalability-yes-32-1000-10-1722416731'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722416731 1df0f86de3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722416731 72bc2f3ea8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:05:58 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:05:58 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-10-1722416731 1000 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:07:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 10:07:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 72bc2f3ea8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722416832
+ git checkout -b scalability-yes-0-1000-10-1722416832
Switched to a new branch 'scalability-yes-0-1000-10-1722416832'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722416832 9bf5500103] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:07:39 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:07:39 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-10-1722416832 1000 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:08:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 10:08:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9bf5500103 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722416933
+ git checkout -b scalability-yes-1-1000-10-1722416933
Switched to a new branch 'scalability-yes-1-1000-10-1722416933'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722416933 b6d3e57576] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722416933 6cafa9557f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:09:20 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:09:20 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-10-1722416933 1000 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:10:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 10:10:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6cafa9557f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722417034
+ git checkout -b scalability-yes-1024-1000-10-1722417034
Switched to a new branch 'scalability-yes-1024-1000-10-1722417034'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722417034 f3fbb897e8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722417034 e736c8f9b3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:11:00 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:11:00 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-10-1722417034 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:12:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 10:12:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e736c8f9b3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722417134
+ git checkout -b scalability-yes-8-1000-10-1722417134
Switched to a new branch 'scalability-yes-8-1000-10-1722417134'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722417134 c29934c784] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722417134 b01a97068d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:12:41 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:12:41 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-10-1722417134 1000 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:13:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 10:13:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b01a97068d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722417235
+ git checkout -b scalability-yes-512-1000-10-1722417235
Switched to a new branch 'scalability-yes-512-1000-10-1722417235'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722417235 856688644a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722417235 77251130e8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:14:22 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:14:22 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-10-1722417235 1000 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:15:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 10:15:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 77251130e8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722417336
+ git checkout -b scalability-yes-128-1000-10-1722417336
Switched to a new branch 'scalability-yes-128-1000-10-1722417336'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722417336 3e9e2fb587] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722417336 c283391767] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:16:03 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:16:03 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-10-1722417336 1000 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:17:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 10:17:17 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c283391767 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722417437
+ git checkout -b scalability-no-32-1000-10-1722417437
Switched to a new branch 'scalability-no-32-1000-10-1722417437'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722417437 bcf8ca183d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:17:44 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:17:44 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-10-1722417437 1000 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:18:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 10:18:58 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bcf8ca183d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722417538
+ git checkout -b scalability-no-0-1000-10-1722417538
Switched to a new branch 'scalability-no-0-1000-10-1722417538'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:19:25 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:19:25 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-10-1722417538 1000 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:20:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 10:20:40 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722417640
+ git checkout -b scalability-no-1-1000-10-1722417640
Switched to a new branch 'scalability-no-1-1000-10-1722417640'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722417640 f84aa9ea7d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:21:07 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:21:07 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-10-1722417640 1000 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:22:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 10:22:21 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f84aa9ea7d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722417742
+ git checkout -b scalability-no-1024-1000-10-1722417742
Switched to a new branch 'scalability-no-1024-1000-10-1722417742'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722417742 c5c37f1880] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:22:48 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:22:48 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-10-1722417742 1000 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:24:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 10:24:02 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c5c37f1880 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722417842
+ git checkout -b scalability-no-8-1000-10-1722417842
Switched to a new branch 'scalability-no-8-1000-10-1722417842'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722417842 e9df6fab20] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:24:29 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:24:29 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-10-1722417842 1000 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:25:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 10:25:43 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e9df6fab20 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722417943
+ git checkout -b scalability-no-512-1000-10-1722417943
Switched to a new branch 'scalability-no-512-1000-10-1722417943'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722417943 3bdcead5a8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:26:10 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:26:10 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-10-1722417943 1000 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:27:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 10:27:24 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3bdcead5a8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722418044
+ git checkout -b scalability-no-128-1000-10-1722418044
Switched to a new branch 'scalability-no-128-1000-10-1722418044'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722418044 0ecf4cd350] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:27:51 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:27:51 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-10-1722418044 1000 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:29:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 10:29:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0ecf4cd350 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722418145
+ git checkout -b scalability-yes-32-1000-10-1722418145
Switched to a new branch 'scalability-yes-32-1000-10-1722418145'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722418145 a8bb41fe8b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722418145 1773dff795] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:29:31 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:29:31 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-10-1722418145 1000 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:31:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 10:31:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1773dff795 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722418263
+ git checkout -b scalability-yes-0-1000-10-1722418263
Switched to a new branch 'scalability-yes-0-1000-10-1722418263'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722418263 af89ee2460] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:31:30 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:31:30 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-10-1722418263 1000 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:33:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 10:33:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at af89ee2460 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722418380
+ git checkout -b scalability-yes-1-1000-10-1722418380
Switched to a new branch 'scalability-yes-1-1000-10-1722418380'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722418380 c4e6d637d1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722418380 79891d3dc9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:33:27 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:33:27 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-10-1722418380 1000 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:34:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 10:34:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79891d3dc9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722418499
+ git checkout -b scalability-yes-1024-1000-10-1722418499
Switched to a new branch 'scalability-yes-1024-1000-10-1722418499'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722418499 445f593415] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722418499 005c7af8c9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:35:26 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:35:26 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-10-1722418499 1000 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:36:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 10:36:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 005c7af8c9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722418618
+ git checkout -b scalability-yes-8-1000-10-1722418618
Switched to a new branch 'scalability-yes-8-1000-10-1722418618'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722418618 9cbde4001f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722418618 a86a474ce7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:37:25 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:37:25 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-10-1722418618 1000 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:38:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 10:38:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a86a474ce7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722418736
+ git checkout -b scalability-yes-512-1000-10-1722418736
Switched to a new branch 'scalability-yes-512-1000-10-1722418736'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722418736 b54767a058] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722418736 4d9b1f7d07] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:39:24 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:39:24 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-10-1722418736 1000 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:40:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 10:40:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4d9b1f7d07 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722418856
+ git checkout -b scalability-yes-128-1000-10-1722418856
Switched to a new branch 'scalability-yes-128-1000-10-1722418856'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722418856 84ac359d28] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722418856 0f5df72e4c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:41:24 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:41:24 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-10-1722418856 1000 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-32-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:42:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 10:42:53 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0f5df72e4c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722418973
+ git checkout -b scalability-no-32-1000-10-1722418973
Switched to a new branch 'scalability-no-32-1000-10-1722418973'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722418973 787c6b0cec] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:43:20 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:43:20 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-10-1722418973 1000 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-0-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:44:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 10:44:52 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 787c6b0cec fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722419092
+ git checkout -b scalability-no-0-1000-10-1722419092
Switched to a new branch 'scalability-no-0-1000-10-1722419092'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:45:19 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:45:19 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-10-1722419092 1000 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:46:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 10:46:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722419210
+ git checkout -b scalability-no-1-1000-10-1722419210
Switched to a new branch 'scalability-no-1-1000-10-1722419210'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722419210 862ab0442e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:47:18 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:47:18 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-10-1722419210 1000 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1024-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:48:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 10:48:47 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 862ab0442e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722419327
+ git checkout -b scalability-no-1024-1000-10-1722419327
Switched to a new branch 'scalability-no-1024-1000-10-1722419327'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722419327 3a0da1a344] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:49:14 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:49:14 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-10-1722419327 1000 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-8-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:50:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 10:50:45 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3a0da1a344 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722419445
+ git checkout -b scalability-no-8-1000-10-1722419445
Switched to a new branch 'scalability-no-8-1000-10-1722419445'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722419445 840cdbc8a8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:51:12 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:51:12 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-10-1722419445 1000 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-512-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:52:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 10:52:44 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 840cdbc8a8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722419564
+ git checkout -b scalability-no-512-1000-10-1722419564
Switched to a new branch 'scalability-no-512-1000-10-1722419564'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722419564 24915efd3c] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:53:11 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:53:11 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-10-1722419564 1000 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-1000-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-1000-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-128-1000-10
+ env
++ date
+ echo Wed 31 Jul 10:54:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 10:54:41 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 24915efd3c fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722419681
+ git checkout -b scalability-no-128-1000-10-1722419681
Switched to a new branch 'scalability-no-128-1000-10-1722419681'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722419681 c9aa1dac54] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:55:08 BST 2024 'RUN   files: 1000  partitions: 10'
Wed 31 Jul 10:55:08 BST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-10-1722419681 1000 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-1000-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 10:56:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 10:56:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c9aa1dac54 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722419797
+ git checkout -b scalability-yes-32-32768-10-1722419797
Switched to a new branch 'scalability-yes-32-32768-10-1722419797'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722419797 8449466586] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722419797 3afacfacc0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:57:34 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 10:57:34 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-10-1722419797 32768 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 10:58:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 10:58:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3afacfacc0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722419930
+ git checkout -b scalability-yes-0-32768-10-1722419930
Switched to a new branch 'scalability-yes-0-32768-10-1722419930'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722419930 c437b32a5b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 10:59:48 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 10:59:48 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-10-1722419930 32768 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:01:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 11:01:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c437b32a5b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722420062
+ git checkout -b scalability-yes-1-32768-10-1722420062
Switched to a new branch 'scalability-yes-1-32768-10-1722420062'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722420062 d1d098bd46] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722420062 c7266dca8a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:01:59 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:01:59 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-10-1722420062 32768 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:03:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 11:03:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c7266dca8a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722420194
+ git checkout -b scalability-yes-1024-32768-10-1722420194
Switched to a new branch 'scalability-yes-1024-32768-10-1722420194'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722420194 3256ac6bc1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722420194 1429b27ba1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:04:10 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:04:10 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-10-1722420194 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:05:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 11:05:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1429b27ba1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722420325
+ git checkout -b scalability-yes-8-32768-10-1722420325
Switched to a new branch 'scalability-yes-8-32768-10-1722420325'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722420325 030579528f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722420325 5e7fa0ec84] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:06:23 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:06:23 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-10-1722420325 32768 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:07:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 11:07:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5e7fa0ec84 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722420457
+ git checkout -b scalability-yes-512-32768-10-1722420457
Switched to a new branch 'scalability-yes-512-32768-10-1722420457'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722420457 a1436836f5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722420457 792b53ce54] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:08:33 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:08:33 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-10-1722420457 32768 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-yes-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:09:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 11:09:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 792b53ce54 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722420587
+ git checkout -b scalability-yes-128-32768-10-1722420587
Switched to a new branch 'scalability-yes-128-32768-10-1722420587'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722420587 597657819b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722420587 443b239c72] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:10:44 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:10:44 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-10-1722420587 32768 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:11:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 11:11:58 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 443b239c72 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722420718
+ git checkout -b scalability-no-32-32768-10-1722420718
Switched to a new branch 'scalability-no-32-32768-10-1722420718'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722420718 7ebe5012c7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:12:54 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:12:54 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-10-1722420718 32768 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:14:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 11:14:08 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7ebe5012c7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722420848
+ git checkout -b scalability-no-0-32768-10-1722420848
Switched to a new branch 'scalability-no-0-32768-10-1722420848'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:15:04 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:15:04 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-10-1722420848 32768 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:16:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 11:16:19 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722420980
+ git checkout -b scalability-no-1-32768-10-1722420980
Switched to a new branch 'scalability-no-1-32768-10-1722420980'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722420980 5511027100] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:17:16 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:17:16 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-10-1722420980 32768 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:18:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 11:18:30 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5511027100 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722421110
+ git checkout -b scalability-no-1024-32768-10-1722421110
Switched to a new branch 'scalability-no-1024-32768-10-1722421110'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722421110 aa4e2526b3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:19:28 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:19:28 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-10-1722421110 32768 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:20:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 11:20:43 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at aa4e2526b3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722421243
+ git checkout -b scalability-no-8-32768-10-1722421243
Switched to a new branch 'scalability-no-8-32768-10-1722421243'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722421243 466a43d6aa] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:21:40 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:21:40 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-10-1722421243 32768 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:22:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 11:22:54 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 466a43d6aa fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722421374
+ git checkout -b scalability-no-512-32768-10-1722421374
Switched to a new branch 'scalability-no-512-32768-10-1722421374'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722421374 3610cec46a] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:23:51 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:23:51 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-10-1722421374 32768 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/index-no-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:25:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 11:25:05 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3610cec46a fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722421505
+ git checkout -b scalability-no-128-32768-10-1722421505
Switched to a new branch 'scalability-no-128-32768-10-1722421505'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722421505 dd4718aaff] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:26:02 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:26:02 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-10-1722421505 32768 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/index-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:27:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 11:27:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dd4718aaff fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722421636
+ git checkout -b scalability-yes-32-32768-10-1722421636
Switched to a new branch 'scalability-yes-32-32768-10-1722421636'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722421636 bd89759332] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722421636 bdf63e5bdf] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:27:43 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:27:43 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-10-1722421636 32768 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:28:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 11:28:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bdf63e5bdf fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722421739
+ git checkout -b scalability-yes-0-32768-10-1722421739
Switched to a new branch 'scalability-yes-0-32768-10-1722421739'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722421739 34618c88cf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:29:27 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:29:27 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-10-1722421739 32768 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:30:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 11:30:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 34618c88cf NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722421843
+ git checkout -b scalability-yes-1-32768-10-1722421843
Switched to a new branch 'scalability-yes-1-32768-10-1722421843'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722421843 5a182f7fc2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722421843 dcd014d2be] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:31:10 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:31:10 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-10-1722421843 32768 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:32:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 11:32:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dcd014d2be fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722421947
+ git checkout -b scalability-yes-1024-32768-10-1722421947
Switched to a new branch 'scalability-yes-1024-32768-10-1722421947'
+ '[' yes == yes ']'
+ patch -p1
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722421947 721610c017] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722421947 b45b3deab1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:32:54 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:32:54 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-10-1722421947 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:34:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 11:34:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b45b3deab1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722422051
+ git checkout -b scalability-yes-8-32768-10-1722422051
Switched to a new branch 'scalability-yes-8-32768-10-1722422051'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722422051 c8f498b26f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722422051 0348b7489d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:34:38 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:34:38 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-10-1722422051 32768 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:35:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 11:35:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0348b7489d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722422155
+ git checkout -b scalability-yes-512-32768-10-1722422155
Switched to a new branch 'scalability-yes-512-32768-10-1722422155'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722422155 47f8b17628] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722422155 af96c87f27] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:36:23 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:36:23 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-10-1722422155 32768 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-yes-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:37:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 11:37:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at af96c87f27 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722422259
+ git checkout -b scalability-yes-128-32768-10-1722422259
Switched to a new branch 'scalability-yes-128-32768-10-1722422259'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722422259 ee6b2364b5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722422259 5a54da06e4] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:38:06 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:38:06 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-10-1722422259 32768 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:39:22 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 11:39:22 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5a54da06e4 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722422363
+ git checkout -b scalability-no-32-32768-10-1722422363
Switched to a new branch 'scalability-no-32-32768-10-1722422363'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722422363 e5552433f0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:39:50 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:39:50 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-10-1722422363 32768 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:41:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 11:41:06 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e5552433f0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722422467
+ git checkout -b scalability-no-0-32768-10-1722422467
Switched to a new branch 'scalability-no-0-32768-10-1722422467'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:41:34 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:41:34 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-10-1722422467 32768 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:42:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 11:42:51 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722422571
+ git checkout -b scalability-no-1-32768-10-1722422571
Switched to a new branch 'scalability-no-1-32768-10-1722422571'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722422571 e10840df9e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:43:17 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:43:17 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-10-1722422571 32768 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:44:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 11:44:34 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e10840df9e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722422674
+ git checkout -b scalability-no-1024-32768-10-1722422674
Switched to a new branch 'scalability-no-1024-32768-10-1722422674'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722422674 08507749e8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:45:01 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:45:01 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-10-1722422674 32768 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:46:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 11:46:19 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 08507749e8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722422779
+ git checkout -b scalability-no-8-32768-10-1722422779
Switched to a new branch 'scalability-no-8-32768-10-1722422779'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722422779 226316c6f4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:46:45 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:46:45 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-10-1722422779 32768 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:48:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 11:48:02 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 226316c6f4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722422882
+ git checkout -b scalability-no-512-32768-10-1722422882
Switched to a new branch 'scalability-no-512-32768-10-1722422882'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722422882 9855b53dd1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:48:29 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:48:29 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-10-1722422882 32768 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/join-no-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:49:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 11:49:45 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9855b53dd1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722422985
+ git checkout -b scalability-no-128-32768-10-1722422985
Switched to a new branch 'scalability-no-128-32768-10-1722422985'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722422985 99d38faafb] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:50:12 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:50:12 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-10-1722422985 32768 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/join-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:51:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 11:51:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 99d38faafb fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722423089
+ git checkout -b scalability-yes-32-32768-10-1722423089
Switched to a new branch 'scalability-yes-32-32768-10-1722423089'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722423089 60c3dfe5d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722423089 2d7a8d8447] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:51:56 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:51:56 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-10-1722423089 32768 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:53:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 11:53:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2d7a8d8447 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722423190
+ git checkout -b scalability-yes-0-32768-10-1722423190
Switched to a new branch 'scalability-yes-0-32768-10-1722423190'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722423190 8d2d91632d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:53:36 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:53:36 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-10-1722423190 32768 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:54:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 11:54:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8d2d91632d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722423290
+ git checkout -b scalability-yes-1-32768-10-1722423290
Switched to a new branch 'scalability-yes-1-32768-10-1722423290'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722423290 37e03e0127] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722423290 97148cdac8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:55:17 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:55:17 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-10-1722423290 32768 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:56:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 11:56:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 97148cdac8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722423391
+ git checkout -b scalability-yes-1024-32768-10-1722423391
Switched to a new branch 'scalability-yes-1024-32768-10-1722423391'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722423391 fc7f69dae5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722423391 1b51a70ad8] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:56:57 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:56:57 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-10-1722423391 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:58:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 11:58:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1b51a70ad8 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722423492
+ git checkout -b scalability-yes-8-32768-10-1722423492
Switched to a new branch 'scalability-yes-8-32768-10-1722423492'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722423492 083f8f913f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722423492 7f94a3c084] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 11:58:38 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 11:58:38 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-10-1722423492 32768 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 11:59:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 11:59:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7f94a3c084 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722423592
+ git checkout -b scalability-yes-512-32768-10-1722423592
Switched to a new branch 'scalability-yes-512-32768-10-1722423592'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722423592 77b67007c7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722423592 2aa6b232a7] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:00:19 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:00:19 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-10-1722423592 32768 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-yes-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:01:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 12:01:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2aa6b232a7 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722423693
+ git checkout -b scalability-yes-128-32768-10-1722423693
Switched to a new branch 'scalability-yes-128-32768-10-1722423693'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722423693 e54956df1f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722423693 8ad7ce3e76] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:02:00 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:02:00 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-10-1722423693 32768 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:03:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 12:03:13 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8ad7ce3e76 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722423794
+ git checkout -b scalability-no-32-32768-10-1722423794
Switched to a new branch 'scalability-no-32-32768-10-1722423794'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722423794 0bc652c4e2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:03:40 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:03:40 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-10-1722423794 32768 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:04:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 12:04:54 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0bc652c4e2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722423894
+ git checkout -b scalability-no-0-32768-10-1722423894
Switched to a new branch 'scalability-no-0-32768-10-1722423894'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:05:21 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:05:21 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-10-1722423894 32768 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:06:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 12:06:35 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722423995
+ git checkout -b scalability-no-1-32768-10-1722423995
Switched to a new branch 'scalability-no-1-32768-10-1722423995'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722423995 b3bf26906c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:07:02 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:07:02 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-10-1722423995 32768 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:08:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 12:08:15 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b3bf26906c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722424095
+ git checkout -b scalability-no-1024-32768-10-1722424095
Switched to a new branch 'scalability-no-1024-32768-10-1722424095'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722424095 1233e30287] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:08:42 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:08:42 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-10-1722424095 32768 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:09:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 12:09:56 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1233e30287 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722424196
+ git checkout -b scalability-no-8-32768-10-1722424196
Switched to a new branch 'scalability-no-8-32768-10-1722424196'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722424196 21dd8cf20d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:10:23 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:10:23 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-10-1722424196 32768 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:11:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 12:11:36 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 21dd8cf20d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722424296
+ git checkout -b scalability-no-512-32768-10-1722424296
Switched to a new branch 'scalability-no-512-32768-10-1722424296'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722424296 0fa12d9f70] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:12:03 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:12:03 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-10-1722424296 32768 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/count-no-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:13:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 12:13:17 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0fa12d9f70 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722424397
+ git checkout -b scalability-no-128-32768-10-1722424397
Switched to a new branch 'scalability-no-128-32768-10-1722424397'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722424397 603d7b6b05] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:13:44 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:13:44 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-10-1722424397 32768 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/count-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:14:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 12:14:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 603d7b6b05 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722424498
+ git checkout -b scalability-yes-32-32768-10-1722424498
Switched to a new branch 'scalability-yes-32-32768-10-1722424498'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722424498 5918fc297b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722424498 8dc012ca32] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:15:25 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:15:25 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-10-1722424498 32768 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:16:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 12:16:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8dc012ca32 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722424599
+ git checkout -b scalability-yes-0-32768-10-1722424599
Switched to a new branch 'scalability-yes-0-32768-10-1722424599'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722424599 f0f8799d42] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:17:05 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:17:05 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-10-1722424599 32768 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:18:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 12:18:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f0f8799d42 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722424700
+ git checkout -b scalability-yes-1-32768-10-1722424700
Switched to a new branch 'scalability-yes-1-32768-10-1722424700'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722424700 3f411e95c8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722424700 c516333bc9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:18:47 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:18:47 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-10-1722424700 32768 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:20:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 12:20:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c516333bc9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722424801
+ git checkout -b scalability-yes-1024-32768-10-1722424801
Switched to a new branch 'scalability-yes-1024-32768-10-1722424801'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722424801 f4de6e7593] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722424801 638d1253ef] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:20:28 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:20:28 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-10-1722424801 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:21:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 12:21:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 638d1253ef fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722424902
+ git checkout -b scalability-yes-8-32768-10-1722424902
Switched to a new branch 'scalability-yes-8-32768-10-1722424902'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722424902 2a4f7521b6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722424902 e3a6e98150] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:22:09 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:22:09 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-10-1722424902 32768 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:23:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 12:23:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e3a6e98150 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722425003
+ git checkout -b scalability-yes-512-32768-10-1722425003
Switched to a new branch 'scalability-yes-512-32768-10-1722425003'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722425003 1e00c010c1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722425003 bc15bfa43f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:23:50 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:23:50 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-10-1722425003 32768 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-yes-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:25:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 12:25:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bc15bfa43f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722425104
+ git checkout -b scalability-yes-128-32768-10-1722425104
Switched to a new branch 'scalability-yes-128-32768-10-1722425104'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722425104 09d4cadea1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722425104 1d2ed02234] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:25:31 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:25:31 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-10-1722425104 32768 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:26:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 12:26:45 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1d2ed02234 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722425205
+ git checkout -b scalability-no-32-32768-10-1722425205
Switched to a new branch 'scalability-no-32-32768-10-1722425205'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722425205 0950b5f8d5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:27:12 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:27:12 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-10-1722425205 32768 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:28:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 12:28:26 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0950b5f8d5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722425306
+ git checkout -b scalability-no-0-32768-10-1722425306
Switched to a new branch 'scalability-no-0-32768-10-1722425306'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:28:53 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:28:53 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-10-1722425306 32768 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:30:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 12:30:07 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722425407
+ git checkout -b scalability-no-1-32768-10-1722425407
Switched to a new branch 'scalability-no-1-32768-10-1722425407'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722425407 91b6b3bfc0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:30:33 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:30:33 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-10-1722425407 32768 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:31:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 12:31:47 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 91b6b3bfc0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722425508
+ git checkout -b scalability-no-1024-32768-10-1722425508
Switched to a new branch 'scalability-no-1024-32768-10-1722425508'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722425508 41d1f61454] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:32:14 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:32:14 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-10-1722425508 32768 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:33:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 12:33:28 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 41d1f61454 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722425609
+ git checkout -b scalability-no-8-32768-10-1722425609
Switched to a new branch 'scalability-no-8-32768-10-1722425609'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722425609 739151b399] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:33:55 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:33:55 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-10-1722425609 32768 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:35:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 12:35:09 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 739151b399 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722425710
+ git checkout -b scalability-no-512-32768-10-1722425710
Switched to a new branch 'scalability-no-512-32768-10-1722425710'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722425710 c8a150a59b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:35:36 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:35:36 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-10-1722425710 32768 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/pgbench-no-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:36:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 12:36:50 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c8a150a59b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722425810
+ git checkout -b scalability-no-128-32768-10-1722425810
Switched to a new branch 'scalability-no-128-32768-10-1722425810'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722425810 e9fcbe083b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:37:17 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:37:17 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-10-1722425810 32768 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/pgbench-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:38:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 12:38:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e9fcbe083b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722425911
+ git checkout -b scalability-yes-32-32768-10-1722425911
Switched to a new branch 'scalability-yes-32-32768-10-1722425911'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722425911 5f62bd224b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722425911 8fd0534ed9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:38:59 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:38:59 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-10-1722425911 32768 yes 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:40:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 12:40:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8fd0534ed9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722426032
+ git checkout -b scalability-yes-0-32768-10-1722426032
Switched to a new branch 'scalability-yes-0-32768-10-1722426032'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722426032 9b8fbbc46c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:40:59 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:40:59 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-10-1722426032 32768 yes 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:42:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 12:42:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9b8fbbc46c NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722426151
+ git checkout -b scalability-yes-1-32768-10-1722426151
Switched to a new branch 'scalability-yes-1-32768-10-1722426151'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722426151 08a9df53dd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722426151 b03755fc76] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:42:58 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:42:58 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-10-1722426151 32768 yes 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:44:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 12:44:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b03755fc76 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722426267
+ git checkout -b scalability-yes-1024-32768-10-1722426267
Switched to a new branch 'scalability-yes-1024-32768-10-1722426267'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722426267 2e385aff6b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722426267 2e65441cf1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:44:54 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:44:54 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-10-1722426267 32768 yes 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:46:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 12:46:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2e65441cf1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722426388
+ git checkout -b scalability-yes-8-32768-10-1722426388
Switched to a new branch 'scalability-yes-8-32768-10-1722426388'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722426388 4a3b552ed6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722426388 d38892c8fc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:46:55 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:46:55 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-10-1722426388 32768 yes 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:48:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 12:48:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d38892c8fc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722426505
+ git checkout -b scalability-yes-512-32768-10-1722426505
Switched to a new branch 'scalability-yes-512-32768-10-1722426505'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722426505 e507248dd9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722426505 9719673d66] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:48:52 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:48:52 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-10-1722426505 32768 yes 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-yes-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:50:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 12:50:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9719673d66 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722426623
+ git checkout -b scalability-yes-128-32768-10-1722426623
Switched to a new branch 'scalability-yes-128-32768-10-1722426623'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722426623 f994d2fa3f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722426623 31ec966c7b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:50:50 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:50:50 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-10-1722426623 32768 yes 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-yes-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-32-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:52:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 12:52:21 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 31ec966c7b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722426741
+ git checkout -b scalability-no-32-32768-10-1722426741
Switched to a new branch 'scalability-no-32-32768-10-1722426741'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722426741 34ca6ea91e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:52:49 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:52:49 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-10-1722426741 32768 no 32 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-32-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-0-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:54:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 12:54:18 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 34ca6ea91e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722426858
+ git checkout -b scalability-no-0-32768-10-1722426858
Switched to a new branch 'scalability-no-0-32768-10-1722426858'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:54:45 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:54:45 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-10-1722426858 32768 no 0 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-0-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:56:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 12:56:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722426976
+ git checkout -b scalability-no-1-32768-10-1722426976
Switched to a new branch 'scalability-no-1-32768-10-1722426976'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722426976 6c00b5c451] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:56:43 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:56:43 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-10-1722426976 32768 no 1 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-1024-32768-10
+ env
++ date
+ echo Wed 31 Jul 12:58:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 12:58:13 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6c00b5c451 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722427093
+ git checkout -b scalability-no-1024-32768-10-1722427093
Switched to a new branch 'scalability-no-1024-32768-10-1722427093'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722427093 3c15be56dd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 12:58:41 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 12:58:41 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-10-1722427093 32768 no 1024 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-1024-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-8-32768-10
+ env
++ date
+ echo Wed 31 Jul 13:00:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 13:00:10 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3c15be56dd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722427210
+ git checkout -b scalability-no-8-32768-10-1722427210
Switched to a new branch 'scalability-no-8-32768-10-1722427210'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722427210 d524dd4e77] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 13:00:37 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 13:00:37 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-10-1722427210 32768 no 8 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-8-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-512-32768-10
+ env
++ date
+ echo Wed 31 Jul 13:02:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 13:02:07 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d524dd4e77 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722427327
+ git checkout -b scalability-no-512-32768-10-1722427327
Switched to a new branch 'scalability-no-512-32768-10-1722427327'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722427327 13c83b1414] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 13:02:35 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 13:02:35 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-10-1722427327 32768 no 512 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-512-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-32768-10
+ RESULTDIR=/mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-32768-10
+ mkdir -p /mnt/data/lock-scalability-test/20240731-0847-glibc-default/results/star-no-128-32768-10
+ env
++ date
+ echo Wed 31 Jul 13:04:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 13:04:06 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 13c83b1414 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722427446
+ git checkout -b scalability-no-128-32768-10-1722427446
Switched to a new branch 'scalability-no-128-32768-10-1722427446'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722427446 e8c0c87788] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 13:04:33 BST 2024 'RUN   files: 32768  partitions: 10'
Wed 31 Jul 13:04:33 BST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-10-1722427446 32768 no 128 /mnt/data/lock-scalability-test/20240731-0847-glibc-default/logs/star-no-128-32768-10 1 10 '1 4 8' 10
+ pg_ctl -D /mnt/data/data-test stop
