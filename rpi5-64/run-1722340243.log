+ set -e
+ LABEL=glibc-default
+ MACHINE=rpi5-64
+ DBNAME=test
+ RUNS=1
+ DURATION=10
+ CLIENTS='1 4 8'
+ PARTITIONS='1000 100 1 0'
+ BUILDS=/mnt/data/builds
+ SOURCE=/mnt/data/postgres
+ PATH_OLD=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
++ date +%Y%m%d-%H%M
+ DATE=20240730-1250
++ pwd
+ PATCHES=/mnt/data/lock-scalability-test/patches
++ pwd
+ LOGS=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs
++ pwd
+ RESULTS=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results
+ DATADIR=/mnt/data/data-test
+ ulimit -n 35000
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 12:50:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 12:50:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 86dc19eb15 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722340243
+ git checkout -b scalability-yes-32-1000-1000-1722340243
Switched to a new branch 'scalability-yes-32-1000-1000-1722340243'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722340243 eedd71f043] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722340243 30f18f16e9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 12:51:11 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 12:51:11 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-1000-1722340243 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 12:52:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 12:52:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 30f18f16e9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722340354
+ git checkout -b scalability-yes-0-1000-1000-1722340354
Switched to a new branch 'scalability-yes-0-1000-1000-1722340354'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722340354 1a3e6396aa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 12:53:01 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 12:53:01 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-1000-1722340354 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 12:54:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 12:54:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1a3e6396aa NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722340465
+ git checkout -b scalability-yes-1-1000-1000-1722340465
Switched to a new branch 'scalability-yes-1-1000-1000-1722340465'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722340465 867b779f82] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722340465 ea769c49dd] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 12:54:52 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 12:54:52 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-1000-1722340465 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 12:56:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 12:56:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ea769c49dd fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722340576
+ git checkout -b scalability-yes-1024-1000-1000-1722340576
Switched to a new branch 'scalability-yes-1024-1000-1000-1722340576'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722340576 d0ed7ad2d5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722340576 4eb4aff04c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 12:56:43 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 12:56:43 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-1000-1722340576 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 12:58:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 12:58:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4eb4aff04c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722340687
+ git checkout -b scalability-yes-8-1000-1000-1722340687
Switched to a new branch 'scalability-yes-8-1000-1000-1722340687'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722340687 06bafa6ff2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722340687 0f917115a9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 12:58:34 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 12:58:34 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-1000-1722340687 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 12:59:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 12:59:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0f917115a9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722340798
+ git checkout -b scalability-yes-512-1000-1000-1722340798
Switched to a new branch 'scalability-yes-512-1000-1000-1722340798'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722340798 9f9069a008] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722340798 4c8c3f03ae] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:00:27 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:00:27 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-1000-1722340798 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:01:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 13:01:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c8c3f03ae fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722340910
+ git checkout -b scalability-yes-128-1000-1000-1722340910
Switched to a new branch 'scalability-yes-128-1000-1000-1722340910'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722340910 1403657120] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722340910 0987701d3d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:02:18 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:02:18 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-1000-1722340910 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:03:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 13:03:42 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0987701d3d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722341022
+ git checkout -b scalability-no-32-1000-1000-1722341022
Switched to a new branch 'scalability-no-32-1000-1000-1722341022'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722341022 c8ba7d499b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:04:09 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:04:09 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-1000-1722341022 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:05:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 13:05:32 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c8ba7d499b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722341132
+ git checkout -b scalability-no-0-1000-1000-1722341132
Switched to a new branch 'scalability-no-0-1000-1000-1722341132'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:05:59 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:05:59 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-1000-1722341132 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:07:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 13:07:23 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722341243
+ git checkout -b scalability-no-1-1000-1000-1722341243
Switched to a new branch 'scalability-no-1-1000-1000-1722341243'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722341243 ab51974497] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:07:50 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:07:50 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-1000-1722341243 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:09:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 13:09:14 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ab51974497 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722341354
+ git checkout -b scalability-no-1024-1000-1000-1722341354
Switched to a new branch 'scalability-no-1024-1000-1000-1722341354'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722341354 0a6d585e1a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:09:41 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:09:41 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-1000-1722341354 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:11:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 13:11:05 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0a6d585e1a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722341465
+ git checkout -b scalability-no-8-1000-1000-1722341465
Switched to a new branch 'scalability-no-8-1000-1000-1722341465'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722341465 3570efac16] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:11:33 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:11:33 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-1000-1722341465 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:12:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 13:12:56 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3570efac16 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722341576
+ git checkout -b scalability-no-512-1000-1000-1722341576
Switched to a new branch 'scalability-no-512-1000-1000-1722341576'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722341576 2a45d96f1f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:13:23 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:13:23 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-1000-1722341576 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:14:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 13:14:47 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2a45d96f1f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722341687
+ git checkout -b scalability-no-128-1000-1000-1722341687
Switched to a new branch 'scalability-no-128-1000-1000-1722341687'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722341687 1d018d9038] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:15:15 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:15:15 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-1000-1722341687 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:16:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 13:16:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1d018d9038 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722341799
+ git checkout -b scalability-yes-32-1000-1000-1722341799
Switched to a new branch 'scalability-yes-32-1000-1000-1722341799'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722341799 0e30720463] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722341799 fe15153bb6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:17:06 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:17:06 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-1000-1722341799 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:18:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 13:18:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fe15153bb6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722341915
+ git checkout -b scalability-yes-0-1000-1000-1722341915
Switched to a new branch 'scalability-yes-0-1000-1000-1722341915'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722341915 107a46e9b9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:19:03 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:19:03 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-1000-1722341915 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:20:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 13:20:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 107a46e9b9 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722342032
+ git checkout -b scalability-yes-1-1000-1000-1722342032
Switched to a new branch 'scalability-yes-1-1000-1000-1722342032'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722342032 2d26e2ad64] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722342032 77dc5c26dc] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:20:59 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:20:59 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-1000-1722342032 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:22:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 13:22:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 77dc5c26dc fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722342147
+ git checkout -b scalability-yes-1024-1000-1000-1722342147
Switched to a new branch 'scalability-yes-1024-1000-1000-1722342147'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722342147 f83d50ba3c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722342147 8a97d1ac02] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:22:54 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:22:54 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-1000-1722342147 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:24:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 13:24:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8a97d1ac02 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722342264
+ git checkout -b scalability-yes-8-1000-1000-1722342264
Switched to a new branch 'scalability-yes-8-1000-1000-1722342264'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722342264 7fc0b1ecc4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722342264 52477d8510] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:24:51 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:24:51 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-1000-1722342264 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:26:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 13:26:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 52477d8510 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722342381
+ git checkout -b scalability-yes-512-1000-1000-1722342381
Switched to a new branch 'scalability-yes-512-1000-1000-1722342381'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722342381 7c7d839169] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722342381 4deaf71887] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:26:48 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:26:48 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-1000-1722342381 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:28:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 13:28:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4deaf71887 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722342497
+ git checkout -b scalability-yes-128-1000-1000-1722342497
Switched to a new branch 'scalability-yes-128-1000-1000-1722342497'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722342497 f8060ccba7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722342497 b7e8015c97] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:28:44 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:28:44 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-1000-1722342497 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:30:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 13:30:13 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b7e8015c97 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722342613
+ git checkout -b scalability-no-32-1000-1000-1722342613
Switched to a new branch 'scalability-no-32-1000-1000-1722342613'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722342613 ce8955d233] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:30:40 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:30:40 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-1000-1722342613 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:32:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 13:32:09 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ce8955d233 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722342729
+ git checkout -b scalability-no-0-1000-1000-1722342729
Switched to a new branch 'scalability-no-0-1000-1000-1722342729'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:32:36 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:32:36 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-1000-1722342729 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:34:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 13:34:06 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722342846
+ git checkout -b scalability-no-1-1000-1000-1722342846
Switched to a new branch 'scalability-no-1-1000-1000-1722342846'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722342846 f7187248ac] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:34:33 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:34:33 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-1000-1722342846 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:36:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 13:36:02 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f7187248ac fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722342962
+ git checkout -b scalability-no-1024-1000-1000-1722342962
Switched to a new branch 'scalability-no-1024-1000-1000-1722342962'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722342962 3090aff31e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:36:29 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:36:29 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-1000-1722342962 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:37:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 13:37:58 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3090aff31e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722343079
+ git checkout -b scalability-no-8-1000-1000-1722343079
Switched to a new branch 'scalability-no-8-1000-1000-1722343079'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722343079 3bb3e0adad] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:38:26 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:38:26 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-1000-1722343079 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:39:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 13:39:55 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3bb3e0adad fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722343195
+ git checkout -b scalability-no-512-1000-1000-1722343195
Switched to a new branch 'scalability-no-512-1000-1000-1722343195'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722343195 2a04c8d842] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:40:23 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:40:23 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-1000-1722343195 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:41:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 13:41:52 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2a04c8d842 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722343312
+ git checkout -b scalability-no-128-1000-1000-1722343312
Switched to a new branch 'scalability-no-128-1000-1000-1722343312'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722343312 a2d8ccc29b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:42:19 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:42:19 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-1000-1722343312 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:43:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 13:43:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a2d8ccc29b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722343428
+ git checkout -b scalability-yes-32-1000-1000-1722343428
Switched to a new branch 'scalability-yes-32-1000-1000-1722343428'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722343428 3f663d61fd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722343428 9e0841e0ba] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:44:15 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:44:15 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-1000-1722343428 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:45:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 13:45:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9e0841e0ba fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722343537
+ git checkout -b scalability-yes-0-1000-1000-1722343537
Switched to a new branch 'scalability-yes-0-1000-1000-1722343537'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722343537 ebe3bb13b0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:46:05 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:46:05 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-1000-1722343537 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:47:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 13:47:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ebe3bb13b0 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722343646
+ git checkout -b scalability-yes-1-1000-1000-1722343646
Switched to a new branch 'scalability-yes-1-1000-1000-1722343646'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722343646 5d88285aa5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722343646 460c713f75] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:47:53 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:47:53 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-1000-1722343646 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:49:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 13:49:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 460c713f75 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722343755
+ git checkout -b scalability-yes-1024-1000-1000-1722343755
Switched to a new branch 'scalability-yes-1024-1000-1000-1722343755'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722343755 f032eee4c4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722343755 9d60408ed6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:49:42 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:49:42 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-1000-1722343755 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:51:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 13:51:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9d60408ed6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722343865
+ git checkout -b scalability-yes-8-1000-1000-1722343865
Switched to a new branch 'scalability-yes-8-1000-1000-1722343865'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722343865 425d29a097] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722343865 85d11a4a7b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:51:32 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:51:32 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-1000-1722343865 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:52:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 13:52:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 85d11a4a7b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722343975
+ git checkout -b scalability-yes-512-1000-1000-1722343975
Switched to a new branch 'scalability-yes-512-1000-1000-1722343975'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722343975 dbb7cef326] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722343975 efac155578] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:53:22 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:53:22 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-1000-1722343975 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:54:44 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 13:54:44 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at efac155578 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722344084
+ git checkout -b scalability-yes-128-1000-1000-1722344084
Switched to a new branch 'scalability-yes-128-1000-1000-1722344084'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722344084 6aa94f79e9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722344084 5dbf2812c0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:55:12 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:55:12 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-1000-1722344084 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:56:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 13:56:34 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5dbf2812c0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722344194
+ git checkout -b scalability-no-32-1000-1000-1722344194
Switched to a new branch 'scalability-no-32-1000-1000-1722344194'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722344194 a3c1ec520a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:57:01 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:57:01 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-1000-1722344194 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 13:58:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 13:58:23 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a3c1ec520a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722344303
+ git checkout -b scalability-no-0-1000-1000-1722344303
Switched to a new branch 'scalability-no-0-1000-1000-1722344303'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 13:58:50 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 13:58:50 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-1000-1722344303 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:00:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 14:00:12 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722344412
+ git checkout -b scalability-no-1-1000-1000-1722344412
Switched to a new branch 'scalability-no-1-1000-1000-1722344412'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722344412 a6db323a9b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:00:39 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:00:39 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-1000-1722344412 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:02:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 14:02:01 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a6db323a9b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722344521
+ git checkout -b scalability-no-1024-1000-1000-1722344521
Switched to a new branch 'scalability-no-1024-1000-1000-1722344521'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722344521 6364a1ee2b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:02:28 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:02:28 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-1000-1722344521 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:03:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 14:03:51 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6364a1ee2b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722344631
+ git checkout -b scalability-no-8-1000-1000-1722344631
Switched to a new branch 'scalability-no-8-1000-1000-1722344631'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722344631 6319e79129] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:04:18 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:04:18 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-1000-1722344631 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:05:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 14:05:40 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6319e79129 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722344740
+ git checkout -b scalability-no-512-1000-1000-1722344740
Switched to a new branch 'scalability-no-512-1000-1000-1722344740'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722344740 4adc14566e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:06:07 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:06:07 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-1000-1722344740 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:07:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 14:07:29 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4adc14566e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722344849
+ git checkout -b scalability-no-128-1000-1000-1722344849
Switched to a new branch 'scalability-no-128-1000-1000-1722344849'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722344849 0549f55e88] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:07:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:07:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-1000-1722344849 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:09:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 14:09:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0549f55e88 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722344959
+ git checkout -b scalability-yes-32-1000-1000-1722344959
Switched to a new branch 'scalability-yes-32-1000-1000-1722344959'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722344959 1a84924518] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722344959 a44d06366f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:09:46 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:09:46 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-1000-1722344959 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:11:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 14:11:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a44d06366f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722345065
+ git checkout -b scalability-yes-0-1000-1000-1722345065
Switched to a new branch 'scalability-yes-0-1000-1000-1722345065'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722345065 8c2d9ce54b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:11:32 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:11:32 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-1000-1722345065 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:12:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 14:12:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8c2d9ce54b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722345171
+ git checkout -b scalability-yes-1-1000-1000-1722345171
Switched to a new branch 'scalability-yes-1-1000-1000-1722345171'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722345171 2f07105454] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722345171 c960820716] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:13:19 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:13:19 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-1000-1722345171 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:14:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 14:14:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c960820716 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722345278
+ git checkout -b scalability-yes-1024-1000-1000-1722345278
Switched to a new branch 'scalability-yes-1024-1000-1000-1722345278'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722345278 fa5dd194a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722345278 50c1bebd76] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:15:05 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:15:05 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-1000-1722345278 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:16:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 14:16:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 50c1bebd76 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722345385
+ git checkout -b scalability-yes-8-1000-1000-1722345385
Switched to a new branch 'scalability-yes-8-1000-1000-1722345385'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722345385 d2644c102d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722345385 b33181f8e6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:16:52 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:16:52 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-1000-1722345385 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:18:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 14:18:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b33181f8e6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722345492
+ git checkout -b scalability-yes-512-1000-1000-1722345492
Switched to a new branch 'scalability-yes-512-1000-1000-1722345492'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722345492 468edd5ab1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722345492 703589071f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:18:39 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:18:39 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-1000-1722345492 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:19:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 14:19:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 703589071f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722345599
+ git checkout -b scalability-yes-128-1000-1000-1722345599
Switched to a new branch 'scalability-yes-128-1000-1000-1722345599'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722345599 4df75b0287] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722345599 bb1f09aaca] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:20:26 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:20:26 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-1000-1722345599 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:21:46 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 14:21:46 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bb1f09aaca fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722345706
+ git checkout -b scalability-no-32-1000-1000-1722345706
Switched to a new branch 'scalability-no-32-1000-1000-1722345706'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722345706 8532c2a5e9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:22:13 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:22:13 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-1000-1722345706 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:23:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 14:23:35 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8532c2a5e9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722345815
+ git checkout -b scalability-no-0-1000-1000-1722345815
Switched to a new branch 'scalability-no-0-1000-1000-1722345815'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:24:02 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:24:02 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-1000-1722345815 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:25:22 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 14:25:22 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722345922
+ git checkout -b scalability-no-1-1000-1000-1722345922
Switched to a new branch 'scalability-no-1-1000-1000-1722345922'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722345922 4a7ab5f774] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:25:50 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:25:50 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-1000-1722345922 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:27:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 14:27:09 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4a7ab5f774 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722346029
+ git checkout -b scalability-no-1024-1000-1000-1722346029
Switched to a new branch 'scalability-no-1024-1000-1000-1722346029'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722346029 28d41bf236] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:27:36 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:27:36 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-1000-1722346029 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:28:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 14:28:55 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 28d41bf236 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722346136
+ git checkout -b scalability-no-8-1000-1000-1722346136
Switched to a new branch 'scalability-no-8-1000-1000-1722346136'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722346136 078427ca36] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:29:23 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:29:23 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-1000-1722346136 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:30:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 14:30:42 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 078427ca36 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722346242
+ git checkout -b scalability-no-512-1000-1000-1722346242
Switched to a new branch 'scalability-no-512-1000-1000-1722346242'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722346242 2a70b3da69] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:31:09 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:31:09 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-1000-1722346242 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:32:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 14:32:30 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2a70b3da69 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722346350
+ git checkout -b scalability-no-128-1000-1000-1722346350
Switched to a new branch 'scalability-no-128-1000-1000-1722346350'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722346350 e88648dfc6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:32:57 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:32:57 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-1000-1722346350 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:34:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 14:34:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e88648dfc6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1000-1722346459
+ git checkout -b scalability-yes-32-1000-1000-1722346459
Switched to a new branch 'scalability-yes-32-1000-1000-1722346459'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1000-1722346459 5767bd1f82] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1000-1722346459 9c01ce82f5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:34:47 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:34:47 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-1000-1722346459 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:34:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 14:34:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9c01ce82f5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1000-1722346490
+ git checkout -b scalability-yes-0-1000-1000-1722346490
Switched to a new branch 'scalability-yes-0-1000-1000-1722346490'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1000-1722346490 538d8708e8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:35:17 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:35:17 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-1000-1722346490 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:35:20 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 14:35:20 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 538d8708e8 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1000-1722346520
+ git checkout -b scalability-yes-1-1000-1000-1722346520
Switched to a new branch 'scalability-yes-1-1000-1000-1722346520'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1000-1722346520 7263ba018f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1000-1722346520 4d821e913f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:35:48 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:35:48 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-1000-1722346520 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:35:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 14:35:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4d821e913f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1000-1722346551
+ git checkout -b scalability-yes-1024-1000-1000-1722346551
Switched to a new branch 'scalability-yes-1024-1000-1000-1722346551'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1000-1722346551 d4a356b0fc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1000-1722346551 f0d71a555d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:36:18 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:36:18 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-1000-1722346551 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:36:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 14:36:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f0d71a555d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1000-1722346581
+ git checkout -b scalability-yes-8-1000-1000-1722346581
Switched to a new branch 'scalability-yes-8-1000-1000-1722346581'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1000-1722346581 4a90e276e2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1000-1722346581 7d28a0276e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:36:49 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:36:49 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-1000-1722346581 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:36:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 14:36:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7d28a0276e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1000-1722346612
+ git checkout -b scalability-yes-512-1000-1000-1722346612
Switched to a new branch 'scalability-yes-512-1000-1000-1722346612'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1000-1722346612 77d7e504dc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1000-1722346612 b10238e3e8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:37:19 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:37:19 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-1000-1722346612 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:37:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 14:37:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b10238e3e8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1000-1722346642
+ git checkout -b scalability-yes-128-1000-1000-1722346642
Switched to a new branch 'scalability-yes-128-1000-1000-1722346642'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1000-1722346642 b87bca3759] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1000-1722346642 7bd1404cbc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:37:49 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:37:49 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-1000-1722346642 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:37:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 14:37:52 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7bd1404cbc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1000-1722346672
+ git checkout -b scalability-no-32-1000-1000-1722346672
Switched to a new branch 'scalability-no-32-1000-1000-1722346672'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1000-1722346672 f7658ce9a1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:38:19 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:38:19 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-1000-1722346672 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:38:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 14:38:23 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f7658ce9a1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1000-1722346703
+ git checkout -b scalability-no-0-1000-1000-1722346703
Switched to a new branch 'scalability-no-0-1000-1000-1722346703'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:38:51 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:38:51 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-1000-1722346703 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:38:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 14:38:54 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1000-1722346734
+ git checkout -b scalability-no-1-1000-1000-1722346734
Switched to a new branch 'scalability-no-1-1000-1000-1722346734'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1000-1722346734 2b38f45699] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:39:21 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:39:21 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-1000-1722346734 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:39:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 14:39:24 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2b38f45699 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1000-1722346764
+ git checkout -b scalability-no-1024-1000-1000-1722346764
Switched to a new branch 'scalability-no-1024-1000-1000-1722346764'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1000-1722346764 e8f2063aeb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:39:52 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:39:52 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-1000-1722346764 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:39:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 14:39:55 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e8f2063aeb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1000-1722346795
+ git checkout -b scalability-no-8-1000-1000-1722346795
Switched to a new branch 'scalability-no-8-1000-1000-1722346795'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1000-1722346795 44bb70c291] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:40:22 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:40:22 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-1000-1722346795 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:40:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 14:40:26 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 44bb70c291 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1000-1722346826
+ git checkout -b scalability-no-512-1000-1000-1722346826
Switched to a new branch 'scalability-no-512-1000-1000-1722346826'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1000-1722346826 2d498ce24e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:40:53 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:40:53 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-1000-1722346826 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-1000
+ env
++ date
+ echo Tue 30 Jul 14:40:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 14:40:56 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2d498ce24e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1000-1722346857
+ git checkout -b scalability-no-128-1000-1000-1722346857
Switched to a new branch 'scalability-no-128-1000-1000-1722346857'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1000-1722346857 0a24ecaf7f] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:41:24 BST 2024 'RUN   files: 1000  partitions: 1000'
Tue 30 Jul 14:41:24 BST 2024 RUN   files: 1000  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-1000-1722346857 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:41:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 14:41:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0a24ecaf7f fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722346887
+ git checkout -b scalability-yes-32-1000-100-1722346887
Switched to a new branch 'scalability-yes-32-1000-100-1722346887'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722346887 14638b3a47] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722346887 2762759cb9] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:41:54 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:41:54 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-100-1722346887 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:43:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 14:43:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2762759cb9 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722346989
+ git checkout -b scalability-yes-0-1000-100-1722346989
Switched to a new branch 'scalability-yes-0-1000-100-1722346989'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722346989 541c545f0a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:43:36 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:43:36 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-100-1722346989 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:44:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 14:44:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 541c545f0a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722347091
+ git checkout -b scalability-yes-1-1000-100-1722347091
Switched to a new branch 'scalability-yes-1-1000-100-1722347091'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722347091 91bbc52e35] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722347091 cf61a85b92] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:45:18 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:45:18 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-100-1722347091 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:46:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 14:46:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cf61a85b92 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722347193
+ git checkout -b scalability-yes-1024-1000-100-1722347193
Switched to a new branch 'scalability-yes-1024-1000-100-1722347193'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722347193 28f94700d7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722347193 b57901a27f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:47:00 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:47:00 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-100-1722347193 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:48:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 14:48:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b57901a27f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722347295
+ git checkout -b scalability-yes-8-1000-100-1722347295
Switched to a new branch 'scalability-yes-8-1000-100-1722347295'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722347295 bf19f0b693] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722347295 9ee69bb66e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:48:42 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:48:42 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-100-1722347295 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:49:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 14:49:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9ee69bb66e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722347397
+ git checkout -b scalability-yes-512-1000-100-1722347397
Switched to a new branch 'scalability-yes-512-1000-100-1722347397'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722347397 a943541ecb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722347397 6e8fbe70f8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:50:24 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:50:24 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-100-1722347397 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:51:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 14:51:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6e8fbe70f8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722347499
+ git checkout -b scalability-yes-128-1000-100-1722347499
Switched to a new branch 'scalability-yes-128-1000-100-1722347499'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722347499 08205dcb30] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722347499 5ab60bf7be] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:52:05 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:52:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-100-1722347499 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:53:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 14:53:20 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5ab60bf7be fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722347600
+ git checkout -b scalability-no-32-1000-100-1722347600
Switched to a new branch 'scalability-no-32-1000-100-1722347600'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722347600 d0a563c15e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:53:47 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:53:47 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-100-1722347600 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:55:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 14:55:02 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d0a563c15e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722347702
+ git checkout -b scalability-no-0-1000-100-1722347702
Switched to a new branch 'scalability-no-0-1000-100-1722347702'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:55:28 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:55:28 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-100-1722347702 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:56:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 14:56:43 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722347803
+ git checkout -b scalability-no-1-1000-100-1722347803
Switched to a new branch 'scalability-no-1-1000-100-1722347803'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722347803 d4d6ce641a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:57:10 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:57:10 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-100-1722347803 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 14:58:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 14:58:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d4d6ce641a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722347905
+ git checkout -b scalability-no-1024-1000-100-1722347905
Switched to a new branch 'scalability-no-1024-1000-100-1722347905'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722347905 6ee4ae451d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 14:58:52 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 14:58:52 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-100-1722347905 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:00:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 15:00:06 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6ee4ae451d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722348006
+ git checkout -b scalability-no-8-1000-100-1722348006
Switched to a new branch 'scalability-no-8-1000-100-1722348006'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722348006 2a8375248c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:00:33 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:00:33 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-100-1722348006 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:01:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 15:01:48 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2a8375248c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722348108
+ git checkout -b scalability-no-512-1000-100-1722348108
Switched to a new branch 'scalability-no-512-1000-100-1722348108'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722348108 94547b14a9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:02:15 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:02:15 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-100-1722348108 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:03:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 15:03:30 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 94547b14a9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722348210
+ git checkout -b scalability-no-128-1000-100-1722348210
Switched to a new branch 'scalability-no-128-1000-100-1722348210'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722348210 caebf0e356] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:03:57 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:03:57 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-100-1722348210 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:05:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 15:05:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at caebf0e356 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722348311
+ git checkout -b scalability-yes-32-1000-100-1722348311
Switched to a new branch 'scalability-yes-32-1000-100-1722348311'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722348311 c74fbc152a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722348311 feaf4cb7ac] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:05:38 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:05:38 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-100-1722348311 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:06:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 15:06:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at feaf4cb7ac fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722348415
+ git checkout -b scalability-yes-0-1000-100-1722348415
Switched to a new branch 'scalability-yes-0-1000-100-1722348415'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722348415 c157873b18] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:07:22 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:07:22 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-100-1722348415 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:08:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 15:08:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c157873b18 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722348519
+ git checkout -b scalability-yes-1-1000-100-1722348519
Switched to a new branch 'scalability-yes-1-1000-100-1722348519'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722348519 85dcdc400e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722348519 d7809dddc7] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:09:05 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:09:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-100-1722348519 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:10:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 15:10:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d7809dddc7 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722348622
+ git checkout -b scalability-yes-1024-1000-100-1722348622
Switched to a new branch 'scalability-yes-1024-1000-100-1722348622'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722348622 f1bce5d9d6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722348622 b494eeecaa] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:10:49 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:10:49 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-100-1722348622 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:12:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 15:12:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b494eeecaa fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722348726
+ git checkout -b scalability-yes-8-1000-100-1722348726
Switched to a new branch 'scalability-yes-8-1000-100-1722348726'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722348726 eb151278ba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722348726 535c42eb68] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:12:33 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:12:33 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-100-1722348726 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:13:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 15:13:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 535c42eb68 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722348830
+ git checkout -b scalability-yes-512-1000-100-1722348830
Switched to a new branch 'scalability-yes-512-1000-100-1722348830'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722348830 4bb3a33f48] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722348830 4c79a5a1ac] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:14:17 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:14:17 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-100-1722348830 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:15:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 15:15:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c79a5a1ac fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722348934
+ git checkout -b scalability-yes-128-1000-100-1722348934
Switched to a new branch 'scalability-yes-128-1000-100-1722348934'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722348934 62d0f738ac] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722348934 f07a50c981] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:16:01 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:16:01 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-100-1722348934 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:17:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 15:17:18 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f07a50c981 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722349038
+ git checkout -b scalability-no-32-1000-100-1722349038
Switched to a new branch 'scalability-no-32-1000-100-1722349038'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722349038 7f32164014] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:17:45 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:17:45 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-100-1722349038 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:19:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 15:19:02 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7f32164014 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722349142
+ git checkout -b scalability-no-0-1000-100-1722349142
Switched to a new branch 'scalability-no-0-1000-100-1722349142'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:19:29 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:19:29 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-100-1722349142 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:20:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 15:20:45 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722349245
+ git checkout -b scalability-no-1-1000-100-1722349245
Switched to a new branch 'scalability-no-1-1000-100-1722349245'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722349245 25e2e2292a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:21:12 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:21:12 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-100-1722349245 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:22:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 15:22:29 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 25e2e2292a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722349349
+ git checkout -b scalability-no-1024-1000-100-1722349349
Switched to a new branch 'scalability-no-1024-1000-100-1722349349'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722349349 e357c07eab] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:22:55 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:22:55 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-100-1722349349 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:24:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 15:24:12 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e357c07eab fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722349452
+ git checkout -b scalability-no-8-1000-100-1722349452
Switched to a new branch 'scalability-no-8-1000-100-1722349452'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722349452 ef5c158152] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:24:40 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:24:40 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-100-1722349452 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:25:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 15:25:56 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef5c158152 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722349556
+ git checkout -b scalability-no-512-1000-100-1722349556
Switched to a new branch 'scalability-no-512-1000-100-1722349556'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722349556 24a63a3f47] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:26:23 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:26:23 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-100-1722349556 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:27:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 15:27:40 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 24a63a3f47 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722349660
+ git checkout -b scalability-no-128-1000-100-1722349660
Switched to a new branch 'scalability-no-128-1000-100-1722349660'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722349660 ff8736377b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:28:07 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:28:07 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-100-1722349660 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:29:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 15:29:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ff8736377b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722349764
+ git checkout -b scalability-yes-32-1000-100-1722349764
Switched to a new branch 'scalability-yes-32-1000-100-1722349764'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722349764 f25985045b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722349764 a4fcf62ef7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:29:50 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:29:50 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-100-1722349764 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:31:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 15:31:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a4fcf62ef7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722349865
+ git checkout -b scalability-yes-0-1000-100-1722349865
Switched to a new branch 'scalability-yes-0-1000-100-1722349865'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722349865 e6683a25d7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:31:31 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:31:31 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-100-1722349865 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:32:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 15:32:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e6683a25d7 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722349965
+ git checkout -b scalability-yes-1-1000-100-1722349965
Switched to a new branch 'scalability-yes-1-1000-100-1722349965'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722349965 31e17e1b02] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722349965 42e932deee] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:33:12 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:33:12 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-100-1722349965 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:34:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 15:34:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 42e932deee fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722350066
+ git checkout -b scalability-yes-1024-1000-100-1722350066
Switched to a new branch 'scalability-yes-1024-1000-100-1722350066'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722350066 26f759d0e6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722350066 90250576ea] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:34:53 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:34:53 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-100-1722350066 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:36:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 15:36:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 90250576ea fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722350167
+ git checkout -b scalability-yes-8-1000-100-1722350167
Switched to a new branch 'scalability-yes-8-1000-100-1722350167'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722350167 da3b777fbc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722350167 a9499a22b3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:36:34 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:36:34 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-100-1722350167 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:37:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 15:37:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a9499a22b3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722350268
+ git checkout -b scalability-yes-512-1000-100-1722350268
Switched to a new branch 'scalability-yes-512-1000-100-1722350268'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722350268 0e1aef2cb2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722350268 ed51965df8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:38:15 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:38:15 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-100-1722350268 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:39:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 15:39:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ed51965df8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722350369
+ git checkout -b scalability-yes-128-1000-100-1722350369
Switched to a new branch 'scalability-yes-128-1000-100-1722350369'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722350369 b6ec5203b6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722350369 6f209b20e7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:39:56 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:39:56 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-100-1722350369 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:41:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 15:41:10 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6f209b20e7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722350470
+ git checkout -b scalability-no-32-1000-100-1722350470
Switched to a new branch 'scalability-no-32-1000-100-1722350470'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722350470 3ea180b521] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:41:37 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:41:37 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-100-1722350470 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:42:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 15:42:51 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3ea180b521 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722350571
+ git checkout -b scalability-no-0-1000-100-1722350571
Switched to a new branch 'scalability-no-0-1000-100-1722350571'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:43:18 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:43:18 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-100-1722350571 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:44:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 15:44:32 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722350672
+ git checkout -b scalability-no-1-1000-100-1722350672
Switched to a new branch 'scalability-no-1-1000-100-1722350672'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722350672 70e4d5c862] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:44:59 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:44:59 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-100-1722350672 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:46:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 15:46:13 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 70e4d5c862 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722350773
+ git checkout -b scalability-no-1024-1000-100-1722350773
Switched to a new branch 'scalability-no-1024-1000-100-1722350773'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722350773 638da60cba] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:46:40 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:46:40 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-100-1722350773 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:47:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 15:47:55 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 638da60cba fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722350875
+ git checkout -b scalability-no-8-1000-100-1722350875
Switched to a new branch 'scalability-no-8-1000-100-1722350875'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722350875 5d5f51ccd9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:48:21 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:48:21 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-100-1722350875 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:49:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 15:49:36 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5d5f51ccd9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722350976
+ git checkout -b scalability-no-512-1000-100-1722350976
Switched to a new branch 'scalability-no-512-1000-100-1722350976'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722350976 60884e8b95] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:50:03 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:50:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-100-1722350976 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:51:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 15:51:17 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 60884e8b95 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722351077
+ git checkout -b scalability-no-128-1000-100-1722351077
Switched to a new branch 'scalability-no-128-1000-100-1722351077'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722351077 27e4510d1c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:51:44 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:51:44 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-100-1722351077 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:52:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 15:52:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 27e4510d1c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722351178
+ git checkout -b scalability-yes-32-1000-100-1722351178
Switched to a new branch 'scalability-yes-32-1000-100-1722351178'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722351178 b4b5b060ec] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722351178 80e4ff8ac7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:53:25 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:53:25 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-100-1722351178 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:54:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 15:54:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 80e4ff8ac7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722351280
+ git checkout -b scalability-yes-0-1000-100-1722351280
Switched to a new branch 'scalability-yes-0-1000-100-1722351280'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722351280 f16b9696b4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:55:07 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:55:07 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-100-1722351280 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:56:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 15:56:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f16b9696b4 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722351382
+ git checkout -b scalability-yes-1-1000-100-1722351382
Switched to a new branch 'scalability-yes-1-1000-100-1722351382'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722351382 7e1fdc0d59] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722351382 da92a592fa] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:56:48 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:56:48 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-100-1722351382 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:58:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 15:58:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at da92a592fa fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722351483
+ git checkout -b scalability-yes-1024-1000-100-1722351483
Switched to a new branch 'scalability-yes-1024-1000-100-1722351483'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722351483 01fb4a7172] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722351483 4c0f9e0a72] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 15:58:30 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 15:58:30 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-100-1722351483 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 15:59:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 15:59:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c0f9e0a72 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722351585
+ git checkout -b scalability-yes-8-1000-100-1722351585
Switched to a new branch 'scalability-yes-8-1000-100-1722351585'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722351585 2a52fc9630] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722351585 d6430906cc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:00:11 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:00:11 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-100-1722351585 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:01:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 16:01:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6430906cc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722351686
+ git checkout -b scalability-yes-512-1000-100-1722351686
Switched to a new branch 'scalability-yes-512-1000-100-1722351686'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722351686 8739bd249e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722351686 19126dea8e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:01:53 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:01:53 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-100-1722351686 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:03:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 16:03:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 19126dea8e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722351788
+ git checkout -b scalability-yes-128-1000-100-1722351788
Switched to a new branch 'scalability-yes-128-1000-100-1722351788'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722351788 ae2dad5610] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722351788 ff09eff4ca] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:03:35 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:03:35 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-100-1722351788 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:04:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 16:04:51 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ff09eff4ca fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722351891
+ git checkout -b scalability-no-32-1000-100-1722351891
Switched to a new branch 'scalability-no-32-1000-100-1722351891'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722351891 9e6ab599dc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:05:18 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:05:18 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-100-1722351891 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:06:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 16:06:33 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9e6ab599dc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722351993
+ git checkout -b scalability-no-0-1000-100-1722351993
Switched to a new branch 'scalability-no-0-1000-100-1722351993'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:07:00 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:07:00 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-100-1722351993 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:08:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 16:08:15 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722352096
+ git checkout -b scalability-no-1-1000-100-1722352096
Switched to a new branch 'scalability-no-1-1000-100-1722352096'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722352096 13e03074aa] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:08:42 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:08:42 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-100-1722352096 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:09:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 16:09:57 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 13e03074aa fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722352197
+ git checkout -b scalability-no-1024-1000-100-1722352197
Switched to a new branch 'scalability-no-1024-1000-100-1722352197'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722352197 73ee78bf3e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:10:24 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:10:24 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-100-1722352197 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:11:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 16:11:39 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 73ee78bf3e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722352299
+ git checkout -b scalability-no-8-1000-100-1722352299
Switched to a new branch 'scalability-no-8-1000-100-1722352299'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722352299 dccc0f71be] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:12:05 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:12:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-100-1722352299 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:13:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 16:13:20 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dccc0f71be fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722352400
+ git checkout -b scalability-no-512-1000-100-1722352400
Switched to a new branch 'scalability-no-512-1000-100-1722352400'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722352400 0d71b4a3c6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:13:46 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:13:46 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-100-1722352400 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:15:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 16:15:01 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0d71b4a3c6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722352501
+ git checkout -b scalability-no-128-1000-100-1722352501
Switched to a new branch 'scalability-no-128-1000-100-1722352501'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722352501 0859091c9d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:15:27 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:15:27 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-100-1722352501 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:16:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 16:16:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0859091c9d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-100-1722352602
+ git checkout -b scalability-yes-32-1000-100-1722352602
Switched to a new branch 'scalability-yes-32-1000-100-1722352602'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-100-1722352602 5308628173] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-100-1722352602 4fb289c5a3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:17:09 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:17:09 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-100-1722352602 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:20:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 16:20:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4fb289c5a3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-100-1722352840
+ git checkout -b scalability-yes-0-1000-100-1722352840
Switched to a new branch 'scalability-yes-0-1000-100-1722352840'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-100-1722352840 938f81655b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:21:07 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:21:07 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-100-1722352840 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:24:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 16:24:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 938f81655b NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-100-1722353079
+ git checkout -b scalability-yes-1-1000-100-1722353079
Switched to a new branch 'scalability-yes-1-1000-100-1722353079'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-100-1722353079 aa6ce3149f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-100-1722353079 61bfcccae6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:25:07 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:25:07 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-100-1722353079 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:28:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 16:28:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 61bfcccae6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-100-1722353315
+ git checkout -b scalability-yes-1024-1000-100-1722353315
Switched to a new branch 'scalability-yes-1024-1000-100-1722353315'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-100-1722353315 24e70dea4f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-100-1722353315 724e948ddb] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:29:02 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:29:02 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-100-1722353315 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:32:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 16:32:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 724e948ddb fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-100-1722353557
+ git checkout -b scalability-yes-8-1000-100-1722353557
Switched to a new branch 'scalability-yes-8-1000-100-1722353557'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-100-1722353557 cce116f7cd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-100-1722353557 5a76b1f13c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:33:05 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:33:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-100-1722353557 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:36:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 16:36:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5a76b1f13c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-100-1722353799
+ git checkout -b scalability-yes-512-1000-100-1722353799
Switched to a new branch 'scalability-yes-512-1000-100-1722353799'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-100-1722353799 d6dfd0be30] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-100-1722353799 c603d23211] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:37:06 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:37:06 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-100-1722353799 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:40:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 16:40:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c603d23211 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-100-1722354036
+ git checkout -b scalability-yes-128-1000-100-1722354036
Switched to a new branch 'scalability-yes-128-1000-100-1722354036'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-100-1722354036 7a5fc8b050] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-100-1722354036 86df94618c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:41:03 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:41:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-100-1722354036 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:44:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 16:44:35 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 86df94618c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-100-1722354275
+ git checkout -b scalability-no-32-1000-100-1722354275
Switched to a new branch 'scalability-no-32-1000-100-1722354275'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-100-1722354275 333f3b52ce] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:45:03 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:45:03 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-100-1722354275 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:48:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 16:48:35 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 333f3b52ce fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-100-1722354515
+ git checkout -b scalability-no-0-1000-100-1722354515
Switched to a new branch 'scalability-no-0-1000-100-1722354515'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:49:02 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:49:02 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-100-1722354515 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:52:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 16:52:36 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-100-1722354756
+ git checkout -b scalability-no-1-1000-100-1722354756
Switched to a new branch 'scalability-no-1-1000-100-1722354756'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-100-1722354756 27d445fdd4] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:53:05 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:53:05 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-100-1722354756 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-100
+ env
++ date
+ echo Tue 30 Jul 16:56:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 16:56:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 27d445fdd4 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-100-1722354999
+ git checkout -b scalability-no-1024-1000-100-1722354999
Switched to a new branch 'scalability-no-1024-1000-100-1722354999'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-100-1722354999 84749485a7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 16:57:06 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 16:57:06 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-100-1722354999 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-100
+ env
++ date
+ echo Tue 30 Jul 17:00:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 17:00:36 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 84749485a7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-100-1722355237
+ git checkout -b scalability-no-8-1000-100-1722355237
Switched to a new branch 'scalability-no-8-1000-100-1722355237'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-100-1722355237 ae463ab943] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:01:04 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 17:01:04 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-100-1722355237 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-100
+ env
++ date
+ echo Tue 30 Jul 17:04:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 17:04:32 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ae463ab943 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-100-1722355473
+ git checkout -b scalability-no-512-1000-100-1722355473
Switched to a new branch 'scalability-no-512-1000-100-1722355473'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-100-1722355473 22baae831d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:05:00 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 17:05:00 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-100-1722355473 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-100
+ env
++ date
+ echo Tue 30 Jul 17:08:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 17:08:28 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 22baae831d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-100-1722355709
+ git checkout -b scalability-no-128-1000-100-1722355709
Switched to a new branch 'scalability-no-128-1000-100-1722355709'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-100-1722355709 4f2aad1eb6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:08:56 BST 2024 'RUN   files: 1000  partitions: 100'
Tue 30 Jul 17:08:56 BST 2024 RUN   files: 1000  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-100-1722355709 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:12:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 17:12:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4f2aad1eb6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722355946
+ git checkout -b scalability-yes-32-1000-1-1722355946
Switched to a new branch 'scalability-yes-32-1000-1-1722355946'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722355946 17d1eb4d3a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722355946 ed8297b59f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:13:23 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:13:23 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-1-1722355946 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:14:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 17:14:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ed8297b59f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722356077
+ git checkout -b scalability-yes-0-1000-1-1722356077
Switched to a new branch 'scalability-yes-0-1000-1-1722356077'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722356077 a294276f0e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:15:34 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:15:34 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-1-1722356077 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:16:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 17:16:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a294276f0e NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722356208
+ git checkout -b scalability-yes-1-1000-1-1722356208
Switched to a new branch 'scalability-yes-1-1000-1-1722356208'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722356208 c29e3f5c41] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722356208 b3629e47c2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:17:45 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:17:45 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-1-1722356208 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:18:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 17:18:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b3629e47c2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722356339
+ git checkout -b scalability-yes-1024-1000-1-1722356339
Switched to a new branch 'scalability-yes-1024-1000-1-1722356339'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722356339 fffc3fbd6d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722356339 80e85ca785] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:19:56 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:19:56 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-1-1722356339 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:21:10 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 17:21:10 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 80e85ca785 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722356470
+ git checkout -b scalability-yes-8-1000-1-1722356470
Switched to a new branch 'scalability-yes-8-1000-1-1722356470'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722356470 7d5a4bdafe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722356470 849ecb1d1f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:22:07 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:22:07 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-1-1722356470 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:23:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 17:23:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 849ecb1d1f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722356601
+ git checkout -b scalability-yes-512-1000-1-1722356601
Switched to a new branch 'scalability-yes-512-1000-1-1722356601'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722356601 40c4555c0e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722356601 d469bee6a5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:24:18 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:24:18 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-1-1722356601 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:25:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 17:25:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d469bee6a5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722356732
+ git checkout -b scalability-yes-128-1000-1-1722356732
Switched to a new branch 'scalability-yes-128-1000-1-1722356732'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722356732 f70ca2f025] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722356732 7c7d711cf2] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:26:28 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:26:28 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-1-1722356732 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:27:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 17:27:42 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7c7d711cf2 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722356862
+ git checkout -b scalability-no-32-1000-1-1722356862
Switched to a new branch 'scalability-no-32-1000-1-1722356862'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722356862 b80e983e5a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:28:39 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:28:39 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-1-1722356862 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:29:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 17:29:53 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b80e983e5a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722356993
+ git checkout -b scalability-no-0-1000-1-1722356993
Switched to a new branch 'scalability-no-0-1000-1-1722356993'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:30:50 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:30:50 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-1-1722356993 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:32:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 17:32:04 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722357124
+ git checkout -b scalability-no-1-1000-1-1722357124
Switched to a new branch 'scalability-no-1-1000-1-1722357124'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722357124 3e3f625623] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:33:00 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:33:00 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-1-1722357124 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:34:14 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 17:34:14 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3e3f625623 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722357254
+ git checkout -b scalability-no-1024-1000-1-1722357254
Switched to a new branch 'scalability-no-1024-1000-1-1722357254'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722357254 dcc2e99706] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:35:11 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:35:11 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-1-1722357254 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:36:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 17:36:24 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dcc2e99706 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722357385
+ git checkout -b scalability-no-8-1000-1-1722357385
Switched to a new branch 'scalability-no-8-1000-1-1722357385'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722357385 e5ca8a0d70] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:37:23 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:37:23 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-1-1722357385 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:38:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 17:38:36 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e5ca8a0d70 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722357517
+ git checkout -b scalability-no-512-1000-1-1722357517
Switched to a new branch 'scalability-no-512-1000-1-1722357517'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722357517 22852b6159] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:39:34 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:39:34 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-1-1722357517 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:40:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 17:40:47 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 22852b6159 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722357648
+ git checkout -b scalability-no-128-1000-1-1722357648
Switched to a new branch 'scalability-no-128-1000-1-1722357648'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722357648 d3528c4f1f] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:41:44 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:41:44 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-1-1722357648 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:42:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 17:42:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d3528c4f1f fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722357778
+ git checkout -b scalability-yes-32-1000-1-1722357778
Switched to a new branch 'scalability-yes-32-1000-1-1722357778'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722357778 a12d4e436c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722357778 11b86403db] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:43:25 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:43:25 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-1-1722357778 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:44:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 17:44:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 11b86403db fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722357882
+ git checkout -b scalability-yes-0-1000-1-1722357882
Switched to a new branch 'scalability-yes-0-1000-1-1722357882'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722357882 355629c6da] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:45:09 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:45:09 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-1-1722357882 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:46:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 17:46:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 355629c6da NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722357985
+ git checkout -b scalability-yes-1-1000-1-1722357985
Switched to a new branch 'scalability-yes-1-1000-1-1722357985'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722357985 fb8fe56ccb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722357985 750e57c2b5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:46:52 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:46:52 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-1-1722357985 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:48:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 17:48:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 750e57c2b5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722358088
+ git checkout -b scalability-yes-1024-1000-1-1722358088
Switched to a new branch 'scalability-yes-1024-1000-1-1722358088'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722358088 5f753e835f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722358088 d176855462] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:48:35 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:48:35 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-1-1722358088 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:49:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 17:49:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d176855462 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722358191
+ git checkout -b scalability-yes-8-1000-1-1722358191
Switched to a new branch 'scalability-yes-8-1000-1-1722358191'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722358191 718e7b649d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722358191 58ac9861e8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:50:18 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:50:18 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-1-1722358191 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:51:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 17:51:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 58ac9861e8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722358294
+ git checkout -b scalability-yes-512-1000-1-1722358294
Switched to a new branch 'scalability-yes-512-1000-1-1722358294'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722358294 28cf77d301] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722358294 3ff8b8be00] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:52:01 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:52:01 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-1-1722358294 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:53:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 17:53:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3ff8b8be00 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722358398
+ git checkout -b scalability-yes-128-1000-1-1722358398
Switched to a new branch 'scalability-yes-128-1000-1-1722358398'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722358398 c29ae12975] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722358398 419d3f0cd0] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:53:45 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:53:45 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-1-1722358398 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:55:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 17:55:01 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 419d3f0cd0 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722358501
+ git checkout -b scalability-no-32-1000-1-1722358501
Switched to a new branch 'scalability-no-32-1000-1-1722358501'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722358501 396f02469c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:55:28 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:55:28 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-1-1722358501 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:56:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 17:56:44 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 396f02469c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722358604
+ git checkout -b scalability-no-0-1000-1-1722358604
Switched to a new branch 'scalability-no-0-1000-1-1722358604'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:57:11 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:57:11 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-1-1722358604 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 17:58:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 17:58:26 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722358706
+ git checkout -b scalability-no-1-1000-1-1722358706
Switched to a new branch 'scalability-no-1-1000-1-1722358706'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722358706 e21d6de36b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 17:58:53 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 17:58:53 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-1-1722358706 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:00:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 18:00:09 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e21d6de36b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722358809
+ git checkout -b scalability-no-1024-1000-1-1722358809
Switched to a new branch 'scalability-no-1024-1000-1-1722358809'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722358809 21f87fe61c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:00:36 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:00:36 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-1-1722358809 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:01:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 18:01:53 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 21f87fe61c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722358913
+ git checkout -b scalability-no-8-1000-1-1722358913
Switched to a new branch 'scalability-no-8-1000-1-1722358913'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722358913 a8d1d2f43a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:02:20 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:02:20 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-1-1722358913 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:03:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 18:03:36 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a8d1d2f43a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722359016
+ git checkout -b scalability-no-512-1000-1-1722359016
Switched to a new branch 'scalability-no-512-1000-1-1722359016'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722359016 226142f630] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:04:03 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:04:03 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-1-1722359016 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:05:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 18:05:19 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 226142f630 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722359119
+ git checkout -b scalability-no-128-1000-1-1722359119
Switched to a new branch 'scalability-no-128-1000-1-1722359119'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722359119 6fec7178e7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:05:46 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:05:46 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-1-1722359119 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:07:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 18:07:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6fec7178e7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722359222
+ git checkout -b scalability-yes-32-1000-1-1722359222
Switched to a new branch 'scalability-yes-32-1000-1-1722359222'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722359222 b74a5c9479] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722359222 32e722fa3c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:07:29 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:07:29 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-1-1722359222 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:08:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 18:08:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 32e722fa3c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722359323
+ git checkout -b scalability-yes-0-1000-1-1722359323
Switched to a new branch 'scalability-yes-0-1000-1-1722359323'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722359323 ae5564876f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:09:10 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:09:10 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-1-1722359323 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:10:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 18:10:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ae5564876f NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722359423
+ git checkout -b scalability-yes-1-1000-1-1722359423
Switched to a new branch 'scalability-yes-1-1000-1-1722359423'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722359423 3712823eb0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722359423 2e3830f7f2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:10:50 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:10:50 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-1-1722359423 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:12:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 18:12:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2e3830f7f2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722359524
+ git checkout -b scalability-yes-1024-1000-1-1722359524
Switched to a new branch 'scalability-yes-1024-1000-1-1722359524'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722359524 766c272751] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722359524 2eda52f1d0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:12:31 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:12:31 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-1-1722359524 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:13:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 18:13:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2eda52f1d0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722359625
+ git checkout -b scalability-yes-8-1000-1-1722359625
Switched to a new branch 'scalability-yes-8-1000-1-1722359625'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722359625 c1fa030ede] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722359625 57db1202aa] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:14:12 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:14:12 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-1-1722359625 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:15:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 18:15:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 57db1202aa fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722359726
+ git checkout -b scalability-yes-512-1000-1-1722359726
Switched to a new branch 'scalability-yes-512-1000-1-1722359726'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722359726 a0c5c2548a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722359726 2ae37f9ec0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:15:53 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:15:53 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-1-1722359726 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:17:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 18:17:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2ae37f9ec0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722359827
+ git checkout -b scalability-yes-128-1000-1-1722359827
Switched to a new branch 'scalability-yes-128-1000-1-1722359827'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722359827 1d704c5fab] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722359827 3354908c19] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:17:34 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:17:34 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-1-1722359827 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:18:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 18:18:47 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3354908c19 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722359927
+ git checkout -b scalability-no-32-1000-1-1722359927
Switched to a new branch 'scalability-no-32-1000-1-1722359927'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722359927 62663bbd79] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:19:15 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:19:15 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-1-1722359927 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:20:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 18:20:28 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 62663bbd79 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722360028
+ git checkout -b scalability-no-0-1000-1-1722360028
Switched to a new branch 'scalability-no-0-1000-1-1722360028'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:20:55 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:20:55 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-1-1722360028 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:22:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 18:22:08 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722360128
+ git checkout -b scalability-no-1-1000-1-1722360128
Switched to a new branch 'scalability-no-1-1000-1-1722360128'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722360128 005f5ef5fb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:22:35 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:22:35 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-1-1722360128 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:23:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 18:23:49 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 005f5ef5fb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722360229
+ git checkout -b scalability-no-1024-1000-1-1722360229
Switched to a new branch 'scalability-no-1024-1000-1-1722360229'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722360229 c2baaea078] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:24:16 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:24:16 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-1-1722360229 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:25:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 18:25:29 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c2baaea078 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722360330
+ git checkout -b scalability-no-8-1000-1-1722360330
Switched to a new branch 'scalability-no-8-1000-1-1722360330'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722360330 8f7d223f32] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:25:57 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:25:57 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-1-1722360330 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:27:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 18:27:10 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8f7d223f32 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722360430
+ git checkout -b scalability-no-512-1000-1-1722360430
Switched to a new branch 'scalability-no-512-1000-1-1722360430'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722360430 ae0c06c307] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:27:37 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:27:37 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-1-1722360430 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:28:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 18:28:50 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ae0c06c307 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722360531
+ git checkout -b scalability-no-128-1000-1-1722360531
Switched to a new branch 'scalability-no-128-1000-1-1722360531'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722360531 74ef62e30e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:29:18 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:29:18 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-1-1722360531 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:30:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 18:30:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 74ef62e30e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722360631
+ git checkout -b scalability-yes-32-1000-1-1722360631
Switched to a new branch 'scalability-yes-32-1000-1-1722360631'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722360631 e4bb789c17] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722360631 6cdd18c204] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:30:58 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:30:58 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-1-1722360631 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:32:12 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 18:32:12 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6cdd18c204 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722360732
+ git checkout -b scalability-yes-0-1000-1-1722360732
Switched to a new branch 'scalability-yes-0-1000-1-1722360732'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722360732 4ccf48e393] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:32:39 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:32:39 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-1-1722360732 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:33:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 18:33:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4ccf48e393 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722360833
+ git checkout -b scalability-yes-1-1000-1-1722360833
Switched to a new branch 'scalability-yes-1-1000-1-1722360833'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722360833 4fe95a2b10] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722360833 bd0af0cb50] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:34:20 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:34:20 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-1-1722360833 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:35:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 18:35:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bd0af0cb50 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722360934
+ git checkout -b scalability-yes-1024-1000-1-1722360934
Switched to a new branch 'scalability-yes-1024-1000-1-1722360934'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722360934 cdea479597] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722360934 63b98cfe1c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:36:01 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:36:01 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-1-1722360934 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:37:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 18:37:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 63b98cfe1c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722361035
+ git checkout -b scalability-yes-8-1000-1-1722361035
Switched to a new branch 'scalability-yes-8-1000-1-1722361035'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722361035 2ff6b5bce7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722361035 cd39c8d3e7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:37:42 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:37:42 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-1-1722361035 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:38:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 18:38:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cd39c8d3e7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722361136
+ git checkout -b scalability-yes-512-1000-1-1722361136
Switched to a new branch 'scalability-yes-512-1000-1-1722361136'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722361136 fa94d2b4f4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722361136 1714c29404] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:39:23 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:39:23 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-1-1722361136 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:40:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 18:40:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1714c29404 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722361237
+ git checkout -b scalability-yes-128-1000-1-1722361237
Switched to a new branch 'scalability-yes-128-1000-1-1722361237'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722361237 f0659f5db3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722361237 8e0d1c8e5e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:41:04 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:41:04 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-1-1722361237 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:42:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 18:42:18 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8e0d1c8e5e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722361338
+ git checkout -b scalability-no-32-1000-1-1722361338
Switched to a new branch 'scalability-no-32-1000-1-1722361338'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722361338 5865af5913] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:42:45 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:42:45 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-1-1722361338 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:43:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 18:43:59 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5865af5913 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722361439
+ git checkout -b scalability-no-0-1000-1-1722361439
Switched to a new branch 'scalability-no-0-1000-1-1722361439'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:44:26 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:44:26 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-1-1722361439 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:45:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 18:45:40 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722361540
+ git checkout -b scalability-no-1-1000-1-1722361540
Switched to a new branch 'scalability-no-1-1000-1-1722361540'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722361540 9a9a5c0b28] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:46:07 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:46:07 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-1-1722361540 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:47:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 18:47:21 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9a9a5c0b28 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722361641
+ git checkout -b scalability-no-1024-1000-1-1722361641
Switched to a new branch 'scalability-no-1024-1000-1-1722361641'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722361641 caf91259a5] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:47:48 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:47:48 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-1-1722361641 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:49:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 18:49:01 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at caf91259a5 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722361742
+ git checkout -b scalability-no-8-1000-1-1722361742
Switched to a new branch 'scalability-no-8-1000-1-1722361742'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722361742 e6de04f448] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:49:28 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:49:28 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-1-1722361742 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:50:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 18:50:42 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e6de04f448 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722361842
+ git checkout -b scalability-no-512-1000-1-1722361842
Switched to a new branch 'scalability-no-512-1000-1-1722361842'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722361842 9ca73c5825] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:51:09 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:51:09 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-1-1722361842 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:52:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 18:52:23 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9ca73c5825 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722361943
+ git checkout -b scalability-no-128-1000-1-1722361943
Switched to a new branch 'scalability-no-128-1000-1-1722361943'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722361943 8938e0a6fd] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:52:50 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:52:50 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-1-1722361943 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:54:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 18:54:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8938e0a6fd fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-1-1722362044
+ git checkout -b scalability-yes-32-1000-1-1722362044
Switched to a new branch 'scalability-yes-32-1000-1-1722362044'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-1-1722362044 520bda8b85] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-1-1722362044 f904a89db0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:54:31 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:54:31 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-1-1722362044 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:55:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 18:55:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f904a89db0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-1-1722362150
+ git checkout -b scalability-yes-0-1000-1-1722362150
Switched to a new branch 'scalability-yes-0-1000-1-1722362150'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-1-1722362150 9e5dd5b1fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:56:18 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:56:18 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-1-1722362150 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:57:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 18:57:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9e5dd5b1fa NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-1-1722362257
+ git checkout -b scalability-yes-1-1000-1-1722362257
Switched to a new branch 'scalability-yes-1-1000-1-1722362257'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-1-1722362257 6e33c19443] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-1-1722362257 cbe732aca1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:58:04 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:58:04 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-1-1722362257 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 18:59:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 18:59:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cbe732aca1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-1-1722362364
+ git checkout -b scalability-yes-1024-1000-1-1722362364
Switched to a new branch 'scalability-yes-1024-1000-1-1722362364'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-1-1722362364 28a5214e5c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-1-1722362364 6709e0a223] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 18:59:50 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 18:59:50 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-1-1722362364 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:01:10 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 19:01:10 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6709e0a223 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-1-1722362470
+ git checkout -b scalability-yes-8-1000-1-1722362470
Switched to a new branch 'scalability-yes-8-1000-1-1722362470'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-1-1722362470 d40557306a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-1-1722362470 acf7ece359] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:01:37 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:01:37 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-1-1722362470 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:02:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 19:02:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at acf7ece359 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-1-1722362577
+ git checkout -b scalability-yes-512-1000-1-1722362577
Switched to a new branch 'scalability-yes-512-1000-1-1722362577'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-1-1722362577 fb9afc6bad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-1-1722362577 791ffb21be] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:03:24 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:03:24 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-1-1722362577 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:04:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 19:04:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 791ffb21be fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-1-1722362683
+ git checkout -b scalability-yes-128-1000-1-1722362683
Switched to a new branch 'scalability-yes-128-1000-1-1722362683'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-1-1722362683 bd06a1379c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-1-1722362683 3b8884cefc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:05:10 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:05:10 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-1-1722362683 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:06:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 19:06:29 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3b8884cefc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-1-1722362789
+ git checkout -b scalability-no-32-1000-1-1722362789
Switched to a new branch 'scalability-no-32-1000-1-1722362789'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-1-1722362789 a219e5a30e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:06:56 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:06:56 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-1-1722362789 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:08:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 19:08:15 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a219e5a30e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-1-1722362895
+ git checkout -b scalability-no-0-1000-1-1722362895
Switched to a new branch 'scalability-no-0-1000-1-1722362895'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:08:42 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:08:42 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-1-1722362895 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:10:04 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 19:10:04 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-1-1722363004
+ git checkout -b scalability-no-1-1000-1-1722363004
Switched to a new branch 'scalability-no-1-1000-1-1722363004'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-1-1722363004 a2b3dc27bb] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:10:31 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:10:31 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-1-1722363004 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:11:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 19:11:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a2b3dc27bb fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-1-1722363110
+ git checkout -b scalability-no-1024-1000-1-1722363110
Switched to a new branch 'scalability-no-1024-1000-1-1722363110'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-1-1722363110 fe710289ac] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:12:17 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:12:17 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-1-1722363110 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:13:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 19:13:37 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fe710289ac fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-1-1722363217
+ git checkout -b scalability-no-8-1000-1-1722363217
Switched to a new branch 'scalability-no-8-1000-1-1722363217'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-1-1722363217 52dde1a308] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:14:04 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:14:04 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-1-1722363217 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:15:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 19:15:23 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 52dde1a308 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-1-1722363323
+ git checkout -b scalability-no-512-1000-1-1722363323
Switched to a new branch 'scalability-no-512-1000-1-1722363323'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-1-1722363323 083898a2b8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:15:51 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:15:51 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-1-1722363323 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-1
+ env
++ date
+ echo Tue 30 Jul 19:17:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 19:17:10 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 083898a2b8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-1-1722363430
+ git checkout -b scalability-no-128-1000-1-1722363430
Switched to a new branch 'scalability-no-128-1000-1-1722363430'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-1-1722363430 022c61fc12] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:17:37 BST 2024 'RUN   files: 1000  partitions: 1'
Tue 30 Jul 19:17:37 BST 2024 RUN   files: 1000  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-1-1722363430 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:18:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 19:18:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 022c61fc12 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722363537
+ git checkout -b scalability-yes-32-1000-0-1722363537
Switched to a new branch 'scalability-yes-32-1000-0-1722363537'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722363537 01d53696c7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722363537 ed8e30ce2f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:19:54 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:19:54 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-1000-0-1722363537 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:21:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 19:21:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ed8e30ce2f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722363668
+ git checkout -b scalability-yes-0-1000-0-1722363668
Switched to a new branch 'scalability-yes-0-1000-0-1722363668'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722363668 fc6fa7f065] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:22:05 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:22:05 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-1000-0-1722363668 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:23:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 19:23:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc6fa7f065 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722363799
+ git checkout -b scalability-yes-1-1000-0-1722363799
Switched to a new branch 'scalability-yes-1-1000-0-1722363799'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722363799 1f4663d67d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722363799 344276fda1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:24:15 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:24:15 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-1000-0-1722363799 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:25:29 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 19:25:29 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 344276fda1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722363929
+ git checkout -b scalability-yes-1024-1000-0-1722363929
Switched to a new branch 'scalability-yes-1024-1000-0-1722363929'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722363929 f7d36be58a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722363929 8d5c31bdc6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:26:25 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:26:25 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-1000-0-1722363929 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:27:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 19:27:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8d5c31bdc6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722364059
+ git checkout -b scalability-yes-8-1000-0-1722364059
Switched to a new branch 'scalability-yes-8-1000-0-1722364059'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722364059 079b3cabbe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722364059 64cff062bf] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:28:36 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:28:36 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-1000-0-1722364059 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:29:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 19:29:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 64cff062bf fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722364189
+ git checkout -b scalability-yes-512-1000-0-1722364189
Switched to a new branch 'scalability-yes-512-1000-0-1722364189'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722364189 11461400e6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722364189 2a397b7246] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:30:47 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:30:47 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-1000-0-1722364189 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:32:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 19:32:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2a397b7246 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722364321
+ git checkout -b scalability-yes-128-1000-0-1722364321
Switched to a new branch 'scalability-yes-128-1000-0-1722364321'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722364321 c6e19f0547] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722364321 9fca54eae7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:32:57 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:32:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-1000-0-1722364321 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:34:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 19:34:11 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9fca54eae7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722364451
+ git checkout -b scalability-no-32-1000-0-1722364451
Switched to a new branch 'scalability-no-32-1000-0-1722364451'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722364451 89f8dbe07b] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:35:07 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:35:07 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-1000-0-1722364451 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:36:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 19:36:21 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 89f8dbe07b fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722364581
+ git checkout -b scalability-no-0-1000-0-1722364581
Switched to a new branch 'scalability-no-0-1000-0-1722364581'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:37:17 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:37:17 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-1000-0-1722364581 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:38:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 19:38:31 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722364711
+ git checkout -b scalability-no-1-1000-0-1722364711
Switched to a new branch 'scalability-no-1-1000-0-1722364711'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722364711 91a86b75b9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:39:27 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:39:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-1000-0-1722364711 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:40:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 19:40:40 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 91a86b75b9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722364840
+ git checkout -b scalability-no-1024-1000-0-1722364840
Switched to a new branch 'scalability-no-1024-1000-0-1722364840'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722364840 fd2b0c6534] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:41:36 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:41:36 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-1000-0-1722364840 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:42:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 19:42:50 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fd2b0c6534 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722364970
+ git checkout -b scalability-no-8-1000-0-1722364970
Switched to a new branch 'scalability-no-8-1000-0-1722364970'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722364970 722ff447fc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:43:45 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:43:45 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-1000-0-1722364970 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:44:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 19:44:59 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 722ff447fc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722365099
+ git checkout -b scalability-no-512-1000-0-1722365099
Switched to a new branch 'scalability-no-512-1000-0-1722365099'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722365099 3a297cecf5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:45:55 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:45:55 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-1000-0-1722365099 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:47:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 19:47:09 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3a297cecf5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722365229
+ git checkout -b scalability-no-128-1000-0-1722365229
Switched to a new branch 'scalability-no-128-1000-0-1722365229'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722365229 5d5fcccd23] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:48:04 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:48:04 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-1000-0-1722365229 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:49:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 19:49:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5d5fcccd23 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722365358
+ git checkout -b scalability-yes-32-1000-0-1722365358
Switched to a new branch 'scalability-yes-32-1000-0-1722365358'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722365358 b3a80775fe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722365358 5b39ae7048] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:49:45 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:49:45 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-1000-0-1722365358 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:51:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 19:51:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5b39ae7048 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722365460
+ git checkout -b scalability-yes-0-1000-0-1722365460
Switched to a new branch 'scalability-yes-0-1000-0-1722365460'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722365460 3dce77ce62] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:51:27 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:51:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-1000-0-1722365460 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:52:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 19:52:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3dce77ce62 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722365563
+ git checkout -b scalability-yes-1-1000-0-1722365563
Switched to a new branch 'scalability-yes-1-1000-0-1722365563'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722365563 70038c5f82] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722365563 1868295bd0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:53:10 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:53:10 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-1000-0-1722365563 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:54:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 19:54:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1868295bd0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722365666
+ git checkout -b scalability-yes-1024-1000-0-1722365666
Switched to a new branch 'scalability-yes-1024-1000-0-1722365666'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722365666 d6bd204120] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722365666 dcf82fc8dd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:54:52 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:54:52 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-1000-0-1722365666 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:56:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 19:56:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dcf82fc8dd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722365768
+ git checkout -b scalability-yes-8-1000-0-1722365768
Switched to a new branch 'scalability-yes-8-1000-0-1722365768'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722365768 da70ae30df] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722365768 88a78379ef] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:56:35 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:56:35 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-1000-0-1722365768 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:57:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 19:57:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 88a78379ef fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722365871
+ git checkout -b scalability-yes-512-1000-0-1722365871
Switched to a new branch 'scalability-yes-512-1000-0-1722365871'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722365871 b10fc63788] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722365871 414c87aa99] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 19:58:18 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 19:58:18 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-1000-0-1722365871 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 19:59:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 19:59:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 414c87aa99 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722365974
+ git checkout -b scalability-yes-128-1000-0-1722365974
Switched to a new branch 'scalability-yes-128-1000-0-1722365974'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722365974 27e357fff3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722365974 d765a55081] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:00:00 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:00:00 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-1000-0-1722365974 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:01:17 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 20:01:17 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d765a55081 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722366077
+ git checkout -b scalability-no-32-1000-0-1722366077
Switched to a new branch 'scalability-no-32-1000-0-1722366077'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722366077 5d25747d56] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:01:43 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:01:43 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-1000-0-1722366077 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:02:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 20:02:59 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5d25747d56 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722366179
+ git checkout -b scalability-no-0-1000-0-1722366179
Switched to a new branch 'scalability-no-0-1000-0-1722366179'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:03:26 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:03:26 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-1000-0-1722366179 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:04:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 20:04:41 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722366282
+ git checkout -b scalability-no-1-1000-0-1722366282
Switched to a new branch 'scalability-no-1-1000-0-1722366282'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722366282 047737eba0] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:05:09 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:05:09 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-1000-0-1722366282 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:06:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 20:06:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 047737eba0 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722366385
+ git checkout -b scalability-no-1024-1000-0-1722366385
Switched to a new branch 'scalability-no-1024-1000-0-1722366385'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722366385 589f474d9a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:06:51 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:06:51 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-1000-0-1722366385 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:08:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 20:08:07 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 589f474d9a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722366487
+ git checkout -b scalability-no-8-1000-0-1722366487
Switched to a new branch 'scalability-no-8-1000-0-1722366487'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722366487 4e3f3e0b61] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:08:34 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:08:34 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-1000-0-1722366487 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:09:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 20:09:50 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4e3f3e0b61 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722366590
+ git checkout -b scalability-no-512-1000-0-1722366590
Switched to a new branch 'scalability-no-512-1000-0-1722366590'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722366590 3ddde87f6e] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:10:16 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:10:16 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-1000-0-1722366590 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:11:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 20:11:32 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3ddde87f6e fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722366692
+ git checkout -b scalability-no-128-1000-0-1722366692
Switched to a new branch 'scalability-no-128-1000-0-1722366692'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722366692 4bc7bf408c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:11:58 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:11:58 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-1000-0-1722366692 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:13:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 20:13:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4bc7bf408c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722366794
+ git checkout -b scalability-yes-32-1000-0-1722366794
Switched to a new branch 'scalability-yes-32-1000-0-1722366794'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722366794 42b6c3823c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722366794 eb3e474583] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:13:41 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:13:41 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-1000-0-1722366794 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:14:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 20:14:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eb3e474583 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722366894
+ git checkout -b scalability-yes-0-1000-0-1722366894
Switched to a new branch 'scalability-yes-0-1000-0-1722366894'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722366894 b7e1f1ddff] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:15:21 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:15:21 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-1000-0-1722366894 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:16:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 20:16:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b7e1f1ddff NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722366995
+ git checkout -b scalability-yes-1-1000-0-1722366995
Switched to a new branch 'scalability-yes-1-1000-0-1722366995'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722366995 833da494a6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722366995 d6014e7d29] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:17:01 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:17:01 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-1000-0-1722366995 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:18:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 20:18:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6014e7d29 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722367095
+ git checkout -b scalability-yes-1024-1000-0-1722367095
Switched to a new branch 'scalability-yes-1024-1000-0-1722367095'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722367095 44e9b981e4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722367095 31d48aeb49] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:18:41 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:18:41 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-1000-0-1722367095 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:19:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 20:19:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 31d48aeb49 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722367195
+ git checkout -b scalability-yes-8-1000-0-1722367195
Switched to a new branch 'scalability-yes-8-1000-0-1722367195'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722367195 8caab14632] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722367195 52b6a2ae06] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:20:21 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:20:21 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-1000-0-1722367195 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:21:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 20:21:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 52b6a2ae06 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722367295
+ git checkout -b scalability-yes-512-1000-0-1722367295
Switched to a new branch 'scalability-yes-512-1000-0-1722367295'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722367295 25b24860bc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722367295 5ac3b88f54] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:22:01 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:22:01 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-1000-0-1722367295 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:23:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 20:23:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5ac3b88f54 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722367395
+ git checkout -b scalability-yes-128-1000-0-1722367395
Switched to a new branch 'scalability-yes-128-1000-0-1722367395'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722367395 374ae52302] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722367395 eebd3d86ad] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:23:41 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:23:41 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-1000-0-1722367395 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:24:55 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 20:24:55 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eebd3d86ad fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722367495
+ git checkout -b scalability-no-32-1000-0-1722367495
Switched to a new branch 'scalability-no-32-1000-0-1722367495'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722367495 82608faca7] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:25:21 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:25:21 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-1000-0-1722367495 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:26:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 20:26:35 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 82608faca7 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722367595
+ git checkout -b scalability-no-0-1000-0-1722367595
Switched to a new branch 'scalability-no-0-1000-0-1722367595'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:27:02 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:27:02 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-1000-0-1722367595 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:28:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 20:28:16 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722367696
+ git checkout -b scalability-no-1-1000-0-1722367696
Switched to a new branch 'scalability-no-1-1000-0-1722367696'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722367696 352084868d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:28:42 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:28:42 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-1000-0-1722367696 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:29:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 20:29:56 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 352084868d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722367796
+ git checkout -b scalability-no-1024-1000-0-1722367796
Switched to a new branch 'scalability-no-1024-1000-0-1722367796'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722367796 e982bdb861] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:30:22 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:30:22 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-1000-0-1722367796 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:31:36 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 20:31:36 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e982bdb861 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722367896
+ git checkout -b scalability-no-8-1000-0-1722367896
Switched to a new branch 'scalability-no-8-1000-0-1722367896'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722367896 223643b735] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:32:02 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:32:02 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-1000-0-1722367896 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:33:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 20:33:16 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 223643b735 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722367996
+ git checkout -b scalability-no-512-1000-0-1722367996
Switched to a new branch 'scalability-no-512-1000-0-1722367996'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722367996 f1b408b472] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:33:42 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:33:42 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-1000-0-1722367996 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:34:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 20:34:56 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f1b408b472 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722368096
+ git checkout -b scalability-no-128-1000-0-1722368096
Switched to a new branch 'scalability-no-128-1000-0-1722368096'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722368096 23c0d94503] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:35:22 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:35:22 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-1000-0-1722368096 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:36:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 20:36:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 23c0d94503 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722368196
+ git checkout -b scalability-yes-32-1000-0-1722368196
Switched to a new branch 'scalability-yes-32-1000-0-1722368196'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722368196 7dce4f3a28] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722368196 9337714d1e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:37:02 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:37:02 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-1000-0-1722368196 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:38:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 20:38:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9337714d1e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722368296
+ git checkout -b scalability-yes-0-1000-0-1722368296
Switched to a new branch 'scalability-yes-0-1000-0-1722368296'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722368296 14f22096ad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:38:42 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:38:42 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-1000-0-1722368296 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:39:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 20:39:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 14f22096ad NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722368396
+ git checkout -b scalability-yes-1-1000-0-1722368396
Switched to a new branch 'scalability-yes-1-1000-0-1722368396'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722368396 59c7b0cefb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722368396 24916961a6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:40:23 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:40:23 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-1000-0-1722368396 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:41:37 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 20:41:37 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 24916961a6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722368497
+ git checkout -b scalability-yes-1024-1000-0-1722368497
Switched to a new branch 'scalability-yes-1024-1000-0-1722368497'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722368497 cdd61e0550] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722368497 5ddea0dfa9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:42:03 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:42:03 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-1000-0-1722368497 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:43:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 20:43:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5ddea0dfa9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722368597
+ git checkout -b scalability-yes-8-1000-0-1722368597
Switched to a new branch 'scalability-yes-8-1000-0-1722368597'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722368597 f902b11263] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722368597 eefbd15a11] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:43:44 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:43:44 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-1000-0-1722368597 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:44:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 20:44:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eefbd15a11 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722368698
+ git checkout -b scalability-yes-512-1000-0-1722368698
Switched to a new branch 'scalability-yes-512-1000-0-1722368698'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722368698 361bcf6aca] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722368698 dfaae035c1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:45:24 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:45:24 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-1000-0-1722368698 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:46:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 20:46:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dfaae035c1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722368798
+ git checkout -b scalability-yes-128-1000-0-1722368798
Switched to a new branch 'scalability-yes-128-1000-0-1722368798'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722368798 ac0f9d1bf2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722368798 7d0ef67586] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:47:05 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:47:05 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-1000-0-1722368798 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:48:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 20:48:18 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7d0ef67586 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722368898
+ git checkout -b scalability-no-32-1000-0-1722368898
Switched to a new branch 'scalability-no-32-1000-0-1722368898'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722368898 e882e65904] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:48:45 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:48:45 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-1000-0-1722368898 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:49:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 20:49:58 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e882e65904 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722368998
+ git checkout -b scalability-no-0-1000-0-1722368998
Switched to a new branch 'scalability-no-0-1000-0-1722368998'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:50:25 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:50:25 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-1000-0-1722368998 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:51:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 20:51:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722369099
+ git checkout -b scalability-no-1-1000-0-1722369099
Switched to a new branch 'scalability-no-1-1000-0-1722369099'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722369099 bc1a431b8f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:52:05 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:52:05 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-1000-0-1722369099 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:53:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 20:53:19 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bc1a431b8f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722369199
+ git checkout -b scalability-no-1024-1000-0-1722369199
Switched to a new branch 'scalability-no-1024-1000-0-1722369199'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722369199 3135c67ed1] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:53:45 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:53:45 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-1000-0-1722369199 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:54:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 20:54:59 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3135c67ed1 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722369299
+ git checkout -b scalability-no-8-1000-0-1722369299
Switched to a new branch 'scalability-no-8-1000-0-1722369299'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722369299 605f3b97d7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:55:25 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:55:25 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-1000-0-1722369299 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:56:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 20:56:40 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 605f3b97d7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722369400
+ git checkout -b scalability-no-512-1000-0-1722369400
Switched to a new branch 'scalability-no-512-1000-0-1722369400'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722369400 869b3e9738] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:57:06 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:57:06 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-1000-0-1722369400 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 20:58:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 20:58:20 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 869b3e9738 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722369500
+ git checkout -b scalability-no-128-1000-0-1722369500
Switched to a new branch 'scalability-no-128-1000-0-1722369500'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722369500 e52cf2179d] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 20:58:46 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 20:58:46 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-1000-0-1722369500 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:00:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 21:00:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e52cf2179d fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-0-1722369600
+ git checkout -b scalability-yes-32-1000-0-1722369600
Switched to a new branch 'scalability-yes-32-1000-0-1722369600'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-0-1722369600 1db19204b6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-0-1722369600 8bd9316f8d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:00:27 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:00:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-1000-0-1722369600 1000 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:00:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 21:00:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8bd9316f8d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-0-1722369630
+ git checkout -b scalability-yes-0-1000-0-1722369630
Switched to a new branch 'scalability-yes-0-1000-0-1722369630'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-0-1722369630 9c59ac16c1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:00:57 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:00:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-1000-0-1722369630 1000 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:00:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 21:00:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9c59ac16c1 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-0-1722369660
+ git checkout -b scalability-yes-1-1000-0-1722369660
Switched to a new branch 'scalability-yes-1-1000-0-1722369660'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-0-1722369660 99ee8389c6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-0-1722369660 bc50f20464] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:01:27 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:01:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-1000-0-1722369660 1000 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:01:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 21:01:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bc50f20464 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-0-1722369690
+ git checkout -b scalability-yes-1024-1000-0-1722369690
Switched to a new branch 'scalability-yes-1024-1000-0-1722369690'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-0-1722369690 0fb517177c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-0-1722369690 525b3a0145] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:01:58 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:01:58 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-1000-0-1722369690 1000 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:02:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 21:02:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 525b3a0145 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-0-1722369721
+ git checkout -b scalability-yes-8-1000-0-1722369721
Switched to a new branch 'scalability-yes-8-1000-0-1722369721'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-0-1722369721 759126ab7c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-0-1722369721 411814f884] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:02:28 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:02:28 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-1000-0-1722369721 1000 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:02:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 21:02:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 411814f884 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-0-1722369751
+ git checkout -b scalability-yes-512-1000-0-1722369751
Switched to a new branch 'scalability-yes-512-1000-0-1722369751'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-0-1722369751 1906ac1b1e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-0-1722369751 70b9f18369] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:02:58 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:02:58 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-1000-0-1722369751 1000 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:03:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 21:03:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 70b9f18369 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-0-1722369781
+ git checkout -b scalability-yes-128-1000-0-1722369781
Switched to a new branch 'scalability-yes-128-1000-0-1722369781'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-0-1722369781 e721975aa3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-0-1722369781 0127d772ca] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:03:28 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:03:28 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-1000-0-1722369781 1000 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:03:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 21:03:31 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0127d772ca fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-0-1722369811
+ git checkout -b scalability-no-32-1000-0-1722369811
Switched to a new branch 'scalability-no-32-1000-0-1722369811'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-0-1722369811 862dda3e80] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:03:58 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:03:58 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-1000-0-1722369811 1000 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:04:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 21:04:01 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 862dda3e80 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-0-1722369842
+ git checkout -b scalability-no-0-1000-0-1722369842
Switched to a new branch 'scalability-no-0-1000-0-1722369842'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:04:28 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:04:28 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-1000-0-1722369842 1000 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:04:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 21:04:31 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-0-1722369872
+ git checkout -b scalability-no-1-1000-0-1722369872
Switched to a new branch 'scalability-no-1-1000-0-1722369872'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-0-1722369872 7cab976710] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:04:58 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:04:58 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-1000-0-1722369872 1000 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:05:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 21:05:02 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7cab976710 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-0-1722369902
+ git checkout -b scalability-no-1024-1000-0-1722369902
Switched to a new branch 'scalability-no-1024-1000-0-1722369902'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-0-1722369902 ae3bae973a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:05:28 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:05:28 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-1000-0-1722369902 1000 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:05:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 21:05:31 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ae3bae973a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-0-1722369931
+ git checkout -b scalability-no-8-1000-0-1722369931
Switched to a new branch 'scalability-no-8-1000-0-1722369931'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-0-1722369931 06d5c1d5e1] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:05:57 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:05:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-1000-0-1722369931 1000 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:06:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 21:06:01 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 06d5c1d5e1 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-0-1722369961
+ git checkout -b scalability-no-512-1000-0-1722369961
Switched to a new branch 'scalability-no-512-1000-0-1722369961'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-0-1722369961 1e5a46a3eb] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:06:27 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:06:27 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-1000-0-1722369961 1000 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-1000-0
+ env
++ date
+ echo Tue 30 Jul 21:06:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 21:06:30 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1e5a46a3eb fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-0-1722369990
+ git checkout -b scalability-no-128-1000-0-1722369990
Switched to a new branch 'scalability-no-128-1000-0-1722369990'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-0-1722369990 f47568cffa] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:06:57 BST 2024 'RUN   files: 1000  partitions: 0'
Tue 30 Jul 21:06:57 BST 2024 RUN   files: 1000  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-1000-0-1722369990 1000 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-1000-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:07:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 21:07:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f47568cffa fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722370020
+ git checkout -b scalability-yes-32-32768-1000-1722370020
Switched to a new branch 'scalability-yes-32-32768-1000-1722370020'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722370020 b676f0ea3d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722370020 6bd5b57b0e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:07:56 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:07:56 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-1000-1722370020 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:09:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 21:09:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6bd5b57b0e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722370163
+ git checkout -b scalability-yes-0-32768-1000-1722370163
Switched to a new branch 'scalability-yes-0-32768-1000-1722370163'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722370163 d79cbbe0cf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:10:20 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:10:20 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-1000-1722370163 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:11:47 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 21:11:47 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d79cbbe0cf NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722370307
+ git checkout -b scalability-yes-1-32768-1000-1722370307
Switched to a new branch 'scalability-yes-1-32768-1000-1722370307'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722370307 cc925fc4f9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722370307 1ed4b2f80d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:12:44 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:12:44 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-1000-1722370307 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:14:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 21:14:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1ed4b2f80d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722370451
+ git checkout -b scalability-yes-1024-32768-1000-1722370451
Switched to a new branch 'scalability-yes-1024-32768-1000-1722370451'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722370451 c392a24059] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722370451 ea162cbdd4] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:15:10 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:15:10 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-1000-1722370451 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:16:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 21:16:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ea162cbdd4 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722370598
+ git checkout -b scalability-yes-8-32768-1000-1722370598
Switched to a new branch 'scalability-yes-8-32768-1000-1722370598'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722370598 3789604c92] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722370598 519f97d957] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:17:35 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:17:35 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-1000-1722370598 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:19:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 21:19:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 519f97d957 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722370742
+ git checkout -b scalability-yes-512-32768-1000-1722370742
Switched to a new branch 'scalability-yes-512-32768-1000-1722370742'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722370742 1a10356fe7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722370742 065627cfe8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:20:00 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:20:00 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-1000-1722370742 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:21:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 21:21:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 065627cfe8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722370887
+ git checkout -b scalability-yes-128-32768-1000-1722370887
Switched to a new branch 'scalability-yes-128-32768-1000-1722370887'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722370887 f3f319b78c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722370887 79ff2fae92] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:22:24 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:22:24 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-1000-1722370887 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:23:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 21:23:50 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79ff2fae92 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722371030
+ git checkout -b scalability-no-32-32768-1000-1722371030
Switched to a new branch 'scalability-no-32-32768-1000-1722371030'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722371030 644f10ffb3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:24:48 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:24:48 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-1000-1722371030 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:26:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 21:26:15 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 644f10ffb3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722371175
+ git checkout -b scalability-no-0-32768-1000-1722371175
Switched to a new branch 'scalability-no-0-32768-1000-1722371175'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:27:12 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:27:12 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-1000-1722371175 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:28:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 21:28:40 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722371320
+ git checkout -b scalability-no-1-32768-1000-1722371320
Switched to a new branch 'scalability-no-1-32768-1000-1722371320'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722371320 77e1be18b8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:29:38 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:29:38 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-1000-1722371320 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:31:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 21:31:05 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 77e1be18b8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722371465
+ git checkout -b scalability-no-1024-32768-1000-1722371465
Switched to a new branch 'scalability-no-1024-32768-1000-1722371465'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722371465 8ab2e6bb15] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:32:03 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:32:03 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-1000-1722371465 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:33:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 21:33:30 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8ab2e6bb15 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722371610
+ git checkout -b scalability-no-8-32768-1000-1722371610
Switched to a new branch 'scalability-no-8-32768-1000-1722371610'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722371610 1c5d65623a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:34:27 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:34:27 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-1000-1722371610 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:35:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 21:35:54 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1c5d65623a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722371755
+ git checkout -b scalability-no-512-32768-1000-1722371755
Switched to a new branch 'scalability-no-512-32768-1000-1722371755'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722371755 4fe7168cbf] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:36:52 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:36:52 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-1000-1722371755 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:38:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 21:38:20 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4fe7168cbf fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722371900
+ git checkout -b scalability-no-128-32768-1000-1722371900
Switched to a new branch 'scalability-no-128-32768-1000-1722371900'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722371900 dbd6286e3a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:39:18 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:39:18 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-1000-1722371900 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:40:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 21:40:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dbd6286e3a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722372045
+ git checkout -b scalability-yes-32-32768-1000-1722372045
Switched to a new branch 'scalability-yes-32-32768-1000-1722372045'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722372045 95c0a7c9da] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722372045 097f4e394a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:41:17 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:41:17 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-1000-1722372045 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:42:53 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 21:42:53 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 097f4e394a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722372173
+ git checkout -b scalability-yes-0-32768-1000-1722372173
Switched to a new branch 'scalability-yes-0-32768-1000-1722372173'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722372173 3a7ed1efde] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:43:25 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:43:25 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-1000-1722372173 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:45:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 21:45:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3a7ed1efde NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722372307
+ git checkout -b scalability-yes-1-32768-1000-1722372307
Switched to a new branch 'scalability-yes-1-32768-1000-1722372307'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722372307 5b8b55cc8f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722372307 38cfcd18f6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:45:39 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:45:39 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-1000-1722372307 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:47:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 21:47:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 38cfcd18f6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722372438
+ git checkout -b scalability-yes-1024-32768-1000-1722372438
Switched to a new branch 'scalability-yes-1024-32768-1000-1722372438'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722372438 48fb9b64ea] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722372438 b0c30e9c28] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:47:50 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:47:50 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-1000-1722372438 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:49:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 21:49:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b0c30e9c28 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722372576
+ git checkout -b scalability-yes-8-32768-1000-1722372576
Switched to a new branch 'scalability-yes-8-32768-1000-1722372576'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722372576 a6a12bef99] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722372576 9f1f82ffb4] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:50:08 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:50:08 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-1000-1722372576 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:51:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 21:51:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9f1f82ffb4 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722372703
+ git checkout -b scalability-yes-512-32768-1000-1722372703
Switched to a new branch 'scalability-yes-512-32768-1000-1722372703'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722372703 c19956f458] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722372703 f2b7da71a1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:52:15 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:52:15 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-1000-1722372703 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:53:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 21:53:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f2b7da71a1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722372839
+ git checkout -b scalability-yes-128-32768-1000-1722372839
Switched to a new branch 'scalability-yes-128-32768-1000-1722372839'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722372839 e9882f222b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722372839 8c3d0c0cda] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:54:31 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:54:31 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-1000-1722372839 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:56:03 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 21:56:03 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8c3d0c0cda fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722372963
+ git checkout -b scalability-no-32-32768-1000-1722372963
Switched to a new branch 'scalability-no-32-32768-1000-1722372963'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722372963 f11127c161] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:56:35 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:56:35 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-1000-1722372963 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 21:58:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 21:58:18 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f11127c161 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722373098
+ git checkout -b scalability-no-0-32768-1000-1722373098
Switched to a new branch 'scalability-no-0-32768-1000-1722373098'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 21:58:50 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 21:58:50 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-1000-1722373098 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:00:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 22:00:31 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722373231
+ git checkout -b scalability-no-1-32768-1000-1722373231
Switched to a new branch 'scalability-no-1-32768-1000-1722373231'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722373231 6473679f7b] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:01:04 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:01:04 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-1000-1722373231 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:02:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 22:02:40 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6473679f7b fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722373360
+ git checkout -b scalability-no-1024-32768-1000-1722373360
Switched to a new branch 'scalability-no-1024-32768-1000-1722373360'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722373360 ef5cd169c0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:03:12 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:03:12 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-1000-1722373360 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:04:54 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 22:04:54 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef5cd169c0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722373495
+ git checkout -b scalability-no-8-32768-1000-1722373495
Switched to a new branch 'scalability-no-8-32768-1000-1722373495'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722373495 0af84774cc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:05:26 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:05:26 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-1000-1722373495 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:07:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 22:07:06 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0af84774cc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722373626
+ git checkout -b scalability-no-512-32768-1000-1722373626
Switched to a new branch 'scalability-no-512-32768-1000-1722373626'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722373626 4dc34f3370] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:07:33 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:07:33 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-1000-1722373626 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:09:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 22:09:13 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4dc34f3370 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722373753
+ git checkout -b scalability-no-128-32768-1000-1722373753
Switched to a new branch 'scalability-no-128-32768-1000-1722373753'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722373753 ca258095c3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:09:40 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:09:40 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-1000-1722373753 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:11:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 22:11:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ca258095c3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722373876
+ git checkout -b scalability-yes-32-32768-1000-1722373876
Switched to a new branch 'scalability-yes-32-32768-1000-1722373876'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722373876 6463f73ba4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722373876 cbee232c3f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:11:43 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:11:43 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-1000-1722373876 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:13:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 22:13:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cbee232c3f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722373987
+ git checkout -b scalability-yes-0-32768-1000-1722373987
Switched to a new branch 'scalability-yes-0-32768-1000-1722373987'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722373987 572c46448f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:13:34 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:13:34 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-1000-1722373987 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:14:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 22:14:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 572c46448f NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722374098
+ git checkout -b scalability-yes-1-32768-1000-1722374098
Switched to a new branch 'scalability-yes-1-32768-1000-1722374098'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722374098 ebe70d880d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722374098 df32b2c55f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:15:25 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:15:25 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-1000-1722374098 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:16:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 22:16:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at df32b2c55f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722374209
+ git checkout -b scalability-yes-1024-32768-1000-1722374209
Switched to a new branch 'scalability-yes-1024-32768-1000-1722374209'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722374209 6c578d4fbe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722374209 a3af3373ff] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:17:17 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:17:17 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-1000-1722374209 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:18:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 22:18:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a3af3373ff fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722374323
+ git checkout -b scalability-yes-8-32768-1000-1722374323
Switched to a new branch 'scalability-yes-8-32768-1000-1722374323'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722374323 b88514c0e1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722374323 b7f325d138] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:19:10 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:19:10 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-1000-1722374323 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:20:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 22:20:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b7f325d138 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722374433
+ git checkout -b scalability-yes-512-32768-1000-1722374433
Switched to a new branch 'scalability-yes-512-32768-1000-1722374433'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722374433 5a56cab52d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722374433 2005fa2da2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:21:01 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:21:01 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-1000-1722374433 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:22:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 22:22:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2005fa2da2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722374544
+ git checkout -b scalability-yes-128-32768-1000-1722374544
Switched to a new branch 'scalability-yes-128-32768-1000-1722374544'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722374544 f00a5b06fd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722374544 cba042c9c8] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:22:51 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:22:51 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-1000-1722374544 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:24:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 22:24:16 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cba042c9c8 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722374656
+ git checkout -b scalability-no-32-32768-1000-1722374656
Switched to a new branch 'scalability-no-32-32768-1000-1722374656'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722374656 5170cbce90] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:24:43 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:24:43 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-1000-1722374656 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:26:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 22:26:06 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5170cbce90 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722374766
+ git checkout -b scalability-no-0-32768-1000-1722374766
Switched to a new branch 'scalability-no-0-32768-1000-1722374766'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:26:33 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:26:33 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-1000-1722374766 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:27:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 22:27:57 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722374877
+ git checkout -b scalability-no-1-32768-1000-1722374877
Switched to a new branch 'scalability-no-1-32768-1000-1722374877'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722374877 9da69b0c4a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:28:24 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:28:24 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-1000-1722374877 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:29:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 22:29:49 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9da69b0c4a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722374989
+ git checkout -b scalability-no-1024-32768-1000-1722374989
Switched to a new branch 'scalability-no-1024-32768-1000-1722374989'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722374989 0c0357879c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:30:15 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:30:15 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-1000-1722374989 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:31:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 22:31:40 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0c0357879c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722375101
+ git checkout -b scalability-no-8-32768-1000-1722375101
Switched to a new branch 'scalability-no-8-32768-1000-1722375101'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722375101 e0801733ce] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:32:07 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:32:07 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-1000-1722375101 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:33:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 22:33:29 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e0801733ce fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722375209
+ git checkout -b scalability-no-512-32768-1000-1722375209
Switched to a new branch 'scalability-no-512-32768-1000-1722375209'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722375209 61ed89e63b] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:33:56 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:33:56 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-1000-1722375209 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:35:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 22:35:21 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 61ed89e63b fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722375321
+ git checkout -b scalability-no-128-32768-1000-1722375321
Switched to a new branch 'scalability-no-128-32768-1000-1722375321'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722375321 824fd0fbcc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:35:48 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:35:48 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-1000-1722375321 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:37:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 22:37:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 824fd0fbcc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722375433
+ git checkout -b scalability-yes-32-32768-1000-1722375433
Switched to a new branch 'scalability-yes-32-32768-1000-1722375433'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722375433 ab9b53d41c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722375433 1d35871536] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:37:40 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:37:40 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-1000-1722375433 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:39:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 22:39:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1d35871536 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722375542
+ git checkout -b scalability-yes-0-32768-1000-1722375542
Switched to a new branch 'scalability-yes-0-32768-1000-1722375542'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722375542 050d615b9e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:39:29 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:39:29 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-1000-1722375542 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:40:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 22:40:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 050d615b9e NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722375650
+ git checkout -b scalability-yes-1-32768-1000-1722375650
Switched to a new branch 'scalability-yes-1-32768-1000-1722375650'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722375650 d14c53959e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722375650 1f4ec0c9ab] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:41:17 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:41:17 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-1000-1722375650 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:42:42 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 22:42:42 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1f4ec0c9ab fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722375762
+ git checkout -b scalability-yes-1024-32768-1000-1722375762
Switched to a new branch 'scalability-yes-1024-32768-1000-1722375762'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722375762 14ac0db17a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722375762 116b4ac13e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:43:09 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:43:09 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-1000-1722375762 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:44:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 22:44:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 116b4ac13e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722375873
+ git checkout -b scalability-yes-8-32768-1000-1722375873
Switched to a new branch 'scalability-yes-8-32768-1000-1722375873'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722375873 2340a61e2e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722375873 a0eb20c8a9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:45:01 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:45:01 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-1000-1722375873 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:46:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 22:46:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a0eb20c8a9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722375985
+ git checkout -b scalability-yes-512-32768-1000-1722375985
Switched to a new branch 'scalability-yes-512-32768-1000-1722375985'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722375985 510cdf0b11] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722375985 9895e59f32] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:46:52 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:46:52 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-1000-1722375985 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:48:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 22:48:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9895e59f32 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722376096
+ git checkout -b scalability-yes-128-32768-1000-1722376096
Switched to a new branch 'scalability-yes-128-32768-1000-1722376096'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722376096 2ce64c1482] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722376096 34f0509949] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:48:43 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:48:43 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-1000-1722376096 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:50:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 22:50:08 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 34f0509949 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722376208
+ git checkout -b scalability-no-32-32768-1000-1722376208
Switched to a new branch 'scalability-no-32-32768-1000-1722376208'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722376208 b868a7746d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:50:35 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:50:35 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-1000-1722376208 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:51:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 22:51:59 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b868a7746d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722376319
+ git checkout -b scalability-no-0-32768-1000-1722376319
Switched to a new branch 'scalability-no-0-32768-1000-1722376319'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:52:26 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:52:26 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-1000-1722376319 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:53:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 22:53:50 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722376430
+ git checkout -b scalability-no-1-32768-1000-1722376430
Switched to a new branch 'scalability-no-1-32768-1000-1722376430'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722376430 9bc55d700a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:54:17 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:54:17 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-1000-1722376430 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:55:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 22:55:42 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9bc55d700a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722376542
+ git checkout -b scalability-no-1024-32768-1000-1722376542
Switched to a new branch 'scalability-no-1024-32768-1000-1722376542'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722376542 6c2c1ca884] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:56:09 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:56:09 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-1000-1722376542 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:57:32 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 22:57:32 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6c2c1ca884 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722376652
+ git checkout -b scalability-no-8-32768-1000-1722376652
Switched to a new branch 'scalability-no-8-32768-1000-1722376652'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722376652 9535d0567a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:57:59 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:57:59 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-1000-1722376652 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 22:59:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 22:59:24 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9535d0567a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722376764
+ git checkout -b scalability-no-512-32768-1000-1722376764
Switched to a new branch 'scalability-no-512-32768-1000-1722376764'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722376764 ce9de54b88] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 22:59:51 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 22:59:51 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-1000-1722376764 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:01:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 23:01:15 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ce9de54b88 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722376875
+ git checkout -b scalability-no-128-32768-1000-1722376875
Switched to a new branch 'scalability-no-128-32768-1000-1722376875'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722376875 7b757d2df6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:01:42 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:01:42 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-1000-1722376875 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:03:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 23:03:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7b757d2df6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1000-1722376985
+ git checkout -b scalability-yes-32-32768-1000-1722376985
Switched to a new branch 'scalability-yes-32-32768-1000-1722376985'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1000-1722376985 982a2b2b4f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1000-1722376985 42db9eaf94] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:03:33 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:03:33 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-1000-1722376985 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:03:36 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 23:03:36 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 42db9eaf94 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1000-1722377016
+ git checkout -b scalability-yes-0-32768-1000-1722377016
Switched to a new branch 'scalability-yes-0-32768-1000-1722377016'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1000-1722377016 30fed797e7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:04:04 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:04:04 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-1000-1722377016 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:04:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 23:04:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 30fed797e7 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1000-1722377047
+ git checkout -b scalability-yes-1-32768-1000-1722377047
Switched to a new branch 'scalability-yes-1-32768-1000-1722377047'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1000-1722377047 e59781a340] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1000-1722377047 29fb810621] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:04:35 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:04:35 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-1000-1722377047 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:04:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 23:04:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 29fb810621 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1000-1722377078
+ git checkout -b scalability-yes-1024-32768-1000-1722377078
Switched to a new branch 'scalability-yes-1024-32768-1000-1722377078'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1000-1722377078 56c69c515a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1000-1722377078 4b24fc6de2] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:05:05 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:05:05 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-1000-1722377078 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:05:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 23:05:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4b24fc6de2 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1000-1722377108
+ git checkout -b scalability-yes-8-32768-1000-1722377108
Switched to a new branch 'scalability-yes-8-32768-1000-1722377108'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1000-1722377108 9349cf99fc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1000-1722377108 5bdc854e2e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:05:35 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:05:35 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-1000-1722377108 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:05:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 23:05:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5bdc854e2e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1000-1722377138
+ git checkout -b scalability-yes-512-32768-1000-1722377138
Switched to a new branch 'scalability-yes-512-32768-1000-1722377138'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1000-1722377138 4e35d48941] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1000-1722377138 6bfb35c949] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:06:05 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:06:05 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-1000-1722377138 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:06:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 23:06:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6bfb35c949 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1000-1722377169
+ git checkout -b scalability-yes-128-32768-1000-1722377169
Switched to a new branch 'scalability-yes-128-32768-1000-1722377169'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1000-1722377169 e62aebf99e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1000-1722377169 31c99a7f70] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:06:36 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:06:36 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-1000-1722377169 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:06:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 23:06:39 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 31c99a7f70 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1000-1722377199
+ git checkout -b scalability-no-32-32768-1000-1722377199
Switched to a new branch 'scalability-no-32-32768-1000-1722377199'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1000-1722377199 541f15c5e8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:07:07 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:07:07 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-1000-1722377199 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:07:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 23:07:10 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 541f15c5e8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1000-1722377230
+ git checkout -b scalability-no-0-32768-1000-1722377230
Switched to a new branch 'scalability-no-0-32768-1000-1722377230'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:07:37 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:07:37 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-1000-1722377230 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:07:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 23:07:40 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1000-1722377260
+ git checkout -b scalability-no-1-32768-1000-1722377260
Switched to a new branch 'scalability-no-1-32768-1000-1722377260'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1000-1722377260 c16e214557] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:08:07 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:08:07 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-1000-1722377260 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:08:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 23:08:10 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c16e214557 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1000-1722377291
+ git checkout -b scalability-no-1024-32768-1000-1722377291
Switched to a new branch 'scalability-no-1024-32768-1000-1722377291'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1000-1722377291 f548b0fa9b] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:08:38 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:08:38 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-1000-1722377291 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:08:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 23:08:41 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f548b0fa9b fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1000-1722377322
+ git checkout -b scalability-no-8-32768-1000-1722377322
Switched to a new branch 'scalability-no-8-32768-1000-1722377322'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1000-1722377322 4c3e371785] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:09:09 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:09:09 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-1000-1722377322 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:09:12 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 23:09:12 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4c3e371785 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1000-1722377352
+ git checkout -b scalability-no-512-32768-1000-1722377352
Switched to a new branch 'scalability-no-512-32768-1000-1722377352'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1000-1722377352 9896a0de67] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:09:39 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:09:39 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-1000-1722377352 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1000
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1000
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-1000
+ env
++ date
+ echo Tue 30 Jul 23:09:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 23:09:42 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9896a0de67 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1000-1722377383
+ git checkout -b scalability-no-128-32768-1000-1722377383
Switched to a new branch 'scalability-no-128-32768-1000-1722377383'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1000-1722377383 cb1abe39b9] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1000 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:10:10 BST 2024 'RUN   files: 32768  partitions: 1000'
Tue 30 Jul 23:10:10 BST 2024 RUN   files: 32768  partitions: 1000
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1000/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1000/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-1000-1722377383 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1000 1 10 '1 4 8' 1000
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:10:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 23:10:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cb1abe39b9 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722377413
+ git checkout -b scalability-yes-32-32768-100-1722377413
Switched to a new branch 'scalability-yes-32-32768-100-1722377413'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722377413 477bbd476d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722377413 b8e82691b5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:11:10 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:11:10 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-100-1722377413 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:12:25 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 23:12:25 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b8e82691b5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722377545
+ git checkout -b scalability-yes-0-32768-100-1722377545
Switched to a new branch 'scalability-yes-0-32768-100-1722377545'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722377545 4e5730c7df] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:13:23 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:13:23 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-100-1722377545 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:14:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 23:14:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4e5730c7df NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722377678
+ git checkout -b scalability-yes-1-32768-100-1722377678
Switched to a new branch 'scalability-yes-1-32768-100-1722377678'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722377678 3512f894d5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722377678 fc64d49ce6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:15:35 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:15:35 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-100-1722377678 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:16:50 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 23:16:50 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc64d49ce6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722377811
+ git checkout -b scalability-yes-1024-32768-100-1722377811
Switched to a new branch 'scalability-yes-1024-32768-100-1722377811'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722377811 573ff710e8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722377811 8ab1eee1af] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:17:47 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:17:47 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-100-1722377811 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:19:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 23:19:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8ab1eee1af fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722377943
+ git checkout -b scalability-yes-8-32768-100-1722377943
Switched to a new branch 'scalability-yes-8-32768-100-1722377943'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722377943 2fbf3e9071] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722377943 d5f9931e82] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:20:00 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:20:00 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-100-1722377943 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:21:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 23:21:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d5f9931e82 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722378075
+ git checkout -b scalability-yes-512-32768-100-1722378075
Switched to a new branch 'scalability-yes-512-32768-100-1722378075'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722378075 a4a853cc2f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722378075 df7892e540] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:22:12 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:22:12 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-100-1722378075 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:23:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 23:23:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at df7892e540 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722378207
+ git checkout -b scalability-yes-128-32768-100-1722378207
Switched to a new branch 'scalability-yes-128-32768-100-1722378207'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722378207 9af950162b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722378207 b5baf073de] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:24:24 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:24:24 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-100-1722378207 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:25:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 23:25:39 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b5baf073de fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722378339
+ git checkout -b scalability-no-32-32768-100-1722378339
Switched to a new branch 'scalability-no-32-32768-100-1722378339'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722378339 e701c5f332] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:26:36 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:26:36 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-100-1722378339 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:27:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 23:27:51 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e701c5f332 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722378471
+ git checkout -b scalability-no-0-32768-100-1722378471
Switched to a new branch 'scalability-no-0-32768-100-1722378471'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:28:48 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:28:48 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-100-1722378471 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:30:03 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 23:30:03 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722378603
+ git checkout -b scalability-no-1-32768-100-1722378603
Switched to a new branch 'scalability-no-1-32768-100-1722378603'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722378603 74b3489ce1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:31:00 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:31:00 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-100-1722378603 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:32:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Tue 30 Jul 23:32:15 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 74b3489ce1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722378735
+ git checkout -b scalability-no-1024-32768-100-1722378735
Switched to a new branch 'scalability-no-1024-32768-100-1722378735'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722378735 ad94f6b756] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:33:11 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:33:11 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-100-1722378735 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:34:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Tue 30 Jul 23:34:26 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ad94f6b756 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722378866
+ git checkout -b scalability-no-8-32768-100-1722378866
Switched to a new branch 'scalability-no-8-32768-100-1722378866'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722378866 d0d2cb70cd] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:35:23 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:35:23 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-100-1722378866 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:36:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Tue 30 Jul 23:36:38 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d0d2cb70cd fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722378998
+ git checkout -b scalability-no-512-32768-100-1722378998
Switched to a new branch 'scalability-no-512-32768-100-1722378998'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722378998 d5bf12afc3] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:37:35 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:37:35 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-100-1722378998 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:38:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Tue 30 Jul 23:38:50 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d5bf12afc3 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722379130
+ git checkout -b scalability-no-128-32768-100-1722379130
Switched to a new branch 'scalability-no-128-32768-100-1722379130'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722379130 45ca7c3315] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:39:46 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:39:46 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-100-1722379130 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:41:03 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Tue 30 Jul 23:41:03 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 45ca7c3315 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722379263
+ git checkout -b scalability-yes-32-32768-100-1722379263
Switched to a new branch 'scalability-yes-32-32768-100-1722379263'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722379263 fecab4f880] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722379263 6a8f21981c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:41:49 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:41:49 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-100-1722379263 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:43:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Tue 30 Jul 23:43:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6a8f21981c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722379388
+ git checkout -b scalability-yes-0-32768-100-1722379388
Switched to a new branch 'scalability-yes-0-32768-100-1722379388'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722379388 8f15e8c925] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:43:55 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:43:55 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-100-1722379388 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:45:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Tue 30 Jul 23:45:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8f15e8c925 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722379513
+ git checkout -b scalability-yes-1-32768-100-1722379513
Switched to a new branch 'scalability-yes-1-32768-100-1722379513'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722379513 cc7055e849] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722379513 f149fbec78] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:46:00 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:46:00 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-100-1722379513 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:47:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Tue 30 Jul 23:47:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f149fbec78 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722379638
+ git checkout -b scalability-yes-1024-32768-100-1722379638
Switched to a new branch 'scalability-yes-1024-32768-100-1722379638'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722379638 3730b71d3d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722379638 b56bca486a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:48:04 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:48:04 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-100-1722379638 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:49:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Tue 30 Jul 23:49:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b56bca486a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722379763
+ git checkout -b scalability-yes-8-32768-100-1722379763
Switched to a new branch 'scalability-yes-8-32768-100-1722379763'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722379763 b94588795d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722379763 ed85feac52] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:50:06 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:50:06 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-100-1722379763 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:51:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Tue 30 Jul 23:51:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ed85feac52 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722379884
+ git checkout -b scalability-yes-512-32768-100-1722379884
Switched to a new branch 'scalability-yes-512-32768-100-1722379884'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722379884 ba13a0c9de] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722379884 a3a6207dd5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:52:05 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:52:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-100-1722379884 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:53:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Tue 30 Jul 23:53:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a3a6207dd5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722380004
+ git checkout -b scalability-yes-128-32768-100-1722380004
Switched to a new branch 'scalability-yes-128-32768-100-1722380004'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722380004 3d7af1b8de] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722380004 5d806c0ad1] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:54:05 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:54:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-100-1722380004 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:55:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Tue 30 Jul 23:55:24 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5d806c0ad1 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722380124
+ git checkout -b scalability-no-32-32768-100-1722380124
Switched to a new branch 'scalability-no-32-32768-100-1722380124'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722380124 17df3ee175] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:56:05 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:56:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-100-1722380124 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:57:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Tue 30 Jul 23:57:23 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 17df3ee175 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722380244
+ git checkout -b scalability-no-0-32768-100-1722380244
Switched to a new branch 'scalability-no-0-32768-100-1722380244'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Tue 30 Jul 23:58:05 BST 2024 'RUN   files: 32768  partitions: 100'
Tue 30 Jul 23:58:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-100-1722380244 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-100
+ env
++ date
+ echo Tue 30 Jul 23:59:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Tue 30 Jul 23:59:23 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722380364
+ git checkout -b scalability-no-1-32768-100-1722380364
Switched to a new branch 'scalability-no-1-32768-100-1722380364'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722380364 0ea6efe75a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:00:05 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:00:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-100-1722380364 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:01:25 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 00:01:25 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0ea6efe75a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722380485
+ git checkout -b scalability-no-1024-32768-100-1722380485
Switched to a new branch 'scalability-no-1024-32768-100-1722380485'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722380485 46221d096a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:02:06 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:02:06 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-100-1722380485 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:03:24 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 00:03:24 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 46221d096a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722380604
+ git checkout -b scalability-no-8-32768-100-1722380604
Switched to a new branch 'scalability-no-8-32768-100-1722380604'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722380604 d7091428e3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:03:52 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:03:52 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-100-1722380604 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:05:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 00:05:10 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d7091428e3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722380710
+ git checkout -b scalability-no-512-32768-100-1722380710
Switched to a new branch 'scalability-no-512-32768-100-1722380710'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722380710 07ebe82e25] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:05:37 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:05:37 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-100-1722380710 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:06:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 00:06:56 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 07ebe82e25 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722380816
+ git checkout -b scalability-no-128-32768-100-1722380816
Switched to a new branch 'scalability-no-128-32768-100-1722380816'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722380816 5fcd83f17e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:07:23 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:07:23 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-100-1722380816 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:08:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 00:08:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5fcd83f17e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722380921
+ git checkout -b scalability-yes-32-32768-100-1722380921
Switched to a new branch 'scalability-yes-32-32768-100-1722380921'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722380921 51dbe6720f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722380921 cb46bb0a57] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:09:08 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:09:08 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-100-1722380921 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:10:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 00:10:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cb46bb0a57 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722381023
+ git checkout -b scalability-yes-0-32768-100-1722381023
Switched to a new branch 'scalability-yes-0-32768-100-1722381023'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722381023 7368029ffe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:10:50 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:10:50 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-100-1722381023 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:12:04 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 00:12:04 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7368029ffe NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722381124
+ git checkout -b scalability-yes-1-32768-100-1722381124
Switched to a new branch 'scalability-yes-1-32768-100-1722381124'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722381124 23b4b032af] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722381124 d1d195486f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:12:31 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:12:31 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-100-1722381124 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:13:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 00:13:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d1d195486f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722381226
+ git checkout -b scalability-yes-1024-32768-100-1722381226
Switched to a new branch 'scalability-yes-1024-32768-100-1722381226'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722381226 7870cc703a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722381226 dd8452231e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:14:13 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:14:13 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-100-1722381226 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:15:28 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 00:15:28 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dd8452231e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722381328
+ git checkout -b scalability-yes-8-32768-100-1722381328
Switched to a new branch 'scalability-yes-8-32768-100-1722381328'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722381328 e01395d755] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722381328 23b5032b6a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:15:55 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:15:55 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-100-1722381328 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:17:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 00:17:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 23b5032b6a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722381429
+ git checkout -b scalability-yes-512-32768-100-1722381429
Switched to a new branch 'scalability-yes-512-32768-100-1722381429'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722381429 31c51ab157] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722381429 c753908b84] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:17:36 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:17:36 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-100-1722381429 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:18:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 00:18:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c753908b84 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722381532
+ git checkout -b scalability-yes-128-32768-100-1722381532
Switched to a new branch 'scalability-yes-128-32768-100-1722381532'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722381532 985a507ef4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722381532 1f985ae9b6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:19:19 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:19:19 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-100-1722381532 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:20:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 00:20:33 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1f985ae9b6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722381633
+ git checkout -b scalability-no-32-32768-100-1722381633
Switched to a new branch 'scalability-no-32-32768-100-1722381633'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722381633 540fba1a30] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:21:00 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:21:00 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-100-1722381633 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:22:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 00:22:15 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 540fba1a30 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722381735
+ git checkout -b scalability-no-0-32768-100-1722381735
Switched to a new branch 'scalability-no-0-32768-100-1722381735'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:22:42 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:22:42 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-100-1722381735 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:23:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 00:23:56 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722381836
+ git checkout -b scalability-no-1-32768-100-1722381836
Switched to a new branch 'scalability-no-1-32768-100-1722381836'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722381836 4d88f11930] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:24:23 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:24:23 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-100-1722381836 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:25:38 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 00:25:38 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4d88f11930 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722381938
+ git checkout -b scalability-no-1024-32768-100-1722381938
Switched to a new branch 'scalability-no-1024-32768-100-1722381938'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722381938 6c6ed0996e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:26:05 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:26:05 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-100-1722381938 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:27:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 00:27:20 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6c6ed0996e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722382040
+ git checkout -b scalability-no-8-32768-100-1722382040
Switched to a new branch 'scalability-no-8-32768-100-1722382040'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722382040 83c47c33fc] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:27:47 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:27:47 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-100-1722382040 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:29:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 00:29:01 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 83c47c33fc fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722382141
+ git checkout -b scalability-no-512-32768-100-1722382141
Switched to a new branch 'scalability-no-512-32768-100-1722382141'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722382141 267c8d3daf] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:29:28 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:29:28 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-100-1722382141 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:30:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 00:30:43 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 267c8d3daf fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722382243
+ git checkout -b scalability-no-128-32768-100-1722382243
Switched to a new branch 'scalability-no-128-32768-100-1722382243'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722382243 3916a8be4c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:31:10 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:31:10 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-100-1722382243 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:32:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 00:32:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3916a8be4c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722382345
+ git checkout -b scalability-yes-32-32768-100-1722382345
Switched to a new branch 'scalability-yes-32-32768-100-1722382345'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722382345 95a50ec6ef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722382345 4a57fea4d1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:32:52 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:32:52 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-100-1722382345 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:34:07 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 00:34:07 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4a57fea4d1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722382447
+ git checkout -b scalability-yes-0-32768-100-1722382447
Switched to a new branch 'scalability-yes-0-32768-100-1722382447'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722382447 b976047875] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:34:34 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:34:34 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-100-1722382447 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:35:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 00:35:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b976047875 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722382549
+ git checkout -b scalability-yes-1-32768-100-1722382549
Switched to a new branch 'scalability-yes-1-32768-100-1722382549'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722382549 fa75296f9c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722382549 17e8979836] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:36:16 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:36:16 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-100-1722382549 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:37:31 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 00:37:31 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 17e8979836 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722382651
+ git checkout -b scalability-yes-1024-32768-100-1722382651
Switched to a new branch 'scalability-yes-1024-32768-100-1722382651'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722382651 03d4c95dd2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722382651 98ab7ed78a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:37:58 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:37:58 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-100-1722382651 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:39:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 00:39:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 98ab7ed78a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722382753
+ git checkout -b scalability-yes-8-32768-100-1722382753
Switched to a new branch 'scalability-yes-8-32768-100-1722382753'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722382753 af88f2e219] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722382753 4f23be9f19] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:39:40 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:39:40 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-100-1722382753 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:40:56 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 00:40:56 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4f23be9f19 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722382856
+ git checkout -b scalability-yes-512-32768-100-1722382856
Switched to a new branch 'scalability-yes-512-32768-100-1722382856'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722382856 e8641995af] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722382856 ad7b046828] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:41:23 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:41:23 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-100-1722382856 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:42:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 00:42:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ad7b046828 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722382959
+ git checkout -b scalability-yes-128-32768-100-1722382959
Switched to a new branch 'scalability-yes-128-32768-100-1722382959'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722382959 6ebadb3ba3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722382959 79a2a77154] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:43:06 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:43:06 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-100-1722382959 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:44:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 00:44:20 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79a2a77154 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722383060
+ git checkout -b scalability-no-32-32768-100-1722383060
Switched to a new branch 'scalability-no-32-32768-100-1722383060'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722383060 359731009a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:44:47 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:44:47 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-100-1722383060 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:46:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 00:46:02 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 359731009a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722383162
+ git checkout -b scalability-no-0-32768-100-1722383162
Switched to a new branch 'scalability-no-0-32768-100-1722383162'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:46:29 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:46:29 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-100-1722383162 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:47:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 00:47:44 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722383264
+ git checkout -b scalability-no-1-32768-100-1722383264
Switched to a new branch 'scalability-no-1-32768-100-1722383264'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722383264 c7882209d2] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:48:11 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:48:11 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-100-1722383264 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:49:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 00:49:26 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c7882209d2 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722383367
+ git checkout -b scalability-no-1024-32768-100-1722383367
Switched to a new branch 'scalability-no-1024-32768-100-1722383367'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722383367 86c4469000] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:49:53 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:49:53 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-100-1722383367 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:51:08 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 00:51:08 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 86c4469000 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722383469
+ git checkout -b scalability-no-8-32768-100-1722383469
Switched to a new branch 'scalability-no-8-32768-100-1722383469'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722383469 df39259605] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:51:36 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:51:36 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-100-1722383469 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:52:51 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 00:52:51 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at df39259605 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722383571
+ git checkout -b scalability-no-512-32768-100-1722383571
Switched to a new branch 'scalability-no-512-32768-100-1722383571'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722383571 90fcf6f3ea] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:53:18 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:53:18 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-100-1722383571 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:54:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 00:54:33 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 90fcf6f3ea fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722383673
+ git checkout -b scalability-no-128-32768-100-1722383673
Switched to a new branch 'scalability-no-128-32768-100-1722383673'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722383673 d265b305ef] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:55:00 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:55:00 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-100-1722383673 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-100
+ env
++ date
+ echo Wed 31 Jul 00:56:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 00:56:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d265b305ef fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-100-1722383775
+ git checkout -b scalability-yes-32-32768-100-1722383775
Switched to a new branch 'scalability-yes-32-32768-100-1722383775'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-100-1722383775 49678de431] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-100-1722383775 03240ff8fa] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 00:56:42 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 00:56:42 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-100-1722383775 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:00:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 01:00:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 03240ff8fa fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-100-1722384014
+ git checkout -b scalability-yes-0-32768-100-1722384014
Switched to a new branch 'scalability-yes-0-32768-100-1722384014'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-100-1722384014 8b0c63eddb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:00:42 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:00:42 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-100-1722384014 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:04:17 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 01:04:17 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8b0c63eddb NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-100-1722384257
+ git checkout -b scalability-yes-1-32768-100-1722384257
Switched to a new branch 'scalability-yes-1-32768-100-1722384257'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-100-1722384257 6844c82fef] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-100-1722384257 c82ce17a8e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:04:44 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:04:44 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-100-1722384257 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:08:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 01:08:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c82ce17a8e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-100-1722384499
+ git checkout -b scalability-yes-1024-32768-100-1722384499
Switched to a new branch 'scalability-yes-1024-32768-100-1722384499'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-100-1722384499 fb5839234d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-100-1722384499 63799bbf0d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:08:46 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:08:46 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-100-1722384499 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:12:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 01:12:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 63799bbf0d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-100-1722384743
+ git checkout -b scalability-yes-8-32768-100-1722384743
Switched to a new branch 'scalability-yes-8-32768-100-1722384743'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-100-1722384743 691a355b34] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-100-1722384743 6ef6f3ec27] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:12:50 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:12:50 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-100-1722384743 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:16:21 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 01:16:21 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6ef6f3ec27 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-100-1722384981
+ git checkout -b scalability-yes-512-32768-100-1722384981
Switched to a new branch 'scalability-yes-512-32768-100-1722384981'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-100-1722384981 f0db6ac4b3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-100-1722384981 9e04d8c1ff] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:16:50 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:16:50 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-100-1722384981 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:20:26 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 01:20:26 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9e04d8c1ff fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-100-1722385226
+ git checkout -b scalability-yes-128-32768-100-1722385226
Switched to a new branch 'scalability-yes-128-32768-100-1722385226'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-100-1722385226 06654ab3bb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-100-1722385226 bb4a1a71db] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:20:53 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:20:53 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-100-1722385226 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:24:31 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 01:24:31 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at bb4a1a71db fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-100-1722385471
+ git checkout -b scalability-no-32-32768-100-1722385471
Switched to a new branch 'scalability-no-32-32768-100-1722385471'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-100-1722385471 aef1f34529] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:24:59 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:24:59 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-100-1722385471 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:28:34 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 01:28:34 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at aef1f34529 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-100-1722385714
+ git checkout -b scalability-no-0-32768-100-1722385714
Switched to a new branch 'scalability-no-0-32768-100-1722385714'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:29:01 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:29:01 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-100-1722385714 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:32:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 01:32:37 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-100-1722385957
+ git checkout -b scalability-no-1-32768-100-1722385957
Switched to a new branch 'scalability-no-1-32768-100-1722385957'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-100-1722385957 7b78986c46] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:33:04 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:33:04 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-100-1722385957 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:36:42 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 01:36:42 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7b78986c46 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-100-1722386202
+ git checkout -b scalability-no-1024-32768-100-1722386202
Switched to a new branch 'scalability-no-1024-32768-100-1722386202'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-100-1722386202 aa439e87ce] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:37:09 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:37:09 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-100-1722386202 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:40:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 01:40:48 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at aa439e87ce fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-100-1722386448
+ git checkout -b scalability-no-8-32768-100-1722386448
Switched to a new branch 'scalability-no-8-32768-100-1722386448'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-100-1722386448 f036504f00] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:41:15 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:41:15 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-100-1722386448 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:44:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 01:44:50 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f036504f00 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-100-1722386690
+ git checkout -b scalability-no-512-32768-100-1722386690
Switched to a new branch 'scalability-no-512-32768-100-1722386690'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-100-1722386690 5a6de74f8d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:45:17 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:45:17 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-100-1722386690 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-100
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-100
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-100
+ env
++ date
+ echo Wed 31 Jul 01:48:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 01:48:49 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5a6de74f8d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-100-1722386929
+ git checkout -b scalability-no-128-32768-100-1722386929
Switched to a new branch 'scalability-no-128-32768-100-1722386929'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-100-1722386929 798c6dc3ab] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-100 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:49:17 BST 2024 'RUN   files: 32768  partitions: 100'
Wed 31 Jul 01:49:17 BST 2024 RUN   files: 32768  partitions: 100
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-100/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-100/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-100-1722386929 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-100 1 10 '1 4 8' 100
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 01:52:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 01:52:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 798c6dc3ab fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722387166
+ git checkout -b scalability-yes-32-32768-1-1722387166
Switched to a new branch 'scalability-yes-32-32768-1-1722387166'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722387166 bf2c9a43d8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722387166 c5d25ad2a0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:53:43 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 01:53:43 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-1-1722387166 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 01:54:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 01:54:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c5d25ad2a0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722387298
+ git checkout -b scalability-yes-0-32768-1-1722387298
Switched to a new branch 'scalability-yes-0-32768-1-1722387298'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722387298 31b86c4a56] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:55:54 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 01:55:54 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-1-1722387298 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 01:57:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 01:57:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 31b86c4a56 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722387428
+ git checkout -b scalability-yes-1-32768-1-1722387428
Switched to a new branch 'scalability-yes-1-32768-1-1722387428'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722387428 7ec31ce6e8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722387428 c8440cd3db] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 01:58:05 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 01:58:05 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-1-1722387428 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 01:59:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 01:59:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c8440cd3db fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722387559
+ git checkout -b scalability-yes-1024-32768-1-1722387559
Switched to a new branch 'scalability-yes-1024-32768-1-1722387559'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722387559 2b1fc9df84] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722387559 ecd000c0e3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:00:16 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:00:16 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-1-1722387559 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:01:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 02:01:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ecd000c0e3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722387692
+ git checkout -b scalability-yes-8-32768-1-1722387692
Switched to a new branch 'scalability-yes-8-32768-1-1722387692'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722387692 ef4b5a6e4f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722387692 f87e40e0a8] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:02:29 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:02:29 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-1-1722387692 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:03:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 02:03:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f87e40e0a8 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722387823
+ git checkout -b scalability-yes-512-32768-1-1722387823
Switched to a new branch 'scalability-yes-512-32768-1-1722387823'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722387823 7f38db4f59] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722387823 db7a0fabdd] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:04:40 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:04:40 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-1-1722387823 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:05:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 02:05:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at db7a0fabdd fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722387954
+ git checkout -b scalability-yes-128-32768-1-1722387954
Switched to a new branch 'scalability-yes-128-32768-1-1722387954'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722387954 6eaac309f4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722387954 d272280167] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:06:51 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:06:51 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-1-1722387954 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:08:05 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 02:08:05 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d272280167 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722388085
+ git checkout -b scalability-no-32-32768-1-1722388085
Switched to a new branch 'scalability-no-32-32768-1-1722388085'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722388085 eefec37054] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:09:02 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:09:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-1-1722388085 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:10:15 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 02:10:15 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at eefec37054 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722388216
+ git checkout -b scalability-no-0-32768-1-1722388216
Switched to a new branch 'scalability-no-0-32768-1-1722388216'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:11:12 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:11:12 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-1-1722388216 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:12:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 02:12:26 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722388346
+ git checkout -b scalability-no-1-32768-1-1722388346
Switched to a new branch 'scalability-no-1-32768-1-1722388346'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722388346 d7a13f620c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:13:23 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:13:23 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-1-1722388346 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:14:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 02:14:37 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d7a13f620c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722388477
+ git checkout -b scalability-no-1024-32768-1-1722388477
Switched to a new branch 'scalability-no-1024-32768-1-1722388477'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722388477 9264753ebd] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:15:34 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:15:34 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-1-1722388477 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:16:48 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 02:16:48 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9264753ebd fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722388608
+ git checkout -b scalability-no-8-32768-1-1722388608
Switched to a new branch 'scalability-no-8-32768-1-1722388608'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722388608 ff73a43174] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:17:45 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:17:45 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-1-1722388608 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:18:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 02:18:59 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ff73a43174 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722388740
+ git checkout -b scalability-no-512-32768-1-1722388740
Switched to a new branch 'scalability-no-512-32768-1-1722388740'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722388740 4f42ca10e8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:19:57 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:19:57 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-1-1722388740 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:21:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 02:21:11 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4f42ca10e8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722388871
+ git checkout -b scalability-no-128-32768-1-1722388871
Switched to a new branch 'scalability-no-128-32768-1-1722388871'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722388871 10a910bf76] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:22:09 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:22:09 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-1-1722388871 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:23:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 02:23:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 10a910bf76 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722389003
+ git checkout -b scalability-yes-32-32768-1-1722389003
Switched to a new branch 'scalability-yes-32-32768-1-1722389003'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722389003 208b01ee1a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722389003 69b4f64c98] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:23:50 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:23:50 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-1-1722389003 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:25:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 02:25:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 69b4f64c98 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722389105
+ git checkout -b scalability-yes-0-32768-1-1722389105
Switched to a new branch 'scalability-yes-0-32768-1-1722389105'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722389105 d6006dfbe2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:25:32 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:25:32 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-1-1722389105 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:26:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 02:26:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d6006dfbe2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722389208
+ git checkout -b scalability-yes-1-32768-1-1722389208
Switched to a new branch 'scalability-yes-1-32768-1-1722389208'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722389208 e568bc7166] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722389208 13d3c9b125] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:27:16 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:27:16 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-1-1722389208 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:28:32 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 02:28:32 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 13d3c9b125 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722389312
+ git checkout -b scalability-yes-1024-32768-1-1722389312
Switched to a new branch 'scalability-yes-1024-32768-1-1722389312'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722389312 698b4b25d4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722389312 fd5798335f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:28:59 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:28:59 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-1-1722389312 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:30:15 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 02:30:15 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fd5798335f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722389415
+ git checkout -b scalability-yes-8-32768-1-1722389415
Switched to a new branch 'scalability-yes-8-32768-1-1722389415'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722389415 05508faf0f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722389415 cf555d809f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:30:43 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:30:43 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-1-1722389415 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:31:59 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 02:31:59 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at cf555d809f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722389519
+ git checkout -b scalability-yes-512-32768-1-1722389519
Switched to a new branch 'scalability-yes-512-32768-1-1722389519'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722389519 9cff0c0275] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722389519 04e8fa0d4f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:32:27 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:32:27 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-1-1722389519 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:33:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 02:33:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 04e8fa0d4f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722389623
+ git checkout -b scalability-yes-128-32768-1-1722389623
Switched to a new branch 'scalability-yes-128-32768-1-1722389623'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722389623 b91b7feae3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722389623 18afc2cb85] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:34:10 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:34:10 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-1-1722389623 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:35:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 02:35:26 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 18afc2cb85 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722389726
+ git checkout -b scalability-no-32-32768-1-1722389726
Switched to a new branch 'scalability-no-32-32768-1-1722389726'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722389726 a8037dc972] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:35:53 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:35:53 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-1-1722389726 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:37:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 02:37:09 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a8037dc972 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722389829
+ git checkout -b scalability-no-0-32768-1-1722389829
Switched to a new branch 'scalability-no-0-32768-1-1722389829'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:37:36 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:37:36 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-1-1722389829 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:38:52 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 02:38:52 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722389932
+ git checkout -b scalability-no-1-32768-1-1722389932
Switched to a new branch 'scalability-no-1-32768-1-1722389932'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722389932 8eca0d6841] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:39:19 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:39:19 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-1-1722389932 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:40:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 02:40:35 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8eca0d6841 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722390035
+ git checkout -b scalability-no-1024-32768-1-1722390035
Switched to a new branch 'scalability-no-1024-32768-1-1722390035'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722390035 fb0fc437f3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:41:02 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:41:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-1-1722390035 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:42:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 02:42:18 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fb0fc437f3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722390139
+ git checkout -b scalability-no-8-32768-1-1722390139
Switched to a new branch 'scalability-no-8-32768-1-1722390139'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722390139 960d56856b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:42:46 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:42:46 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-1-1722390139 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:44:02 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 02:44:02 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 960d56856b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722390243
+ git checkout -b scalability-no-512-32768-1-1722390243
Switched to a new branch 'scalability-no-512-32768-1-1722390243'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722390243 70b7bdd063] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:44:30 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:44:30 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-1-1722390243 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:45:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 02:45:47 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 70b7bdd063 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722390347
+ git checkout -b scalability-no-128-32768-1-1722390347
Switched to a new branch 'scalability-no-128-32768-1-1722390347'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722390347 7881b8e8e6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:46:14 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:46:14 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-1-1722390347 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:47:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 02:47:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 7881b8e8e6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722390450
+ git checkout -b scalability-yes-32-32768-1-1722390450
Switched to a new branch 'scalability-yes-32-32768-1-1722390450'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722390450 29b3e6a7ba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722390450 933436de52] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:47:57 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:47:57 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-1-1722390450 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:49:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 02:49:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 933436de52 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722390551
+ git checkout -b scalability-yes-0-32768-1-1722390551
Switched to a new branch 'scalability-yes-0-32768-1-1722390551'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722390551 0002bbeb52] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:49:38 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:49:38 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-1-1722390551 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:50:51 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 02:50:51 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0002bbeb52 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722390651
+ git checkout -b scalability-yes-1-32768-1-1722390651
Switched to a new branch 'scalability-yes-1-32768-1-1722390651'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722390651 346813572a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722390651 1d1f83977a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:51:19 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:51:19 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-1-1722390651 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:52:33 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 02:52:33 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1d1f83977a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722390753
+ git checkout -b scalability-yes-1024-32768-1-1722390753
Switched to a new branch 'scalability-yes-1024-32768-1-1722390753'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722390753 a87338e771] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722390753 ad14886615] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:53:00 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:53:00 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-1-1722390753 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:54:13 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 02:54:13 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ad14886615 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722390854
+ git checkout -b scalability-yes-8-32768-1-1722390854
Switched to a new branch 'scalability-yes-8-32768-1-1722390854'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722390854 ae2abef26f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722390854 8bb9b975f0] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:54:41 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:54:41 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-1-1722390854 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:55:54 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 02:55:54 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8bb9b975f0 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722390955
+ git checkout -b scalability-yes-512-32768-1-1722390955
Switched to a new branch 'scalability-yes-512-32768-1-1722390955'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722390955 bbf1a0480e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722390955 ba34d4c0c9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:56:22 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:56:22 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-1-1722390955 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:57:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 02:57:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ba34d4c0c9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722391055
+ git checkout -b scalability-yes-128-32768-1-1722391055
Switched to a new branch 'scalability-yes-128-32768-1-1722391055'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722391055 41978d7df7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722391055 f8b029fe2b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:58:02 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:58:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-1-1722391055 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 02:59:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 02:59:16 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f8b029fe2b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722391156
+ git checkout -b scalability-no-32-32768-1-1722391156
Switched to a new branch 'scalability-no-32-32768-1-1722391156'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722391156 a0a30fc6f0] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 02:59:43 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 02:59:43 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-1-1722391156 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:00:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 03:00:57 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a0a30fc6f0 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722391257
+ git checkout -b scalability-no-0-32768-1-1722391257
Switched to a new branch 'scalability-no-0-32768-1-1722391257'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:01:24 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:01:24 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-1-1722391257 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:02:37 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 03:02:37 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722391357
+ git checkout -b scalability-no-1-32768-1-1722391357
Switched to a new branch 'scalability-no-1-32768-1-1722391357'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722391357 b803443fa1] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:03:04 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:03:04 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-1-1722391357 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:04:18 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 03:04:18 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b803443fa1 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722391458
+ git checkout -b scalability-no-1024-32768-1-1722391458
Switched to a new branch 'scalability-no-1024-32768-1-1722391458'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722391458 c2596cf363] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:04:45 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:04:45 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-1-1722391458 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:05:58 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 03:05:58 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c2596cf363 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722391558
+ git checkout -b scalability-no-8-32768-1-1722391558
Switched to a new branch 'scalability-no-8-32768-1-1722391558'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722391558 c987f5f4d3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:06:25 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:06:25 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-1-1722391558 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:07:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 03:07:39 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c987f5f4d3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722391659
+ git checkout -b scalability-no-512-32768-1-1722391659
Switched to a new branch 'scalability-no-512-32768-1-1722391659'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722391659 8c79a42dd0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:08:06 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:08:06 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-1-1722391659 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:09:19 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 03:09:19 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8c79a42dd0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722391759
+ git checkout -b scalability-no-128-32768-1-1722391759
Switched to a new branch 'scalability-no-128-32768-1-1722391759'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722391759 55244517cf] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:09:46 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:09:46 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-1-1722391759 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:11:00 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 03:11:00 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 55244517cf fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722391861
+ git checkout -b scalability-yes-32-32768-1-1722391861
Switched to a new branch 'scalability-yes-32-32768-1-1722391861'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722391861 6601e50b75] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722391861 43426e6455] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:11:28 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:11:28 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-1-1722391861 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:12:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 03:12:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 43426e6455 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722391961
+ git checkout -b scalability-yes-0-32768-1-1722391961
Switched to a new branch 'scalability-yes-0-32768-1-1722391961'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722391961 9ac254045c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:13:09 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:13:09 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-1-1722391961 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:14:23 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 03:14:23 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9ac254045c NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722392063
+ git checkout -b scalability-yes-1-32768-1-1722392063
Switched to a new branch 'scalability-yes-1-32768-1-1722392063'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722392063 ef65a0a069] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722392063 c5480a44f3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:14:50 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:14:50 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-1-1722392063 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:16:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 03:16:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c5480a44f3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722392165
+ git checkout -b scalability-yes-1024-32768-1-1722392165
Switched to a new branch 'scalability-yes-1024-32768-1-1722392165'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722392165 ed4a9e1b9f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722392165 b35b65020d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:16:32 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:16:32 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-1-1722392165 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:17:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 03:17:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b35b65020d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722392266
+ git checkout -b scalability-yes-8-32768-1-1722392266
Switched to a new branch 'scalability-yes-8-32768-1-1722392266'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722392266 22a41fa994] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722392266 3f62ee7b66] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:18:13 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:18:13 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-1-1722392266 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:19:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 03:19:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3f62ee7b66 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722392367
+ git checkout -b scalability-yes-512-32768-1-1722392367
Switched to a new branch 'scalability-yes-512-32768-1-1722392367'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722392367 c6c4bcee80] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722392367 14cd3806a5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:19:54 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:19:54 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-1-1722392367 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:21:08 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 03:21:08 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 14cd3806a5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722392468
+ git checkout -b scalability-yes-128-32768-1-1722392468
Switched to a new branch 'scalability-yes-128-32768-1-1722392468'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722392468 348f1fdf25] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722392468 9751cbc134] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:21:35 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:21:35 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-1-1722392468 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:22:49 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 03:22:49 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9751cbc134 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722392569
+ git checkout -b scalability-no-32-32768-1-1722392569
Switched to a new branch 'scalability-no-32-32768-1-1722392569'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722392569 399e6dccae] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:23:16 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:23:16 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-1-1722392569 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:24:30 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 03:24:30 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 399e6dccae fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722392670
+ git checkout -b scalability-no-0-32768-1-1722392670
Switched to a new branch 'scalability-no-0-32768-1-1722392670'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:24:57 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:24:57 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-1-1722392670 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:26:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 03:26:11 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722392771
+ git checkout -b scalability-no-1-32768-1-1722392771
Switched to a new branch 'scalability-no-1-32768-1-1722392771'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722392771 95930b3b5f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:26:39 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:26:39 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-1-1722392771 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:27:53 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 03:27:53 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 95930b3b5f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722392873
+ git checkout -b scalability-no-1024-32768-1-1722392873
Switched to a new branch 'scalability-no-1024-32768-1-1722392873'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722392873 b950f55a94] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:28:20 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:28:20 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-1-1722392873 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:29:35 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 03:29:35 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b950f55a94 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722392975
+ git checkout -b scalability-no-8-32768-1-1722392975
Switched to a new branch 'scalability-no-8-32768-1-1722392975'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722392975 c0475cabc6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:30:02 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:30:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-1-1722392975 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:31:16 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 03:31:16 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c0475cabc6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722393076
+ git checkout -b scalability-no-512-32768-1-1722393076
Switched to a new branch 'scalability-no-512-32768-1-1722393076'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722393076 83e0975dc0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:31:43 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:31:43 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-1-1722393076 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:32:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 03:32:57 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 83e0975dc0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722393177
+ git checkout -b scalability-no-128-32768-1-1722393177
Switched to a new branch 'scalability-no-128-32768-1-1722393177'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722393177 2f672b44a3] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:33:24 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:33:24 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-1-1722393177 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:34:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 03:34:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2f672b44a3 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-1-1722393278
+ git checkout -b scalability-yes-32-32768-1-1722393278
Switched to a new branch 'scalability-yes-32-32768-1-1722393278'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-1-1722393278 d956d00922] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-1-1722393278 af62fdddf5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:35:05 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:35:05 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-1-1722393278 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:36:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 03:36:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at af62fdddf5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-1-1722393385
+ git checkout -b scalability-yes-0-32768-1-1722393385
Switched to a new branch 'scalability-yes-0-32768-1-1722393385'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-1-1722393385 645f5c60ff] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:36:52 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:36:52 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-1-1722393385 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:38:14 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 03:38:14 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 645f5c60ff NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-1-1722393494
+ git checkout -b scalability-yes-1-32768-1-1722393494
Switched to a new branch 'scalability-yes-1-32768-1-1722393494'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-1-1722393494 63701fed0a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-1-1722393494 4ad77acd44] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:38:41 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:38:41 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-1-1722393494 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:40:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 03:40:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4ad77acd44 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-1-1722393601
+ git checkout -b scalability-yes-1024-32768-1-1722393601
Switched to a new branch 'scalability-yes-1024-32768-1-1722393601'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-1-1722393601 a4aba7a237] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-1-1722393601 a3a98afcd3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:40:28 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:40:28 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-1-1722393601 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:41:48 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 03:41:48 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a3a98afcd3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-1-1722393708
+ git checkout -b scalability-yes-8-32768-1-1722393708
Switched to a new branch 'scalability-yes-8-32768-1-1722393708'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-1-1722393708 e9679bd0a7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-1-1722393708 974db1335a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:42:15 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:42:15 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-1-1722393708 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:43:35 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 03:43:35 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 974db1335a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-1-1722393815
+ git checkout -b scalability-yes-512-32768-1-1722393815
Switched to a new branch 'scalability-yes-512-32768-1-1722393815'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-1-1722393815 02e81112a5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-1-1722393815 e1843365a0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:44:02 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:44:02 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-1-1722393815 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:45:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 03:45:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e1843365a0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-1-1722393924
+ git checkout -b scalability-yes-128-32768-1-1722393924
Switched to a new branch 'scalability-yes-128-32768-1-1722393924'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-1-1722393924 8d1824d934] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-1-1722393924 54e970f51a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:45:51 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:45:51 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-1-1722393924 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:47:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 03:47:10 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 54e970f51a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-1-1722394030
+ git checkout -b scalability-no-32-32768-1-1722394030
Switched to a new branch 'scalability-no-32-32768-1-1722394030'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-1-1722394030 2eb4b3e0e5] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:47:37 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:47:37 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-1-1722394030 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:48:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 03:48:57 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2eb4b3e0e5 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-1-1722394137
+ git checkout -b scalability-no-0-32768-1-1722394137
Switched to a new branch 'scalability-no-0-32768-1-1722394137'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:49:24 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:49:24 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-1-1722394137 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:50:45 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 03:50:45 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-1-1722394246
+ git checkout -b scalability-no-1-32768-1-1722394246
Switched to a new branch 'scalability-no-1-32768-1-1722394246'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-1-1722394246 936529250a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:51:12 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:51:12 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-1-1722394246 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:52:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 03:52:33 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 936529250a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-1-1722394353
+ git checkout -b scalability-no-1024-32768-1-1722394353
Switched to a new branch 'scalability-no-1024-32768-1-1722394353'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-1-1722394353 8a13871998] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:53:00 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:53:00 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-1-1722394353 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:54:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 03:54:21 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8a13871998 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-1-1722394461
+ git checkout -b scalability-no-8-32768-1-1722394461
Switched to a new branch 'scalability-no-8-32768-1-1722394461'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-1-1722394461 f11fca792c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:54:49 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:54:49 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-1-1722394461 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:56:09 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 03:56:09 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f11fca792c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-1-1722394569
+ git checkout -b scalability-no-512-32768-1-1722394569
Switched to a new branch 'scalability-no-512-32768-1-1722394569'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-1-1722394569 abba57bfda] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:56:37 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:56:37 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-1-1722394569 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-1
+ env
++ date
+ echo Wed 31 Jul 03:57:56 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 03:57:56 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at abba57bfda fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-1-1722394676
+ git checkout -b scalability-no-128-32768-1-1722394676
Switched to a new branch 'scalability-no-128-32768-1-1722394676'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-1-1722394676 f7677e4924] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-1 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 03:58:23 BST 2024 'RUN   files: 32768  partitions: 1'
Wed 31 Jul 03:58:23 BST 2024 RUN   files: 32768  partitions: 1
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-1-1722394676 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-1 1 10 '1 4 8' 1
+ pg_ctl -D /mnt/data/data-test stop
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 03:59:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 03:59:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f7677e4924 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722394784
+ git checkout -b scalability-yes-32-32768-0-1722394784
Switched to a new branch 'scalability-yes-32-32768-0-1722394784'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722394784 9250c74789] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722394784 599789400c] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:00:41 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:00:41 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-32-32768-0-1722394784 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:01:55 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 04:01:55 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 599789400c fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722394915
+ git checkout -b scalability-yes-0-32768-0-1722394915
Switched to a new branch 'scalability-yes-0-32768-0-1722394915'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722394915 e3df8aa735] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:02:52 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:02:52 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-0-32768-0-1722394915 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:04:06 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 04:04:06 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e3df8aa735 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722395046
+ git checkout -b scalability-yes-1-32768-0-1722395046
Switched to a new branch 'scalability-yes-1-32768-0-1722395046'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722395046 68a0b1b958] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722395046 4874d98bb9] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:05:02 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:05:02 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1-32768-0-1722395046 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:06:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 04:06:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4874d98bb9 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722395176
+ git checkout -b scalability-yes-1024-32768-0-1722395176
Switched to a new branch 'scalability-yes-1024-32768-0-1722395176'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722395176 e34f4584be] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722395176 b8deffa761] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:07:13 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:07:13 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-1024-32768-0-1722395176 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:08:27 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 04:08:27 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b8deffa761 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722395307
+ git checkout -b scalability-yes-8-32768-0-1722395307
Switched to a new branch 'scalability-yes-8-32768-0-1722395307'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722395307 80d3d9a9fa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722395307 a4a006e878] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:09:24 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:09:24 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-8-32768-0-1722395307 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:10:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 04:10:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a4a006e878 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722395438
+ git checkout -b scalability-yes-512-32768-0-1722395438
Switched to a new branch 'scalability-yes-512-32768-0-1722395438'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722395438 0fd2776ffe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722395438 093830c6fd] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:11:35 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:11:35 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-512-32768-0-1722395438 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-yes-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:12:49 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 04:12:49 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 093830c6fd fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722395569
+ git checkout -b scalability-yes-128-32768-0-1722395569
Switched to a new branch 'scalability-yes-128-32768-0-1722395569'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722395569 879d53d60e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722395569 9d89613b4f] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:13:45 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:13:45 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-yes-128-32768-0-1722395569 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:14:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 04:14:59 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9d89613b4f fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722395699
+ git checkout -b scalability-no-32-32768-0-1722395699
Switched to a new branch 'scalability-no-32-32768-0-1722395699'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722395699 a2924c63ad] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:15:56 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:15:56 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-32-32768-0-1722395699 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:17:10 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 04:17:10 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a2924c63ad fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722395830
+ git checkout -b scalability-no-0-32768-0-1722395830
Switched to a new branch 'scalability-no-0-32768-0-1722395830'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:18:06 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:18:06 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-0-32768-0-1722395830 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:19:20 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 04:19:20 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722395960
+ git checkout -b scalability-no-1-32768-0-1722395960
Switched to a new branch 'scalability-no-1-32768-0-1722395960'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722395960 8aee4a93e6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:20:15 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:20:15 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1-32768-0-1722395960 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:21:29 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 04:21:29 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8aee4a93e6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722396089
+ git checkout -b scalability-no-1024-32768-0-1722396089
Switched to a new branch 'scalability-no-1024-32768-0-1722396089'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722396089 a9d698b190] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:22:26 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:22:26 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-1024-32768-0-1722396089 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:23:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 04:23:40 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at a9d698b190 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722396220
+ git checkout -b scalability-no-8-32768-0-1722396220
Switched to a new branch 'scalability-no-8-32768-0-1722396220'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722396220 c38718de57] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:24:36 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:24:36 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-8-32768-0-1722396220 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:25:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 04:25:50 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c38718de57 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722396350
+ git checkout -b scalability-no-512-32768-0-1722396350
Switched to a new branch 'scalability-no-512-32768-0-1722396350'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722396350 c23c54a5fb] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:26:45 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:26:45 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-512-32768-0-1722396350 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/index-no-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:27:59 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 04:27:59 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c23c54a5fb fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722396479
+ git checkout -b scalability-no-128-32768-0-1722396479
Switched to a new branch 'scalability-no-128-32768-0-1722396479'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722396479 6f7d121a7b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:28:55 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:28:55 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh rpi5-64 scalability-no-128-32768-0-1722396479 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/index-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:30:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 04:30:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6f7d121a7b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722396609
+ git checkout -b scalability-yes-32-32768-0-1722396609
Switched to a new branch 'scalability-yes-32-32768-0-1722396609'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722396609 006cfa6da5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722396609 6d1f5cb69e] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:30:36 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:30:36 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-32-32768-0-1722396609 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:31:52 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 04:31:52 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6d1f5cb69e fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722396712
+ git checkout -b scalability-yes-0-32768-0-1722396712
Switched to a new branch 'scalability-yes-0-32768-0-1722396712'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722396712 5e54065cb2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:32:19 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:32:19 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-0-32768-0-1722396712 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:33:34 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 04:33:34 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 5e54065cb2 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722396815
+ git checkout -b scalability-yes-1-32768-0-1722396815
Switched to a new branch 'scalability-yes-1-32768-0-1722396815'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722396815 4be8423346] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722396815 1ba3bb4c9d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:34:01 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:34:01 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1-32768-0-1722396815 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:35:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 04:35:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1ba3bb4c9d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722396918
+ git checkout -b scalability-yes-1024-32768-0-1722396918
Switched to a new branch 'scalability-yes-1024-32768-0-1722396918'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722396918 cec05f80fc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722396918 0294de7eae] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:35:45 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:35:45 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-1024-32768-0-1722396918 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:37:01 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 04:37:01 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0294de7eae fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722397021
+ git checkout -b scalability-yes-8-32768-0-1722397021
Switched to a new branch 'scalability-yes-8-32768-0-1722397021'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722397021 805e184ec2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722397021 f6946f692e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:37:28 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:37:28 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-8-32768-0-1722397021 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:38:45 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 04:38:45 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f6946f692e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722397125
+ git checkout -b scalability-yes-512-32768-0-1722397125
Switched to a new branch 'scalability-yes-512-32768-0-1722397125'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722397125 731bca9039] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722397125 8478bfef91] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:39:12 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:39:12 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-512-32768-0-1722397125 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-yes-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:40:30 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 04:40:30 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8478bfef91 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722397230
+ git checkout -b scalability-yes-128-32768-0-1722397230
Switched to a new branch 'scalability-yes-128-32768-0-1722397230'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722397230 67986d4bba] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722397230 6ce6e78884] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:40:57 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:40:57 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-yes-128-32768-0-1722397230 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:42:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 04:42:13 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6ce6e78884 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722397333
+ git checkout -b scalability-no-32-32768-0-1722397333
Switched to a new branch 'scalability-no-32-32768-0-1722397333'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722397333 ce1c475b47] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:42:39 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:42:39 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-32-32768-0-1722397333 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:43:57 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 04:43:57 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ce1c475b47 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722397437
+ git checkout -b scalability-no-0-32768-0-1722397437
Switched to a new branch 'scalability-no-0-32768-0-1722397437'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:44:23 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:44:23 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-0-32768-0-1722397437 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:45:39 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 04:45:39 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722397540
+ git checkout -b scalability-no-1-32768-0-1722397540
Switched to a new branch 'scalability-no-1-32768-0-1722397540'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722397540 85820145d7] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:46:07 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:46:07 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1-32768-0-1722397540 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:47:23 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 04:47:23 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 85820145d7 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722397643
+ git checkout -b scalability-no-1024-32768-0-1722397643
Switched to a new branch 'scalability-no-1024-32768-0-1722397643'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722397643 4f9579bd51] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:47:50 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:47:50 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-1024-32768-0-1722397643 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:49:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 04:49:06 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4f9579bd51 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722397746
+ git checkout -b scalability-no-8-32768-0-1722397746
Switched to a new branch 'scalability-no-8-32768-0-1722397746'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722397746 0d321f0e04] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:49:33 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:49:33 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-8-32768-0-1722397746 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:50:50 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 04:50:50 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 0d321f0e04 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722397850
+ git checkout -b scalability-no-512-32768-0-1722397850
Switched to a new branch 'scalability-no-512-32768-0-1722397850'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722397850 be7abdb6f1] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:51:17 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:51:17 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-512-32768-0-1722397850 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/join-no-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:52:33 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 04:52:33 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at be7abdb6f1 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722397953
+ git checkout -b scalability-no-128-32768-0-1722397953
Switched to a new branch 'scalability-no-128-32768-0-1722397953'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722397953 09005ad4aa] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:53:00 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:53:00 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh rpi5-64 scalability-no-128-32768-0-1722397953 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/join-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:54:16 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 04:54:16 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 09005ad4aa fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722398056
+ git checkout -b scalability-yes-32-32768-0-1722398056
Switched to a new branch 'scalability-yes-32-32768-0-1722398056'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722398056 7372a0e795] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722398056 e050058a9a] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:54:43 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:54:43 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-32-32768-0-1722398056 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:55:57 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 04:55:57 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e050058a9a fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722398157
+ git checkout -b scalability-yes-0-32768-0-1722398157
Switched to a new branch 'scalability-yes-0-32768-0-1722398157'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722398157 6f59911e08] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:56:24 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:56:24 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-0-32768-0-1722398157 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:57:38 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 04:57:38 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6f59911e08 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722398258
+ git checkout -b scalability-yes-1-32768-0-1722398258
Switched to a new branch 'scalability-yes-1-32768-0-1722398258'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722398258 d6a2cb5b70] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722398258 45ac594226] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:58:04 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:58:04 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1-32768-0-1722398258 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 04:59:18 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 04:59:18 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 45ac594226 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722398358
+ git checkout -b scalability-yes-1024-32768-0-1722398358
Switched to a new branch 'scalability-yes-1024-32768-0-1722398358'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722398358 192a48ae7e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722398358 4f5150cd6c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 04:59:44 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 04:59:44 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-1024-32768-0-1722398358 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:00:58 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 05:00:58 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4f5150cd6c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722398458
+ git checkout -b scalability-yes-8-32768-0-1722398458
Switched to a new branch 'scalability-yes-8-32768-0-1722398458'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722398458 246abfe9d2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722398458 efb9df8362] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:01:25 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:01:25 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-8-32768-0-1722398458 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:02:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 05:02:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at efb9df8362 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722398559
+ git checkout -b scalability-yes-512-32768-0-1722398559
Switched to a new branch 'scalability-yes-512-32768-0-1722398559'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722398559 92de7d8bad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722398559 3016735f07] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:03:06 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:03:06 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-512-32768-0-1722398559 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-yes-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:04:19 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 05:04:19 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 3016735f07 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722398659
+ git checkout -b scalability-yes-128-32768-0-1722398659
Switched to a new branch 'scalability-yes-128-32768-0-1722398659'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722398659 0fad6241ee] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722398659 205ce803f7] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:04:46 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:04:46 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-yes-128-32768-0-1722398659 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:06:00 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 05:06:00 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 205ce803f7 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722398760
+ git checkout -b scalability-no-32-32768-0-1722398760
Switched to a new branch 'scalability-no-32-32768-0-1722398760'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722398760 866e907469] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:06:27 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:06:27 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-32-32768-0-1722398760 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:07:40 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 05:07:40 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 866e907469 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722398860
+ git checkout -b scalability-no-0-32768-0-1722398860
Switched to a new branch 'scalability-no-0-32768-0-1722398860'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:08:07 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:08:07 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-0-32768-0-1722398860 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:09:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 05:09:21 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722398961
+ git checkout -b scalability-no-1-32768-0-1722398961
Switched to a new branch 'scalability-no-1-32768-0-1722398961'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722398961 9f6142d378] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:09:47 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:09:47 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1-32768-0-1722398961 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:11:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 05:11:01 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 9f6142d378 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722399061
+ git checkout -b scalability-no-1024-32768-0-1722399061
Switched to a new branch 'scalability-no-1024-32768-0-1722399061'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722399061 b615334dbc] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:11:28 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:11:28 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-1024-32768-0-1722399061 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:12:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 05:12:41 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b615334dbc fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722399161
+ git checkout -b scalability-no-8-32768-0-1722399161
Switched to a new branch 'scalability-no-8-32768-0-1722399161'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722399161 54db8b2bee] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:13:08 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:13:08 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-8-32768-0-1722399161 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:14:21 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 05:14:21 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 54db8b2bee fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722399261
+ git checkout -b scalability-no-512-32768-0-1722399261
Switched to a new branch 'scalability-no-512-32768-0-1722399261'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722399261 6d84873abb] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:14:48 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:14:48 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-512-32768-0-1722399261 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/count-no-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:16:01 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 05:16:01 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 6d84873abb fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722399361
+ git checkout -b scalability-no-128-32768-0-1722399361
Switched to a new branch 'scalability-no-128-32768-0-1722399361'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722399361 b0362ad626] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:16:28 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:16:28 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh rpi5-64 scalability-no-128-32768-0-1722399361 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/count-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:17:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 05:17:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b0362ad626 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722399461
+ git checkout -b scalability-yes-32-32768-0-1722399461
Switched to a new branch 'scalability-yes-32-32768-0-1722399461'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722399461 82bb8f44c5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722399461 ef39e51916] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:18:08 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:18:08 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-32-32768-0-1722399461 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:19:22 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 05:19:22 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ef39e51916 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722399562
+ git checkout -b scalability-yes-0-32768-0-1722399562
Switched to a new branch 'scalability-yes-0-32768-0-1722399562'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722399562 dfce0753d3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:19:48 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:19:48 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-0-32768-0-1722399562 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:21:02 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 05:21:02 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dfce0753d3 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722399662
+ git checkout -b scalability-yes-1-32768-0-1722399662
Switched to a new branch 'scalability-yes-1-32768-0-1722399662'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722399662 34bf76957c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722399662 fb7b9b39ea] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:21:29 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:21:29 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1-32768-0-1722399662 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:22:43 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 05:22:43 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fb7b9b39ea fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722399763
+ git checkout -b scalability-yes-1024-32768-0-1722399763
Switched to a new branch 'scalability-yes-1024-32768-0-1722399763'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722399763 ba636fc37d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722399763 79c32bd3b6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:23:10 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:23:10 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-1024-32768-0-1722399763 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:24:24 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 05:24:24 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 79c32bd3b6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722399864
+ git checkout -b scalability-yes-8-32768-0-1722399864
Switched to a new branch 'scalability-yes-8-32768-0-1722399864'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722399864 c22e6fe636] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722399864 36cdbf8f83] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:24:51 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:24:51 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-8-32768-0-1722399864 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:26:05 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 05:26:05 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 36cdbf8f83 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722399965
+ git checkout -b scalability-yes-512-32768-0-1722399965
Switched to a new branch 'scalability-yes-512-32768-0-1722399965'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722399965 ede1ee8359] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722399965 fcef6275a9] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:26:32 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:26:32 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-512-32768-0-1722399965 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-yes-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:27:46 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 05:27:46 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fcef6275a9 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722400066
+ git checkout -b scalability-yes-128-32768-0-1722400066
Switched to a new branch 'scalability-yes-128-32768-0-1722400066'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722400066 38b876991f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722400066 e5881676c8] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:28:12 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:28:12 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-yes-128-32768-0-1722400066 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:29:26 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 05:29:26 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e5881676c8 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722400166
+ git checkout -b scalability-no-32-32768-0-1722400166
Switched to a new branch 'scalability-no-32-32768-0-1722400166'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722400166 43df47eecc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:29:53 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:29:53 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-32-32768-0-1722400166 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:31:06 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 05:31:06 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 43df47eecc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722400266
+ git checkout -b scalability-no-0-32768-0-1722400266
Switched to a new branch 'scalability-no-0-32768-0-1722400266'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:31:33 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:31:33 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-0-32768-0-1722400266 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:32:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 05:32:47 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722400367
+ git checkout -b scalability-no-1-32768-0-1722400367
Switched to a new branch 'scalability-no-1-32768-0-1722400367'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722400367 4ebdc6618a] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:33:13 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:33:13 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1-32768-0-1722400367 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:34:27 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 05:34:27 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 4ebdc6618a fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722400467
+ git checkout -b scalability-no-1024-32768-0-1722400467
Switched to a new branch 'scalability-no-1024-32768-0-1722400467'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722400467 c89c270ea3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:34:53 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:34:53 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-1024-32768-0-1722400467 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:36:07 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 05:36:07 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c89c270ea3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722400567
+ git checkout -b scalability-no-8-32768-0-1722400567
Switched to a new branch 'scalability-no-8-32768-0-1722400567'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722400567 33549b6ec3] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:36:34 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:36:34 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-8-32768-0-1722400567 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:37:47 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 05:37:47 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 33549b6ec3 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722400667
+ git checkout -b scalability-no-512-32768-0-1722400667
Switched to a new branch 'scalability-no-512-32768-0-1722400667'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722400667 f58928b7e5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:38:14 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:38:14 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-512-32768-0-1722400667 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/pgbench-no-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:39:28 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 05:39:28 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at f58928b7e5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722400768
+ git checkout -b scalability-no-128-32768-0-1722400768
Switched to a new branch 'scalability-no-128-32768-0-1722400768'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722400768 b38f2f1501] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:39:54 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:39:54 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh rpi5-64 scalability-no-128-32768-0-1722400768 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/pgbench-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:41:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed 31 Jul 05:41:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at b38f2f1501 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-0-1722400869
+ git checkout -b scalability-yes-32-32768-0-1722400869
Switched to a new branch 'scalability-yes-32-32768-0-1722400869'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-0-1722400869 b2561069e5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-0-1722400869 43972419a8] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:41:35 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:41:35 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-32-32768-0-1722400869 32768 yes 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:41:39 BST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed 31 Jul 05:41:39 BST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 43972419a8 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-0-1722400899
+ git checkout -b scalability-yes-0-32768-0-1722400899
Switched to a new branch 'scalability-yes-0-32768-0-1722400899'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-0-1722400899 d5c8fa3f16] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:42:05 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:42:05 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-0-32768-0-1722400899 32768 yes 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:42:09 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed 31 Jul 05:42:09 BST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at d5c8fa3f16 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-0-1722400929
+ git checkout -b scalability-yes-1-32768-0-1722400929
Switched to a new branch 'scalability-yes-1-32768-0-1722400929'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-0-1722400929 16895a9db6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-0-1722400929 c8248b0533] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:42:36 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:42:36 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1-32768-0-1722400929 32768 yes 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:42:40 BST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed 31 Jul 05:42:40 BST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at c8248b0533 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-0-1722400960
+ git checkout -b scalability-yes-1024-32768-0-1722400960
Switched to a new branch 'scalability-yes-1024-32768-0-1722400960'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-0-1722400960 67e30fda9d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-0-1722400960 32add93dd9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:43:08 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:43:08 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-1024-32768-0-1722400960 32768 yes 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:43:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed 31 Jul 05:43:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 32add93dd9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-0-1722400991
+ git checkout -b scalability-yes-8-32768-0-1722400991
Switched to a new branch 'scalability-yes-8-32768-0-1722400991'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-0-1722400991 0e8277237f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-0-1722400991 15397c130e] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:43:38 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:43:38 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-8-32768-0-1722400991 32768 yes 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:43:41 BST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed 31 Jul 05:43:41 BST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 15397c130e fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-0-1722401022
+ git checkout -b scalability-yes-512-32768-0-1722401022
Switched to a new branch 'scalability-yes-512-32768-0-1722401022'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-0-1722401022 c44ccceefc] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-0-1722401022 1b16e49e64] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:44:08 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:44:08 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-512-32768-0-1722401022 32768 yes 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-yes-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:44:11 BST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed 31 Jul 05:44:11 BST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 1b16e49e64 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-0-1722401051
+ git checkout -b scalability-yes-128-32768-0-1722401051
Switched to a new branch 'scalability-yes-128-32768-0-1722401051'
+ '[' yes == yes ']'
+ cat /mnt/data/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-0-1722401051 305aeb220c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-0-1722401051 fc6628bbe5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:44:38 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:44:38 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-yes-128-32768-0-1722401051 32768 yes 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-yes-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-32-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:44:41 BST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed 31 Jul 05:44:41 BST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at fc6628bbe5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-0-1722401082
+ git checkout -b scalability-no-32-32768-0-1722401082
Switched to a new branch 'scalability-no-32-32768-0-1722401082'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-0-1722401082 2fa3a3eb43] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:45:08 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:45:08 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-32-32768-0-1722401082 32768 no 32 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-32-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-0-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:45:11 BST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed 31 Jul 05:45:11 BST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2fa3a3eb43 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-0-1722401111
+ git checkout -b scalability-no-0-32768-0-1722401111
Switched to a new branch 'scalability-no-0-32768-0-1722401111'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:45:40 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:45:40 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-0-32768-0-1722401111 32768 no 0 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-0-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:45:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed 31 Jul 05:45:43 BST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at e458dc1ac8 Doc: update some HTTP links to point to canonical URLs.
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-0-1722401143
+ git checkout -b scalability-no-1-32768-0-1722401143
Switched to a new branch 'scalability-no-1-32768-0-1722401143'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-0-1722401143 dcdaa16c7d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:46:10 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:46:10 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1-32768-0-1722401143 32768 no 1 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-1024-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:46:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed 31 Jul 05:46:13 BST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at dcdaa16c7d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-0-1722401173
+ git checkout -b scalability-no-1024-32768-0-1722401173
Switched to a new branch 'scalability-no-1024-32768-0-1722401173'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-0-1722401173 ecd0e6d53d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:46:40 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:46:40 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-1024-32768-0-1722401173 32768 no 1024 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-1024-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-8-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:46:43 BST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed 31 Jul 05:46:43 BST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at ecd0e6d53d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-0-1722401203
+ git checkout -b scalability-no-8-32768-0-1722401203
Switched to a new branch 'scalability-no-8-32768-0-1722401203'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-0-1722401203 8c6a6a622f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:47:10 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:47:10 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-8-32768-0-1722401203 32768 no 8 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-8-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-512-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:47:13 BST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed 31 Jul 05:47:13 BST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 8c6a6a622f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-0-1722401233
+ git checkout -b scalability-no-512-32768-0-1722401233
Switched to a new branch 'scalability-no-512-32768-0-1722401233'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-0-1722401233 2517897d77] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:47:41 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:47:41 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-512-32768-0-1722401233 32768 no 512 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-512-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-0
+ RESULTDIR=/mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-0
+ mkdir -p /mnt/data/lock-scalability-test/20240730-1250-glibc-default/results/star-no-128-32768-0
+ env
++ date
+ echo Wed 31 Jul 05:47:44 BST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed 31 Jul 05:47:44 BST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres /mnt/data/lock-scalability-test
+ git reset --hard
HEAD is now at 2517897d77 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-0-1722401264
+ git checkout -b scalability-no-128-32768-0-1722401264
Switched to a new branch 'scalability-no-128-32768-0-1722401264'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /mnt/data/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-0-1722401264 fff42aa5aa] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-0 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
/mnt/data/lock-scalability-test
++ date
+ echo Wed 31 Jul 05:48:10 BST 2024 'RUN   files: 32768  partitions: 0'
Wed 31 Jul 05:48:10 BST 2024 RUN   files: 32768  partitions: 0
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/data/data-test
+ pg_ctl -D /mnt/data/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 1GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/data/data-test -l /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-0/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh rpi5-64 scalability-no-128-32768-0-1722401264 32768 no 128 /mnt/data/lock-scalability-test/20240730-1250-glibc-default/logs/star-no-128-32768-0 1 10 '1 4 8' 0
+ pg_ctl -D /mnt/data/data-test stop
