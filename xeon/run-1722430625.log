+ set -e
+ LABEL=glibc-default
+ MACHINE=xeon
+ DBNAME=test
+ RUNS=1
+ DURATION=10
+ CLIENTS='1 16 32'
+ PARTITIONS=10
+ BUILDS=/mnt/data/builds
+ SOURCE=/mnt/data/postgres
+ PATH_OLD=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
++ date +%Y%m%d-%H%M
+ DATE=20240731-1457
++ pwd
+ PATCHES=/home/tomas/lock-scalability-test/patches
++ pwd
+ LOGS=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs
++ pwd
+ RESULTS=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results
+ DATADIR=/mnt/pgdata/data-test
+ ulimit -n 35000
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-32-1000-10
+ env
++ date
+ echo Wed Jul 31 02:57:05 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 02:57:05 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1d02c36868 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722430626
+ git checkout -b scalability-yes-32-1000-10-1722430626
Switched to a new branch 'scalability-yes-32-1000-10-1722430626'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722430626 f5ae235b09] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722430626 8f4b8646e2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 02:57:59 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 02:57:59 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-1000-10-1722430626 1000 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-0-1000-10
+ env
++ date
+ echo Wed Jul 31 02:59:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 02:59:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f4b8646e2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722430754
+ git checkout -b scalability-yes-0-1000-10-1722430754
Switched to a new branch 'scalability-yes-0-1000-10-1722430754'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722430754 bb1e72bcd8] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:00:06 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:00:06 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-1000-10-1722430754 1000 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1-1000-10
+ env
++ date
+ echo Wed Jul 31 03:01:21 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 03:01:21 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bb1e72bcd8 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722430881
+ git checkout -b scalability-yes-1-1000-10-1722430881
Switched to a new branch 'scalability-yes-1-1000-10-1722430881'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722430881 32fdcce7aa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722430881 ba2e2a53b8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:02:14 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:02:14 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-1000-10-1722430881 1000 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 03:03:29 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 03:03:29 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ba2e2a53b8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722431010
+ git checkout -b scalability-yes-1024-1000-10-1722431010
Switched to a new branch 'scalability-yes-1024-1000-10-1722431010'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722431010 737916059d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722431010 67ed3c5a39] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:04:22 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:04:22 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-1000-10-1722431010 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-8-1000-10
+ env
++ date
+ echo Wed Jul 31 03:05:37 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 03:05:37 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 67ed3c5a39 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722431137
+ git checkout -b scalability-yes-8-1000-10-1722431137
Switched to a new branch 'scalability-yes-8-1000-10-1722431137'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722431137 18eb6ecf06] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722431137 b6bb44db4c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:06:30 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:06:30 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-1000-10-1722431137 1000 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-512-1000-10
+ env
++ date
+ echo Wed Jul 31 03:07:45 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 03:07:45 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b6bb44db4c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722431265
+ git checkout -b scalability-yes-512-1000-10-1722431265
Switched to a new branch 'scalability-yes-512-1000-10-1722431265'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722431265 264d843e68] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722431265 bfc94c6168] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:08:38 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:08:38 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-1000-10-1722431265 1000 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-128-1000-10
+ env
++ date
+ echo Wed Jul 31 03:09:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 03:09:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bfc94c6168 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722431394
+ git checkout -b scalability-yes-128-1000-10-1722431394
Switched to a new branch 'scalability-yes-128-1000-10-1722431394'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722431394 f32f06f3f4] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722431394 6163f7b936] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:10:46 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:10:46 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-1000-10-1722431394 1000 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-32-1000-10
+ env
++ date
+ echo Wed Jul 31 03:12:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 03:12:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6163f7b936 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722431521
+ git checkout -b scalability-no-32-1000-10-1722431521
Switched to a new branch 'scalability-no-32-1000-10-1722431521'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722431521 88d046af14] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:12:54 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:12:54 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-1000-10-1722431521 1000 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-0-1000-10
+ env
++ date
+ echo Wed Jul 31 03:14:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 03:14:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 88d046af14 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722431649
+ git checkout -b scalability-no-0-1000-10-1722431649
Switched to a new branch 'scalability-no-0-1000-10-1722431649'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:15:01 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:15:01 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-1000-10-1722431649 1000 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1-1000-10
+ env
++ date
+ echo Wed Jul 31 03:16:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 03:16:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722431777
+ git checkout -b scalability-no-1-1000-10-1722431777
Switched to a new branch 'scalability-no-1-1000-10-1722431777'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722431777 428a22254f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:17:09 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:17:09 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-1000-10-1722431777 1000 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 03:18:24 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 03:18:24 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 428a22254f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722431904
+ git checkout -b scalability-no-1024-1000-10-1722431904
Switched to a new branch 'scalability-no-1024-1000-10-1722431904'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722431904 ecf6fd7eb3] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:19:16 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:19:16 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-1000-10-1722431904 1000 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-8-1000-10
+ env
++ date
+ echo Wed Jul 31 03:20:32 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 03:20:32 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ecf6fd7eb3 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722432032
+ git checkout -b scalability-no-8-1000-10-1722432032
Switched to a new branch 'scalability-no-8-1000-10-1722432032'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722432032 bacbc8032a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:21:25 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:21:25 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-1000-10-1722432032 1000 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-512-1000-10
+ env
++ date
+ echo Wed Jul 31 03:22:40 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 03:22:40 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bacbc8032a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722432160
+ git checkout -b scalability-no-512-1000-10-1722432160
Switched to a new branch 'scalability-no-512-1000-10-1722432160'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722432160 097610e550] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:23:32 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:23:32 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-1000-10-1722432160 1000 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-128-1000-10
+ env
++ date
+ echo Wed Jul 31 03:24:47 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 03:24:47 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 097610e550 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722432288
+ git checkout -b scalability-no-128-1000-10-1722432288
Switched to a new branch 'scalability-no-128-1000-10-1722432288'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722432288 7387bc63b2] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:25:40 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:25:40 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-1000-10-1722432288 1000 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-32-1000-10
+ env
++ date
+ echo Wed Jul 31 03:26:55 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 03:26:55 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7387bc63b2 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722432415
+ git checkout -b scalability-yes-32-1000-10-1722432415
Switched to a new branch 'scalability-yes-32-1000-10-1722432415'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722432415 0f84446da3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722432415 e4590b56cb] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:27:24 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:27:24 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-1000-10-1722432415 1000 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-0-1000-10
+ env
++ date
+ echo Wed Jul 31 03:28:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 03:28:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e4590b56cb fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722432523
+ git checkout -b scalability-yes-0-1000-10-1722432523
Switched to a new branch 'scalability-yes-0-1000-10-1722432523'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722432523 1b8b03794c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:29:11 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:29:11 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-1000-10-1722432523 1000 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1-1000-10
+ env
++ date
+ echo Wed Jul 31 03:30:30 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 03:30:30 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1b8b03794c NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722432630
+ git checkout -b scalability-yes-1-1000-10-1722432630
Switched to a new branch 'scalability-yes-1-1000-10-1722432630'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722432630 959a83517d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722432630 a8efa9e027] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:30:58 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:30:58 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-1000-10-1722432630 1000 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 03:32:17 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 03:32:17 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a8efa9e027 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722432737
+ git checkout -b scalability-yes-1024-1000-10-1722432737
Switched to a new branch 'scalability-yes-1024-1000-10-1722432737'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722432737 3a6e6f12d1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722432737 bf82cfb27e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:32:46 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:32:46 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-1000-10-1722432737 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-8-1000-10
+ env
++ date
+ echo Wed Jul 31 03:34:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 03:34:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bf82cfb27e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722432846
+ git checkout -b scalability-yes-8-1000-10-1722432846
Switched to a new branch 'scalability-yes-8-1000-10-1722432846'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722432846 c3e4d0c05e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722432846 b25d58203b] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:34:34 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:34:34 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-1000-10-1722432846 1000 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-512-1000-10
+ env
++ date
+ echo Wed Jul 31 03:35:53 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 03:35:53 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b25d58203b fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722432953
+ git checkout -b scalability-yes-512-1000-10-1722432953
Switched to a new branch 'scalability-yes-512-1000-10-1722432953'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722432953 43e3266f21] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722432953 7cb93574da] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:36:21 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:36:21 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-1000-10-1722432953 1000 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-128-1000-10
+ env
++ date
+ echo Wed Jul 31 03:37:40 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 03:37:40 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7cb93574da fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722433060
+ git checkout -b scalability-yes-128-1000-10-1722433060
Switched to a new branch 'scalability-yes-128-1000-10-1722433060'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722433060 40bd0a61c7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722433060 d3cbf42151] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:38:09 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:38:09 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-1000-10-1722433060 1000 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-32-1000-10
+ env
++ date
+ echo Wed Jul 31 03:39:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 03:39:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d3cbf42151 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722433168
+ git checkout -b scalability-no-32-1000-10-1722433168
Switched to a new branch 'scalability-no-32-1000-10-1722433168'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722433168 4cfc26dc09] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:39:57 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:39:57 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-1000-10-1722433168 1000 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-0-1000-10
+ env
++ date
+ echo Wed Jul 31 03:41:16 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 03:41:16 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4cfc26dc09 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722433276
+ git checkout -b scalability-no-0-1000-10-1722433276
Switched to a new branch 'scalability-no-0-1000-10-1722433276'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:41:44 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:41:44 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-1000-10-1722433276 1000 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1-1000-10
+ env
++ date
+ echo Wed Jul 31 03:43:03 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 03:43:03 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722433383
+ git checkout -b scalability-no-1-1000-10-1722433383
Switched to a new branch 'scalability-no-1-1000-10-1722433383'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722433383 8540037e5e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:43:32 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:43:32 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-1000-10-1722433383 1000 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 03:44:51 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 03:44:51 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8540037e5e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722433491
+ git checkout -b scalability-no-1024-1000-10-1722433491
Switched to a new branch 'scalability-no-1024-1000-10-1722433491'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722433491 98e721e4fc] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:45:19 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:45:19 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-1000-10-1722433491 1000 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-8-1000-10
+ env
++ date
+ echo Wed Jul 31 03:46:38 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 03:46:38 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 98e721e4fc fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722433599
+ git checkout -b scalability-no-8-1000-10-1722433599
Switched to a new branch 'scalability-no-8-1000-10-1722433599'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722433599 b2456d379f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:47:06 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:47:06 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-1000-10-1722433599 1000 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-512-1000-10
+ env
++ date
+ echo Wed Jul 31 03:48:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 03:48:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b2456d379f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722433706
+ git checkout -b scalability-no-512-1000-10-1722433706
Switched to a new branch 'scalability-no-512-1000-10-1722433706'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722433706 ea5e816d6f] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:48:54 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:48:54 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-1000-10-1722433706 1000 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-128-1000-10
+ env
++ date
+ echo Wed Jul 31 03:50:13 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 03:50:13 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ea5e816d6f fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722433813
+ git checkout -b scalability-no-128-1000-10-1722433813
Switched to a new branch 'scalability-no-128-1000-10-1722433813'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722433813 830e408fff] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:50:41 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:50:41 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-1000-10-1722433813 1000 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-32-1000-10
+ env
++ date
+ echo Wed Jul 31 03:52:01 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 03:52:01 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 830e408fff fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722433921
+ git checkout -b scalability-yes-32-1000-10-1722433921
Switched to a new branch 'scalability-yes-32-1000-10-1722433921'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722433921 85e0253988] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722433921 7d3637a079] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:52:29 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:52:29 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-1000-10-1722433921 1000 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-0-1000-10
+ env
++ date
+ echo Wed Jul 31 03:53:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 03:53:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7d3637a079 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722434023
+ git checkout -b scalability-yes-0-1000-10-1722434023
Switched to a new branch 'scalability-yes-0-1000-10-1722434023'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722434023 681d71c35f] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:54:11 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:54:11 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-1000-10-1722434023 1000 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1-1000-10
+ env
++ date
+ echo Wed Jul 31 03:55:25 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 03:55:25 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 681d71c35f NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722434125
+ git checkout -b scalability-yes-1-1000-10-1722434125
Switched to a new branch 'scalability-yes-1-1000-10-1722434125'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722434125 193183f8de] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722434125 21f55c10e3] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:55:53 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:55:53 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-1000-10-1722434125 1000 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 03:57:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 03:57:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 21f55c10e3 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722434227
+ git checkout -b scalability-yes-1024-1000-10-1722434227
Switched to a new branch 'scalability-yes-1024-1000-10-1722434227'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722434227 2efec50260] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722434227 f79a7e817d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:57:34 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:57:34 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-1000-10-1722434227 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-8-1000-10
+ env
++ date
+ echo Wed Jul 31 03:58:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 03:58:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at f79a7e817d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722434328
+ git checkout -b scalability-yes-8-1000-10-1722434328
Switched to a new branch 'scalability-yes-8-1000-10-1722434328'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722434328 b9cda7094b] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722434328 3ee7ec4d11] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 03:59:17 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 03:59:17 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-1000-10-1722434328 1000 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-512-1000-10
+ env
++ date
+ echo Wed Jul 31 04:00:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 04:00:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3ee7ec4d11 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722434431
+ git checkout -b scalability-yes-512-1000-10-1722434431
Switched to a new branch 'scalability-yes-512-1000-10-1722434431'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722434431 6a502a3569] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722434431 48e45a4739] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:00:59 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:00:59 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-1000-10-1722434431 1000 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-128-1000-10
+ env
++ date
+ echo Wed Jul 31 04:02:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 04:02:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 48e45a4739 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722434533
+ git checkout -b scalability-yes-128-1000-10-1722434533
Switched to a new branch 'scalability-yes-128-1000-10-1722434533'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722434533 3ba4bf9bdf] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722434533 199bbb9b1c] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:02:41 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:02:41 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-1000-10-1722434533 1000 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-32-1000-10
+ env
++ date
+ echo Wed Jul 31 04:03:55 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 04:03:55 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 199bbb9b1c fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722434635
+ git checkout -b scalability-no-32-1000-10-1722434635
Switched to a new branch 'scalability-no-32-1000-10-1722434635'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722434635 eb62897d63] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:04:24 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:04:24 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-1000-10-1722434635 1000 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-0-1000-10
+ env
++ date
+ echo Wed Jul 31 04:05:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 04:05:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at eb62897d63 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722434737
+ git checkout -b scalability-no-0-1000-10-1722434737
Switched to a new branch 'scalability-no-0-1000-10-1722434737'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:06:05 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:06:05 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-1000-10-1722434737 1000 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1-1000-10
+ env
++ date
+ echo Wed Jul 31 04:07:19 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 04:07:19 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722434839
+ git checkout -b scalability-no-1-1000-10-1722434839
Switched to a new branch 'scalability-no-1-1000-10-1722434839'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722434839 80cc608d0d] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:07:47 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:07:47 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-1000-10-1722434839 1000 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 04:09:00 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 04:09:00 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 80cc608d0d fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722434941
+ git checkout -b scalability-no-1024-1000-10-1722434941
Switched to a new branch 'scalability-no-1024-1000-10-1722434941'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722434941 c689620ee7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:09:29 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:09:29 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-1000-10-1722434941 1000 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-8-1000-10
+ env
++ date
+ echo Wed Jul 31 04:10:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 04:10:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c689620ee7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722435043
+ git checkout -b scalability-no-8-1000-10-1722435043
Switched to a new branch 'scalability-no-8-1000-10-1722435043'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722435043 790ad688d9] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:11:11 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:11:11 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-1000-10-1722435043 1000 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-512-1000-10
+ env
++ date
+ echo Wed Jul 31 04:12:25 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 04:12:25 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 790ad688d9 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722435145
+ git checkout -b scalability-no-512-1000-10-1722435145
Switched to a new branch 'scalability-no-512-1000-10-1722435145'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722435145 39214be351] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:12:53 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:12:53 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-1000-10-1722435145 1000 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-128-1000-10
+ env
++ date
+ echo Wed Jul 31 04:14:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 04:14:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 39214be351 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722435247
+ git checkout -b scalability-no-128-1000-10-1722435247
Switched to a new branch 'scalability-no-128-1000-10-1722435247'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722435247 74821a5e4b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:14:35 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:14:35 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-1000-10-1722435247 1000 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-32-1000-10
+ env
++ date
+ echo Wed Jul 31 04:15:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 04:15:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 74821a5e4b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722435349
+ git checkout -b scalability-yes-32-1000-10-1722435349
Switched to a new branch 'scalability-yes-32-1000-10-1722435349'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722435349 fcc2aeb02d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722435349 340d52a2e1] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:16:17 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:16:17 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-1000-10-1722435349 1000 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-0-1000-10
+ env
++ date
+ echo Wed Jul 31 04:17:32 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 04:17:32 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 340d52a2e1 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722435452
+ git checkout -b scalability-yes-0-1000-10-1722435452
Switched to a new branch 'scalability-yes-0-1000-10-1722435452'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722435452 8f7f63720d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:18:00 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:18:00 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-1000-10-1722435452 1000 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1-1000-10
+ env
++ date
+ echo Wed Jul 31 04:19:15 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 04:19:15 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8f7f63720d NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722435555
+ git checkout -b scalability-yes-1-1000-10-1722435555
Switched to a new branch 'scalability-yes-1-1000-10-1722435555'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722435555 8dc46938a7] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722435555 cd3b452ca6] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:19:43 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:19:43 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-1000-10-1722435555 1000 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 04:20:58 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 04:20:58 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cd3b452ca6 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722435658
+ git checkout -b scalability-yes-1024-1000-10-1722435658
Switched to a new branch 'scalability-yes-1024-1000-10-1722435658'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722435658 bc6fe4ddaa] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722435658 2574035cb7] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:21:27 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:21:27 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-1000-10-1722435658 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-8-1000-10
+ env
++ date
+ echo Wed Jul 31 04:22:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 04:22:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2574035cb7 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722435762
+ git checkout -b scalability-yes-8-1000-10-1722435762
Switched to a new branch 'scalability-yes-8-1000-10-1722435762'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722435762 f24f2acf10] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722435762 086eef2b5c] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:23:10 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:23:10 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-1000-10-1722435762 1000 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-512-1000-10
+ env
++ date
+ echo Wed Jul 31 04:24:25 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 04:24:25 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 086eef2b5c fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722435865
+ git checkout -b scalability-yes-512-1000-10-1722435865
Switched to a new branch 'scalability-yes-512-1000-10-1722435865'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722435865 823f63b8ec] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722435865 b03c6b62f2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:24:53 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:24:53 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-1000-10-1722435865 1000 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-128-1000-10
+ env
++ date
+ echo Wed Jul 31 04:26:07 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 04:26:07 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b03c6b62f2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722435968
+ git checkout -b scalability-yes-128-1000-10-1722435968
Switched to a new branch 'scalability-yes-128-1000-10-1722435968'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722435968 47d779e701] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722435968 e4fdd3edfc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:26:36 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:26:36 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-1000-10-1722435968 1000 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-32-1000-10
+ env
++ date
+ echo Wed Jul 31 04:27:50 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 04:27:50 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e4fdd3edfc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722436071
+ git checkout -b scalability-no-32-1000-10-1722436071
Switched to a new branch 'scalability-no-32-1000-10-1722436071'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722436071 cb34b7d1dc] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:28:19 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:28:19 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-1000-10-1722436071 1000 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-0-1000-10
+ env
++ date
+ echo Wed Jul 31 04:29:33 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 04:29:33 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cb34b7d1dc fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722436173
+ git checkout -b scalability-no-0-1000-10-1722436173
Switched to a new branch 'scalability-no-0-1000-10-1722436173'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:30:02 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:30:02 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-1000-10-1722436173 1000 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1-1000-10
+ env
++ date
+ echo Wed Jul 31 04:31:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 04:31:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722436277
+ git checkout -b scalability-no-1-1000-10-1722436277
Switched to a new branch 'scalability-no-1-1000-10-1722436277'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722436277 2e46aa3942] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:31:45 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:31:45 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-1000-10-1722436277 1000 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 04:33:00 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 04:33:00 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2e46aa3942 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722436380
+ git checkout -b scalability-no-1024-1000-10-1722436380
Switched to a new branch 'scalability-no-1024-1000-10-1722436380'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722436380 bc12d4c49e] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:33:28 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:33:28 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-1000-10-1722436380 1000 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-8-1000-10
+ env
++ date
+ echo Wed Jul 31 04:34:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 04:34:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at bc12d4c49e fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722436483
+ git checkout -b scalability-no-8-1000-10-1722436483
Switched to a new branch 'scalability-no-8-1000-10-1722436483'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722436483 190f1c04c6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:35:11 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:35:11 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-1000-10-1722436483 1000 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-512-1000-10
+ env
++ date
+ echo Wed Jul 31 04:36:26 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 04:36:26 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 190f1c04c6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722436586
+ git checkout -b scalability-no-512-1000-10-1722436586
Switched to a new branch 'scalability-no-512-1000-10-1722436586'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722436586 edd679888d] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:36:54 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:36:54 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-1000-10-1722436586 1000 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-128-1000-10
+ env
++ date
+ echo Wed Jul 31 04:38:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 04:38:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at edd679888d fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722436689
+ git checkout -b scalability-no-128-1000-10-1722436689
Switched to a new branch 'scalability-no-128-1000-10-1722436689'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722436689 6496f3256a] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:38:37 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:38:37 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-1000-10-1722436689 1000 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-32-1000-10
+ env
++ date
+ echo Wed Jul 31 04:39:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 04:39:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6496f3256a fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-1000-10-1722436792
+ git checkout -b scalability-yes-32-1000-10-1722436792
Switched to a new branch 'scalability-yes-32-1000-10-1722436792'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-1000-10-1722436792 d865a15a13] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-1000-10-1722436792 c2cb113c0f] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:40:20 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:40:20 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-1000-10-1722436792 1000 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-0-1000-10
+ env
++ date
+ echo Wed Jul 31 04:43:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 04:43:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c2cb113c0f fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-1000-10-1722436999
+ git checkout -b scalability-yes-0-1000-10-1722436999
Switched to a new branch 'scalability-yes-0-1000-10-1722436999'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-1000-10-1722436999 c700151a3a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:43:48 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:43:48 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-1000-10-1722436999 1000 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1-1000-10
+ env
++ date
+ echo Wed Jul 31 04:46:48 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 04:46:48 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c700151a3a NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-1000-10-1722437209
+ git checkout -b scalability-yes-1-1000-10-1722437209
Switched to a new branch 'scalability-yes-1-1000-10-1722437209'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-1000-10-1722437209 9e61a1f966] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-1000-10-1722437209 2b03baddf5] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:47:17 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:47:17 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-1000-10-1722437209 1000 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 04:50:17 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 04:50:17 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2b03baddf5 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-1000-10-1722437417
+ git checkout -b scalability-yes-1024-1000-10-1722437417
Switched to a new branch 'scalability-yes-1024-1000-10-1722437417'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-1000-10-1722437417 3c294a11d1] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-1000-10-1722437417 10a43220e6] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:50:45 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:50:45 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-1000-10-1722437417 1000 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-8-1000-10
+ env
++ date
+ echo Wed Jul 31 04:53:46 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 04:53:46 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 10a43220e6 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-1000-10-1722437626
+ git checkout -b scalability-yes-8-1000-10-1722437626
Switched to a new branch 'scalability-yes-8-1000-10-1722437626'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-1000-10-1722437626 28a13da399] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-1000-10-1722437626 8914d39f19] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:54:15 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:54:15 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-1000-10-1722437626 1000 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-512-1000-10
+ env
++ date
+ echo Wed Jul 31 04:57:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 04:57:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8914d39f19 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-1000-10-1722437836
+ git checkout -b scalability-yes-512-1000-10-1722437836
Switched to a new branch 'scalability-yes-512-1000-10-1722437836'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-1000-10-1722437836 c22d4af803] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-1000-10-1722437836 07acac88a6] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 04:57:44 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 04:57:44 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-1000-10-1722437836 1000 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-128-1000-10
+ env
++ date
+ echo Wed Jul 31 05:00:45 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 05:00:45 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 07acac88a6 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-1000-10-1722438045
+ git checkout -b scalability-yes-128-1000-10-1722438045
Switched to a new branch 'scalability-yes-128-1000-10-1722438045'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-1000-10-1722438045 f028ddb25c] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-1000-10-1722438045 035fcbe5db] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:01:14 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:01:14 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-1000-10-1722438045 1000 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-32-1000-10
+ env
++ date
+ echo Wed Jul 31 05:04:14 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 05:04:14 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 035fcbe5db fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-1000-10-1722438255
+ git checkout -b scalability-no-32-1000-10-1722438255
Switched to a new branch 'scalability-no-32-1000-10-1722438255'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-1000-10-1722438255 07968abd6d] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:04:43 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:04:43 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-1000-10-1722438255 1000 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-0-1000-10
+ env
++ date
+ echo Wed Jul 31 05:07:43 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 05:07:43 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 07968abd6d fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-1000-10-1722438463
+ git checkout -b scalability-no-0-1000-10-1722438463
Switched to a new branch 'scalability-no-0-1000-10-1722438463'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:08:11 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:08:11 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-1000-10-1722438463 1000 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1-1000-10
+ env
++ date
+ echo Wed Jul 31 05:11:12 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 05:11:12 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-1000-10-1722438672
+ git checkout -b scalability-no-1-1000-10-1722438672
Switched to a new branch 'scalability-no-1-1000-10-1722438672'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ patch -p1
+ sed s/MY_PLACEHOLDER/1/
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-1000-10-1722438672 b4461cdb07] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:11:40 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:11:40 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-1000-10-1722438672 1000 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1024-1000-10
+ env
++ date
+ echo Wed Jul 31 05:14:38 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 05:14:38 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b4461cdb07 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-1000-10-1722438879
+ git checkout -b scalability-no-1024-1000-10-1722438879
Switched to a new branch 'scalability-no-1024-1000-10-1722438879'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-1000-10-1722438879 14a8a9cc5f] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:15:07 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:15:07 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-1000-10-1722438879 1000 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-8-1000-10
+ env
++ date
+ echo Wed Jul 31 05:18:07 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 05:18:07 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 14a8a9cc5f fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-1000-10-1722439087
+ git checkout -b scalability-no-8-1000-10-1722439087
Switched to a new branch 'scalability-no-8-1000-10-1722439087'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-1000-10-1722439087 4fd2e12b8a] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:18:35 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:18:35 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-1000-10-1722439087 1000 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-512-1000-10
+ env
++ date
+ echo Wed Jul 31 05:21:36 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 05:21:36 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4fd2e12b8a fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-1000-10-1722439296
+ git checkout -b scalability-no-512-1000-10-1722439296
Switched to a new branch 'scalability-no-512-1000-10-1722439296'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-1000-10-1722439296 4313fd4db5] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:22:04 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:22:04 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-1000-10-1722439296 1000 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-1000-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-1000-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-128-1000-10
+ env
++ date
+ echo Wed Jul 31 05:25:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 05:25:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4313fd4db5 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-1000-10-1722439505
+ git checkout -b scalability-no-128-1000-10-1722439505
Switched to a new branch 'scalability-no-128-1000-10-1722439505'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-1000-10-1722439505 90f74125cb] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-1000-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:25:33 PM CEST 2024 'RUN   files: 1000  partitions: 10'
Wed Jul 31 05:25:33 PM CEST 2024 RUN   files: 1000  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-1000-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 1000'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-1000-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-1000-10-1722439505 1000 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-1000-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for files in 1000 32768
+ for p in $PARTITIONS
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-32-32768-10
+ env
++ date
+ echo Wed Jul 31 05:28:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 05:28:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 90f74125cb fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722439713
+ git checkout -b scalability-yes-32-32768-10-1722439713
Switched to a new branch 'scalability-yes-32-32768-10-1722439713'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722439713 7e13003ffe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722439713 72279f28b2] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:29:26 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:29:26 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-32-32768-10-1722439713 32768 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-0-32768-10
+ env
++ date
+ echo Wed Jul 31 05:30:41 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 05:30:41 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 72279f28b2 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722439841
+ git checkout -b scalability-yes-0-32768-10-1722439841
Switched to a new branch 'scalability-yes-0-32768-10-1722439841'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722439841 8318a28e64] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:31:34 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:31:34 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-0-32768-10-1722439841 32768 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1-32768-10
+ env
++ date
+ echo Wed Jul 31 05:32:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 05:32:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8318a28e64 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722439969
+ git checkout -b scalability-yes-1-32768-10-1722439969
Switched to a new branch 'scalability-yes-1-32768-10-1722439969'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722439969 cc3bd858bd] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722439969 ebdf167a0f] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:33:41 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:33:41 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1-32768-10-1722439969 32768 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 05:34:56 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 05:34:56 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ebdf167a0f fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722440096
+ git checkout -b scalability-yes-1024-32768-10-1722440096
Switched to a new branch 'scalability-yes-1024-32768-10-1722440096'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722440096 78845e7f2a] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722440096 a4cd7c4930] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:35:49 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:35:49 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-1024-32768-10-1722440096 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-8-32768-10
+ env
++ date
+ echo Wed Jul 31 05:37:04 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 05:37:04 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a4cd7c4930 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722440224
+ git checkout -b scalability-yes-8-32768-10-1722440224
Switched to a new branch 'scalability-yes-8-32768-10-1722440224'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722440224 3d680cf085] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722440224 b0ef235d9d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:37:57 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:37:57 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-8-32768-10-1722440224 32768 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-512-32768-10
+ env
++ date
+ echo Wed Jul 31 05:39:12 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 05:39:12 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b0ef235d9d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722440352
+ git checkout -b scalability-yes-512-32768-10-1722440352
Switched to a new branch 'scalability-yes-512-32768-10-1722440352'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722440352 bdae1573fe] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722440352 d70a332395] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:40:04 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:40:04 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-512-32768-10-1722440352 32768 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-yes-128-32768-10
+ env
++ date
+ echo Wed Jul 31 05:41:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 05:41:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at d70a332395 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722440480
+ git checkout -b scalability-yes-128-32768-10-1722440480
Switched to a new branch 'scalability-yes-128-32768-10-1722440480'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722440480 e5786268e5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722440480 cc6ba820fc] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:42:12 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:42:12 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-yes-128-32768-10-1722440480 32768 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-32-32768-10
+ env
++ date
+ echo Wed Jul 31 05:43:27 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 05:43:27 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cc6ba820fc fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722440607
+ git checkout -b scalability-no-32-32768-10-1722440607
Switched to a new branch 'scalability-no-32-32768-10-1722440607'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722440607 fdebf87404] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:44:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:44:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-32-32768-10-1722440607 32768 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-0-32768-10
+ env
++ date
+ echo Wed Jul 31 05:45:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 05:45:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fdebf87404 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722440735
+ git checkout -b scalability-no-0-32768-10-1722440735
Switched to a new branch 'scalability-no-0-32768-10-1722440735'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:46:27 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:46:27 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-0-32768-10-1722440735 32768 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1-32768-10
+ env
++ date
+ echo Wed Jul 31 05:47:42 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 05:47:42 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722440862
+ git checkout -b scalability-no-1-32768-10-1722440862
Switched to a new branch 'scalability-no-1-32768-10-1722440862'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722440862 cdb19d3f99] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:48:34 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:48:34 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1-32768-10-1722440862 32768 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 05:49:49 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 05:49:49 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at cdb19d3f99 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722440990
+ git checkout -b scalability-no-1024-32768-10-1722440990
Switched to a new branch 'scalability-no-1024-32768-10-1722440990'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722440990 19dc72cc82] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:50:42 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:50:42 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-1024-32768-10-1722440990 32768 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-8-32768-10
+ env
++ date
+ echo Wed Jul 31 05:51:57 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 05:51:57 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 19dc72cc82 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722441118
+ git checkout -b scalability-no-8-32768-10-1722441118
Switched to a new branch 'scalability-no-8-32768-10-1722441118'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722441118 c42060e71f] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:52:50 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:52:50 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-8-32768-10-1722441118 32768 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-512-32768-10
+ env
++ date
+ echo Wed Jul 31 05:54:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 05:54:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c42060e71f fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722441245
+ git checkout -b scalability-no-512-32768-10-1722441245
Switched to a new branch 'scalability-no-512-32768-10-1722441245'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722441245 6d07954bd0] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:54:57 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:54:57 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-512-32768-10-1722441245 32768 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/index-no-128-32768-10
+ env
++ date
+ echo Wed Jul 31 05:56:12 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 05:56:12 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6d07954bd0 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722441372
+ git checkout -b scalability-no-128-32768-10-1722441372
Switched to a new branch 'scalability-no-128-32768-10-1722441372'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722441372 b1130a44fe] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:57:05 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:57:05 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-index.sh xeon scalability-no-128-32768-10-1722441372 32768 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/index-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-32-32768-10
+ env
++ date
+ echo Wed Jul 31 05:58:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 05:58:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at b1130a44fe fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722441500
+ git checkout -b scalability-yes-32-32768-10-1722441500
Switched to a new branch 'scalability-yes-32-32768-10-1722441500'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722441500 18a9a4a2c0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722441500 692b363274] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 05:58:48 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 05:58:48 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-32-32768-10-1722441500 32768 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-0-32768-10
+ env
++ date
+ echo Wed Jul 31 06:00:08 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 06:00:08 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 692b363274 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722441608
+ git checkout -b scalability-yes-0-32768-10-1722441608
Switched to a new branch 'scalability-yes-0-32768-10-1722441608'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722441608 c651ec6583] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:00:36 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:00:36 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-0-32768-10-1722441608 32768 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1-32768-10
+ env
++ date
+ echo Wed Jul 31 06:01:55 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 06:01:55 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c651ec6583 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722441716
+ git checkout -b scalability-yes-1-32768-10-1722441716
Switched to a new branch 'scalability-yes-1-32768-10-1722441716'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722441716 6f1cae68f3] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722441716 a076056b73] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:02:24 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:02:24 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1-32768-10-1722441716 32768 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 06:03:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 06:03:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a076056b73 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722441823
+ git checkout -b scalability-yes-1024-32768-10-1722441823
Switched to a new branch 'scalability-yes-1024-32768-10-1722441823'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722441823 fe99eedbc5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722441823 af48f8fb05] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:04:12 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:04:12 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-1024-32768-10-1722441823 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-8-32768-10
+ env
++ date
+ echo Wed Jul 31 06:05:31 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 06:05:31 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at af48f8fb05 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722441931
+ git checkout -b scalability-yes-8-32768-10-1722441931
Switched to a new branch 'scalability-yes-8-32768-10-1722441931'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722441931 9643ca1466] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722441931 291d0ae134] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:05:59 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:05:59 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-8-32768-10-1722441931 32768 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-512-32768-10
+ env
++ date
+ echo Wed Jul 31 06:07:19 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 06:07:19 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 291d0ae134 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722442039
+ git checkout -b scalability-yes-512-32768-10-1722442039
Switched to a new branch 'scalability-yes-512-32768-10-1722442039'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722442039 e3fb941620] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722442039 3c2e375580] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:07:47 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:07:47 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-512-32768-10-1722442039 32768 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-yes-128-32768-10
+ env
++ date
+ echo Wed Jul 31 06:09:06 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 06:09:06 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 3c2e375580 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722442146
+ git checkout -b scalability-yes-128-32768-10-1722442146
Switched to a new branch 'scalability-yes-128-32768-10-1722442146'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722442146 29878fe6f0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722442146 6bb6ac917e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:09:35 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:09:35 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-yes-128-32768-10-1722442146 32768 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-32-32768-10
+ env
++ date
+ echo Wed Jul 31 06:10:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 06:10:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6bb6ac917e fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722442254
+ git checkout -b scalability-no-32-32768-10-1722442254
Switched to a new branch 'scalability-no-32-32768-10-1722442254'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722442254 a98772d1c6] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:11:22 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:11:22 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-32-32768-10-1722442254 32768 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-0-32768-10
+ env
++ date
+ echo Wed Jul 31 06:12:42 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 06:12:42 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a98772d1c6 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722442362
+ git checkout -b scalability-no-0-32768-10-1722442362
Switched to a new branch 'scalability-no-0-32768-10-1722442362'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:13:10 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:13:10 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-0-32768-10-1722442362 32768 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1-32768-10
+ env
++ date
+ echo Wed Jul 31 06:14:29 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 06:14:29 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722442469
+ git checkout -b scalability-no-1-32768-10-1722442469
Switched to a new branch 'scalability-no-1-32768-10-1722442469'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722442469 18c9fdb82e] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:14:58 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:14:58 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1-32768-10-1722442469 32768 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 06:16:17 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 06:16:17 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 18c9fdb82e fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722442577
+ git checkout -b scalability-no-1024-32768-10-1722442577
Switched to a new branch 'scalability-no-1024-32768-10-1722442577'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722442577 6e81c8bd4a] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:16:45 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:16:45 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-1024-32768-10-1722442577 32768 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-8-32768-10
+ env
++ date
+ echo Wed Jul 31 06:18:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 06:18:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6e81c8bd4a fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722442684
+ git checkout -b scalability-no-8-32768-10-1722442684
Switched to a new branch 'scalability-no-8-32768-10-1722442684'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722442684 14d0f05076] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:18:33 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:18:33 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-8-32768-10-1722442684 32768 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-512-32768-10
+ env
++ date
+ echo Wed Jul 31 06:19:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 06:19:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 14d0f05076 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722442792
+ git checkout -b scalability-no-512-32768-10-1722442792
Switched to a new branch 'scalability-no-512-32768-10-1722442792'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722442792 0daf61db91] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:20:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:20:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-512-32768-10-1722442792 32768 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/join-no-128-32768-10
+ env
++ date
+ echo Wed Jul 31 06:21:39 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 06:21:39 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0daf61db91 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722442899
+ git checkout -b scalability-no-128-32768-10-1722442899
Switched to a new branch 'scalability-no-128-32768-10-1722442899'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722442899 26396817b6] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:22:08 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:22:08 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-join.sh xeon scalability-no-128-32768-10-1722442899 32768 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/join-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-32-32768-10
+ env
++ date
+ echo Wed Jul 31 06:23:27 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 06:23:27 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 26396817b6 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722443007
+ git checkout -b scalability-yes-32-32768-10-1722443007
Switched to a new branch 'scalability-yes-32-32768-10-1722443007'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722443007 63d49807ad] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722443007 7aa83edbde] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:23:55 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:23:55 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-32-32768-10-1722443007 32768 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-0-32768-10
+ env
++ date
+ echo Wed Jul 31 06:25:09 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 06:25:09 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 7aa83edbde fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722443109
+ git checkout -b scalability-yes-0-32768-10-1722443109
Switched to a new branch 'scalability-yes-0-32768-10-1722443109'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722443109 9a7ad9c426] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:25:38 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:25:38 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-0-32768-10-1722443109 32768 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1-32768-10
+ env
++ date
+ echo Wed Jul 31 06:26:51 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 06:26:51 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 9a7ad9c426 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722443211
+ git checkout -b scalability-yes-1-32768-10-1722443211
Switched to a new branch 'scalability-yes-1-32768-10-1722443211'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722443211 d7f150b866] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722443211 a321912b1c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:27:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:27:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1-32768-10-1722443211 32768 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 06:28:33 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 06:28:33 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a321912b1c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722443314
+ git checkout -b scalability-yes-1024-32768-10-1722443314
Switched to a new branch 'scalability-yes-1024-32768-10-1722443314'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722443314 e1e8bbed35] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722443314 efbca790f9] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:29:02 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:29:02 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-1024-32768-10-1722443314 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-8-32768-10
+ env
++ date
+ echo Wed Jul 31 06:30:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 06:30:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at efbca790f9 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722443416
+ git checkout -b scalability-yes-8-32768-10-1722443416
Switched to a new branch 'scalability-yes-8-32768-10-1722443416'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722443416 c8e3d04944] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722443416 0d3e888d0d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:30:44 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:30:44 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-8-32768-10-1722443416 32768 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-512-32768-10
+ env
++ date
+ echo Wed Jul 31 06:31:57 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 06:31:57 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0d3e888d0d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722443518
+ git checkout -b scalability-yes-512-32768-10-1722443518
Switched to a new branch 'scalability-yes-512-32768-10-1722443518'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722443518 e1a8facaf6] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722443518 49ab65d997] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:32:26 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:32:26 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-512-32768-10-1722443518 32768 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-yes-128-32768-10
+ env
++ date
+ echo Wed Jul 31 06:33:40 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 06:33:40 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 49ab65d997 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722443620
+ git checkout -b scalability-yes-128-32768-10-1722443620
Switched to a new branch 'scalability-yes-128-32768-10-1722443620'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722443620 ee510bd5da] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722443620 50c41a7541] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:34:08 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:34:08 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-yes-128-32768-10-1722443620 32768 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-32-32768-10
+ env
++ date
+ echo Wed Jul 31 06:35:22 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 06:35:22 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 50c41a7541 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722443722
+ git checkout -b scalability-no-32-32768-10-1722443722
Switched to a new branch 'scalability-no-32-32768-10-1722443722'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722443722 e53c6ae5ae] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:35:50 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:35:50 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-32-32768-10-1722443722 32768 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-0-32768-10
+ env
++ date
+ echo Wed Jul 31 06:37:04 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 06:37:04 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e53c6ae5ae fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722443824
+ git checkout -b scalability-no-0-32768-10-1722443824
Switched to a new branch 'scalability-no-0-32768-10-1722443824'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:37:32 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:37:32 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-0-32768-10-1722443824 32768 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1-32768-10
+ env
++ date
+ echo Wed Jul 31 06:38:46 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 06:38:46 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722443926
+ git checkout -b scalability-no-1-32768-10-1722443926
Switched to a new branch 'scalability-no-1-32768-10-1722443926'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722443926 0f90224433] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:39:14 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:39:14 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1-32768-10-1722443926 32768 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 06:40:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 06:40:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0f90224433 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722444028
+ git checkout -b scalability-no-1024-32768-10-1722444028
Switched to a new branch 'scalability-no-1024-32768-10-1722444028'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722444028 708c6cb427] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:40:56 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:40:56 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-1024-32768-10-1722444028 32768 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-8-32768-10
+ env
++ date
+ echo Wed Jul 31 06:42:10 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 06:42:10 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 708c6cb427 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722444130
+ git checkout -b scalability-no-8-32768-10-1722444130
Switched to a new branch 'scalability-no-8-32768-10-1722444130'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722444130 4ac137f0a6] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:42:38 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:42:38 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-8-32768-10-1722444130 32768 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-512-32768-10
+ env
++ date
+ echo Wed Jul 31 06:43:52 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 06:43:52 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 4ac137f0a6 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722444232
+ git checkout -b scalability-no-512-32768-10-1722444232
Switched to a new branch 'scalability-no-512-32768-10-1722444232'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722444232 e060dbd719] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:44:21 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:44:21 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-512-32768-10-1722444232 32768 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/count-no-128-32768-10
+ env
++ date
+ echo Wed Jul 31 06:45:34 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 06:45:34 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e060dbd719 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722444335
+ git checkout -b scalability-no-128-32768-10-1722444335
Switched to a new branch 'scalability-no-128-32768-10-1722444335'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722444335 8ac3bf7333] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:46:02 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:46:02 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-count.sh xeon scalability-no-128-32768-10-1722444335 32768 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/count-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-32-32768-10
+ env
++ date
+ echo Wed Jul 31 06:47:16 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 06:47:16 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 8ac3bf7333 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722444436
+ git checkout -b scalability-yes-32-32768-10-1722444436
Switched to a new branch 'scalability-yes-32-32768-10-1722444436'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722444436 d364d098d5] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722444436 56700ffa00] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:47:45 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:47:45 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-32-32768-10-1722444436 32768 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-0-32768-10
+ env
++ date
+ echo Wed Jul 31 06:48:59 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 06:48:59 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 56700ffa00 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722444539
+ git checkout -b scalability-yes-0-32768-10-1722444539
Switched to a new branch 'scalability-yes-0-32768-10-1722444539'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722444539 325e292f57] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:49:28 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:49:28 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-0-32768-10-1722444539 32768 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1-32768-10
+ env
++ date
+ echo Wed Jul 31 06:50:42 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 06:50:42 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 325e292f57 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722444643
+ git checkout -b scalability-yes-1-32768-10-1722444643
Switched to a new branch 'scalability-yes-1-32768-10-1722444643'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722444643 edeb218684] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722444643 da44bc61ab] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:51:11 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:51:11 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1-32768-10-1722444643 32768 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 06:52:26 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 06:52:26 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at da44bc61ab fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722444746
+ git checkout -b scalability-yes-1024-32768-10-1722444746
Switched to a new branch 'scalability-yes-1024-32768-10-1722444746'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722444746 af0be2ca12] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722444746 1fcc39cd99] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:52:54 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:52:54 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-1024-32768-10-1722444746 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-8-32768-10
+ env
++ date
+ echo Wed Jul 31 06:54:09 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 06:54:09 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1fcc39cd99 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722444849
+ git checkout -b scalability-yes-8-32768-10-1722444849
Switched to a new branch 'scalability-yes-8-32768-10-1722444849'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722444849 7674e9706d] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722444849 6dcb00e414] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:54:37 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:54:37 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-8-32768-10-1722444849 32768 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-512-32768-10
+ env
++ date
+ echo Wed Jul 31 06:55:52 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 06:55:52 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6dcb00e414 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722444952
+ git checkout -b scalability-yes-512-32768-10-1722444952
Switched to a new branch 'scalability-yes-512-32768-10-1722444952'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722444952 b0a1521554] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722444952 6dc63e15e8] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:56:20 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:56:20 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-512-32768-10-1722444952 32768 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-yes-128-32768-10
+ env
++ date
+ echo Wed Jul 31 06:57:35 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 06:57:35 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6dc63e15e8 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722445055
+ git checkout -b scalability-yes-128-32768-10-1722445055
Switched to a new branch 'scalability-yes-128-32768-10-1722445055'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722445055 d8aad139c0] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722445055 628a436b37] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:58:03 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:58:03 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-yes-128-32768-10-1722445055 32768 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-32-32768-10
+ env
++ date
+ echo Wed Jul 31 06:59:18 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 06:59:18 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 628a436b37 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722445158
+ git checkout -b scalability-no-32-32768-10-1722445158
Switched to a new branch 'scalability-no-32-32768-10-1722445158'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722445158 814860b2d3] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 06:59:47 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 06:59:47 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-32-32768-10-1722445158 32768 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-0-32768-10
+ env
++ date
+ echo Wed Jul 31 07:01:01 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 07:01:01 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 814860b2d3 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722445261
+ git checkout -b scalability-no-0-32768-10-1722445261
Switched to a new branch 'scalability-no-0-32768-10-1722445261'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:01:30 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:01:30 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-0-32768-10-1722445261 32768 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1-32768-10
+ env
++ date
+ echo Wed Jul 31 07:02:44 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 07:02:44 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722445364
+ git checkout -b scalability-no-1-32768-10-1722445364
Switched to a new branch 'scalability-no-1-32768-10-1722445364'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722445364 0f641817b8] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:03:13 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:03:13 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1-32768-10-1722445364 32768 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 07:04:28 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 07:04:28 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 0f641817b8 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722445468
+ git checkout -b scalability-no-1024-32768-10-1722445468
Switched to a new branch 'scalability-no-1024-32768-10-1722445468'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722445468 c92a6860a0] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:04:56 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:04:56 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-1024-32768-10-1722445468 32768 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-8-32768-10
+ env
++ date
+ echo Wed Jul 31 07:06:11 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 07:06:11 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at c92a6860a0 fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722445571
+ git checkout -b scalability-no-8-32768-10-1722445571
Switched to a new branch 'scalability-no-8-32768-10-1722445571'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722445571 5930c88b46] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:06:39 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:06:39 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-8-32768-10-1722445571 32768 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-512-32768-10
+ env
++ date
+ echo Wed Jul 31 07:07:54 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 07:07:54 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 5930c88b46 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722445674
+ git checkout -b scalability-no-512-32768-10-1722445674
Switched to a new branch 'scalability-no-512-32768-10-1722445674'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722445674 1073146bf2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:08:22 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:08:22 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-512-32768-10-1722445674 32768 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/pgbench-no-128-32768-10
+ env
++ date
+ echo Wed Jul 31 07:09:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 07:09:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1073146bf2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722445777
+ git checkout -b scalability-no-128-32768-10-1722445777
Switched to a new branch 'scalability-no-128-32768-10-1722445777'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722445777 e1452c2d5b] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:10:06 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:10:06 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-pgbench.sh xeon scalability-no-128-32768-10-1722445777 32768 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/pgbench-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for t in index join count pgbench star
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-32-32768-10
+ env
++ date
+ echo Wed Jul 31 07:11:20 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 32'
Wed Jul 31 07:11:20 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at e1452c2d5b fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-32-32768-10-1722445880
+ git checkout -b scalability-yes-32-32768-10-1722445880
Switched to a new branch 'scalability-yes-32-32768-10-1722445880'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-32-32768-10-1722445880 860e3c133e] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-yes-32-32768-10-1722445880 08a941b820] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:11:48 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:11:48 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-32-32768-10-1722445880 32768 yes 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-0-32768-10
+ env
++ date
+ echo Wed Jul 31 07:14:49 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 0'
Wed Jul 31 07:14:49 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 08a941b820 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-0-32768-10-1722446089
+ git checkout -b scalability-yes-0-32768-10-1722446089
Switched to a new branch 'scalability-yes-0-32768-10-1722446089'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-0-32768-10-1722446089 a046552937] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:15:17 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:15:17 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-0-32768-10-1722446089 32768 yes 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1-32768-10
+ env
++ date
+ echo Wed Jul 31 07:18:17 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1'
Wed Jul 31 07:18:17 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at a046552937 NUM_LOCK_PARTITIONS
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1-32768-10-1722446297
+ git checkout -b scalability-yes-1-32768-10-1722446297
Switched to a new branch 'scalability-yes-1-32768-10-1722446297'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1-32768-10-1722446297 72e1358ff9] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-yes-1-32768-10-1722446297 1bc72c393c] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:18:45 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:18:45 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1-32768-10-1722446297 32768 yes 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 07:21:44 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 1024'
Wed Jul 31 07:21:44 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 1bc72c393c fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-1024-32768-10-1722446504
+ git checkout -b scalability-yes-1024-32768-10-1722446504
Switched to a new branch 'scalability-yes-1024-32768-10-1722446504'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-1024-32768-10-1722446504 6761eab7eb] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-yes-1024-32768-10-1722446504 2f51fa6b8d] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:22:13 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:22:13 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-1024-32768-10-1722446504 32768 yes 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-8-32768-10
+ env
++ date
+ echo Wed Jul 31 07:25:14 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 8'
Wed Jul 31 07:25:14 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 2f51fa6b8d fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-8-32768-10-1722446714
+ git checkout -b scalability-yes-8-32768-10-1722446714
Switched to a new branch 'scalability-yes-8-32768-10-1722446714'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-8-32768-10-1722446714 35e1fde4d2] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-yes-8-32768-10-1722446714 6987cb035d] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:25:42 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:25:42 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-8-32768-10-1722446714 32768 yes 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-512-32768-10
+ env
++ date
+ echo Wed Jul 31 07:28:43 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 512'
Wed Jul 31 07:28:43 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 6987cb035d fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-512-32768-10-1722446923
+ git checkout -b scalability-yes-512-32768-10-1722446923
Switched to a new branch 'scalability-yes-512-32768-10-1722446923'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-512-32768-10-1722446923 8773809517] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-yes-512-32768-10-1722446923 fa5fcd7e53] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:29:11 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:29:11 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-512-32768-10-1722446923 32768 yes 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-yes-128-32768-10
+ env
++ date
+ echo Wed Jul 31 07:32:13 PM CEST 2024 'BUILD lock partitions: yes  fastpath groups: 128'
Wed Jul 31 07:32:13 PM CEST 2024 BUILD lock partitions: yes  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fa5fcd7e53 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-yes-128-32768-10-1722447133
+ git checkout -b scalability-yes-128-32768-10-1722447133
Switched to a new branch 'scalability-yes-128-32768-10-1722447133'
+ '[' yes == yes ']'
+ cat /home/tomas/lock-scalability-test/patches/0001-Increase-NUM_LOCK_PARTITIONS-to-64.patch
+ patch -p1
patching file src/include/storage/lwlock.h
+ git commit src -m NUM_LOCK_PARTITIONS
[scalability-yes-128-32768-10-1722447133 17f9512134] NUM_LOCK_PARTITIONS
 1 file changed, 1 insertion(+), 1 deletion(-)
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-yes-128-32768-10-1722447133 046de40bf5] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/yes-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:32:41 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:32:41 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/yes-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-yes-128-32768-10-1722447133 32768 yes 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-yes-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for partitions in yes no
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-32-32768-10
+ env
++ date
+ echo Wed Jul 31 07:35:41 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 32'
Wed Jul 31 07:35:41 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 32
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 046de40bf5 fastpath lock groups 128
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-32-32768-10-1722447342
+ git checkout -b scalability-no-32-32768-10-1722447342
Switched to a new branch 'scalability-no-32-32768-10-1722447342'
+ '[' no == yes ']'
+ '[' 32 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/32/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 32'
[scalability-no-32-32768-10-1722447342 44766ac450] fastpath lock groups 32
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-32-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:36:09 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:36:09 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-32-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-32-32768-10-1722447342 32768 no 32 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-32-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-0-32768-10
+ env
++ date
+ echo Wed Jul 31 07:39:09 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 0'
Wed Jul 31 07:39:09 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 0
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 44766ac450 fastpath lock groups 32
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-0-32768-10-1722447549
+ git checkout -b scalability-no-0-32768-10-1722447549
Switched to a new branch 'scalability-no-0-32768-10-1722447549'
+ '[' no == yes ']'
+ '[' 0 '!=' 0 ']'
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-0-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:39:38 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:39:38 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-0-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-0-32768-10-1722447549 32768 no 0 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-0-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1-32768-10
+ env
++ date
+ echo Wed Jul 31 07:42:37 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1'
Wed Jul 31 07:42:37 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 05faf06e9c pg_createsubscriber: Message improvements
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1-32768-10-1722447757
+ git checkout -b scalability-no-1-32768-10-1722447757
Switched to a new branch 'scalability-no-1-32768-10-1722447757'
+ '[' no == yes ']'
+ '[' 1 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1'
[scalability-no-1-32768-10-1722447757 963880c397] fastpath lock groups 1
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
lock.c: In function ‘LockAcquireExtended’:
lock.c:926:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
  926 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘LockRelease’:
lock.c:2081:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2081 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGrantRelationLock’:
lock.c:2669:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2669 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathUnGrantRelationLock’:
lock.c:2721:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2721 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘FastPathGetRelationLockEntry’:
lock.c:2866:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2866 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
lock.c: In function ‘GetLockConflicts’:
lock.c:2989:17: warning: ‘memset’ used with length equal to number of elements without multiplication by element size [-Wmemset-elt-size]
 2989 |                 memset(FastPathLocalUseCounts, 0, sizeof(FastPathLocalUseInitialized));
      |                 ^~~~~~
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:43:06 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:43:06 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1-32768-10-1722447757 32768 no 1 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-1024-32768-10
+ env
++ date
+ echo Wed Jul 31 07:46:05 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 1024'
Wed Jul 31 07:46:05 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 1024
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 963880c397 fastpath lock groups 1
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-1024-32768-10-1722447966
+ git checkout -b scalability-no-1024-32768-10-1722447966
Switched to a new branch 'scalability-no-1024-32768-10-1722447966'
+ '[' no == yes ']'
+ '[' 1024 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/1024/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 1024'
[scalability-no-1024-32768-10-1722447966 902c371d2c] fastpath lock groups 1024
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-1024-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:46:34 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:46:34 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-1024-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-1024-32768-10-1722447966 32768 no 1024 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-1024-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-8-32768-10
+ env
++ date
+ echo Wed Jul 31 07:49:35 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 8'
Wed Jul 31 07:49:35 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 8
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at 902c371d2c fastpath lock groups 1024
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-8-32768-10-1722448175
+ git checkout -b scalability-no-8-32768-10-1722448175
Switched to a new branch 'scalability-no-8-32768-10-1722448175'
+ '[' no == yes ']'
+ '[' 8 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/8/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 8'
[scalability-no-8-32768-10-1722448175 ada6cb63c7] fastpath lock groups 8
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-8-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:50:04 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:50:04 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-8-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-8-32768-10-1722448175 32768 no 8 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-8-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-512-32768-10
+ env
++ date
+ echo Wed Jul 31 07:53:03 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 512'
Wed Jul 31 07:53:03 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 512
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at ada6cb63c7 fastpath lock groups 8
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-512-32768-10-1722448383
+ git checkout -b scalability-no-512-32768-10-1722448383
Switched to a new branch 'scalability-no-512-32768-10-1722448383'
+ '[' no == yes ']'
+ '[' 512 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/512/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 512'
[scalability-no-512-32768-10-1722448383 fb108695d2] fastpath lock groups 512
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-512-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:53:31 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:53:31 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-512-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-512-32768-10-1722448383 32768 no 512 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-512-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
+ for groups in 32 0 1 1024 8 512 128
+ LOGDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-32768-10
+ RESULTDIR=/home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-32768-10
+ mkdir -p /home/tomas/lock-scalability-test/20240731-1457-glibc-default/results/star-no-128-32768-10
+ env
++ date
+ echo Wed Jul 31 07:56:32 PM CEST 2024 'BUILD lock partitions: no  fastpath groups: 128'
Wed Jul 31 07:56:32 PM CEST 2024 BUILD lock partitions: no  fastpath groups: 128
+ pushd /mnt/data/postgres
/mnt/data/postgres ~/lock-scalability-test
+ git reset --hard
HEAD is now at fb108695d2 fastpath lock groups 512
+ git checkout master
Switched to branch 'master'
Your branch is up to date with 'origin/master'.
+ git clean -f -d -x
++ date +%s
+ BRANCH=scalability-no-128-32768-10-1722448592
+ git checkout -b scalability-no-128-32768-10-1722448592
Switched to a new branch 'scalability-no-128-32768-10-1722448592'
+ '[' no == yes ']'
+ '[' 128 '!=' 0 ']'
+ cat /home/tomas/lock-scalability-test/patches/0002-Increase-the-number-of-fastpath-locks.patch
+ sed s/MY_PLACEHOLDER/128/
+ patch -p1
patching file src/backend/storage/lmgr/lock.c
patching file src/include/storage/proc.h
+ git commit src -m 'fastpath lock groups 128'
[scalability-no-128-32768-10-1722448592 39ace4b14e] fastpath lock groups 128
 2 files changed, 116 insertions(+), 27 deletions(-)
+ git log
+ head -n 1000
+ CC='ccache gcc'
+ ./configure --prefix=/mnt/data/builds/no-128-32768-10 --enable-debug --enable-depend
+ make -s clean
+ make -s -j4 install
+ cd contrib
+ make -s clean
+ make -s -j4 install
+ cd ..
+ popd
~/lock-scalability-test
++ date
+ echo Wed Jul 31 07:57:00 PM CEST 2024 'RUN   files: 32768  partitions: 10'
Wed Jul 31 07:57:00 PM CEST 2024 RUN   files: 32768  partitions: 10
+ ulimit -a
+ export PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/mnt/data/builds/no-128-32768-10/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ pg_config
+ killall -9 postgres
postgres: no process found
+ true
+ sleep 1
+ rm -Rf /mnt/pgdata/data-test
+ pg_ctl -D /mnt/pgdata/data-test init
+ echo 'max_connections = 1000'
+ echo 'shared_buffers = 2GB'
+ echo 'max_locks_per_transaction = 8192'
+ echo 'max_parallel_workers_per_gather = 0'
+ echo 'random_page_cost = 1.5'
+ echo 'max_files_per_process = 32768'
+ pg_ctl -D /mnt/pgdata/data-test -l /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-32768-10/pg.log start
+ psql postgres -c 'select * from pg_settings'
+ ./run-star.sh xeon scalability-no-128-32768-10-1722448592 32768 no 128 /home/tomas/lock-scalability-test/20240731-1457-glibc-default/logs/star-no-128-32768-10 1 10 '1 16 32' 10
+ pg_ctl -D /mnt/pgdata/data-test stop
